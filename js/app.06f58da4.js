(function(e){function t(t){for(var r,n,o=t[0],c=t[1],l=t[2],d=0,h=[];d<o.length;d++)n=o[d],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&h.push(s[n][0]),s[n]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(h.length)h.shift()();return i.push.apply(i,l||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],r=!0,n=1;n<a.length;n++){var c=a[n];0!==s[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=a[0]))}return e}var r={},s={0:0},i=[];function n(e){return o.p+"js/"+({}[e]||e)+"."+{2:"97da1bd5"}[e]+".js"}function o(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.e=function(e){var t=[],a=s[e];if(0!==a)if(a)t.push(a[2]);else{var r=new Promise((function(t,r){a=s[e]=[t,r]}));t.push(a[2]=r);var i,c=document.createElement("script");c.charset="utf-8",c.timeout=120,o.nc&&c.setAttribute("nonce",o.nc),c.src=n(e);var l=new Error;i=function(t){c.onerror=c.onload=null,clearTimeout(d);var a=s[e];if(0!==a){if(a){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+i+")",l.name="ChunkLoadError",l.type=r,l.request=i,a[1](l)}s[e]=void 0}};var d=setTimeout((function(){i({type:"timeout",target:c})}),12e4);c.onerror=c.onload=i,document.head.appendChild(c)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(a,r,function(t){return e[t]}.bind(null,r));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var d=0;d<c.length;d++)t(c[d]);var u=l;i.push([0,1]),a()})({0:function(e,t,a){e.exports=a("2f39")},1:function(e,t){},1195:function(e,t){e.exports="data:image/png;base64,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"},2:function(e,t){},"2f39":function(e,t,a){"use strict";a.r(t);a("e6cf"),a("5319"),a("7d6e"),a("e54f"),a("62f2"),a("7e6d");var r=a("2b0e"),s=a("bf69"),i=a("42d2"),n=a("b05d"),o=a("2a19"),c=a("1b3f"),l=a("b12a"),d=a("436b"),u=a("5dab");r["a"].use(n["a"],{config:{notify:{position:"top",timeout:5e3,textColor:"white",actions:[{icon:"close",color:"white"}]},loadingBar:{color:"secondary"}},lang:s["a"],iconSet:i["a"],plugins:{Notify:o["a"],LoadingBar:c["a"],AppFullscreen:l["a"],Dialog:d["a"],AppVisibility:u["a"]}});var h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"q-app"}},[a("router-view")],1)},p=[];const f=new r["a"];var m={name:"App",computed:{currentUser(){return this.$store.getters.currentUser}},created(){this.$q.iconMapFn=e=>{if(!0===e.startsWith("if:")){const t=e.substring(3);return{cls:"iconfont "+t}}},f.$on("logout",this.handleLogout),this.$root.$on("logout",this.handleLogout),this.currentUser},watch:{"$q.appVisible"(e){console.log(e?"App became visible":"App went in the background")}},mounted(){this.setDocumentVh(),window.addEventListener("resize",this.setDocumentVh)},methods:{setDocumentVh(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)},handleLogout(){this.$store.commit("SET_CURRENT_USER",null)}}},g=m,v=a("2877"),y=Object(v["a"])(g,h,p,!1,null,null,null),b=y.exports,w=a("2f62"),C=a("0e44");const _="CHANGE_CANVAS_COLOR",k="CHANGE_CANVAS_OPACITY",L="CHANGE_CANVAS_BG_COLOR",A="CHANGE_CANVAS_LINE_WIDTH",E="CHANGE_CANVAS_LAYER",S="CHANGE_CANVAS_VIEW_SIZE",R="CHANGE_CANVAS_SHAPE_TYPE",T="CHANGE_CURRENT_FRAME",q="SET_CANVAS_OBJS",P="ADD_CANVAS_OBJ",x="SET_AUDIO_TRACK",O="SET_STAGE_OBJS",$="SET_STAGE_BG_COLOR",N="SET_PLAYER_SIZE",B="SET_CURRENT_TS",I="SET_CURRENT_DUR",F="SET_RECORD_PAUSE",U="SET_CONVERT_PROGRESS",D="SET_REPLY_URL",M="INSERT_FRAME_BY_IMAGES",Q="INSERT_FRAME_BY_IMAGE",j="REMOVE_FRAME_BY_NUM",V="SET_CURRENT_USER",W="SET_PREFERENCE",H="SET_BUILD_VERSION",z="SET_VIDEO_INFO";a("c975"),a("ace4"),a("5cc6");function G(e,t){let a,r,s;return a=(new Date).getTime()+e,r=null,s=function(){return a+=e,r=setTimeout(s,a-(new Date).getTime()),t()},r=setTimeout(s,a-(new Date).getTime()),{cancel:()=>clearTimeout(r)}}function Y(e,t){const a=e.replace("#",""),r=parseInt(a.substring(0,2),16),s=parseInt(a.substring(2,4),16),i=parseInt(a.substring(4,6),16);return"rgba("+r+","+s+","+i+","+t/100+")"}function Z(e){let t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);const a=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length);let s=0;while(s<t.length)r[s]=t.charCodeAt(s),s++;return new Blob([r],{type:a})}function K(e,t){const a=document.createElement("a");a.setAttribute("download",e),a.setAttribute("href",t),a.click()}const X={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,a,r,s,i,n,o,c="",l=0;e=this._utf8_encode(e);while(l<e.length)t=e.charCodeAt(l++),a=e.charCodeAt(l++),r=e.charCodeAt(l++),s=t>>2,i=(3&t)<<4|a>>4,n=(15&a)<<2|r>>6,o=63&r,isNaN(a)?n=o=64:isNaN(r)&&(o=64),c=c+this._keyStr.charAt(s)+this._keyStr.charAt(i)+this._keyStr.charAt(n)+this._keyStr.charAt(o);return c},decode:function(e){var t,a,r,s,i,n,o,c="",l=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<e.length)s=this._keyStr.indexOf(e.charAt(l++)),i=this._keyStr.indexOf(e.charAt(l++)),n=this._keyStr.indexOf(e.charAt(l++)),o=this._keyStr.indexOf(e.charAt(l++)),t=s<<2|i>>4,a=(15&i)<<4|n>>2,r=(3&n)<<6|o,c+=String.fromCharCode(t),64!=n&&(c+=String.fromCharCode(a)),64!=o&&(c+=String.fromCharCode(r));return c=this._utf8_decode(c),c},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",a=0;a<e.length;a++){var r=e.charCodeAt(a);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){var t,a,r,s="",i=0;t=a=0;while(i<e.length)t=e.charCodeAt(i),t<128?(s+=String.fromCharCode(t),i++):t>191&&t<224?(a=e.charCodeAt(i+1),s+=String.fromCharCode((31&t)<<6|63&a),i+=2):(a=e.charCodeAt(i+1),r=e.charCodeAt(i+2),s+=String.fromCharCode((15&t)<<12|(63&a)<<6|63&r),i+=3);return s}},J={color:"#1d1d1d",colorIndex:3,lineWidth:2,bgColor:"#fff",layerType:"C",shapeType:"L",isOpacity:!1,viewSize:[900,506]},ee={currentBgColor:e=>e.bgColor,isOpacity:e=>e.isOpacity,currentColor:e=>e.isOpacity?Y(e.color,50):e.color,currentLineWidth:e=>e.lineWidth,currentLayerType:e=>e.layerType,colorIndex:e=>e.colorIndex,currentShapeType:e=>e.shapeType,viewSize:e=>{let t=window.screen.availWidth;const a=window.screen.availHeight;if(Math.min(t,a)<450){t>560&&(t=560);const e=t<a?4/3:3/4,r=parseInt(e*t,10);return[t,r]}return e.viewSize}},te={[L](e,t){e.bgColor=t},[_](e,{color:t,idx:a}){e.color=t,e.colorIndex=a+1},[A](e,t){e.lineWidth=t},[E](e,t){e.layerType=t},[R](e,t){e.shapeType=t},[k](e,t){e.isOpacity=t},[S](e,t){e.viewSize=t}};var ae={state:J,getters:ee,mutations:te};const re={canvasObjs:[],audioTrack:{url:null,blob:null},stages:[],stageBgColor:"#fff",playerSize:[],currentTs:0,currentDur:0,recordPaused:!1,convertProgress:"",replyUrl:null},se={canvasObjs:e=>e.canvasObjs,duration:e=>{const t=e.canvasObjs.find((e=>"End"===e.ac));return t?t.ts:0},audioTrack:e=>e.audioTrack,stages:e=>e.stages,stageBgColor:e=>e.stageBgColor,playerSize:e=>e.playerSize,currentTs:e=>e.currentTs,currentDur:e=>e.currentDur,recordPaused:e=>e.recordPaused,convertProgress:e=>e.convertProgress,replyUrl:e=>e.replyUrl},ie={[q](e,t){e.canvasObjs=t},[P](e,t){e.canvasObjs.push(t)},[x](e,t){e.audioTrack=t},[O](e,t){e.stages=t},[$](e,t){e.stageBgColor=t},[N](e,t){e.playerSize=t},[B](e,t){e.currentTs=t},[I](e,t){e.currentDur=t},[F](e,t){e.recordPaused=t},[U](e,t){e.convertProgress=t},[D](e,t){e.replyUrl=t}};var ne={state:re,getters:se,mutations:ie},oe=(a("a434"),a("8dee")),ce=a.n(oe);const le={frameNo:1,frameList:[{id:ce.a.generate()}]},de={currentFrame:e=>e.frameNo,frameList:e=>e.frameList,currentFid:e=>e.frameList[e.frameNo-1].id},ue={[T](e,t){t>0&&(e.frameNo=t),t>e.frameList.length&&e.frameList.push({id:ce.a.generate()})},[Q](e,t){e.frameList.splice(e.frameNo,0,{id:ce.a.generate(),bg:t}),e.frameNo+=1},[M](e,t){const a=e.frameList.length;t.forEach((t=>{e.frameList.push({id:ce.a.generate(),bg:t})})),t.length>0&&(e.frameNo=a+1)},[j](e,t){e.frameList.splice(t-1,1)}};var he={state:le,getters:de,mutations:ue};const pe={currentUser:null,buildVersion:null,preferences:{tolerance:4,lang:navigator.language.match(/zh/)?"zh":"en"}},fe={currentUser:e=>e.currentUser,preferences:e=>e.preferences},me={[V](e,t){e.currentUser=t},[W](e,t){e.preferences=Object.assign({},e.preferences,t)},[H](e,t){e.buildVersion=t}};var ge={state:pe,getters:fe,mutations:me};const ve={videoInfo:null},ye={videoInfo:e=>e.videoInfo},be={[z](e,t){e.videoInfo=t}};var we={state:ve,getters:ye,mutations:be};r["a"].use(w["a"]);const Ce=Object(C["a"])({paths:["user"]});var _e=function(){const e=new w["a"].Store({plugins:[Ce],modules:{canvas:ae,record:ne,frame:he,user:ge,video:we},strict:!1});return e},ke=a("8c4f"),Le=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-layout",{attrs:{view:"hHh Lpr lFf"}},[a("q-header",["editor"===e.currentRoute?a("editor-header"):"video"===e.currentRoute?a("player-header"):"videoconvert"===e.currentRoute?a("convert-header"):a("common-header",{attrs:{showUploadBtn:"preview"===e.currentRoute}})],1),a("q-page-container",[a("router-view")],1),a("q-dialog",{model:{value:e.openDrawPref,callback:function(t){e.openDrawPref=t},expression:"openDrawPref"}},[a("draw-preference")],1),a("q-dialog",{model:{value:e.openColorPicker,callback:function(t){e.openColorPicker=t},expression:"openColorPicker"}},[a("color-picker")],1),a("q-dialog",{model:{value:e.openLineWidth,callback:function(t){e.openLineWidth=t},expression:"openLineWidth"}},[a("line-width")],1),a("q-dialog",{model:{value:e.openLogin,callback:function(t){e.openLogin=t},expression:"openLogin"}},[a("login-form",{on:{logined:function(t){e.openLogin=!1}}})],1)],1)},Ae=[],Ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-toolbar",[a("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"if:icon17up","aria-label":"Home",to:"/"}}),a("q-btn",{staticClass:"frame-nav-disp",attrs:{flat:"",dense:"",ripple:!1}},[e._v(e._s(e.frameNavDisplay))]),a("q-btn",{attrs:{dense:"",flat:"",icon:"delete_forever"},on:{click:e.triggerRemoveFrame}},[a("q-tooltip",[e._v(e._s(e.$t("editor.deleteCurFrame")))])],1),a("q-space"),a("q-btn",{staticClass:"record-btn",class:{recording:e.currentTs},attrs:{flat:"",icon:"fiber_manual_record",label:e.currentTs?e.currentTsDisplay:e.$t("editor.recordStart")},on:{click:e.startRecord}}),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.currentTs,expression:"currentTs"}],attrs:{dense:"",flat:"",icon:e.recordPaused?"play_arrow":"pause"},on:{click:e.pauseRecord}}),a("q-btn",{attrs:{dense:"",round:"",flat:""}},[a("q-icon",{attrs:{name:"if:icondot"}}),a("q-menu",[a("q-list",{staticStyle:{"min-width":"100px"}},[a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{to:"/mywork",clickable:""}},[a("q-item-section",[e._v(e._s(e.$t("editor.mywork")))])],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.triggerShowPref}},[a("q-item-section",[e._v(e._s(e.$t("editor.preference")))])],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$q.fullscreen.toggle()}}},[a("q-item-section",[e._v(e._s(e.$q.fullscreen.isActive?"退出全屏":"全屏显示"))])],1)],1)],1)],1)],1)},Se=[],Re=a("bd4c");const{formatDate:Te}=Re["b"];var qe={name:"EditorHeader",components:{},data(){return{}},computed:{currentTs(){return this.$store.getters.currentTs},currentDur(){return this.$store.getters.currentDur},recordPaused(){return this.$store.getters.recordPaused},currentTsDisplay(){return Te(this.currentDur,"mm:ss")},currentFrame(){return this.$store.getters.currentFrame},frameList(){return this.$store.getters.frameList},frameNavDisplay(){return this.$t("editor.frameNo",{cur:this.currentFrame,len:this.frameList.length})}},methods:{triggerShowPref(){f.$emit("open:drawPref")},startRecord(){f.$emit("toggle:startRecord")},pauseRecord(){f.$emit("toggle:pauseRecord")},triggerRemoveFrame(){f.$emit("remove:frame")}}},Pe=qe,xe=a("65c6"),Oe=a("9c40"),$e=a("05c0"),Ne=a("2c91"),Be=a("0016"),Ie=a("4e73"),Fe=a("1c1c"),Ue=a("66e5"),De=a("4074"),Me=a("7f67"),Qe=a("eebe"),je=a.n(Qe),Ve=Object(v["a"])(Pe,Ee,Se,!1,null,null,null),We=Ve.exports;je()(Ve,"components",{QToolbar:xe["a"],QBtn:Oe["a"],QTooltip:$e["a"],QSpace:Ne["a"],QIcon:Be["a"],QMenu:Ie["a"],QList:Fe["a"],QItem:Ue["a"],QItemSection:De["a"]}),je()(Ve,"directives",{ClosePopup:Me["a"]});var He=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-toolbar",[r("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"arrow_back",to:"/"}}),r("q-toolbar-title",[e._v("\n    "+e._s(e.title)+"\n  ")]),r("q-space"),e.audioTrack&&e.audioTrack.blob?r("q-btn",{attrs:{flat:"",primary:"",icon:"cloud_upload",label:e.$t("preview.upload")},on:{click:e.openUploadDialog}}):e._e(),e.currentUser?r("span",{staticClass:"q-mr-md md"},[e._v(e._s(e.currentUser.nickname))]):e._e(),e.currentUser?r("q-btn",{attrs:{flat:"",round:""}},[r("q-avatar",[e.currentUser.avatar?r("img",{attrs:{src:e.currentUser.avatar}}):r("img",{attrs:{src:a("1195")}})]),r("q-menu",[r("q-list",{staticStyle:{"min-width":"100px"}},[r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.handleLogout}},[r("q-item-section",[e._v("\n            "+e._s(e.$t("mywork.changeAccount"))+"\n          ")])],1)],1)],1)],1):e._e(),e.currentUser?e._e():r("q-btn",{attrs:{flat:"",primary:""},on:{click:e.requireLogin}},[e._v("\n    "+e._s(e.$t("mywork.login"))+"\n  ")])],1)},ze=[],Ge={name:"CommonHeader",props:["showUploadBtn"],data(){return{}},computed:{audioTrack(){return this.$store.getters.audioTrack},currentUser(){return this.$store.getters.currentUser},title(){return this.$t(`${this.$route.name}.title`)}},methods:{requireLogin(){f.$emit("requireLogin")},handleLogout(){this.$store.commit("SET_CURRENT_USER",null)},openUploadDialog(){this.currentUser?f.$emit("open:uploader"):this.requireLogin()}}},Ye=Ge,Ze=a("6ac5"),Ke=a("cb32"),Xe=Object(v["a"])(Ye,He,ze,!1,null,null,null),Je=Xe.exports;je()(Xe,"components",{QToolbar:xe["a"],QBtn:Oe["a"],QToolbarTitle:Ze["a"],QSpace:Ne["a"],QAvatar:Ke["a"],QMenu:Ie["a"],QList:Fe["a"],QItem:Ue["a"],QItemSection:De["a"]}),je()(Xe,"directives",{ClosePopup:Me["a"]});var et=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-toolbar",[r("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"if:icon17up"}}),e.info?r("q-toolbar-title",[e._v("\n    "+e._s(e.info.t)+"\n  ")]):e._e(),r("q-space"),e.info?r("div",{staticClass:"q-mr-md"},[r("span",{staticClass:"q-mr-md"},[e._v(e._s(e.info.created_by.nickname))]),r("q-avatar",[e.info.created_by.avatar?r("img",{attrs:{src:e.info.created_by.avatar}}):r("img",{attrs:{src:a("1195")}})])],1):e._e(),e.info?r("q-btn",{attrs:{flat:"",round:"",icon:"more_vert"}},[r("q-menu",[r("q-list",{staticStyle:{"min-width":"100px"}},[e.canConvert?r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",to:"/vdc/"+e.info.id}},[r("q-item-section",[e._v("\n            本地导出\n          ")])],1):e._e(),r("q-separator"),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.requestFullscreen}},[r("q-item-section",[e._v("\n            全屏播放\n          ")])],1),e.isAuthor?r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.removeVideo}},[r("q-item-section",{staticClass:"text-red"},[e._v("\n            删除\n          ")])],1):e._e(),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",to:"/"}},[r("q-item-section",[e._v("\n            去创作\n          ")])],1)],1)],1)],1):e._e()],1)},tt=[],at={name:"PlayerHeader",data(){return{}},computed:{currentUser(){return this.$store.getters.currentUser},info(){return this.$store.getters.videoInfo},isAuthor(){return this.currentUser&&this.currentUser.id===this.info.created_by.id},canConvert(){if(this.info){const e=this.info.cd.canvas.filter((e=>"TX"===e.ac));return 0===e.length}return!1}},methods:{requestFullscreen(e){f.$emit("video:fullscreen")},removeVideo(){f.$emit("video:remove")},localExport(){f.$emit("video:export")}}},rt=at,st=a("eb85"),it=Object(v["a"])(rt,et,tt,!1,null,null,null),nt=it.exports;je()(it,"components",{QToolbar:xe["a"],QBtn:Oe["a"],QToolbarTitle:Ze["a"],QSpace:Ne["a"],QAvatar:Ke["a"],QMenu:Ie["a"],QList:Fe["a"],QItem:Ue["a"],QItemSection:De["a"],QSeparator:st["a"]}),je()(it,"directives",{ClosePopup:Me["a"]});var ot=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-toolbar",[a("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"arrow_back"},on:{click:function(t){return e.$router.back(-1)}}}),e.info?a("q-toolbar-title",[e._v("\n    "+e._s(e.info.t)+"\n  ")]):e._e(),a("q-space"),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.progress,expression:"progress"}],attrs:{flat:""}},[e._v("\n    "+e._s(e.progress)+"\n  ")]),a("q-btn",{attrs:{flat:""},on:{click:function(t){return e.triggerEvent("scaleHalf")}}},[e._v("\n    缩略\n  ")]),a("q-btn",{attrs:{flat:""},on:{click:function(t){return e.triggerEvent("fitHeight")}}},[e._v("\n    高度优先\n  ")]),a("q-btn",{attrs:{flat:""},on:{click:function(t){return e.triggerEvent("crop")}}},[e._v("\n    裁剪留白\n  ")]),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.replyUrl,expression:"replyUrl"}],attrs:{flat:"",icon:"save_alt",label:"保存到本地"},on:{click:function(t){return e.triggerEvent("download")}}})],1)},ct=[],lt={name:"PlayerHeader",data(){return{}},computed:{info(){return this.$store.getters.videoInfo},progress(){return this.$store.getters.convertProgress},replyUrl(){return this.$store.getters.replyUrl}},methods:{triggerEvent(e){f.$emit("vdc:"+e)}}},dt=lt,ut=Object(v["a"])(dt,ot,ct,!1,null,null,null),ht=ut.exports;je()(ut,"components",{QToolbar:xe["a"],QBtn:Oe["a"],QToolbarTitle:Ze["a"],QSpace:Ne["a"]});var pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-card",{staticClass:"dialog-width-sm"},[a("q-card-section",{staticClass:"row items-center q-pb-none"},[a("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("editor.preference")))]),a("q-space"),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),a("q-card-section",[a("q-list",{attrs:{separator:""}},[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[a("q-item-section",[a("q-item-label",[e._v(e._s(e.$t("editor.blackboardMode"))+" "),a("small",{staticClass:"second"},[e._v(e._s(e.$t("editor.blackboardModeSub")))])])],1),a("q-item-section",{attrs:{side:""}},[a("q-toggle",{attrs:{color:"blue",val:!1},model:{value:e.blackboard,callback:function(t){e.blackboard=t},expression:"blackboard"}})],1)],1),a("q-item",{attrs:{tag:"label"}},[a("q-item-section",{attrs:{side:""}},[e._v("\n          "+e._s(e.$t("editor.pencilT"))+" "+e._s(e.tolerance)+" "),a("small",{staticClass:"second"},[e._v(e._s(e.$t("editor.pencilTSub")))])]),a("q-item-section",[a("q-slider",{attrs:{max:8,step:1,min:1,label:"",color:"teal"},model:{value:e.tolerance,callback:function(t){e.tolerance=t},expression:"tolerance"}})],1)],1),a("q-item",[a("q-item-section",[a("q-item-label",[e._v(e._s(e.$t("editor.langPref")))])],1),a("q-item-section",{attrs:{side:""}},[a("q-select",{attrs:{filled:"",options:e.langList,"option-value":"value","option-label":"label",dense:!0,"options-dense":!0},model:{value:e.lang,callback:function(t){e.lang=t},expression:"lang"}})],1)],1)],1)],1)],1)},ft=[],mt={name:"DrawPreference",components:{},data(){return{langList:[{label:"中文",value:"zh"},{label:"English",value:"en"}]}},computed:{currentBgColor(){return this.$store.getters.currentBgColor},blackboard:{get(){return"#fff"!==this.currentBgColor},set(e){this.$store.commit("CHANGE_CANVAS_BG_COLOR",e?"#2C3E50":"#fff")}},tolerance:{get(){return this.$store.getters.preferences.tolerance},set(e){this.$store.commit("SET_PREFERENCE",{tolerance:e})}},lang:{get(){return this.$store.getters.preferences.lang},set(e){this.$store.commit("SET_PREFERENCE",{lang:e})}}}},gt=mt,vt=a("f09f"),yt=a("a370"),bt=a("0170"),wt=a("9564"),Ct=a("c1d0"),_t=a("ddd8"),kt=a("714f"),Lt=Object(v["a"])(gt,pt,ft,!1,null,null,null),At=Lt.exports;je()(Lt,"components",{QCard:vt["a"],QCardSection:yt["a"],QSpace:Ne["a"],QBtn:Oe["a"],QList:Fe["a"],QItem:Ue["a"],QItemSection:De["a"],QItemLabel:bt["a"],QToggle:wt["a"],QSlider:Ct["a"],QSelect:_t["a"]}),je()(Lt,"directives",{ClosePopup:Me["a"],Ripple:kt["a"]});var Et=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-card",{staticClass:"dialog-width-sm"},[a("q-card-section",{staticClass:"row items-center q-pb-none"},[a("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("ctrlBar.penColor")))]),a("q-space"),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),a("q-card-section",[a("q-color",{staticClass:"my-picker",attrs:{"default-view":"palette",palette:e.colorList,"no-footer":"",flat:""},model:{value:e.color,callback:function(t){e.color=t},expression:"color"}})],1),a("q-card-section",[a("q-list",{attrs:{separator:""}},[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[a("q-item-section",[a("q-item-label",[e._v(e._s(e.$t("ctrlBar.opacity")))])],1),a("q-item-section",{attrs:{side:""}},[a("q-toggle",{attrs:{color:"blue",val:!1},model:{value:e.isOpacity,callback:function(t){e.isOpacity=t},expression:"isOpacity"}})],1)],1)],1)],1)],1)},St=[],Rt={name:"ColorPicker",components:{},data(){return{colorList:["#e74000","#0088ff","#1d1d1d","#ffff00","#ff9e9d","#5cb85c","#5e405f","#f5f5f5"]}},computed:{color:{get(){return this.$store.getters.currentColor},set(e){console.log(e);const t=this.colorList.indexOf(e);this.$store.commit("CHANGE_CANVAS_COLOR",{color:e,idx:t})}},isOpacity:{get(){return this.$store.getters.isOpacity},set(e){this.$store.commit("CHANGE_CANVAS_OPACITY",e)}}}},Tt=Rt,qt=a("b498"),Pt=Object(v["a"])(Tt,Et,St,!1,null,null,null),xt=Pt.exports;je()(Pt,"components",{QCard:vt["a"],QCardSection:yt["a"],QSpace:Ne["a"],QBtn:Oe["a"],QColor:qt["a"],QList:Fe["a"],QItem:Ue["a"],QItemSection:De["a"],QItemLabel:bt["a"],QToggle:wt["a"]}),je()(Pt,"directives",{ClosePopup:Me["a"],Ripple:kt["a"]});var Ot=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-card",{staticClass:"dialog-width-sm"},[a("q-card-section",{staticClass:"row items-center q-pb-none"},[a("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("ctrlBar.penWidth")))]),a("q-space"),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),a("q-card-section",[a("div",{staticClass:"line-wrap"},[a("div",{staticClass:"sample-line",style:e.lineWidthStyle})]),a("q-slider",{attrs:{max:20,step:1,min:1},model:{value:e.lineWidth,callback:function(t){e.lineWidth=t},expression:"lineWidth"}})],1)],1)},$t=[],Nt={name:"LineWidth",components:{},data(){return{}},computed:{color(){return this.$store.getters.currentColor},lineWidthStyle(){return"height:"+this.lineWidth+"px;background-color:"+this.color+";"},lineWidth:{get(){return this.$store.getters.currentLineWidth},set(e){this.$store.commit("CHANGE_CANVAS_LINE_WIDTH",e)}}}},Bt=Nt,It=Object(v["a"])(Bt,Ot,$t,!1,null,null,null),Ft=It.exports;je()(It,"components",{QCard:vt["a"],QCardSection:yt["a"],QSpace:Ne["a"],QBtn:Oe["a"],QSlider:Ct["a"]}),je()(It,"directives",{ClosePopup:Me["a"]});var Ut=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-card",{staticClass:"dialog-width-sm"},[a("q-card-section",[a("q-tabs",{attrs:{shrink:"","active-color":"primary"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("q-tab",{attrs:{name:"tab1",label:e.$t("account.userLogin")}}),a("q-tab",{attrs:{name:"tab2",label:e.$t("account.userRegister")}})],1)],1),a("q-card-section",[a("q-form",{ref:"form",staticClass:"login-form",attrs:{autofocus:!1},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}}},[a("q-input",{staticClass:"q-mb-md",attrs:{placeholder:e.$t("account.email"),rules:[function(e){return e&&e.length>0||"必须填写"}],type:"email",dense:""},model:{value:e.validateForm.email,callback:function(t){e.$set(e.validateForm,"email",t)},expression:"validateForm.email"}}),a("q-input",{staticClass:"q-mb-md",attrs:{dense:"",rules:[function(e){return e&&e.length>0||"必须填写"},function(e){return e.length>=6&&e.length<=20||"密码长度大于6小于20"}],placeholder:"输入密码",type:e.visibility?"text":"password"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-btn",{attrs:{round:"",dense:"",flat:"",icon:e.visibility?"visibility_off":"visibility"},on:{click:function(t){e.visibility=!e.visibility}}})]},proxy:!0}]),model:{value:e.validateForm.password,callback:function(t){e.$set(e.validateForm,"password",t)},expression:"validateForm.password"}}),"tab1"!==e.activeTab?a("q-input",{staticClass:"q-mb-md",attrs:{placeholder:e.$t("account.nick"),rules:[function(e){return e&&e.length>0||"必须填写"},function(e){return e.length<=10||"昵称长度不能大于10"}],type:"text",dense:""},model:{value:e.validateForm.nick,callback:function(t){e.$set(e.validateForm,"nick",t)},expression:"validateForm.nick"}}):e._e(),a("q-btn",{staticClass:"full-width",attrs:{label:"tab1"===e.activeTab?e.$t("account.login"):e.$t("account.register"),color:"primary",rounded:""},on:{click:e.submit}})],1)],1)],1)},Dt=[],Mt=(a("bf19"),a("b621")),Qt=a.n(Mt),jt={name:"LoginForm",props:{},data(){return{activeTab:"tab1",visibility:!1,validateForm:{email:"",password:"",nick:""}}},methods:{submit(){this.$refs.form.validate().then((e=>{e&&("tab1"===this.activeTab?this.doLogin():this.doRegister())}))},doLogin(){const{email:e,password:t}=this.validateForm;Qt.a.auth.login({email:e,password:t}).then((e=>{this.$store.commit("SET_CURRENT_USER",e.toJSON()),this.$emit("logined")})).catch((e=>{console.error(e),this.$q.notify({message:"登录失败",type:"negative",timeout:1e4})}))},doRegister(){const{email:e,password:t,nick:a}=this.validateForm;Qt.a.auth.register({password:t,email:e}).then((e=>{e.set("displayName",a).update().then((t=>{console.log(t),this.$store.commit("SET_CURRENT_USER",e.toJSON()),this.$emit("logined")}))})).catch((e=>{console.error(e),this.$q.notify({message:"注册失败",type:"negative",timeout:1e4})}))}}},Vt=jt,Wt=a("429b"),Ht=a("7460"),zt=a("0378"),Gt=a("27f9"),Yt=Object(v["a"])(Vt,Ut,Dt,!1,null,null,null),Zt=Yt.exports;je()(Yt,"components",{QCard:vt["a"],QCardSection:yt["a"],QTabs:Wt["a"],QTab:Ht["a"],QForm:zt["a"],QInput:Gt["a"],QBtn:Oe["a"]});var Kt={name:"MainLayout",components:{DrawPreference:At,EditorHeader:We,CommonHeader:Je,PlayerHeader:nt,ConvertHeader:ht,ColorPicker:xt,LineWidth:Ft,LoginForm:Zt},data(){return{openDrawPref:!1,openColorPicker:!1,openLineWidth:!1,openLogin:!1}},computed:{currentRoute(){return this.$route.name}},created(){f.$on("open:drawPref",(()=>{this.openDrawPref=!0})),f.$on("open:colorPicker",(()=>{this.openColorPicker=!0})),f.$on("open:lineWidth",(()=>{this.openLineWidth=!0})),f.$on("requireLogin",(()=>{this.openLogin=!0}))}},Xt=Kt,Jt=a("4d5a"),ea=a("e359"),ta=a("09e3"),aa=a("24e8"),ra=Object(v["a"])(Xt,Le,Ae,!1,null,null,null),sa=ra.exports;je()(ra,"components",{QLayout:Jt["a"],QHeader:ea["a"],QPageContainer:ta["a"],QDialog:aa["a"]});var ia=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"bg-grey-3 e-container"},[a("div",{staticClass:"frame-ctrl nav-prev",on:{click:function(){return e.handleNavFrame(-1)}}},[a("q-icon",{attrs:{name:"chevron_left",size:"md"}})],1),a("div",{staticClass:"frame-ctrl nav-next",on:{click:function(){return e.handleNavFrame(1)}}},[a("q-icon",{attrs:{name:e.currentFrame<e.frameList.length?"chevron_right":"plus_one",size:"md"}})],1),a("div",{ref:"canvasWrap",staticClass:"canvas-container",style:e.maxCanvasH,on:{scroll:e.handleScroll}},[a("canvas-layer",{ref:"canvas",attrs:{width:e.viewSize[0],wrapHeight:e.viewSize[1]},on:{capture:e.handleCapture}})],1),a("div",{staticClass:"divider"},[e._v(e._s(e.$t("editor.canvasHTip"))+e._s(e.viewSize[1])+"px")]),a("control-bar",{on:{convertPdf:e.handleConvertPdf,compressImage:e.handleCompressImage,undo:e.handleUndoEarse}})],1)},na=[],oa=(a("ddb0"),a("2b3d"),a("2ef0")),ca=a.n(oa),la=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"layerContainer",staticClass:"canvas-layer-wrap",style:e.layerContainerHeight},[e.isPlayer?e._e():a("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"pdfLayer",style:e.pdfLayerStyle,attrs:{width:e.pdfCanvasW,height:e.pdfCanvasH}}),a("div",{staticClass:"canvas-layer",style:e.layerStyle+e.bgColor},[e.needCapture?a("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"captureLayer",style:e.captureLayerStyle,attrs:{width:e.canvasW,height:e.captureH}}):e._e(),a("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fakeLayer",style:e.layerStyle,attrs:{width:e.canvasW,height:e.canvasH}}),a("canvas",{ref:"stageLayer",staticClass:"stage-layer",style:e.layerStyle,attrs:{width:e.canvasW,height:e.canvasH}}),a("canvas",{ref:"displayLayer",staticClass:"display-layer",style:e.layerStyle,attrs:{width:e.canvasW,height:e.canvasH}}),e.isPlayer?a("canvas",{ref:"syncLayer",staticClass:"sync-layer",style:e.layerStyle,attrs:{width:e.canvasW,height:e.canvasH}}):e._e(),e.isPlayer?e._e():a("canvas",{ref:"editLayer",staticClass:"edit-layer",style:e.layerStyle+e.cursorStyle,attrs:{width:e.canvasW,height:e.canvasH},on:{mousedown:e.handleMousedown,touchstart:e.handleMousedown,mousemove:e.handleMousemove,touchmove:e.handleMousemove,mouseup:e.handleMouseup,touchend:e.handleMouseup,mouseout:e.handleMouseout}}),e.isPlayer?a("div",{directives:[{name:"show",rawName:"v-show",value:e.showCursor,expression:"showCursor"}],staticClass:"sync-cursor",style:e.syncCursorPos}):e._e()])])},da=[],ua=(a("fb6a"),a("4d29")),ha=a.n(ua);function pa(e){return Math.max.apply(Math,e)}function fa(e){return Math.min.apply(Math,e)}function ma(e){const t=e.map((e=>e[0])),a=e.map((e=>e[1]));return[fa(t),fa(a),pa(t)-fa(t),pa(a)-fa(a)]}function ga(e,t){return 1!==t?e*t+.5<<0:e}function va(e,t,a=1){const r=Math.round(t[0]*a-e.lineWidth/2-.5),s=Math.round(t[1]*a-e.lineWidth/2-.5),i=Math.round(t[2]*a+e.lineWidth+.5),n=Math.round(t[3]*a+e.lineWidth+.5);e.clearRect(r,s,i,n)}function ya(e,t,a=1){va(e,ma(t),a),t=[]}function ba(e,t,a,r=!0){if(r&&e.clearCurve(),1===t.length){const r=t[0];return e.beginPath(),e.arc(ga(r[0],a),ga(r[1],a),e.lineWidth/2,0,2*Math.PI,!0),e.closePath(),void e.fill()}e.beginPath();const s=ga(t[0][0],a),i=ga(t[0][1],a);if(e.moveTo(s,i),2===t.length)return e.lineTo(ga(t[1][0],a),ga(t[1][1],a)),void e.stroke();let n=1;while(n<t.length-2){const r=ga((t[n][0]+t[n+1][0])/2,a),s=ga((t[n][1]+t[n+1][1])/2,a),i=ga(t[n][0],a),o=ga(t[n][1],a);e.quadraticCurveTo(i,o,r,s),n++}const o=ga(t[n][0],a),c=ga(t[n][1],a),l=ga(t[n+1][0],a),d=ga(t[n+1][1],a);e.quadraticCurveTo(o,c,l,d),e.stroke()}function wa(e,t,a,r,s=1){return{x:Math.min(e,a)/s,y:Math.min(t,r)/s,w:Math.abs(a-e)/s,h:Math.abs(r-t)/s}}function Ca(e,t,a,r=1){e.beginPath(),e.arc(t*r,a*r,4,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.stroke()}function _a(e,t,a=1){t.forEach((t=>{switch(t.ty){case"C":const r=t.po[0],s=t.po[t.po.length-1];Ca(e,r[0],r[1],a),Ca(e,s[0],s[1],a);break;case"MC":e.save(),e.setLineDash([5]),ba(e,t.po,a,!1),e.restore();break;case"S":switch(t.sty){case"L":case"AL":Ca(e,t.data[0],t.data[1],a),Ca(e,t.data[2],t.data[3],a);break;case"C":Ra(e,t.data,a);break;case"R":Sa(e,t.data,a);break}}}))}function ka(e,t){let a,r,s,i,n,o;return!(!e||!t)&&(n=(e,t)=>!(e[1]<t[0]||e[0]>t[1]),a=[e.x,e.x+e.w],e.w<0&&(a=[a[1],a[0]]),r=[t.x,t.x+t.w],s=[e.y,e.y+e.h],e.h<0&&(s=[s[1],s[0]]),i=[t.y,t.y+t.h],o=n(a,r)&&n(s,i),o)}function La(e,t,a={}){const r=[],s=t.x+t.w,i=t.y+t.h;return e.forEach((e=>{switch(e.ty){case"C":case"MC":if(a.unclude_curve)break;for(let a of e.po)if(a[0]>=t.x&&a[0]<=s&&a[1]>=t.y&&a[1]<=i){r.push(e);break}break;case"S":if(a.only_curve)break;const n=wa(...e.data);switch(e.sty){case"R":case"C":ka(t,n)&&r.push(e);break;case"L":case"AL":const a=[e.data[0],e.data[1]],o=[e.data[2],e.data[3]],c=n.w,l=n.h,d=[n.x,n.y],u=[n.x+n.w,n.y+n.h],h=c/7;let p=1;const f=[a,o];while(d[0]+h*p<u[0]){const e=d[0]+h*p,t=l/c*h*p;let r;r=(o[1]-a[1])*(o[0]-a[0])>0?t+d[1]:u[1]-t,f.push([e,r]),p+=1}for(let n of f)if(n[0]>=t.x&&n[0]<=s&&n[1]>=t.y&&n[1]<=i){r.push(e);break}break}}})),r}function Aa(e,t,a=1,r){e.save(),e.lineWidth=2,e.strokeStyle=r,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(t[0]*a,t[1]*a),e.lineTo(t[2]*a,t[3]*a),e.stroke(),e.restore()}function Ea(e,t,a=1,r){const s=10;e.save(),e.lineWidth=2,r&&(e.strokeStyle=r),e.lineCap="round",e.lineJoin="round";const i=t[2],n=t[3],o=Math.atan2(t[3]-t[1],t[2]-t[0]);e.beginPath(),e.moveTo(t[0]*a,t[1]*a),e.lineTo(t[2]*a,t[3]*a),e.moveTo(i,n),e.lineTo(i-s*Math.cos(o-Math.PI/6),n-s*Math.sin(o-Math.PI/6)),e.moveTo(i,n),e.lineTo(i-s*Math.cos(o+Math.PI/6),n-s*Math.sin(o+Math.PI/6)),e.stroke(),e.restore()}function Sa(e,t,a=1,r){e.save(),e.lineWidth=2,r&&(e.strokeStyle=r);const s=wa(...t,a);e.strokeRect(s.x,s.y,s.w,s.h),e.restore()}function Ra(e,t,a=1,r){const s=wa(...t,a),i=s.x+s.w/2,n=s.y+s.h/2;e.save(),e.lineWidth=2,r&&(e.strokeStyle=r),e.beginPath(),e.ellipse(i,n,s.w/2,s.h/2,0,2*Math.PI,!1),e.stroke(),e.restore()}var Ta=a("69a0"),qa=a.n(Ta);const Pa="libiao.ubairn.com",xa="up17org.b0.upaiyun.com",Oa="https://libiao.ubairn.com",$a="cloud://u17-56e024.7531-u17-56e024",Na=`${$a}/`,Ba=`${$a}-1255324306/`,Ia="https://7531-u17-56e024-1255324306.tcb.qcloud.la/",Fa=[{name:"咖啡色",value:"#655643"},{name:"粉色",value:"#FF9E9D"},{name:"橙色",value:"#ec8749"},{name:"蓝色",value:"#0088ff"},{name:"红色",value:"#e74000"},{name:"绿色",value:"#5cb85c"},{name:"白色",value:"#ffffff"},{name:"黑色",value:"#1d1d1d"}],Ua="/ftriDMtpThOrkDlXwhbIZCE46Y=",Da="up17org",{formatDate:Ma}=Re["b"];let Qa;function ja(e){if(e.match(Na)||e.match(Ba)){const t=e.replace(Na,"").replace(Ba,"");return Ia+t}return e.match(xa)?e.replace(xa,Pa):e.match(Pa)||e.match("http")?e:Oa+e}const Va=(e,t={})=>{const a=Math.round((new Date).getTime()/1e3)+3600,r=t.thumb||"image"===e&&"/quality/75/format/webp/compress/true/progressive/true";let s=Ma(Date.now(),"YYYY_MM_DD_HH_")+ce.a.generate();if(r){const e=r.match(/crop\/(\d+x\d+a+\d+a+\d+)/);e&&e.length>1&&(s+=e[1])}const i="/file/"+e+"/"+s,n={bucket:Da,expiration:a,"save-key":i};if(r&&(n["x-gmkerl-thumb"]=r),t.apps){const e=i+"."+t.apps.f;n["apps"]=[{name:"naga",type:"audio",save_as:e,avopts:"/f/"+t.apps.f}]}const o=X.encode(JSON.stringify(n));t.done({signature:qa.a.hash(o+"&"+Ua),policy:o,bucket:Da,"save-key":i,expiration:a})};function Wa(e,t,a){Qa?t?(Object.keys(Qa).forEach((e=>{t.append(e,Qa[e])})),a(t)):a(Qa):Va(e,{done:r=>{Qa=r,Wa(e,t,a)}})}function Ha(e,t){r["a"].axios({method:"POST",url:"https://v0.api.upyun.com/up17org",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{const a=e.data;200===a.code&&t(a)}))}function za(e,t=!1){return new Promise(((a,r)=>{Wa("image",new FormData,(r=>{r.append("file",t?Z(e):e),Ha(r,(e=>{a({url:e.url,h:e["image-height"]/2,w:e["image-width"]/2,size:e.file_size})}))}))}))}function Ga(e){return new Promise(((t,a)=>{Va("audio",{apps:{f:"MP3"},done:a=>{const r=new FormData;r.append("file",e),r.append("content-type","audio/ogg"),Object.keys(a).forEach((e=>{r.append(e,a[e])})),Ha(r,(e=>{t(e.url)}))}})}))}function Ya(e={},t){c["a"].start();let a=new Qt.a.TableObject("video"),r=new Qt.a.Query,s=10,i=["-cd"];e.uid?r.compare("created_by","=",+e.uid):e.cateId&&r.compare("cate_id","=",e.cateId),(e.uid||e.cateId)&&i.push("-uinfo"),(e.recent||e.hidePrivate)&&r.compare("is_private","!=",!0),e.classid&&r.arrayContains("classids",[e.classid]),e.keyword&&r.matches("t",new RegExp(e.keyword,"i")),e.started_at&&r.compare("created_at",">",e.started_at.getTime()/1e3),e.ended_at&&r.compare("created_at","<",e.ended_at.getTime()/1e3),e.lt_count&&r.compare("n","<",+e.lt_count),e.gt_count&&r.compare("n",">",+e.gt_count),e.onlyCount?a.setQuery(r).select("created_at").find().then((e=>{if(200===e.statusCode){const a=e.data.meta.total_count;console.log("共有 "+a+" 条记录"),t(a)}})):a.setQuery(r).select(i).orderBy("-created_at").limit(s).expand("created_by").offset(e.offset||0).find({withCount:!0}).then((e=>{if(200===e.statusCode){const a=e.data.objects;console.log("共查询到 "+a.length+" 条记录",a);let r=[];for(let e of a)r.push(Object.assign({},e,{duration:Ma(e.dur,"mm:ss"),cover_url:ja(e.cover_url),count:e.n||0,c_at:Ma(1e3*e.created_at,"YYYY-MM-DD")}));t(r,e.data.meta.next,e.data.meta.total_count)}c["a"].stop()}))}function Za(e,t,a){c["a"].start();let r=new Qt.a.TableObject("video");r.expand("created_by").get(e).then((e=>{const a=JSON.parse(e.data.cd);let r=a.canvas.find((e=>"AU"===e.ac));t(Object.assign({},e.data,{duration:Ma(e.data.dur,"mm:ss"),cover_url:ja(e.data.cover_url),count:e.data.n||0,c_at:Ma(1e3*e.data.created_at,"YYYY-MM-DD"),cd:a,ap:r?r.data:e.data.ap})),c["a"].stop()}),a)}function Ka(e,t){let a=new Qt.a.TableObject("video");a.delete(e).then(t)}function Xa(e){let t=new Qt.a.TableObject("video"),a=t.getWithoutData(e);a.incrementBy("n",1),a.update()}function Ja(e,t){let a=new Qt.a.TableObject("video"),r=a.create();r.set(e).save().then((e=>{201===e.statusCode&&(console.log("创建video成功, objectId:"+e.data.id),t(e.data.id))}))}function er(e){return"string"===typeof e&&0===e.indexOf("#")||String(e).indexOf("rgba")>-1?e:Fa[e].value}function tr(e={},t){let a=new Qt.a.TableObject("task"),r=new Qt.a.Query;r.isNull("url"),a.setQuery(r).orderBy("-created_at").limit(20).expand("created_by").offset(e.offset||0).find({withCount:!0}).then((e=>{if(200===e.statusCode){const a=e.data.objects.map((e=>(e.c_at=Ma(1e3*e.created_at,"YYYY-MM-DD HH:mm"),e)));t(a,e.data.meta.next,e.data.meta.total_count)}}))}function ar(e){let t=new Qt.a.File;console.log(e),t.upload({fileObj:e},{categoryID:"5b5409b81548293cc1d75bf7"}).then((e=>{console.log(e.data)}))}var rr={name:"CanvasLayer",props:{wrapHeight:{default:506,type:Number,require:!0},isPlayer:{default:!1,type:Boolean},width:{default:900,type:Number},playerBgColor:{default:"#fff",type:String},needCapture:{default:!1,type:Boolean},scale:{default:1,type:Number},stageMode:{default:"start",type:String}},data(){return{height:this.wrapHeight,curX:0,curY:0,curOp:1,curColor:"#333333",scaleRate:this.scale,straX:!1,straY:!1,pdfHeight:this.wrapHeight,showCursor:!1}},mounted(){this.imageDict={},this.canvasObjs=[],this.earseHistoryObjs=[],this._points=[],this.ctxScaleRatio(),this.isPlayer?this.setupSyncLayer():(this.setupEditLayer(),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup))},beforeDestroy(){this.isPlayer||(document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup))},computed:{layerContainerHeight(){return this.isPlayer?"height:"+this.wrapHeight*this.scaleRate+"px;":""},layerStyle(){return"width:"+this.width*this.scaleRate+"px;height:"+this.height*this.scaleRate+"px;"},pdfLayerStyle(){return"width:"+this.width+"px;height:"+this.pdfHeight+"px;"},captureLayerStyle(){return"width:"+this.width+"px;height:"+this.wrapHeight+"px;"},captureH(){return this.wrapHeight*window.devicePixelRatio*this.scaleRate},pdfCanvasH(){return 2*this.pdfHeight},pdfCanvasW(){return 2*this.width},bgColor(){return this.isPlayer?"background-color:"+this.playerBgColor:"background-color:"+this.$store.getters.currentBgColor},canvasW(){return this.width*window.devicePixelRatio*this.scaleRate},canvasH(){return this.height*window.devicePixelRatio*this.scaleRate},color(){return this.$store.getters.currentColor},cursorStyle(){const e="url('"+Oa+"/img/circle_"+this.$store.getters.colorIndex+".svg')";switch(this.layerType){case"E":case"S":return"cursor: crosshair;";default:return window.devicePixelRatio>1?"cursor: -webkit-image-set("+e+" 2x) 6 6, auto;":"cursor: "+e+" 6 6, auto;"}},tolerance(){return this.$store.getters.preferences.tolerance},lineWidth(){return this.$store.getters.currentLineWidth},layerType(){return this.$store.getters.currentLayerType},shapeType(){return this.$store.getters.currentShapeType},syncCursorPos(){return"transform: translateX("+this.curX*this.scaleRate+"px) translateY("+this.curY*this.scaleRate+"px) scale("+this.scaleRate+","+this.scaleRate+"); opacity:"+this.curOp+"; background-color:"+this.curColor+";width: 12px;height: 12px;border-radius: 12px;margin-top: -6px;margin-left: -6px;"}},watch:{layerType:function(e,t){this.setupEditLayer()},scaleRate:function(e,t){this.$nextTick((()=>{this.ctxScaleRatio()}))}},methods:{ctxScaleRatio(){["displayLayer","stageLayer","editLayer","fakeLayer","syncLayer"].forEach((e=>{const t=this.$refs[e];t&&t.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)}))},setupEditLayer(){const e=this.getLayerCtx("editLayer");switch(this.layerType){case"C":break;case"E":e.strokeStyle="#ff8619",e.fillStyle="rgba(255, 255, 255,0.4)",e.lineCap="round",e.lineJoin="round",e.lineWidth=1;break;case"S":break}},setupSyncLayer(){},scrollLayerContainer(e){this.$refs.layerContainer&&(this.$refs.layerContainer.scrollTop=e*this.scaleRate)},preloadStage(e,t){return new Promise(((a,r)=>{if(this.imageDict[t])a(this.imageDict[t]);else{let r=new window.Image;r.crossOrigin="Anonymous",r.onload=()=>{this.imageDict[t]=r,r=null,a(this.imageDict[t])},r.src=ja(e.url)}}))},async preloadStages(e){for(const t of e)t.bg&&await this.preloadStage(t.bg,t.id)},updateHeight(e){return e<this.wrapHeight&&(e=this.wrapHeight),new Promise(((t,a)=>{e!==this.height?(this.height=e,this.$nextTick((()=>{this.ctxScaleRatio(),t()}))):(this.clearCtx("stageLayer"),t())}))},async setStageLayer(e,t,a){e.url&&(this.$q.loadingBar.start(),await this.preloadStage(e,t).then((t=>{let r=e.w,s=e.h;r!==this.width&&(s=this.width*s/r,r=this.width);const i=this.getLayerCtx("stageLayer");i.save(),a&&(i.globalAlpha=a);let n=0;s<this.wrapHeight&&"center"===this.stageMode&&(n=(this.wrapHeight-s)/2),i.drawImage(t,0,n,r*this.scaleRate,s*this.scaleRate),i.restore(),this.$q.loadingBar.stop()})))},getPointBy(e){if(e.touches){const{pageX:t,pageY:a,target:{offsetParent:{offsetLeft:r,offsetTop:s}}}=e.changedTouches[0];return[parseInt(t-r,10),parseInt(a-s-50,10)]}return[parseInt(e.layerX,10),parseInt(e.layerY,10)]},handleMousedown(e){const t=[this._px,this._py]=this.getPointBy(e);switch(this._dragging=!0,this.layerType){case"C":this._points.length=0,this._points.push(t);break;case"E":break;case"S":break}},handleMouseout(){this._dragging&&(this._dragging=!1,this.handleMouseup())},handleMousemove(e){const t=this.getPointBy(e),a=this.getLayerCtx("editLayer"),{x:r,y:s,w:i,h:n}=wa(t[0],t[1],this._px,this._py,this.scaleRate);switch(this.layerType){case"C":{if(!this._dragging)return void this.$emit("capture",{ac:"CM",data:[t[0]/this.scaleRate,t[1]/this.scaleRate]});if(this.straX&&(this.stra_y?t[1]=this.stra_y:this.stra_y=t[1]),this.straY&&(this.stra_x?t[0]=this.stra_x:this.stra_x=t[0]),this._px===t[0]&&this._py===t[1])return;this._px=t[0],this._py=t[1],this._points.push(t),this._points=ha.a.radialDistance(this._points,this.tolerance);const e={co:this.color,wi:this.lineWidth,ty:this.layerType,po:this._points.slice()};this.$emit("capture",{ac:"CSync",data:e}),this.renderCurve(e,"editLayer",!0);break}case"E":{if(!this._dragging)return;this.clearCtx("editLayer"),a.fillRect(r,s,i,n),a.save(),a.setLineDash([5]),a.strokeRect(r,s,i,n),a.restore();const e=La(this.canvasObjs,{x:r,y:s,w:i,h:n});_a(a,e,this.scaleRate);break}case"S":{if(!this._dragging)return;this._prev_shape_rect&&va(a,this._prev_shape_rect,this.scaleRate),this._prev_shape_rect=[r-10,s-10,i+20,n+20];const e={ty:"S",co:this.color,sty:this.shapeType,data:[this._px/this.scaleRate,this._py/this.scaleRate,t[0]/this.scaleRate,t[1]/this.scaleRate]};this.renderShape(e,"editLayer");break}}},handleMouseup(e){this._dragging=!1,this.stra_y=null,this.stra_x=null;const t=this.getPointBy(e),a=wa(t[0],t[1],this._px,this._py,this.scaleRate);switch(this.layerType){case"C":if(this._points.length>0){const e={po:this._points.slice(),co:this.color,wi:this.lineWidth,ty:this.layerType};this.clearCtx("editLayer",this._points),this.$emit("capture",{ac:"CEnd",data:e}),this.renderCurve(e),this._points.length=0}break;case"E":{this.clearCtx("editLayer");const e=La(this.canvasObjs,a),t=e.map((e=>e.id));if(!t.length)return void console.log("no earse");this.removeCanvasObjs(t),this.earseHistoryObjs.push(e),this.$emit("capture",{ac:"E",data:t}),this.reRenderCanvasData();break}case"S":{const e={ty:"S",co:this.color,sty:this.shapeType,data:[this._px/this.scaleRate,this._py/this.scaleRate,t[0]/this.scaleRate,t[1]/this.scaleRate]};this._prev_shape_rect&&(va(this.getLayerCtx("editLayer"),this._prev_shape_rect,this.scaleRate),this._prev_shape_rect=null),this.renderShape(e),this.$emit("capture",{ac:"SEnd",data:e});break}}},redrawEarseHistory(){const e=this.earseHistoryObjs.pop();if(e){this.batchRenderObjs(e);for(const t of e)this.addCanvasObj(t);this.$emit("capture",{ac:"UE",data:e})}},resetLayer(){this.canvasObjs=[],this.clearCtx("displayLayer"),this.clearCtx("editLayer"),this.clearCtx("stageLayer"),this.clearCtx("syncLayer")},reRenderCanvasData(e){e&&(this.canvasObjs=e),this.canvasObjs.length?this.batchRenderObjs(this.canvasObjs,!0):this.clearCtx("displayLayer")},cursorMove(e){if(this.showCursor)for(const t of Object.keys(e))this.$data[t]=e[t]},removeCanvasObjs(e){return this.canvasObjs=this.canvasObjs.filter((t=>e.indexOf(t.id)<0)),this.canvasObjs},renderOneObj(e,t){return new Promise(((a,r)=>{switch(e.ty){case"C":this.renderCurve(e,t),a();break;case"S":this.renderShape(e,t),a();break;default:this.renderCurve(e,t),a();break}}))},async batchRenderObjs(e,t=!1){this.clearCtx("fakeLayer");for(const a of e)await this.renderOneObj(a,"fakeLayer");t&&this.clearCtx("displayLayer"),this.getLayerCtx("displayLayer").drawImage(this.$refs.fakeLayer,0,0,this.width*this.scaleRate,this.height*this.scaleRate)},renderCurve(e,t="displayLayer",a=!1){const r=this.getLayerCtx(t);if(r.strokeStyle=r.fillStyle=er(e.co),r.lineWidth=e.wi*this.scaleRate,r.lineCap=r.lineJoin="round",a){const a=r._points;r.clearCurve=a?()=>this.clearCtx(t,a):()=>{},r._points=e.po}else"displayLayer"===t&&this.addCanvasObj(e);ba(r,e.po,this.scaleRate,a)},renderShape(e,t="displayLayer"){const a=this.getLayerCtx(t);switch(e.sty){case"L":Aa(a,e.data,this.scaleRate,e.co);break;case"AL":Ea(a,e.data,this.scaleRate,e.co);break;case"R":Sa(a,e.data,this.scaleRate,e.co);break;case"C":Ra(a,e.data,this.scaleRate,e.co);break}"displayLayer"===t&&this.addCanvasObj(e)},getLayerCtx(e){return this.$refs[e].getContext("2d")},addCanvasObj(e){e.id=e.id||ce.a.generate(),this.canvasObjs.push(e)},clearCtx(e="editLayer",t){if(!this.$refs[e])return;const a=this.getLayerCtx(e);t?ya(a,t,this.scaleRate):a.clearRect(0,0,this.canvasW,this.canvasH)},setScaleRateBy(e={}){if(e.origin)this.scaleRate=1;else{const t=e.width||window.screen.width;let a=t/this.width;e.height&&this.wrapHeight*a>e.height&&(a=e.height/this.wrapHeight),this.scaleRate=Math.floor(1e3*a)/1e3}},handleKeydown(e){16===e.keyCode&&(this.straX=!0,this.$toast.success("横直线模式生效")),18===e.keyCode&&(this.straY=!0,this.$toast.success("竖直线模式生效"))},handleKeyup(e){16===e.keyCode&&(this.straX=!1,this.$toast.warning("横直线模式失效")),18===e.keyCode&&(this.straY=!1,this.$toast.warning("竖直线模式失效"))},toggleCursor(e){this.showCursor=e},convertPDF2PNG(e,t){return new Promise(((a,r)=>{e.getPage(t).then((e=>{const t=e.getViewport(1),r=2*this.width/t.width,s=e.getViewport(r),i=parseInt(s.height,10);this.pdfHeight=i/2,this.$nextTick((()=>{e.render({canvasContext:this.getLayerCtx("pdfLayer"),viewport:s}).then((()=>{a(this.$refs.pdfLayer.toDataURL("image/webp",.8))}))}))}))}))},putImageAsBg(e){return new Promise(((t,a)=>{const r=new Image,s=this.getLayerCtx("pdfLayer");r.onload=()=>{let a=r.width,i=r.height;a>2*this.width?(i=2*this.width*i/a,a=2*this.width,this.pdfHeight=i/2,this.$nextTick((()=>{s.drawImage(r,0,0,a,i),t(this.$refs.pdfLayer.toDataURL("image/webp",.8))}))):t(e)},r.src=e}))},drawPointer(e){e.beginPath();const t=this.$refs.layerContainer.scrollTop*window.devicePixelRatio,a=this.curX*window.devicePixelRatio,r=this.curY*window.devicePixelRatio-t;a>0&&r>0&&(e.arc(a,r,12,0,2*Math.PI,!1),e.fillStyle=Y(this.curColor,100*this.curOp),e.fill())},captureCurrentImage(){const e=this.getLayerCtx("captureLayer"),t=["stageLayer","displayLayer","syncLayer"],a=this.$refs.layerContainer.scrollTop*window.devicePixelRatio;t.forEach((t=>{"stageLayer"===t&&(e.fillStyle=this.playerBgColor,e.fillRect(0,0,this.canvasW,this.captureH)),e.drawImage(this.$refs[t],0,a,this.canvasW,this.captureH,0,0,this.canvasW,this.captureH)})),this.drawPointer(e),e.font="24px 楷体",e.fillStyle="rgba(255,255,255,0.7)",e.shadowColor="rgba(0,0,0,0.2)",e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=2;const r="手绘微课",s=this.canvasW-e.measureText(r).width-10,i=this.captureH-20;return e.fillText(r,s,i),e.restore(),this.$refs.captureLayer},renderAvatar(e,t,a){const r=[80,80];return new Promise(((s,i)=>{const n=new window.Image;n.onload=()=>{e.drawImage(n,this.width*this.scaleRate/2-r[0]/2,a,r[0],r[1]),s(a+r[1]+25)},n.onerror=()=>{s(a+r[1]+25)},n.src=t}))},async genVideoCover(e={}){const t=this.getLayerCtx("fakeLayer");t.fillStyle="#fff";const a=this.width*this.scaleRate,r=this.height*this.scaleRate;t.fillRect(0,0,a,r);let s=80;t.textBaseline="middle",t.font="22px Roboto",t.fillStyle="#666";const i=e.title,n=t.measureText(i).width;if(n<a){const e=a/2-n/2;t.fillText(i,e,s)}t.font="16px Roboto",t.fillStyle="#999";const o="由手绘微课录制",c=a/2-t.measureText(o).width/2;if(t.fillText(o,c,r-60),s+=40,e.avatar&&s+130<r-60&&(s=await this.renderAvatar(t,e.avatar,s)),e.author){t.font="18px Roboto",t.fillStyle="#333";const r=a/2-t.measureText(e.author).width/2;t.fillText(e.author,r,s)}e.done(this.$refs.fakeLayer)}}},sr=rr,ir=(a("7315"),Object(v["a"])(sr,la,da,!1,null,"9a365332",null)),nr=ir.exports,or=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"controlBar"}},[e.shapeCtrlTrigger?a("q-popup-proxy",{attrs:{target:e.shapeCtrlTrigger}},[a("q-card",[a("q-tabs",{attrs:{shrink:"","active-color":"primary","indicator-color":"transparent",dense:""},model:{value:e.shapeType,callback:function(t){e.shapeType=t},expression:"shapeType"}},[a("q-tab",{attrs:{name:"L",label:e.$t("ctrlBar.line"),icon:"short_text"}}),a("q-tab",{attrs:{name:"AL",label:e.$t("ctrlBar.arrowLine"),icon:"trending_flat"}}),a("q-tab",{attrs:{name:"C",label:e.$t("ctrlBar.circle"),icon:"panorama_fish_eye"}}),a("q-tab",{attrs:{name:"R",label:e.$t("ctrlBar.rect"),icon:"crop_landscape"}})],1)],1)],1):e._e(),a("q-toolbar",{staticClass:"bg-white"},[a("q-tabs",{attrs:{shrink:"","active-color":"primary","indicator-color":"transparent",dense:""},model:{value:e.canvasLayer,callback:function(t){e.canvasLayer=t},expression:"canvasLayer"}},[a("q-tab",{attrs:{name:"C",label:e.$t("ctrlBar.pen"),icon:"edit"}}),a("q-tab",{ref:"shapeBtn",attrs:{name:"S",icon:e.currentShapeIcon,label:e.$t("ctrlBar.shape")}}),a("q-tab",{attrs:{name:"E",label:e.$t("ctrlBar.eraser"),icon:"crop_free"}})],1),a("q-space"),e.$q.screen.lt.md?e._e():a("q-btn",{staticClass:"q-mr-md",attrs:{icon:"undo",round:"",flat:""},on:{click:function(){return e.$emit("undo")}}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[e._v("\n        "+e._s(e.$t("ctrlBar.undoErase"))+"\n      ")])],1),e.$q.screen.lt.md?e._e():a("q-btn",{staticClass:"q-mr-md",attrs:{icon:"line_weight",round:"",flat:""},on:{click:e.openLineWidth}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[e._v("\n        "+e._s(e.$t("ctrlBar.penWidth"))+"\n      ")])],1),e.$q.screen.lt.md?e._e():a("q-btn",{staticClass:"q-mr-md",style:e.colorPickerStyle,attrs:{icon:"color_lens",round:"",flat:""},on:{click:e.openColorPicker}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[e._v("\n        "+e._s(e.$t("ctrlBar.penColor"))+"\n      ")])],1),a("uploader",{attrs:{autoStart:!1,options:e.uploadOptions},on:{"file-added":e.onFileAdded}},[a("uploader-btn",{attrs:{single:!0,attrs:e.uploadAttrs}},[a("q-btn",{attrs:{icon:"picture_as_pdf",round:"",flat:""}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[e._v("\n            "+e._s(e.$t("ctrlBar.uploadPdf"))+"\n          ")])],1)],1),e.$q.screen.lt.md?a("q-btn",{attrs:{icon:"more_vert",round:"",flat:""}},[a("q-menu",[a("q-list",{staticStyle:{"min-width":"100px"}},[a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return e.$emit("undo")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"undo"}})],1),a("q-item-section",[e._v("\n                "+e._s(e.$t("ctrlBar.undoErase"))+"\n              ")])],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.openLineWidth}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"line_weight"}})],1),a("q-item-section",[e._v("\n                "+e._s(e.$t("ctrlBar.penWidth"))+"\n              ")])],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.openColorPicker}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"color_lens"}})],1),a("q-item-section",[e._v("\n                "+e._s(e.$t("ctrlBar.penColor"))+"\n              ")])],1)],1)],1)],1):e._e()],1)],1)],1)},cr=[];const lr=a("9511");var dr={name:"ControlBar",props:{},data(){return{openMoreMenu:!1,uploadOptions:{testChunks:!1,singleFile:!0},uploadAttrs:{accept:"application/pdf,image/*"},limitPageNum:100,shapeCtrlTrigger:null}},mounted(){lr.workerSrc=Oa+"/js/pdf.worker.js",this.shapeCtrlTrigger=this.$refs.shapeBtn.$el},computed:{colorPickerStyle(){return"color:"+this.$store.getters.currentColor},canvasLayer:{get(){return this.$store.getters.currentLayerType},set(e){this.$store.commit("CHANGE_CANVAS_LAYER",e)}},layerType(){return this.$store.getters.currentLayerType},shapeType:{get(){return this.$store.getters.currentShapeType},set(e){this.$store.commit("CHANGE_CANVAS_SHAPE_TYPE",e)}},currentShapeIcon(){switch(this.$store.getters.currentShapeType){case"L":return"short_text";case"AL":return"trending_flat";case"C":return"panorama_fish_eye";case"R":return"crop_landscape";default:return""}}},methods:{openColorPicker(){f.$emit("open:colorPicker")},openLineWidth(){f.$emit("open:lineWidth")},onFileAdded(e){const t=e.fileType.match(/image/);f.$emit("load:start",t?"正在插入背景图片":"正在解析文件");const a=new FileReader;t?(a.readAsDataURL(e.file),a.onload=e=>{this.$emit("compressImage",e.target.result)}):(a.readAsArrayBuffer(e.file),a.onload=e=>{lr.getDocument({data:e.target.result,cMapUrl:"/js/cmaps/",cMapPacked:!0}).then((e=>{f.$emit("load:end");const t=e.numPages;t>this.limitPageNum?f.$emit("dialog",{title:"提示",msg:"已超过文档上传页数限制: "+this.limitPageNum+"/"+t+", 继续操作，超出部分将不会被导入",confirm:()=>{this.$emit("convertPdf",{pdf:e,missionNum:this.limitPageNum})}}):this.$emit("convertPdf",{pdf:e,missionNum:t})}))})}}},ur=dr,hr=(a("8008"),a("7cbe")),pr=Object(v["a"])(ur,or,cr,!1,null,"d06b5422",null),fr=pr.exports;je()(pr,"components",{QPopupProxy:hr["a"],QCard:vt["a"],QTabs:Wt["a"],QTab:Ht["a"],QToolbar:xe["a"],QSpace:Ne["a"],QBtn:Oe["a"],QTooltip:$e["a"],QMenu:Ie["a"],QList:Fe["a"],QItem:Ue["a"],QItemSection:De["a"],QIcon:Be["a"]}),je()(pr,"directives",{ClosePopup:Me["a"]});var mr=a("c093"),gr=a.n(mr),vr=a("755b");const yr=100;var br={name:"Editor",data(){return{framesData:{}}},components:{CanvasLayer:nr,ControlBar:fr},created(){f.$on("toggle:startRecord",this.startRecord),f.$on("toggle:pauseRecord",this.pauseRecord),f.$on("remove:frame",this.removeCurFrame)},mounted(){gr.a.isRecordingSupported()||this.$q.notify({type:"negative",message:this.$t("editor.recordNotSupport")});const e=this.frameList[this.currentFrame-1];e.bg&&this.$refs.canvas.updateHeight(e.bg.h).then((()=>{this.$refs.canvas.setStageLayer(e.bg,e.id)})),this.currentAc=null,this.auRecorder=new gr.a({encoderPath:vr["a"]}),this.auRecorder.onstart=()=>{this.records=[],this.currentTs=1,this.$q.notify({type:"positive",message:this.$t("editor.recordStart")});const e=this.$refs.canvasWrap.scrollTop;this.addAcRecord("F",{id:this.currentFid,top:e}),this.addAcRecord("CC",this.currentColor),this.setupRecordClock()},this.auRecorder.onpause=()=>{this.recordPaused=!0,this.clock.cancel(),this.$q.notify({type:"positive",message:this.$t("editor.paused")})},this.auRecorder.onresume=()=>{this.recordPaused=!1,this.currentAc=null,this.setupRecordClock(),this.$q.notify({type:"positive",message:this.$t("editor.resumed")})},this.auRecorder.onstop=()=>{this.addAcRecord("End"),this.clock.cancel(),this.currentTs=0,this.$store.commit("SET_CANVAS_OBJS",this.records);const e=ca.a.uniq(this.records.filter((e=>"F"===e.ac)).map((e=>"object"===typeof e.data?e.data.id:e.data))).map((e=>this.frameList.find((t=>t.id===e))));this.$store.commit("SET_STAGE_OBJS",e),this.$store.commit("SET_STAGE_BG_COLOR",this.currentBgColor),this.$store.commit("SET_PLAYER_SIZE",this.viewSize),this.$router.push({path:"preview"})},this.auRecorder.ondataavailable=e=>{const t=new Blob([e],{type:"audio/ogg"}),a=URL.createObjectURL(t);this.$store.commit("SET_AUDIO_TRACK",{url:a,blob:t})}},computed:{currentColor(){return this.$store.getters.currentColor},currentBgColor(){return this.$store.getters.currentBgColor},currentFrame(){return this.$store.getters.currentFrame},frameList(){return this.$store.getters.frameList},currentFid(){return this.$store.getters.currentFid},viewSize(){return this.$store.getters.viewSize},maxCanvasH(){return"max-height:"+this.viewSize[1]+"px;"},lang(){return this.$store.getters.preferences.lang},currentTs:{get(){return this.$store.getters.currentTs},set(e){this.$store.commit("SET_CURRENT_TS",e)}},currentDur:{get(){return this.$store.getters.currentDur},set(e){this.$store.commit("SET_CURRENT_DUR",e)}},recordPaused:{get(){return this.$store.getters.recordPaused},set(e){this.$store.commit("SET_RECORD_PAUSE",e)}}},watch:{currentColor:function(e,t){this.addAcRecord("CC",e)},currentFrame:function(e,t){const a=this.frameList[t-1];a&&(this.framesData[a.id]=this.$refs.canvas.canvasObjs),this.loadFrameContent(e),this.skipCapture=!0,this.$refs.canvasWrap.scrollTop=0},lang:function(e){this._i18n.locale=e}},methods:{startRecord(){this.currentTs?this.auRecorder.stop():this.auRecorder.start()},pauseRecord(){this.recordPaused?this.auRecorder.resume():this.auRecorder.pause()},setupRecordClock(){this.clock=G(yr,(()=>{this.currentTs+=yr,this.currentTs%1e3===1&&(this.currentDur=this.currentTs),this.currentAc&&(this.records.push(this.currentAc),this.currentAc=null)}))},handleCapture(e){if(this.currentTs){if(this.currentAc&&this.currentAc.ac!==e.ac&&"CEnd"===this.currentAc.ac)return;this.currentAc=Object.assign({},e,{ts:this.currentTs})}},addAcRecord(e,t={}){this.currentTs&&this.records.push({ac:e,ts:this.currentTs,data:t})},handleUndoEarse(){this.$refs.canvas.redrawEarseHistory()},handleNavFrame(e){const t=this.currentFrame+e;this.$store.commit("CHANGE_CURRENT_FRAME",t)},handleNavToFrame(e){this.$store.commit("CHANGE_CURRENT_FRAME",e+1)},removeCurFrame(){this.$q.dialog({title:"确认操作",message:"确定要删除当前第 "+this.currentFrame+" 页吗？",cancel:!0,persistent:!0}).onOk((()=>{if(this.$store.commit("REMOVE_FRAME_BY_NUM",this.currentFrame),this.currentFrame>this.frameList.length){const e=0===this.frameList.length?1:this.currentFrame-1;this.$store.commit("CHANGE_CURRENT_FRAME",e)}else this.loadFrameContent(this.currentFrame)}))},loadFrameContent(e){const t=this.frameList[e-1].id,a=this.frameList[e-1].bg;this.$refs.canvas.updateHeight(a?a.h:this.viewSize[1]).then((()=>{this.$refs.canvas.reRenderCanvasData(this.framesData[t]||[]),a&&this.$refs.canvas.setStageLayer(a,t)})),this.addAcRecord("F",this.currentFid)},handleScroll(e){this.skipCapture?this.skipCapture=!1:this.handleCapture({ac:"SL",data:e.target.scrollTop})},async handleConvertPdf(e){let t=1;const a=[];while(t<=e.missionNum)f.$emit("load:start","正在导入第 "+t+" 页/共 "+e.missionNum+" 页"),await new Promise(((r,s)=>{this.$refs.canvas.convertPDF2PNG(e.pdf,t).then((e=>{za(e,!0).then((e=>{a.push(e),r()}))}))})),t++;this.$store.commit("INSERT_FRAME_BY_IMAGES",a),f.$emit("load:end")},handleCompressImage(e){this.$refs.canvas.putImageAsBg(e).then((e=>{za(e,!0).then((e=>{this.$store.commit("INSERT_FRAME_BY_IMAGE",e),f.$emit("load:end")}))}))}}},wr=br,Cr=(a("ebf5"),a("9989")),_r=Object(v["a"])(wr,ia,na,!1,null,"1afb9034",null),kr=_r.exports;je()(_r,"components",{QPage:Cr["a"],QIcon:Be["a"]});var Lr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"q-pa-md"},[e.currentUser?a("q-infinite-scroll",{attrs:{offset:10},on:{load:e.onLoad},scopedSlots:e._u([e.hasNext?{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}:null],null,!0)},[a("q-list",{attrs:{separator:""}},[a("q-item-label",{attrs:{header:""}},[e._v(e._s(e.$t("mywork.created"))+" "+e._s(e.allCount))]),e._l(e.workList,(function(t,r){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:r,attrs:{clickable:"",to:"/vd/"+t.id}},[a("q-item-section",[a("q-item-label",[e._v(e._s(t.t))]),a("q-item-label",{attrs:{caption:""}},[a("small",[e._v("创建于")]),e._v(" "+e._s(t.c_at)+" "),a("small",[e._v("已播放")]),e._v(" "+e._s(t.count))])],1),a("q-item-section",{attrs:{side:""}},[e._v("\n          "+e._s(t.duration)+"\n        ")])],1)}))],2)],1):e._e(),e.workList&&0===e.workList.length?a("div",{staticClass:"empty-tip"},[e._v("暂无任何作品")]):e._e()],1)},Ar=[],Er={name:"MyWork",data(){return{allCount:0,workList:null,hasNext:!1}},computed:{currentUser(){return this.$store.getters.currentUser}},watch:{currentUser:{handler(e){e||f.$emit("requireLogin")},immediate:!0}},methods:{loadVideos(e={},t){this.query=e,Ya(e,((a,r,s)=>{this.hasNext=!!r;let i=a;e.offset&&(i=this.workList.concat(a)),this.workList=i,this.allCount=s,t&&t()}))},onLoad(e,t){if(1===e||this.hasNext){const e=Object.assign(this.query||{},{offset:this.workList?this.workList.length:0,uid:this.currentUser.id});this.loadVideos(e,t)}}}},Sr=Er,Rr=a("ef35"),Tr=a("8380"),qr=Object(v["a"])(Sr,Lr,Ar,!1,null,null,null),Pr=qr.exports;je()(qr,"components",{QInfiniteScroll:Rr["a"],QList:Fe["a"],QItemLabel:bt["a"],QItem:Ue["a"],QItemSection:De["a"],QSpinnerDots:Tr["a"]}),je()(qr,"directives",{Ripple:kt["a"]});var xr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"preview-container"},[a("player",{attrs:{audioUrl:e.audioTrack.url,canvasObjs:e.canvasObjs,stages:e.stages,autoPlay:!0,bgColor:e.stageBgColor,size:e.playerSize,duration:e.duration}})],1)},Or=[],$r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"player-wrap"},[a("div",{staticClass:"canvas-container"},[a("canvas-layer",{ref:"canvas",attrs:{isPlayer:!0,playerBgColor:e.bgColor,width:e.size[0],wrapHeight:e.size[1]}}),a("div",{staticClass:"coverage",on:{click:e.handlePlay}},[e.currentTs?e._e():[a("q-btn",{staticClass:"video-ctrl-cover",attrs:{color:"primary",round:"",icon:"play_arrow"}}),a("div",{staticClass:"video-dur"},[e._v(e._s(e.hDur))])]],2)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.currentTs,expression:"currentTs"}],staticClass:"ctrl-bar"},[a("q-btn",{staticClass:"q-mr-sm",attrs:{size:"sm",round:"",flat:"",icon:e.currentTs&&!e.isPaused?"pause":"play_arrow"},on:{click:e.handlePlay}}),e.canSeek?a("q-slider",{attrs:{dense:"",step:1,color:"white"},on:{change:e.onChangeProgress},model:{value:e.progress,callback:function(t){e.progress=t},expression:"progress"}}):e._e(),a("span",{staticClass:"time"},[e._v(e._s(e.currentTsDisplay))])],1)])},Nr=[],Br=(a("26e9"),a("1e5c"));const Ir=100,{formatDate:Fr}=Re["b"];var Ur={name:"Player",components:{CanvasLayer:nr},props:{audioUrl:{type:String,require:!0},canvasObjs:{type:Array,require:!0},duration:{type:Number,require:!0},autoPlay:{type:Boolean,default:!1},stages:{type:Array},bgColor:{type:String},canSeek:{type:Boolean,default:!0},size:{type:Array,default(){return[900,506]}}},data(){return{currentTs:0,currentDur:0,progress:0,isPaused:!1,framesData:{}}},computed:{currentTsDisplay(){return Fr(this.currentDur,"mm:ss")},hDur(){return Fr(this.duration,"mm:ss")}},mounted(){this.canvasLayer=this.$refs.canvas,this.autoPlay&&this.canvasObjs.length&&this.preloadResource(this.startPlay)},beforeDestroy(){this.currentTs&&this.stopPlay(),this.currentAudio&&this.currentAudio.unload()},methods:{startPlay(){this.setupPlayerClock(),this.currentAudio.play(),this.$emit("played"),this.canvasLayer.toggleCursor(!0)},pausePlay(){this.clock&&this.clock.cancel(),this.currentAudio.pause(),this.isPaused=!0,this.$q.notify({message:"已暂停",type:"positive",timeout:3e3})},async resumePlay(){if(this.seekToTs&&this.seekToTs!==this.currentTs){const e=this.frameByTs(this.seekToTs);this.currentTs=this.seekToTs;const{cd:t,framesData:a,curFid:r,top:s,color:i}=this.parseRealPathByRange(0,this.currentTs);this.framesData=a,this.curFid=r,this.frameChange(e.data.id,s),this.canvasLayer.cursorMove({curColor:i}),this.canvasLayer.reRenderCanvasData(t),await this.seekAudio(this.currentTs),this.seekToTs=0}this.setupPlayerClock(),this.isPaused&&this.currentAudio.play(),this.isPaused=!1},stopPlay(){this.clock&&this.clock.cancel(),this.currentAudio&&this.currentAudio.stop(),this.currentTs=0,this.isPaused=!1,this.canvasLayer.toggleCursor(!1),this.canvasLayer.resetLayer(),this.framesData={},this.curFid=null,this.canvasLayer.scrollLayerContainer(0)},handlePlay(){this.currentTs?this.isPaused?this.resumePlay():this.pausePlay():this.preloadResource(this.startPlay)},doEachTask(e){return new Promise(((t,a)=>{this.canvasObjs.filter((t=>e-Ir<=t.ts&&t.ts<e)).forEach(this.playEachRecord),e%1e3===0&&(this.currentDur=e),this.progress=e/this.duration*100,t()}))},setupPlayerClock(){this.clock=G(Ir,(()=>{this.currentTs+=Ir,this.doEachTask(this.currentTs)}))},playEachRecord(e){switch(e.ac){case"CSync":case"Cy":{this.canvasLayer.renderCurve(e.data,"syncLayer",!0);const t=e.data.po[e.data.po.length-1];this.canvasLayer.cursorMove({curX:t[0],curY:t[1],curOp:.5});break}case"CEnd":case"CE":this.canvasLayer.clearCtx("syncLayer"),this.canvasLayer.renderCurve(e.data);break;case"E":this.canvasLayer.removeCanvasObjs(e.data),this.canvasLayer.reRenderCanvasData();break;case"CM":this.canvasLayer.cursorMove({curX:e.data[0],curY:e.data[1],curOp:1});break;case"F":case"Frame":{this.preFid=this.curFid;let t=0;"object"===typeof e.data?(this.curFid=e.data.id,t=e.data.top):this.curFid=e.data,this.preFid&&(this.framesData[this.preFid]=this.canvasLayer.canvasObjs),this.frameChange(this.curFid,t);break}case"SL":this.canvasLayer.scrollLayerContainer(e.data);break;case"SEnd":this.canvasLayer.renderShape(e.data);break;case"End":this.progress=100,this.stopPlay();break;case"CC":this.canvasLayer.cursorMove({curColor:e.data});break;case"UE":this.canvasLayer.batchRenderObjs(e.data);for(const t of e.data)this.canvasLayer.addCanvasObj(t);break}},preloadResource(e){this.canvasLayer.preloadStages(this.stages),this.loadAudio(e)},groupRecordsByFrameRate(){let e=0;const t=[];while(e<this.duration)e+=Ir,t.push(this.canvasObjs.filter((t=>e-Ir<=t.ts&&t.ts<e)));return t},loadAudio(e){if(this.currentAudio)return void e();const t=this.audioUrl.match("http")?this.audioUrl:Oa+this.audioUrl;this.currentAudio=new Br["Howl"]({src:[t,t+".MP3"],html5:!0,format:["ogg","mp3"],onload:e,onloaderror:()=>{this.$q.notify({message:"音频加载失败",type:"negative",timeout:1e4})}})},onChangeProgress(e){this.canSeek&&(this.seekToTs=Math.round(e*this.duration/100),this.currentDur=this.seekToTs)},seekAudio(e){return new Promise(((t,a)=>{this.currentAudio?(this.currentAudio.once("seek",t),this.currentAudio.seek(e/1e3)):t()}))},fitScreenWidth(){this.$refs.canvas.setScaleRateBy()},fitToOriginWidth(){this.$refs.canvas.setScaleRateBy({origin:!0})},frameByTs(e,t={}){const a=this.canvasObjs.filter((e=>"F"===e.ac)).reverse();for(const r in a)if(a[r].ts-e<=0)return t.to?a[r-t.to]:a[r]},frameChange(e,t){const a=this.stages.find((t=>t.id===e));if(a){const e=a.bg;this.canvasLayer.updateHeight(e?e.h:this.size[1]).then((()=>{this.canvasLayer.reRenderCanvasData(this.framesData[a.id]||[]),e&&this.canvasLayer.setStageLayer(e,a.id),this.canvasLayer.scrollLayerContainer(t)}))}},parseRealPathByRange(e,t){let a,r,s,i,n;const o=["F","CEnd","E","SEnd","CC","UE","SL"];let c=[];const l=this.canvasObjs.filter((a=>o.indexOf(a.ac)>-1&&e<=a.ts&&a.ts<=t));0===e&&(s={},a=r=null);for(const d of l)switch(d.ac){case"CEnd":case"SEnd":c.push(d.data);break;case"SL":i=d.data;break;case"CC":n=d.data;break;case"E":c=c.filter((e=>d.data.indexOf(e.id)<0));break;case"UE":Array.isArray(d.data)&&c.concat(d.data);break;case"F":0===e?(a=r,r=d.data,a&&(s[a]=c.slice(0)),c=s[r]||[]):c=[];break}return 0===e?{cd:c,framesData:s,curFid:r,top:i,color:n}:{cd:c,top:i}}}},Dr=Ur,Mr=(a("3cdd"),Object(v["a"])(Dr,$r,Nr,!1,null,"df5aa4a2",null)),Qr=Mr.exports;je()(Mr,"components",{QBtn:Oe["a"],QSlider:Ct["a"]});var jr={name:"Preview",components:{Player:Qr},data(){return{title:""}},computed:{audioTrack(){return this.$store.getters.audioTrack},canvasObjs(){return this.$store.getters.canvasObjs},duration(){return this.$store.getters.duration},stages(){return this.$store.getters.stages},currentUser(){return this.$store.getters.currentUser},stageBgColor(){return this.$store.getters.stageBgColor},playerSize(){return this.$store.getters.playerSize}},created(){f.$on("open:uploader",this.openUploadDialog)},mounted(){this.audioTrack.blob.size||this.$q.notify({message:"音频资源已失效",type:"negative",timeout:1e4})},methods:{openUploadDialog(){this.$q.dialog({title:this.$t("preview.upload"),message:"给本次录制的微课命名",prompt:{model:this.title,isValid:e=>e.length>2,type:"text"},cancel:!0,persistent:!0}).onOk((e=>{this.publishVideo()}))},publishVideo(){this.title.length<=30&&(f.$emit("load:start","发布中..."),Ga(this.audioTrack.blob).then((e=>{let t=this.audioTrack.blob.size;this.stages.forEach((e=>{e.bg&&(t+=e.bg.size)}));const a=this.stages.find((e=>e.bg));this.$store.commit("ADD_CANVAS_OBJ",{ac:"AU",ts:1,data:e,dur:this.duration}),Ja({cd:JSON.stringify({stage:this.stages,canvas:this.canvasObjs,dur:this.duration,size:this.playerSize,bgcolor:this.stageBgColor,resSize:t}),t:this.title,dur:this.duration,cover_url:a?a.bg.url:""},(e=>{this.title="",this.dialog=!1,f.$emit("load:end"),this.$router.replace({path:`/vd/${e}`})}))})).catch((()=>{this.$q.notify({message:this.$t("preview.pubFail"),type:"negative",timeout:1e4})})))}}},Vr=jr,Wr=Object(v["a"])(Vr,xr,Or,!1,null,"473801d5",null),Hr=Wr.exports,zr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"preview-container"},[e.info.cd?a("player",{ref:"player",attrs:{audioUrl:e.info.ap,canvasObjs:e.info.cd.canvas,stages:e.info.cd.stage,duration:e.info.dur,size:e.info.cd.size,bgColor:e.info.cd.bgcolor},on:{played:e.plusPlayCount}}):e._e()],1)},Gr=[],Yr={name:"Video",components:{Player:Qr},data(){return{info:{t:"",created_by:{nickname:""}}}},computed:{currentUser(){return this.$store.getters.currentUser}},watch:{},created(){f.$on("video:fullscreen",this.requestFullscreen),f.$on("video:remove",this.removeVideo)},destroyed(){this.$store.commit("SET_VIDEO_INFO",null)},mounted(){this.getVideoBy(this.$route.params.id),window.addEventListener("orientationchange",(()=>{this.$refs.player.fitScreenWidth(),window.screen.orientation&&"landscape-primary"===window.screen.orientation.type&&this.$confirm("建议开启全屏模式, 获取最佳观看体验","提示",{type:"info",beforeClose:(e,t,a)=>{e&&this.requestFullscreen(),a()}})})),document.addEventListener("webkitfullscreenchange",(e=>{const t=document.mozFullScreen||document.webkitIsFullScreen;t||this.$refs.player.fitToOriginWidth()}))},methods:{getVideoBy(e){Za(e,(e=>{this.info=e,this.$store.commit("SET_VIDEO_INFO",e),this.$nextTick((()=>{window.screen.width<900&&this.$refs.player.fitScreenWidth()}))}))},plusPlayCount(){Xa(this.$route.params.id)},requestFullscreen(e){const t=this.$refs.player.$el;e&&this.$refs.player.fitScreenWidth(),t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()},removeVideo(){this.$q.dialog({title:"确认操作",message:"确定要删除 "+this.info.t+" 吗？无法恢复",cancel:!0,persistent:!0}).onOk((()=>{Ka(this.info.id,(e=>{this.$router.replace({path:"/mywork"})}))}))}}},Zr=Yr,Kr=Object(v["a"])(Zr,zr,Gr,!1,null,null,null),Xr=Kr.exports,Jr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[e.replyUrl?a("div",{staticClass:"text-center"},[a("video",{attrs:{width:e.info.cd.size[0],src:e.replyUrl,poster:e.coverImg,controls:""}}),a("div",[a("q-input",{attrs:{value:e.replyUrl,filled:""}})],1)]):e._e(),e.canConvert?a("div",{staticStyle:{"pointer-events":"none"}},[e.info.cd&&!e.replyUrl?a("player",{ref:"player",attrs:{canvasObjs:e.info.cd.canvas,stages:e.info.cd.stage,size:e.info.cd.size,duration:e.info.dur,scaleRate:e.scaleRate,bgColor:e.bgColor,stageMode:e.stageMode,unick:e.info.uinfo.displayName||"匿名",avatar:e.info.uinfo.photoURL||e.info.uinfo.av,title:e.info.t},on:{captureImg:e.getCaptureImg,playover:e.handleOver,getCover:function(t){return e.coverImg=t}}}):e._e()],1):e._e()])},es=[],ts=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"player-wrap"},[a("canvas-layer",{ref:"canvas",attrs:{isPlayer:!0,needCapture:!0,playerBgColor:e.bgColor,stageMode:e.stageMode,width:Math.round(e.size[0]),scale:e.scaleRate,wrapHeight:Math.round(e.size[1]>450||"center"!==e.stageMode?e.size[1]:450)}})],1)},as=[];const rs=100;var ss={name:"MiniPlayer",components:{CanvasLayer:nr},props:{canvasObjs:{type:Array,require:!0},scaleRate:{type:Number},stages:{type:Array},bgColor:{type:String},unick:{type:String},title:{type:String},cursor:{type:Boolean,default:!1},stageMode:{type:String},size:{type:Array,default(){return[900,506]}}},data(){return{currentTs:0,framesData:{}}},mounted(){this.canvasLayer=this.$refs.canvas,this.canvasObjs.length&&this.canvasLayer.genVideoCover({title:this.title,author:this.unick,avatar:this.avatar,done:e=>{this.$emit("getCover",e.toDataURL("image/png",.8)),this.preloadResource(this.startPlay)}})},beforeDestroy(){this.currentTs&&this.clock&&this.clock.cancel()},methods:{startPlay(){this.setupPlayerClock(),this.canvasLayer.toggleCursor(this.cursor)},stopPlay(){this.clock&&this.clock.cancel(),this.currentTs=0,this.canvasLayer.toggleCursor(!1),this.canvasLayer.resetLayer(),this.framesData={},this.curFid=null,this.canvasLayer.scrollLayerContainer(0),this.$emit("playover")},doEachTask(e){return new Promise(((t,a)=>{this.canvasObjs.filter((t=>e-rs<=t.ts&&t.ts<e)).forEach(this.playEachRecord),this.$emit("captureImg",this.canvasLayer.captureCurrentImage(),e),t()}))},setupPlayerClock(){this.clock=G(rs,(()=>{this.currentTs+=rs,this.doEachTask(this.currentTs)}))},playEachRecord(e){switch(e.ac){case"CSync":case"Cy":{this.canvasLayer.renderCurve(e.data,"syncLayer",!0);const t=e.data.po[e.data.po.length-1];this.canvasLayer.cursorMove({curX:t[0],curY:t[1],curOp:.5});break}case"CEnd":case"CE":this.canvasLayer.clearCtx("syncLayer"),this.canvasLayer.renderCurve(e.data);break;case"E":this.canvasLayer.removeCanvasObjs(e.data),this.canvasLayer.reRenderCanvasData();break;case"CM":this.canvasLayer.cursorMove({curX:e.data[0],curY:e.data[1],curOp:1});break;case"F":case"Frame":{this.preFid=this.curFid;let t=0;"object"===typeof e.data?(this.curFid=e.data.id,t=e.data.top):this.curFid=e.data,this.preFid&&(this.framesData[this.preFid]=this.canvasLayer.canvasObjs),this.frameChange(this.curFid,t);break}case"SL":this.canvasLayer.scrollLayerContainer(e.data);break;case"SEnd":this.canvasLayer.renderShape(e.data);break;case"End":this.progress=100,this.stopPlay();break;case"CC":this.canvasLayer.cursorMove({curColor:e.data});break;case"UE":this.canvasLayer.batchRenderObjs(e.data);for(const t of e.data)this.canvasLayer.addCanvasObj(t);break}},preloadResource(e){this.canvasLayer.preloadStages(this.stages),e()},async frameChange(e,t){const a=this.stages.find((t=>t.id===e));if(a){const e=a.bg;await this.canvasLayer.updateHeight(e?e.h:this.size[1]).then((()=>{this.canvasLayer.reRenderCanvasData(this.framesData[a.id]||[]),e&&this.canvasLayer.setStageLayer(e,a.id),this.canvasLayer.scrollLayerContainer(t)}))}},parseRealPathByRange(e,t){let a,r,s,i,n;const o=["F","CEnd","E","SEnd","CC","UE","SL"];let c=[];const l=this.canvasObjs.filter((a=>o.indexOf(a.ac)>-1&&e<=a.ts&&a.ts<=t));0===e&&(s={},a=r=null);for(const d of l)switch(d.ac){case"CEnd":case"SEnd":c.push(d.data);break;case"SL":i=d.data;break;case"CC":n=d.data;break;case"E":c=c.filter((e=>d.data.indexOf(e.id)<0));break;case"UE":Array.isArray(d.data)&&c.concat(d.data);break;case"F":0===e?(a=r,r=d.data,a&&(s[a]=c.slice(0)),c=s[r]||[]):c=[];break}return 0===e?{cd:c,framesData:s,curFid:r,top:i,color:n}:{cd:c,top:i}}}},is=ss,ns=(a("f072"),Object(v["a"])(is,ts,as,!1,null,"eb2536ee",null)),os=ns.exports,cs=(a("c19f"),a("cfc3"),a("4a9b"),function(e){this.data=new Uint8Array(e),this.pos=0});cs.prototype.seek=function(e){this.pos=e},cs.prototype.writeBytes=function(e){for(var t=0;t<e.length;t++)this.data[this.pos++]=e[t]},cs.prototype.writeByte=function(e){this.data[this.pos++]=e},cs.prototype.writeU8=cs.prototype.writeByte,cs.prototype.writeU16BE=function(e){this.data[this.pos++]=e>>8,this.data[this.pos++]=e},cs.prototype.writeDoubleBE=function(e){for(var t=new Uint8Array(new Float64Array([e]).buffer),a=t.length-1;a>=0;a--)this.writeByte(t[a])},cs.prototype.writeFloatBE=function(e){for(var t=new Uint8Array(new Float32Array([e]).buffer),a=t.length-1;a>=0;a--)this.writeByte(t[a])},cs.prototype.writeString=function(e){for(var t=0;t<e.length;t++)this.data[this.pos++]=e.charCodeAt(t)},cs.prototype.writeEBMLVarIntWidth=function(e,t){switch(t){case 1:this.writeU8(128|e);break;case 2:this.writeU8(64|e>>8),this.writeU8(e);break;case 3:this.writeU8(32|e>>16),this.writeU8(e>>8),this.writeU8(e);break;case 4:this.writeU8(16|e>>24),this.writeU8(e>>16),this.writeU8(e>>8),this.writeU8(e);break;case 5:this.writeU8(8|e/4294967296&7),this.writeU8(e>>24),this.writeU8(e>>16),this.writeU8(e>>8),this.writeU8(e);break;default:throw new RuntimeException("Bad EBML VINT size "+t)}},cs.prototype.measureEBMLVarInt=function(e){if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<268435455)return 4;if(e<34359738367)return 5;throw new RuntimeException("EBML VINT size not supported "+e)},cs.prototype.writeEBMLVarInt=function(e){this.writeEBMLVarIntWidth(e,this.measureEBMLVarInt(e))},cs.prototype.writeUnsignedIntBE=function(e,t){switch(void 0===t&&(t=this.measureUnsignedInt(e)),t){case 5:this.writeU8(Math.floor(e/4294967296));case 4:this.writeU8(e>>24);case 3:this.writeU8(e>>16);case 2:this.writeU8(e>>8);case 1:this.writeU8(e);break;default:throw new RuntimeException("Bad UINT size "+t)}},cs.prototype.measureUnsignedInt=function(e){return e<256?1:e<65536?2:e<1<<24?3:e<4294967296?4:5},cs.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayBufferDataStream's pos lies beyond end of buffer"};var ls=cs,ds=a("ad16"),us=function(e,t){function a(e,t){var a={};return[e,t].forEach((function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])})),a}function r(e){return!("string"!==typeof e||!e.match(/^data:image\/webp;base64,/i))&&window.atob(e.substring("data:image/webp;base64,".length))}function s(e,t){var a=e.toDataURL("image/webp",t);return r(a)}function i(e){var t=e.indexOf("VP8 ");if(-1==t)throw"Failed to identify beginning of keyframe in WebP image";return t+="VP8 ".length+4,e.substring(t)}function n(e){this.value=e}function o(e){this.value=e}function c(e,t,a){if(Array.isArray(a))for(var r=0;r<a.length;r++)c(e,t,a[r]);else if("string"===typeof a)e.writeString(a);else if(a instanceof Uint8Array)e.writeBytes(a);else{if(!a.id)throw"Bad EBML datatype "+typeof a.data;var s,i,l;if(a.offset=e.pos+t,e.writeUnsignedIntBE(a.id),Array.isArray(a.data))-1===a.size?e.writeByte(255):(s=e.pos,e.writeBytes([0,0,0,0])),i=e.pos,a.dataOffset=i+t,c(e,t,a.data),-1!==a.size&&(l=e.pos,a.size=l-i,e.seek(s),e.writeEBMLVarIntWidth(a.size,4),e.seek(l));else if("string"===typeof a.data)e.writeEBMLVarInt(a.data.length),a.dataOffset=e.pos+t,e.writeString(a.data);else if("number"===typeof a.data)a.size||(a.size=e.measureUnsignedInt(a.data)),e.writeEBMLVarInt(a.size),a.dataOffset=e.pos+t,e.writeUnsignedIntBE(a.data,a.size);else if(a.data instanceof o)e.writeEBMLVarInt(8),a.dataOffset=e.pos+t,e.writeDoubleBE(a.data.value);else if(a.data instanceof n)e.writeEBMLVarInt(4),a.dataOffset=e.pos+t,e.writeFloatBE(a.data.value);else{if(!(a.data instanceof Uint8Array))throw"Bad EBML datatype "+typeof a.data;e.writeEBMLVarInt(a.data.byteLength),a.dataOffset=e.pos+t,e.writeBytes(a.data)}}}return function(r){var n,l,d,u,h=5e3,p=1,f=!1,m=[],g=0,v=0,y={quality:.95,fileWriter:null,fd:null,frameDuration:null,frameRate:null},b={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},w={id:17545,data:new o(0)},C=[],_=new t(r.fileWriter||r.fd);function k(e){return e-d.dataOffset}function L(){var e={id:21420,size:5,data:0},t={id:290298740,data:[]};for(var a in b){var r=b[a];r.positionEBML=Object.create(e),t.data.push({id:19899,data:[{id:21419,data:r.id},r.positionEBML]})}return t}function A(){u=L();var t={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},a={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},w]},r={id:374648427,data:[{id:174,data:[{id:215,data:p},{id:29637,data:p},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:[{id:176,data:n},{id:186,data:l}]}]}]};d={id:408125543,size:-1,data:[u,a,r]};var s=new e(256);c(s,_.pos,[t,d]),_.write(s.getAsDataArray()),b.SegmentInfo.positionEBML.data=k(a.offset),b.Tracks.positionEBML.data=k(r.offset)}function E(t){var a=new e(4);if(!(t.trackNumber>0&&t.trackNumber<127))throw"TrackNumber must be > 0 and < 127";return a.writeEBMLVarInt(t.trackNumber),a.writeU16BE(t.timecode),a.writeByte(128),{id:163,data:[a.getAsDataArray(),t.frame]}}function S(e){return{id:524531317,data:[{id:231,data:Math.round(e.timecode)}]}}function R(e,t,a){C.push({id:187,data:[{id:179,data:t},{id:183,data:[{id:247,data:e},{id:241,data:k(a)}]}]})}function T(){var t={id:475249515,data:C},a=new e(16+32*C.length);c(a,_.pos,t),_.write(a.getAsDataArray()),b.Cues.positionEBML.data=k(t.offset)}function q(){if(0!=m.length){for(var t=0,a=0;a<m.length;a++)t+=m[a].frame.length;var r=new e(t+32*m.length),s=S({timecode:Math.round(g)});for(a=0;a<m.length;a++)s.data.push(E(m[a]));c(r,_.pos,s),_.write(r.getAsDataArray()),R(p,Math.round(g),s.offset),m=[],g+=v,v=0}}function P(){if(!r.frameDuration){if(!r.frameRate)throw"Missing required frameDuration or frameRate setting";r.frameDuration=1e3/r.frameRate}}function x(e){e.trackNumber=p,e.timecode=Math.round(v),m.push(e),v+=e.duration,v>=h&&q()}function O(){var t=new e(u.size),a=_.pos;c(t,u.dataOffset,u.data),_.seek(u.dataOffset),_.write(t.getAsDataArray()),_.seek(a)}function $(){var t=new e(8),a=_.pos;t.writeDoubleBE(g),_.seek(w.dataOffset),_.write(t.getAsDataArray()),_.seek(a)}this.addFrame=function(e){if(f){if(e.width!=n||e.height!=l)throw"Frame size differs from previous frames"}else n=e.width,l=e.height,A(),f=!0;var t=s(e,{quality:r.quality});if(!t)throw"Couldn't decode WebP frame, does the browser support WebP?";x({frame:i(t),duration:r.frameDuration})},this.complete=function(){return q(),T(),O(),$(),_.complete("video/webm")},this.getWrittenSize=function(){return _.length},r=a(y,r||{}),P()}},hs=us(ls,ds["a"]),ps=a("9110");const fs=a("046a");var ms={name:"VideoConvert",components:{Player:os},data(){return{info:{t:"",unick:""},audioUrl:null,coverImg:"",canConvert:!1,scaleRate:1,bgColor:null,stageMode:null}},computed:{progress:{get(){return this.$store.getters.convertProgress},set(e){this.$store.commit("SET_CONVERT_PROGRESS",e)}},replyUrl:{get(){return this.$store.getters.replyUrl},set(e){this.$store.commit("SET_REPLY_URL",e)}}},created(){f.$on("vdc:download",(()=>{K(this.info.id+"_up17.mp4",this.replyUrl)})),f.$on("vdc:crop",this.cropVideo),f.$on("vdc:fitHeight",this.fitHeightVideo),f.$on("vdc:scaleHalf",this.scaleHalf),f.$on("vdc:upload",this.uploadVideo)},mounted(){this.ffmpeg=Object(ps["createFFmpeg"])({corePath:"https://unpkg.com/@ffmpeg/core@0.9.0-alpha.2/dist/ffmpeg-core.js",log:!0}),Za(this.$route.params.id,this.initData)},methods:{initWebmWriter(){this.encoder=new hs({quality:1,frameRate:10,fd:this.ffmpeg.FS("open",this.info.id+"2.webm","w+")})},cropVideo(){this.canConvert=!1;let e=0;this.info.cd.stage.forEach((t=>{if(t.bg){const{w:a,h:r}=t.bg,s=this.info.cd.size[0]*r/a;s>e&&(e=s)}})),this.info.cd.size[1]=Math.ceil(e),this.$nextTick((()=>{this.encoder.complete().then((()=>{this.initWebmWriter(),this.canConvert=!0}))}))},scaleHalf(){this.canConvert=!1,this.scaleRate=.5,this.$nextTick((()=>{this.encoder.complete().then((()=>{this.initWebmWriter(),this.canConvert=!0}))}))},fitHeightVideo(){this.canConvert=!1;let e=this.info.cd.size[1];this.info.cd.stage.forEach((t=>{if(t.bg){const{w:a,h:r}=t.bg,s=this.info.cd.size[0]*r/a;s<e&&(e=s)}})),this.info.cd.size[1]=Math.ceil(e),this.$nextTick((()=>{this.encoder.complete().then((()=>{this.initWebmWriter(),this.canConvert=!0}))}))},async initData(e){this.$store.commit("SET_VIDEO_INFO",e);const t=e.cd.canvas.filter((e=>"AU"===e.ac));this.audioUrls=t.map((e=>ja(e.data))),this.audioDurs=t.map(((e,a)=>t[a+1]?t[a+1].ts-e.ts:e.dur)),console.log(this.audioUrls);const a=e.cd.canvas.filter((e=>"TX"===e.ac));a.length>0&&(this.subtitles=fs.stringify(a.map(((e,a)=>{const r=e.data.split("");return r.length>24&&(r.splice(24,0,"\n"),e.data=r.join("")),{start:t[a].ts,end:t[a].ts+t[a].dur,text:e.data}}))),this.bgColor="#000",this.stageMode="center");const r=this.$q.dialog({message:"正在加载转码组件",progress:!0,persistent:!0,ok:!1});await this.ffmpeg.load(),this.vdRecords=e.cd.canvas.filter((e=>"VD"===e.ac)).map((e=>({url:e.data.url,ts:e.ts}))),console.log(JSON.stringify(this.vdRecords)),this.info=e,this.initWebmWriter(),this.canConvert=!0,r.hide()},getCaptureImg(e,t){this.encoder.addFrame(e),t<this.info.dur&&(this.progress="正在导出... "+Math.floor(100*t/this.info.dur)+" %")},handleOver(){const e=this.subtitles?"mp3":"m4a";this.encoder.complete().then((async t=>{const a=await this.downloadAudio(),r=URL.createObjectURL(t);this.subtitles&&(this.progress="正在生成字幕文件...",console.log(this.subtitles),this.ffmpeg.FS("writeFile",this.info.id+".srt",this.subtitles));let s=a[0];a.length>1&&(s=await this.combineAudios(a,e)),this.ffmpeg.FS("writeFile",this.info.id+".webm",await Object(ps["fetchFile"])(r)),this.output="output.mp4",await this.ffmpeg.run("-i",this.info.id+".webm","-i",s,this.output),this.subtitles&&(this.output="output2.mp4",await this.ffmpeg.run("-i","output.mp4","-filter_complex","subtitles=filename="+this.info.id+".srt","-y",this.output));const i=this.ffmpeg.FS("readFile",this.output);this.progress=null,this.replyUrl=URL.createObjectURL(new Blob([i.buffer],{type:"video/mp4"})),this.$q.notify({type:"positive",message:"MP4视频导出完成"})}))},async combineAudios(e,t="m4a"){this.progress="合并多个音频...";const a=`${this.info.id}_allin.${t}`;return await this.ffmpeg.run("-i",`concat:${e.join("|")}`,"-acodec","copy",a),this.progress="所有音频合并完成",e.forEach((e=>{this.ffmpeg.FS("unlink",e)})),a},downloadAudio(e="m4a"){this.progress="正在处理音频...";const t=[],a=this.audioUrls[0].split(".");return"aac"===a[a.length-1]&&(e="aac"),this.audioUrls.forEach(((a,r)=>{t.push(new Promise(((t,s)=>{const i=`${this.info.id}_${r}.${e}`;Object(ps["fetchFile"])(a).then((e=>{this.ffmpeg.FS("writeFile",i,e),t(i)}))})))})),Promise.all(t)},uploadVideo(){ar(this.ffmpeg.FS("readFile",this.output))}}},gs=ms,vs=Object(v["a"])(gs,Jr,es,!1,null,null,null),ys=vs.exports;je()(vs,"components",{QInput:Gt["a"]});var bs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"q-pa-md"},[a("div",{staticClass:"filter-panel"},[a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col"},[a("q-input",{attrs:{dense:"",outlined:"",label:"选择开始日期",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{model:{value:e.started_at,callback:function(t){e.started_at=t},expression:"started_at"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:e.started_at,callback:function(t){e.started_at=t},expression:"started_at"}})],1),a("div",{staticClass:"col"},[a("q-input",{attrs:{dense:"",outlined:"",label:"选择结束日期",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{model:{value:e.ended_at,callback:function(t){e.ended_at=t},expression:"ended_at"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:e.ended_at,callback:function(t){e.ended_at=t},expression:"ended_at"}})],1),a("div",{staticClass:"col"},[a("q-input",{attrs:{dense:"",outlined:"",label:"观看次数<",type:"number"},model:{value:e.lt_count,callback:function(t){e.lt_count=t},expression:"lt_count"}})],1),a("div",{staticClass:"col"},[a("q-input",{attrs:{dense:"",outlined:"",label:"观看次数>",type:"number"},model:{value:e.gt_count,callback:function(t){e.gt_count=t},expression:"gt_count"}})],1),a("div",{staticClass:"col"},[a("q-btn",{attrs:{color:"primary"},on:{click:e.doFilter}},[e._v("查询")])],1)])]),a("q-infinite-scroll",{attrs:{offset:10},on:{load:e.onLoad},scopedSlots:e._u([e.hasNext?{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}:null],null,!0)},[a("q-list",{attrs:{separator:""}},[a("q-item-label",{attrs:{header:""}},[e._v(e._s(e.$t("mywork.created"))+" "+e._s(e.allCount))]),e._l(e.workList,(function(t,r){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:r,attrs:{clickable:"",to:"/vd/"+t.id}},[a("q-item-section",[a("q-item-label",[e._v(e._s(t.t))]),a("q-item-label",{attrs:{caption:""}},[a("small",[e._v("创建于")]),e._v(" "+e._s(t.c_at)+" "),a("small",[e._v("已播放")]),e._v(" "+e._s(t.count)+"\n            "),a("small",[e._v("作者")]),e._v(" "+e._s(t.created_by.displayName||t.created_by.nickname||"匿名")+"\n          ")])],1),a("q-item-section",{attrs:{side:""}},[e._v("\n          "+e._s(t.duration)+"\n        ")])],1)}))],2)],1),e.workList&&0===e.workList.length?a("div",{staticClass:"empty-tip"},[e._v("暂无任何作品")]):e._e()],1)},ws=[],Cs={name:"MyWork",data(){return{allCount:0,workList:null,hasNext:!1,started_at:null,ended_at:null,lt_count:null,gt_count:null}},methods:{doFilter(){this.loadVideos({started_at:this.started_at,ended_at:this.ended_at,lt_count:this.lt_count,gt_count:this.gt_count})},loadVideos(e={},t){this.query=e,Ya(e,((a,r,s)=>{this.hasNext=!!r;let i=a;e.offset&&(i=this.workList.concat(a)),this.workList=i,this.allCount=s,t&&t()}))},onLoad(e,t){if(1===e||this.hasNext){const e=Object.assign(this.query||{},{offset:this.workList?this.workList.length:0});this.loadVideos(e,t)}}}},_s=Cs,ks=a("52ee"),Ls=Object(v["a"])(_s,bs,ws,!1,null,null,null),As=Ls.exports;je()(Ls,"components",{QInput:Gt["a"],QIcon:Be["a"],QPopupProxy:hr["a"],QDate:ks["a"],QBtn:Oe["a"],QInfiniteScroll:Rr["a"],QList:Fe["a"],QItemLabel:bt["a"],QItem:Ue["a"],QItemSection:De["a"],QSpinnerDots:Tr["a"]}),je()(Ls,"directives",{ClosePopup:Me["a"],Ripple:kt["a"]});var Es=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"q-pa-md"},[a("q-infinite-scroll",{attrs:{offset:10},on:{load:e.onLoad},scopedSlots:e._u([e.hasNext?{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}:null],null,!0)},[a("q-list",{attrs:{separator:""}},[a("q-item-label",{attrs:{header:""}},[e._v(e._s(e.$t("mywork.created"))+" "+e._s(e.allCount))]),e._l(e.workList,(function(t,r){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:r,attrs:{clickable:"",to:"/vd/"+t.vid}},[a("q-item-section",[a("q-item-label",[e._v(e._s(t.vid))]),a("q-item-label",{attrs:{caption:""}},[a("small",[e._v("创建于")]),e._v(" "+e._s(t.c_at)+"\n          ")])],1),a("q-item-section",{attrs:{side:""}},[e._v("\n          "+e._s(t.created_by.displayName||t.created_by.nickname||"匿名")+"\n        ")])],1)}))],2)],1),e.workList&&0===e.workList.length?a("div",{staticClass:"empty-tip"},[e._v("暂无任何任务")]):e._e()],1)},Ss=[],Rs={name:"TaskList",data(){return{allCount:0,workList:null,hasNext:!1}},methods:{loadVideos(e={},t){this.query=e,tr(e,((a,r,s)=>{this.hasNext=!!r;let i=a;e.offset&&(i=this.workList.concat(a)),this.workList=i,this.allCount=s,t&&t()}))},onLoad(e,t){if(1===e||this.hasNext){const e=Object.assign(this.query||{},{offset:this.workList?this.workList.length:0});this.loadVideos(e,t)}}}},Ts=Rs,qs=Object(v["a"])(Ts,Es,Ss,!1,null,null,null),Ps=qs.exports;je()(qs,"components",{QInfiniteScroll:Rr["a"],QList:Fe["a"],QItemLabel:bt["a"],QItem:Ue["a"],QItemSection:De["a"],QSpinnerDots:Tr["a"]}),je()(qs,"directives",{Ripple:kt["a"]});const xs=[{path:"/",component:sa,children:[{path:"",name:"editor",component:kr},{path:"mywork",name:"mywork",component:Pr},{path:"preview",name:"preview",component:Hr},{path:"/vd/:id",name:"video",component:Xr},{path:"/vdc/:id",name:"videoconvert",component:ys},{path:"/worklist",name:"worklist",component:As},{path:"/tasklist",name:"tasklist",component:Ps}]},{path:"*",component:()=>a.e(2).then(a.bind(null,"e51e"))}];var Os=xs;r["a"].use(ke["a"]);var $s=function(){const e=new ke["a"]({scrollBehavior(e,t,a){return e.hash?{selector:e.hash}:a||{x:0,y:0}},routes:Os,mode:"hash",base:""});return e},Ns=async function(){const e="function"===typeof _e?await _e({Vue:r["a"]}):_e,t="function"===typeof $s?await $s({Vue:r["a"],store:e}):$s;e.$router=t;const a={router:t,store:e,render:e=>e(b),el:"#q-app"};return{app:a,store:e,router:t}},Bs=a("ef55"),Is=a.n(Bs),Fs=({app:e,router:t,store:a,Vue:r})=>{r.use(Is.a),Qt.a.init("1e40ebdba903ddf4aa47",{logLevel:"debug"});const s="0.1.0";console.log("debug ",!1),console.log("最新部署版本: ",s),a.getters.buildVersion!==s&&a.commit("SET_BUILD_VERSION",s),document.body.addEventListener("touchmove",(e=>{e.preventDefault()})),Qt.a.auth.getCurrentUser().then((e=>{a.commit("SET_CURRENT_USER",e.toJSON())}))},Us=a("a925"),Ds={app:{cancelBtn:"Cancel",confirmBtn:"Confirm",requireLoginTip:"Please login your account",loading:"loading..."},account:{userLogin:"User Login",userRegister:"New User Register",email:"Email",pwd:"Password",nick:"Nickname",login:"Login",register:"Register"},editor:{recordStart:"Record",pause:"Pause",resume:"Resume",paused:"Paused",resumed:"Resumed",mywork:"My work",preference:"Preference",canvasPref:"Canvas",pencilPref:"Pencil",langPref:"Language",blackboardMode:"Blackboard Mode",blackboardModeSub:"fit all frames",pencilT:"Pencil Tolerance",pencilTSub:"smaller better",feedback:"Feedback",viewFrameList:"Frame List",deleteCurFrame:"Remove Current Frame",pausedRecordTip:"Record Paused",recordResume:"Resume Record",canvasHTip:"Current canvas height limited to ",frameNo:"Page {cur} of {len}",recordNotSupport:"Current device does not support audio recording",graph:"Graph",legend:"Legend"},ctrlBar:{line:"Line",arrowLine:"Arrow Line",circle:"Circle",rect:"Rect",pen:"Pencil",shape:"Shape",eraser:"Eraser",undoErase:"Undo Last Erase",penWidth:"Pencil Width",penColor:"Pick Color",uploadPdf:"Upload PDF",opacity:"Opacity Mode",penWidthVal:"Current {px} pixel"},mywork:{title:"My Work",changeAccount:"Change Account",login:"Login",uploadLocal:"Upload Local Course",created:"Created"},contact:{title:"Contact Me",guide:"User Guide"},preview:{title:"Preview",upload:"Upload & Publish",save:"Save To Local",pubBtn:"Publish",pubFail:"Publish failed!"},worklist:{title:"Work List"},tasklist:{title:"Task List"},video:{download:"Download this video to local"}},Ms={app:{cancelBtn:"取消",confirmBtn:"确定",requireLoginTip:"请先登录您的账号",loading:"加载中..."},account:{userLogin:"用户登录",userRegister:"新用户注册",email:"邮箱",pwd:"密码",nick:"昵称",login:"登录",register:"注册"},editor:{recordStart:"开始录制",pause:"暂停",resume:"继续",paused:"已暂停",resumed:"已继续",mywork:"我的微课",preference:"偏好设置",canvasPref:"画布配置",langPref:"语言设置",pencilPref:"笔迹配置",blackboardMode:"模拟黑板背景",blackboardModeSub:"影响所有页面背景色",pencilT:"笔迹灵敏度",pencilTSub:"越小越灵敏",feedback:"反馈",viewFrameList:"分页快速预览",deleteCurFrame:"删除当前页",pausedRecordTip:"已暂停录制",recordResume:"继续录制",canvasHTip:"当前画布录制高度限定为",frameNo:"第 {cur}/{len} 页",recordNotSupport:"当前设备不支持语音录制",graph:"图表",legend:"英雄志"},ctrlBar:{line:"直线",arrowLine:"箭头",circle:"圆形",rect:"矩形",pen:"画笔",shape:"作图",eraser:"橡皮擦",undoErase:"撤销擦除",penWidth:"画笔粗细",penColor:"画笔调色",uploadPdf:"上传课件",opacity:"荧光模式",penWidthVal:"当前 {px} 像素"},mywork:{title:"我的微课",changeAccount:"切换账号",login:"去登录",uploadLocal:"上传本地微课",created:"已创作"},contact:{title:"向作者反馈",guide:"用户指南"},preview:{title:"预览",upload:"上传并发布",save:"保存到本地",pubBtn:"发布",pubFail:"发布失败"},worklist:{title:"作品列表"},tasklist:{title:"任务列表"},video:{download:"下载此微课到本地"}},Qs={en:Ds,zh:Ms};r["a"].use(Us["a"]);const js=new Us["a"]({locale:"zh",fallbackLocale:"zh",messages:Qs});var Vs=({app:e})=>{e.i18n=js},Ws=a("bc3a"),Hs=a.n(Ws);r["a"].prototype.$axios=Hs.a;const zs="";async function Gs(){const{app:e,store:t,router:a}=await Ns();let s=!1;const i=e=>{s=!0;const t=Object(e)===e?a.resolve(e).route.fullPath:e;window.location.href=t},n=window.location.href.replace(window.location.origin,""),o=[Fs,Vs,void 0];for(let l=0;!1===s&&l<o.length;l++)if("function"===typeof o[l])try{await o[l]({app:e,router:a,store:t,Vue:r["a"],ssrContext:null,redirect:i,urlPath:n,publicPath:zs})}catch(c){return c&&c.url?void(window.location.href=c.url):void console.error("[Quasar] boot error:",c)}!0!==s&&new r["a"](e)}Gs()},3:function(e,t){},"3cdd":function(e,t,a){"use strict";a("8be0")},"3e6e":function(e,t,a){},4:function(e,t){},"41ed":function(e,t,a){},5:function(e,t){},7315:function(e,t,a){"use strict";a("a7ec")},"7e6d":function(e,t,a){},8008:function(e,t,a){"use strict";a("41ed")},"8be0":function(e,t,a){},a7ec:function(e,t,a){},ad16:function(e,t,a){"use strict";(function(e){a("c19f"),a("ace4"),a("e6cf"),a("5cc6");var r=function(t){return function(a){var r=[],s=Promise.resolve(),i=null,n=null;function o(e){return new Promise((function(t,a){var r=new FileReader;r.addEventListener("loadend",(function(){t(r.result)})),r.readAsArrayBuffer(e)}))}function c(e){return new Promise((function(t,a){e instanceof Uint8Array?t(e):e instanceof ArrayBuffer||ArrayBuffer.isView(e)?t(new Uint8Array(e)):e instanceof Blob?t(o(e).then((function(e){return new Uint8Array(e)}))):t(o(new Blob([e])).then((function(e){return new Uint8Array(e)})))}))}function l(e){var t=e.byteLength||e.length||e.size;if(!Number.isInteger(t))throw"Failed to determine size of element";return t}"undefined"!==typeof FileWriter&&a instanceof FileWriter?i=a:t&&a&&(n=a),this.pos=0,this.length=0,this.seek=function(e){if(e<0)throw"Offset may not be negative";if(isNaN(e))throw"Offset may not be NaN";if(e>this.length)throw"Seeking beyond the end of file is not allowed";this.pos=e},this.write=function(a){var o={offset:this.pos,data:a,length:l(a)},d=o.offset>=this.length;this.pos+=o.length,this.length=Math.max(this.length,this.pos),s=s.then((function(){if(n)return new Promise((function(a,r){c(o.data).then((function(r){var s=0,i=e.from(r.buffer),c=function(e,r,i){s+=r,s>=i.length?a():t.write(n,i,s,i.length-s,o.offset+s,c)};t.write(n,i,0,i.length,o.offset,c)}))}));if(i)return new Promise((function(e,t){i.onwriteend=e,i.seek(o.offset),i.write(new Blob([o.data]))}));if(!d)for(var a=0;a<r.length;a++){var s=r[a];if(!(o.offset+o.length<=s.offset||o.offset>=s.offset+s.length)){if(o.offset<s.offset||o.offset+o.length>s.offset+s.length)throw new Error("Overwrite crosses blob boundaries");return o.offset==s.offset&&o.length==s.length?void(s.data=o.data):c(s.data).then((function(e){return s.data=e,c(o.data)})).then((function(e){o.data=e,s.data.set(o.data,o.offset-s.offset)}))}}r.push(o)}))},this.complete=function(e){return s=n||i?s.then((function(){return null})):s.then((function(){for(var t=[],a=0;a<r.length;a++)t.push(r[a].data);return new Blob(t,{mimeType:e})})),s}}};t["a"]=r(null)}).call(this,a("b639").Buffer)},e427:function(e,t,a){},ebf5:function(e,t,a){"use strict";a("e427")},f072:function(e,t,a){"use strict";a("3e6e")}});