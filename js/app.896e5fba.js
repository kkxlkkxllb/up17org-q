(function(t){function e(e){for(var a,i,o=e[0],c=e[1],l=e[2],u=0,h=[];u<o.length;u++)i=o[u],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&h.push(n[i][0]),n[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);d&&d(e);while(h.length)h.shift()();return s.push.apply(s,l||[]),r()}function r(){for(var t,e=0;e<s.length;e++){for(var r=s[e],a=!0,i=1;i<r.length;i++){var c=r[i];0!==n[c]&&(a=!1)}a&&(s.splice(e--,1),t=o(o.s=r[0]))}return t}var a={},n={0:0},s=[];function i(t){return o.p+"js/"+({}[t]||t)+"."+{2:"97da1bd5"}[t]+".js"}function o(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.e=function(t){var e=[],r=n[t];if(0!==r)if(r)e.push(r[2]);else{var a=new Promise((function(e,a){r=n[t]=[e,a]}));e.push(r[2]=a);var s,c=document.createElement("script");c.charset="utf-8",c.timeout=120,o.nc&&c.setAttribute("nonce",o.nc),c.src=i(t);var l=new Error;s=function(e){c.onerror=c.onload=null,clearTimeout(u);var r=n[t];if(0!==r){if(r){var a=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",l.name="ChunkLoadError",l.type=a,l.request=s,r[1](l)}n[t]=void 0}};var u=setTimeout((function(){s({type:"timeout",target:c})}),12e4);c.onerror=c.onload=s,document.head.appendChild(c)}return Promise.all(e)},o.m=t,o.c=a,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(r,a,function(e){return t[e]}.bind(null,a));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=e,c=c.slice();for(var u=0;u<c.length;u++)e(c[u]);var d=l;s.push([0,1]),r()})({0:function(t,e,r){t.exports=r("2f39")},"0440":function(t,e,r){"use strict";r("814e")},1:function(t,e){},1195:function(t,e){t.exports="data:image/png;base64,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"},2:function(t,e){},"2f39":function(t,e,r){"use strict";r.r(e);r("e6cf"),r("5319"),r("7d6e"),r("e54f"),r("62f2"),r("7e6d");var a=r("2b0e"),n=r("bf69"),s=r("42d2"),i=r("b05d"),o=r("2a19"),c=r("1b3f"),l=r("b12a"),u=r("436b"),d=r("5dab");a["a"].use(i["a"],{config:{notify:{position:"top",timeout:5e3,textColor:"white",actions:[{icon:"close",color:"white"}]},loadingBar:{color:"secondary"}},lang:n["a"],iconSet:s["a"],plugins:{Notify:o["a"],LoadingBar:c["a"],AppFullscreen:l["a"],Dialog:u["a"],AppVisibility:d["a"]}});var h=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"q-app"}},[r("router-view")],1)},p=[];const f=new a["a"];var m={name:"App",computed:{currentUser(){return this.$store.getters.currentUser}},created(){this.$q.iconMapFn=t=>{if(!0===t.startsWith("if:")){const e=t.substring(3);return{cls:"iconfont "+e}}},f.$on("logout",this.handleLogout),this.$root.$on("logout",this.handleLogout),this.currentUser},watch:{"$q.appVisible"(t){console.log(t?"App became visible":"App went in the background")}},mounted(){this.setDocumentVh(),window.addEventListener("resize",this.setDocumentVh)},methods:{setDocumentVh(){const t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`)},handleLogout(){this.$store.commit("SET_CURRENT_USER",null)}}},g=m,y=r("2877"),v=Object(y["a"])(g,h,p,!1,null,null,null),b=v.exports,w=r("2f62"),C=r("0e44");const _="CHANGE_CANVAS_COLOR",L="CHANGE_CANVAS_OPACITY",k="CHANGE_CANVAS_BG_COLOR",S="CHANGE_CANVAS_LINE_WIDTH",x="CHANGE_CANVAS_LAYER",R="CHANGE_CANVAS_VIEW_SIZE",T="CHANGE_CANVAS_SHAPE_TYPE",E="CHANGE_CURRENT_FRAME",A="SET_CANVAS_OBJS",P="ADD_CANVAS_OBJ",O="SET_AUDIO_TRACK",q="SET_STAGE_OBJS",M="SET_STAGE_BG_COLOR",I="SET_PLAYER_SIZE",$="SET_CURRENT_TS",N="SET_CURRENT_DUR",F="SET_RECORD_PAUSE",j="SET_CONVERT_PROGRESS",D="SET_REPLY_URL",B="INSERT_FRAME_BY_IMAGES",U="INSERT_FRAME_BY_IMAGE",Q="REMOVE_FRAME_BY_NUM",W="SET_CURRENT_USER",V="SET_PREFERENCE",H="SET_BUILD_VERSION",G="SET_VIDEO_INFO",z="SET_VIDEO_IMGS_IN_USED";r("c975"),r("ace4"),r("5cc6");function Y(t,e){let r,a,n;return r=(new Date).getTime()+t,a=null,n=function(){return r+=t,a=setTimeout(n,r-(new Date).getTime()),e()},a=setTimeout(n,r-(new Date).getTime()),{cancel:()=>clearTimeout(a)}}function X(t,e){const r=t.replace("#",""),a=parseInt(r.substring(0,2),16),n=parseInt(r.substring(2,4),16),s=parseInt(r.substring(4,6),16);return"rgba("+a+","+n+","+s+","+e/100+")"}function Z(t){let e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);const r=t.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(e.length);let n=0;while(n<e.length)a[n]=e.charCodeAt(n),n++;return new Blob([a],{type:r})}function K(t,e){const r=document.createElement("a");r.setAttribute("download",t),r.setAttribute("href",e),r.click()}const J={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,r,a,n,s,i,o,c="",l=0;t=this._utf8_encode(t);while(l<t.length)e=t.charCodeAt(l++),r=t.charCodeAt(l++),a=t.charCodeAt(l++),n=e>>2,s=(3&e)<<4|r>>4,i=(15&r)<<2|a>>6,o=63&a,isNaN(r)?i=o=64:isNaN(a)&&(o=64),c=c+this._keyStr.charAt(n)+this._keyStr.charAt(s)+this._keyStr.charAt(i)+this._keyStr.charAt(o);return c},decode:function(t){var e,r,a,n,s,i,o,c="",l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<t.length)n=this._keyStr.indexOf(t.charAt(l++)),s=this._keyStr.indexOf(t.charAt(l++)),i=this._keyStr.indexOf(t.charAt(l++)),o=this._keyStr.indexOf(t.charAt(l++)),e=n<<2|s>>4,r=(15&s)<<4|i>>2,a=(3&i)<<6|o,c+=String.fromCharCode(e),64!=i&&(c+=String.fromCharCode(r)),64!=o&&(c+=String.fromCharCode(a));return c=this._utf8_decode(c),c},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var a=t.charCodeAt(r);a<128?e+=String.fromCharCode(a):a>127&&a<2048?(e+=String.fromCharCode(a>>6|192),e+=String.fromCharCode(63&a|128)):(e+=String.fromCharCode(a>>12|224),e+=String.fromCharCode(a>>6&63|128),e+=String.fromCharCode(63&a|128))}return e},_utf8_decode:function(t){var e,r,a,n="",s=0;e=r=0;while(s<t.length)e=t.charCodeAt(s),e<128?(n+=String.fromCharCode(e),s++):e>191&&e<224?(r=t.charCodeAt(s+1),n+=String.fromCharCode((31&e)<<6|63&r),s+=2):(r=t.charCodeAt(s+1),a=t.charCodeAt(s+2),n+=String.fromCharCode((15&e)<<12|(63&r)<<6|63&a),s+=3);return n}},tt={color:"#1d1d1d",colorIndex:3,lineWidth:2,bgColor:"#fff",layerType:"C",shapeType:"L",isOpacity:!1,viewSize:[900,506]},et={currentBgColor:t=>t.bgColor,isOpacity:t=>t.isOpacity,currentColor:t=>t.isOpacity?X(t.color,50):t.color,currentLineWidth:t=>t.lineWidth,currentLayerType:t=>t.layerType,colorIndex:t=>t.colorIndex,currentShapeType:t=>t.shapeType,viewSize:t=>{let e=window.screen.availWidth;const r=window.screen.availHeight;if(Math.min(e,r)<450){e>560&&(e=560);const t=e<r?4/3:3/4,a=parseInt(t*e,10);return[e,a]}return t.viewSize}},rt={[k](t,e){t.bgColor=e},[_](t,{color:e,idx:r}){t.color=e,t.colorIndex=r+1},[S](t,e){t.lineWidth=e},[x](t,e){t.layerType=e},[T](t,e){t.shapeType=e},[L](t,e){t.isOpacity=e},[R](t,e){t.viewSize=e}};var at={state:tt,getters:et,mutations:rt};const nt={canvasObjs:[],audioTrack:{url:null,blob:null},stages:[],stageBgColor:"#fff",playerSize:[],currentTs:0,currentDur:0,recordPaused:!1,convertProgress:"",replyUrl:null},st={canvasObjs:t=>t.canvasObjs,duration:t=>{const e=t.canvasObjs.find((t=>"End"===t.ac));return e?e.ts:0},audioTrack:t=>t.audioTrack,stages:t=>t.stages,stageBgColor:t=>t.stageBgColor,playerSize:t=>t.playerSize,currentTs:t=>t.currentTs,currentDur:t=>t.currentDur,recordPaused:t=>t.recordPaused,convertProgress:t=>t.convertProgress,replyUrl:t=>t.replyUrl},it={[A](t,e){t.canvasObjs=e},[P](t,e){t.canvasObjs.push(e)},[O](t,e){t.audioTrack=e},[q](t,e){t.stages=e},[M](t,e){t.stageBgColor=e},[I](t,e){t.playerSize=e},[$](t,e){t.currentTs=e},[N](t,e){t.currentDur=e},[F](t,e){t.recordPaused=e},[j](t,e){t.convertProgress=e},[D](t,e){t.replyUrl=e}};var ot={state:nt,getters:st,mutations:it},ct=(r("a434"),r("8dee")),lt=r.n(ct);const ut={frameNo:1,frameList:[{id:lt.a.generate()}]},dt={currentFrame:t=>t.frameNo,frameList:t=>t.frameList,currentFid:t=>t.frameList[t.frameNo-1].id},ht={[E](t,e){e>0&&(t.frameNo=e),e>t.frameList.length&&t.frameList.push({id:lt.a.generate()})},[U](t,e){t.frameList.splice(t.frameNo,0,{id:lt.a.generate(),bg:e}),t.frameNo+=1},[B](t,e){const r=t.frameList.length;e.forEach((e=>{t.frameList.push({id:lt.a.generate(),bg:e})})),e.length>0&&(t.frameNo=r+1)},[Q](t,e){t.frameList.splice(e-1,1)}};var pt={state:ut,getters:dt,mutations:ht};const ft={currentUser:null,buildVersion:null,preferences:{tolerance:4,lang:navigator.language.match(/zh/)?"zh":"en"}},mt={currentUser:t=>t.currentUser,preferences:t=>t.preferences},gt={[W](t,e){t.currentUser=e},[V](t,e){t.preferences=Object.assign({},t.preferences,e)},[H](t,e){t.buildVersion=e}};var yt={state:ft,getters:mt,mutations:gt};const vt={videoInfo:null,videoImgsInUsed:[]},bt={videoInfo:t=>t.videoInfo,videoImgsInUsed:t=>t.videoImgsInUsed},wt={[G](t,e){t.videoInfo=e},[z](t,e){t.videoImgsInUsed=e}};var Ct={state:vt,getters:bt,mutations:wt};a["a"].use(w["a"]);const _t=Object(C["a"])({paths:["user","video.videoImgsInUsed"]});var Lt=function(){const t=new w["a"].Store({plugins:[_t],modules:{canvas:at,record:ot,frame:pt,user:yt,video:Ct},strict:!1});return t},kt=r("8c4f"),St=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-layout",{attrs:{view:"hHh Lpr lFf"}},[r("q-header",["editor"===t.currentRoute?r("editor-header"):"video"===t.currentRoute?r("player-header"):"videoconvert"===t.currentRoute?r("convert-header"):r("common-header",{attrs:{showUploadBtn:"preview"===t.currentRoute}})],1),r("q-page-container",[r("router-view")],1),r("q-dialog",{model:{value:t.openDrawPref,callback:function(e){t.openDrawPref=e},expression:"openDrawPref"}},[r("draw-preference")],1),r("q-dialog",{model:{value:t.openColorPicker,callback:function(e){t.openColorPicker=e},expression:"openColorPicker"}},[r("color-picker")],1),r("q-dialog",{model:{value:t.openLineWidth,callback:function(e){t.openLineWidth=e},expression:"openLineWidth"}},[r("line-width")],1),r("q-dialog",{model:{value:t.openLogin,callback:function(e){t.openLogin=e},expression:"openLogin"}},[r("login-form",{on:{logined:function(e){t.openLogin=!1}}})],1)],1)},xt=[],Rt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-toolbar",[r("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"if:icon17up","aria-label":"Home",to:"/"}}),r("q-btn",{staticClass:"frame-nav-disp",attrs:{flat:"",dense:"",ripple:!1}},[t._v(t._s(t.frameNavDisplay))]),r("q-btn",{attrs:{dense:"",flat:"",icon:"delete_forever"},on:{click:t.triggerRemoveFrame}},[r("q-tooltip",[t._v(t._s(t.$t("editor.deleteCurFrame")))])],1),r("q-space"),r("q-btn",{staticClass:"record-btn",class:{recording:t.currentTs},attrs:{flat:"",icon:"fiber_manual_record",label:t.currentTs?t.currentTsDisplay:t.$t("editor.recordStart")},on:{click:t.startRecord}}),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.currentTs,expression:"currentTs"}],attrs:{dense:"",flat:"",icon:t.recordPaused?"play_arrow":"pause"},on:{click:t.pauseRecord}}),r("q-btn",{attrs:{dense:"",round:"",flat:""}},[r("q-icon",{attrs:{name:"if:icondot"}}),r("q-menu",[r("q-list",{staticStyle:{"min-width":"100px"}},[r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{to:"/mywork",clickable:""}},[r("q-item-section",[t._v(t._s(t.$t("editor.mywork")))])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.triggerShowPref}},[r("q-item-section",[t._v(t._s(t.$t("editor.preference")))])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.$q.fullscreen.toggle()}}},[r("q-item-section",[t._v(t._s(t.$q.fullscreen.isActive?"退出全屏":"全屏显示"))])],1)],1)],1)],1)],1)},Tt=[],Et=r("bd4c");const{formatDate:At}=Et["b"];var Pt={name:"EditorHeader",components:{},data(){return{}},computed:{currentTs(){return this.$store.getters.currentTs},currentDur(){return this.$store.getters.currentDur},recordPaused(){return this.$store.getters.recordPaused},currentTsDisplay(){return At(this.currentDur,"mm:ss")},currentFrame(){return this.$store.getters.currentFrame},frameList(){return this.$store.getters.frameList},frameNavDisplay(){return this.$t("editor.frameNo",{cur:this.currentFrame,len:this.frameList.length})}},methods:{triggerShowPref(){f.$emit("open:drawPref")},startRecord(){f.$emit("toggle:startRecord")},pauseRecord(){f.$emit("toggle:pauseRecord")},triggerRemoveFrame(){f.$emit("remove:frame")}}},Ot=Pt,qt=r("65c6"),Mt=r("9c40"),It=r("05c0"),$t=r("2c91"),Nt=r("0016"),Ft=r("4e73"),jt=r("1c1c"),Dt=r("66e5"),Bt=r("4074"),Ut=r("7f67"),Qt=r("eebe"),Wt=r.n(Qt),Vt=Object(y["a"])(Ot,Rt,Tt,!1,null,null,null),Ht=Vt.exports;Wt()(Vt,"components",{QToolbar:qt["a"],QBtn:Mt["a"],QTooltip:It["a"],QSpace:$t["a"],QIcon:Nt["a"],QMenu:Ft["a"],QList:jt["a"],QItem:Dt["a"],QItemSection:Bt["a"]}),Wt()(Vt,"directives",{ClosePopup:Ut["a"]});var Gt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-toolbar",[a("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"arrow_back",to:"/"}}),a("q-toolbar-title",[t._v("\n    "+t._s(t.title)+"\n  ")]),a("q-space"),t.audioTrack&&t.audioTrack.blob?a("q-btn",{attrs:{flat:"",primary:"",icon:"cloud_upload",label:t.$t("preview.upload")},on:{click:t.openUploadDialog}}):t._e(),t.currentUser?a("span",{staticClass:"q-mr-md md"},[t._v(t._s(t.currentUser.nickname))]):t._e(),t.currentUser?a("q-btn",{attrs:{flat:"",round:""}},[a("q-avatar",[t.currentUser.avatar?a("img",{attrs:{src:t.currentUser.avatar}}):a("img",{attrs:{src:r("1195")}})]),a("q-menu",[a("q-list",{staticStyle:{"min-width":"100px"}},[a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.handleLogout}},[a("q-item-section",[t._v("\n            "+t._s(t.$t("mywork.changeAccount"))+"\n          ")])],1)],1)],1)],1):t._e(),t.currentUser?t._e():a("q-btn",{attrs:{flat:"",primary:""},on:{click:t.requireLogin}},[t._v("\n    "+t._s(t.$t("mywork.login"))+"\n  ")])],1)},zt=[],Yt={name:"CommonHeader",props:["showUploadBtn"],data(){return{}},computed:{audioTrack(){return this.$store.getters.audioTrack},currentUser(){return this.$store.getters.currentUser},title(){return this.$t(`${this.$route.name}.title`)}},methods:{requireLogin(){f.$emit("requireLogin")},handleLogout(){this.$store.commit("SET_CURRENT_USER",null)},openUploadDialog(){this.currentUser?f.$emit("open:uploader"):this.requireLogin()}}},Xt=Yt,Zt=r("6ac5"),Kt=r("cb32"),Jt=Object(y["a"])(Xt,Gt,zt,!1,null,null,null),te=Jt.exports;Wt()(Jt,"components",{QToolbar:qt["a"],QBtn:Mt["a"],QToolbarTitle:Zt["a"],QSpace:$t["a"],QAvatar:Kt["a"],QMenu:Ft["a"],QList:jt["a"],QItem:Dt["a"],QItemSection:Bt["a"]}),Wt()(Jt,"directives",{ClosePopup:Ut["a"]});var ee=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-toolbar",[a("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"if:icon17up"}}),t.info?a("q-toolbar-title",[t._v("\n    "+t._s(t.info.t)+"\n  ")]):t._e(),a("q-space"),t.info?a("div",{staticClass:"q-mr-md"},[a("span",{staticClass:"q-mr-md"},[t._v(t._s(t.info.created_by.nickname))]),a("q-avatar",[t.info.created_by.avatar?a("img",{attrs:{src:t.info.created_by.avatar}}):a("img",{attrs:{src:r("1195")}})])],1):t._e(),t.info?a("q-btn",{attrs:{flat:"",round:"",icon:"more_vert"}},[a("q-menu",[a("q-list",{staticStyle:{"min-width":"100px"}},[a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",to:"/vdc/"+t.info.id}},[a("q-item-section",[t._v("\n            本地导出\n          ")])],1),a("q-separator"),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.requestFullscreen}},[a("q-item-section",[t._v("\n            全屏播放\n          ")])],1),t.isAuthor?a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.removeVideo}},[a("q-item-section",{staticClass:"text-red"},[t._v("\n            删除\n          ")])],1):t._e(),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",to:"/"}},[a("q-item-section",[t._v("\n            去创作\n          ")])],1)],1)],1)],1):t._e()],1)},re=[],ae={name:"PlayerHeader",data(){return{}},computed:{currentUser(){return this.$store.getters.currentUser},info(){return this.$store.getters.videoInfo},isAuthor(){return this.currentUser&&this.currentUser.id===this.info.created_by.id},canConvert(){if(this.info){const t=this.info.cd.canvas.filter((t=>"TX"===t.ac));return 0===t.length}return!1}},methods:{requestFullscreen(t){f.$emit("video:fullscreen")},removeVideo(){f.$emit("video:remove")},localExport(){f.$emit("video:export")}}},ne=ae,se=r("eb85"),ie=Object(y["a"])(ne,ee,re,!1,null,null,null),oe=ie.exports;Wt()(ie,"components",{QToolbar:qt["a"],QBtn:Mt["a"],QToolbarTitle:Zt["a"],QSpace:$t["a"],QAvatar:Kt["a"],QMenu:Ft["a"],QList:jt["a"],QItem:Dt["a"],QItemSection:Bt["a"],QSeparator:se["a"]}),Wt()(ie,"directives",{ClosePopup:Ut["a"]});var ce=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-toolbar",[r("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"arrow_back"},on:{click:function(e){return t.$router.back(-1)}}}),t.info?r("q-toolbar-title",[t._v("\n    "+t._s(t.info.t)+"\n  ")]):t._e(),r("q-space"),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.progress,expression:"progress"}],attrs:{flat:""}},[t._v("\n    "+t._s(t.progress)+"\n  ")]),r("q-btn",{attrs:{flat:""},on:{click:function(e){return t.triggerEvent("scaleHalf")}}},[t._v("\n    缩略\n  ")]),r("q-btn",{attrs:{flat:""},on:{click:function(e){return t.triggerEvent("fitHeight")}}},[t._v("\n    高度优先\n  ")]),r("q-btn",{attrs:{flat:""},on:{click:function(e){return t.triggerEvent("crop")}}},[t._v("\n    裁剪留白\n  ")]),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.replyUrl,expression:"replyUrl"}],attrs:{flat:"",icon:"save_alt",label:"保存到本地"},on:{click:function(e){return t.triggerEvent("download")}}})],1)},le=[],ue={name:"PlayerHeader",data(){return{}},computed:{info(){return this.$store.getters.videoInfo},progress(){return this.$store.getters.convertProgress},replyUrl(){return this.$store.getters.replyUrl}},methods:{triggerEvent(t){f.$emit("vdc:"+t)}}},de=ue,he=Object(y["a"])(de,ce,le,!1,null,null,null),pe=he.exports;Wt()(he,"components",{QToolbar:qt["a"],QBtn:Mt["a"],QToolbarTitle:Zt["a"],QSpace:$t["a"]});var fe=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-card",{staticClass:"dialog-width-sm"},[r("q-card-section",{staticClass:"row items-center q-pb-none"},[r("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("editor.preference")))]),r("q-space"),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),r("q-card-section",[r("q-list",{attrs:{separator:""}},[r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[r("q-item-section",[r("q-item-label",[t._v(t._s(t.$t("editor.blackboardMode"))+" "),r("small",{staticClass:"second"},[t._v(t._s(t.$t("editor.blackboardModeSub")))])])],1),r("q-item-section",{attrs:{side:""}},[r("q-toggle",{attrs:{color:"blue",val:!1},model:{value:t.blackboard,callback:function(e){t.blackboard=e},expression:"blackboard"}})],1)],1),r("q-item",{attrs:{tag:"label"}},[r("q-item-section",{attrs:{side:""}},[t._v("\n          "+t._s(t.$t("editor.pencilT"))+" "+t._s(t.tolerance)+" "),r("small",{staticClass:"second"},[t._v(t._s(t.$t("editor.pencilTSub")))])]),r("q-item-section",[r("q-slider",{attrs:{max:8,step:1,min:1,label:"",color:"teal"},model:{value:t.tolerance,callback:function(e){t.tolerance=e},expression:"tolerance"}})],1)],1),r("q-item",[r("q-item-section",[r("q-item-label",[t._v(t._s(t.$t("editor.langPref")))])],1),r("q-item-section",{attrs:{side:""}},[r("q-select",{attrs:{filled:"",options:t.langList,"option-value":"value","option-label":"label",dense:!0,"options-dense":!0},model:{value:t.lang,callback:function(e){t.lang=e},expression:"lang"}})],1)],1)],1)],1)],1)},me=[],ge={name:"DrawPreference",components:{},data(){return{langList:[{label:"中文",value:"zh"},{label:"English",value:"en"}]}},computed:{currentBgColor(){return this.$store.getters.currentBgColor},blackboard:{get(){return"#fff"!==this.currentBgColor},set(t){this.$store.commit("CHANGE_CANVAS_BG_COLOR",t?"#2C3E50":"#fff")}},tolerance:{get(){return this.$store.getters.preferences.tolerance},set(t){this.$store.commit("SET_PREFERENCE",{tolerance:t})}},lang:{get(){return this.$store.getters.preferences.lang},set(t){this.$store.commit("SET_PREFERENCE",{lang:t})}}}},ye=ge,ve=r("f09f"),be=r("a370"),we=r("0170"),Ce=r("9564"),_e=r("c1d0"),Le=r("ddd8"),ke=r("714f"),Se=Object(y["a"])(ye,fe,me,!1,null,null,null),xe=Se.exports;Wt()(Se,"components",{QCard:ve["a"],QCardSection:be["a"],QSpace:$t["a"],QBtn:Mt["a"],QList:jt["a"],QItem:Dt["a"],QItemSection:Bt["a"],QItemLabel:we["a"],QToggle:Ce["a"],QSlider:_e["a"],QSelect:Le["a"]}),Wt()(Se,"directives",{ClosePopup:Ut["a"],Ripple:ke["a"]});var Re=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-card",{staticClass:"dialog-width-sm"},[r("q-card-section",{staticClass:"row items-center q-pb-none"},[r("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("ctrlBar.penColor")))]),r("q-space"),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),r("q-card-section",[r("q-color",{staticClass:"my-picker",attrs:{"default-view":"palette",palette:t.colorList,"no-footer":"",flat:""},model:{value:t.color,callback:function(e){t.color=e},expression:"color"}})],1),r("q-card-section",[r("q-list",{attrs:{separator:""}},[r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[r("q-item-section",[r("q-item-label",[t._v(t._s(t.$t("ctrlBar.opacity")))])],1),r("q-item-section",{attrs:{side:""}},[r("q-toggle",{attrs:{color:"blue",val:!1},model:{value:t.isOpacity,callback:function(e){t.isOpacity=e},expression:"isOpacity"}})],1)],1)],1)],1)],1)},Te=[],Ee={name:"ColorPicker",components:{},data(){return{colorList:["#e74000","#0088ff","#1d1d1d","#ffff00","#ff9e9d","#5cb85c","#5e405f","#f5f5f5"]}},computed:{color:{get(){return this.$store.getters.currentColor},set(t){console.log(t);const e=this.colorList.indexOf(t);this.$store.commit("CHANGE_CANVAS_COLOR",{color:t,idx:e})}},isOpacity:{get(){return this.$store.getters.isOpacity},set(t){this.$store.commit("CHANGE_CANVAS_OPACITY",t)}}}},Ae=Ee,Pe=r("b498"),Oe=Object(y["a"])(Ae,Re,Te,!1,null,null,null),qe=Oe.exports;Wt()(Oe,"components",{QCard:ve["a"],QCardSection:be["a"],QSpace:$t["a"],QBtn:Mt["a"],QColor:Pe["a"],QList:jt["a"],QItem:Dt["a"],QItemSection:Bt["a"],QItemLabel:we["a"],QToggle:Ce["a"]}),Wt()(Oe,"directives",{ClosePopup:Ut["a"],Ripple:ke["a"]});var Me=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-card",{staticClass:"dialog-width-sm"},[r("q-card-section",{staticClass:"row items-center q-pb-none"},[r("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("ctrlBar.penWidth")))]),r("q-space"),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),r("q-card-section",[r("div",{staticClass:"line-wrap"},[r("div",{staticClass:"sample-line",style:t.lineWidthStyle})]),r("q-slider",{attrs:{max:20,step:1,min:1},model:{value:t.lineWidth,callback:function(e){t.lineWidth=e},expression:"lineWidth"}})],1)],1)},Ie=[],$e={name:"LineWidth",components:{},data(){return{}},computed:{color(){return this.$store.getters.currentColor},lineWidthStyle(){return"height:"+this.lineWidth+"px;background-color:"+this.color+";"},lineWidth:{get(){return this.$store.getters.currentLineWidth},set(t){this.$store.commit("CHANGE_CANVAS_LINE_WIDTH",t)}}}},Ne=$e,Fe=Object(y["a"])(Ne,Me,Ie,!1,null,null,null),je=Fe.exports;Wt()(Fe,"components",{QCard:ve["a"],QCardSection:be["a"],QSpace:$t["a"],QBtn:Mt["a"],QSlider:_e["a"]}),Wt()(Fe,"directives",{ClosePopup:Ut["a"]});var De=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-card",{staticClass:"dialog-width-sm"},[r("q-card-section",[r("q-tabs",{attrs:{shrink:"","active-color":"primary"},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[r("q-tab",{attrs:{name:"tab1",label:t.$t("account.userLogin")}}),r("q-tab",{attrs:{name:"tab2",label:t.$t("account.userRegister")}})],1)],1),r("q-card-section",[r("q-form",{ref:"myform",staticClass:"login-form",attrs:{autofocus:!1},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}}},[r("q-input",{staticClass:"q-mb-md",attrs:{placeholder:t.$t("account.email"),rules:[function(t){return t&&t.length>0||"必须填写"}],type:"email",dense:""},model:{value:t.validateForm.email,callback:function(e){t.$set(t.validateForm,"email",e)},expression:"validateForm.email"}}),r("q-input",{staticClass:"q-mb-md",attrs:{dense:"",rules:[function(t){return t&&t.length>0||"必须填写"},function(t){return t.length>=6&&t.length<=20||"密码长度大于6小于20"}],placeholder:"输入密码",type:t.visibility?"text":"password"},scopedSlots:t._u([{key:"append",fn:function(){return[r("q-btn",{attrs:{round:"",dense:"",flat:"",icon:t.visibility?"visibility_off":"visibility"},on:{click:function(e){t.visibility=!t.visibility}}})]},proxy:!0}]),model:{value:t.validateForm.password,callback:function(e){t.$set(t.validateForm,"password",e)},expression:"validateForm.password"}}),"tab1"!==t.activeTab?r("q-input",{staticClass:"q-mb-md",attrs:{placeholder:t.$t("account.nick"),rules:[function(t){return t&&t.length>0||"必须填写"},function(t){return t.length<=10||"昵称长度不能大于10"}],type:"text",dense:""},model:{value:t.validateForm.nick,callback:function(e){t.$set(t.validateForm,"nick",e)},expression:"validateForm.nick"}}):t._e(),r("q-btn",{staticClass:"full-width",attrs:{label:"tab1"===t.activeTab?t.$t("account.login"):t.$t("account.register"),color:"primary",rounded:""},on:{click:t.submit}})],1)],1)],1)},Be=[],Ue=(r("bf19"),r("b621")),Qe=r.n(Ue),We={name:"LoginForm",props:{},data(){return{activeTab:"tab1",visibility:!1,validateForm:{email:"",password:"",nick:""}}},methods:{submit(){"tab1"===this.activeTab?this.doLogin():this.doRegister()},doLogin(){const{email:t,password:e}=this.validateForm;Qe.a.auth.login({email:t,password:e}).then((t=>{this.$store.commit("SET_CURRENT_USER",t.toJSON()),this.$emit("logined")})).catch((t=>{console.error(t),this.$q.notify({message:"登录失败",type:"negative",timeout:1e4})}))},doRegister(){const{email:t,password:e,nick:r}=this.validateForm;Qe.a.auth.register({password:e,email:t}).then((t=>{t.set("displayName",r).update().then((e=>{console.log(e),this.$store.commit("SET_CURRENT_USER",t.toJSON()),this.$emit("logined")}))})).catch((t=>{console.error(t),this.$q.notify({message:"注册失败",type:"negative",timeout:1e4})}))}}},Ve=We,He=r("429b"),Ge=r("7460"),ze=r("0378"),Ye=r("27f9"),Xe=Object(y["a"])(Ve,De,Be,!1,null,null,null),Ze=Xe.exports;Wt()(Xe,"components",{QCard:ve["a"],QCardSection:be["a"],QTabs:He["a"],QTab:Ge["a"],QForm:ze["a"],QInput:Ye["a"],QBtn:Mt["a"]});var Ke={name:"MainLayout",components:{DrawPreference:xe,EditorHeader:Ht,CommonHeader:te,PlayerHeader:oe,ConvertHeader:pe,ColorPicker:qe,LineWidth:je,LoginForm:Ze},data(){return{openDrawPref:!1,openColorPicker:!1,openLineWidth:!1,openLogin:!1}},computed:{currentRoute(){return this.$route.name}},created(){f.$on("open:drawPref",(()=>{this.openDrawPref=!0})),f.$on("open:colorPicker",(()=>{this.openColorPicker=!0})),f.$on("open:lineWidth",(()=>{this.openLineWidth=!0})),f.$on("requireLogin",(()=>{this.openLogin=!0}))}},Je=Ke,tr=r("4d5a"),er=r("e359"),rr=r("09e3"),ar=r("24e8"),nr=Object(y["a"])(Je,St,xt,!1,null,null,null),sr=nr.exports;Wt()(nr,"components",{QLayout:tr["a"],QHeader:er["a"],QPageContainer:rr["a"],QDialog:ar["a"]});var ir=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-page",{staticClass:"bg-grey-3 e-container"},[r("div",{staticClass:"frame-ctrl nav-prev",on:{click:function(){return t.handleNavFrame(-1)}}},[r("q-icon",{attrs:{name:"chevron_left",size:"md"}})],1),r("div",{staticClass:"frame-ctrl nav-next",on:{click:function(){return t.handleNavFrame(1)}}},[r("q-icon",{attrs:{name:t.currentFrame<t.frameList.length?"chevron_right":"plus_one",size:"md"}})],1),r("div",{ref:"canvasWrap",staticClass:"canvas-container",style:t.maxCanvasH,on:{scroll:t.handleScroll}},[r("canvas-layer",{ref:"canvas",attrs:{width:t.viewSize[0],wrapHeight:t.viewSize[1]},on:{capture:t.handleCapture}})],1),r("div",{staticClass:"divider"},[t._v(t._s(t.$t("editor.canvasHTip"))+t._s(t.viewSize[1])+"px")]),r("control-bar",{on:{convertPdf:t.handleConvertPdf,compressImage:t.handleCompressImage,undo:t.handleUndoEarse}})],1)},or=[],cr=(r("ddb0"),r("2b3d"),r("2ef0")),lr=r.n(cr),ur=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"layerContainer",staticClass:"canvas-layer-wrap",style:t.layerContainerHeight},[t.isPlayer?t._e():r("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"pdfLayer",style:t.pdfLayerStyle,attrs:{width:t.pdfCanvasW,height:t.pdfCanvasH}}),r("div",{staticClass:"canvas-layer",style:t.layerStyle+t.bgColor},[t.needCapture?r("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"captureLayer",style:t.captureLayerStyle,attrs:{width:t.canvasW,height:t.captureH}}):t._e(),r("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fakeLayer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"stageLayer",staticClass:"stage-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"displayLayer",staticClass:"display-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),t.isPlayer?r("canvas",{ref:"syncLayer",staticClass:"sync-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}):t._e(),t.isPlayer?t._e():r("canvas",{ref:"editLayer",staticClass:"edit-layer",style:t.layerStyle+t.cursorStyle,attrs:{width:t.canvasW,height:t.canvasH},on:{mousedown:t.handleMousedown,touchstart:t.handleMousedown,mousemove:t.handleMousemove,touchmove:t.handleMousemove,mouseup:t.handleMouseup,touchend:t.handleMouseup,mouseout:t.handleMouseout}}),t.isPlayer?r("div",{directives:[{name:"show",rawName:"v-show",value:t.showCursor,expression:"showCursor"}],staticClass:"sync-cursor",style:t.syncCursorPos}):t._e()])])},dr=[],hr=(r("fb6a"),r("4d29")),pr=r.n(hr);function fr(t){return Math.max.apply(Math,t)}function mr(t){return Math.min.apply(Math,t)}function gr(t){const e=t.map((t=>t[0])),r=t.map((t=>t[1]));return[mr(e),mr(r),fr(e)-mr(e),fr(r)-mr(r)]}function yr(t,e){return 1!==e?t*e+.5<<0:t}function vr(t,e,r=1){const a=Math.round(e[0]*r-t.lineWidth/2-.5),n=Math.round(e[1]*r-t.lineWidth/2-.5),s=Math.round(e[2]*r+t.lineWidth+.5),i=Math.round(e[3]*r+t.lineWidth+.5);t.clearRect(a,n,s,i)}function br(t,e,r=1){vr(t,gr(e),r),e=[]}function wr(t,e,r,a=!0){if(a&&t.clearCurve(),1===e.length){const a=e[0];return t.beginPath(),t.arc(yr(a[0],r),yr(a[1],r),t.lineWidth/2,0,2*Math.PI,!0),t.closePath(),void t.fill()}t.beginPath();const n=yr(e[0][0],r),s=yr(e[0][1],r);if(t.moveTo(n,s),2===e.length)return t.lineTo(yr(e[1][0],r),yr(e[1][1],r)),void t.stroke();let i=1;while(i<e.length-2){const a=yr((e[i][0]+e[i+1][0])/2,r),n=yr((e[i][1]+e[i+1][1])/2,r),s=yr(e[i][0],r),o=yr(e[i][1],r);t.quadraticCurveTo(s,o,a,n),i++}const o=yr(e[i][0],r),c=yr(e[i][1],r),l=yr(e[i+1][0],r),u=yr(e[i+1][1],r);t.quadraticCurveTo(o,c,l,u),t.stroke()}function Cr(t,e,r,a,n=1){return{x:Math.min(t,r)/n,y:Math.min(e,a)/n,w:Math.abs(r-t)/n,h:Math.abs(a-e)/n}}function _r(t,e,r,a=1){t.beginPath(),t.arc(e*a,r*a,4,2*Math.PI,!1),t.closePath(),t.lineWidth=1,t.stroke()}function Lr(t,e,r=1){e.forEach((e=>{switch(e.ty){case"C":const a=e.po[0],n=e.po[e.po.length-1];_r(t,a[0],a[1],r),_r(t,n[0],n[1],r);break;case"MC":t.save(),t.setLineDash([5]),wr(t,e.po,r,!1),t.restore();break;case"S":switch(e.sty){case"L":case"AL":_r(t,e.data[0],e.data[1],r),_r(t,e.data[2],e.data[3],r);break;case"C":Er(t,e.data,r);break;case"R":Tr(t,e.data,r);break}}}))}function kr(t,e){let r,a,n,s,i,o;return!(!t||!e)&&(i=(t,e)=>!(t[1]<e[0]||t[0]>e[1]),r=[t.x,t.x+t.w],t.w<0&&(r=[r[1],r[0]]),a=[e.x,e.x+e.w],n=[t.y,t.y+t.h],t.h<0&&(n=[n[1],n[0]]),s=[e.y,e.y+e.h],o=i(r,a)&&i(n,s),o)}function Sr(t,e,r={}){const a=[],n=e.x+e.w,s=e.y+e.h;return t.forEach((t=>{switch(t.ty){case"C":case"MC":if(r.unclude_curve)break;for(let r of t.po)if(r[0]>=e.x&&r[0]<=n&&r[1]>=e.y&&r[1]<=s){a.push(t);break}break;case"S":if(r.only_curve)break;const i=Cr(...t.data);switch(t.sty){case"R":case"C":kr(e,i)&&a.push(t);break;case"L":case"AL":const r=[t.data[0],t.data[1]],o=[t.data[2],t.data[3]],c=i.w,l=i.h,u=[i.x,i.y],d=[i.x+i.w,i.y+i.h],h=c/7;let p=1;const f=[r,o];while(u[0]+h*p<d[0]){const t=u[0]+h*p,e=l/c*h*p;let a;a=(o[1]-r[1])*(o[0]-r[0])>0?e+u[1]:d[1]-e,f.push([t,a]),p+=1}for(let i of f)if(i[0]>=e.x&&i[0]<=n&&i[1]>=e.y&&i[1]<=s){a.push(t);break}break}}})),a}function xr(t,e,r=1,a){t.save(),t.lineWidth=2,t.strokeStyle=a,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(e[0]*r,e[1]*r),t.lineTo(e[2]*r,e[3]*r),t.stroke(),t.restore()}function Rr(t,e,r=1,a){const n=10;t.save(),t.lineWidth=2,a&&(t.strokeStyle=a),t.lineCap="round",t.lineJoin="round";const s=e[2],i=e[3],o=Math.atan2(e[3]-e[1],e[2]-e[0]);t.beginPath(),t.moveTo(e[0]*r,e[1]*r),t.lineTo(e[2]*r,e[3]*r),t.moveTo(s,i),t.lineTo(s-n*Math.cos(o-Math.PI/6),i-n*Math.sin(o-Math.PI/6)),t.moveTo(s,i),t.lineTo(s-n*Math.cos(o+Math.PI/6),i-n*Math.sin(o+Math.PI/6)),t.stroke(),t.restore()}function Tr(t,e,r=1,a){t.save(),t.lineWidth=2,a&&(t.strokeStyle=a);const n=Cr(...e,r);t.strokeRect(n.x,n.y,n.w,n.h),t.restore()}function Er(t,e,r=1,a){const n=Cr(...e,r),s=n.x+n.w/2,i=n.y+n.h/2;t.save(),t.lineWidth=2,a&&(t.strokeStyle=a),t.beginPath(),t.ellipse(s,i,n.w/2,n.h/2,0,2*Math.PI,!1),t.stroke(),t.restore()}var Ar=r("bc3a"),Pr=r.n(Ar),Or=r("69a0"),qr=r.n(Or);const Mr="libiao.ubairn.com",Ir="up17org.b0.upaiyun.com",$r="https://libiao.ubairn.com",Nr="cloud://u17-56e024.7531-u17-56e024",Fr=`${Nr}/`,jr=`${Nr}-1255324306/`,Dr="https://7531-u17-56e024-1255324306.tcb.qcloud.la/",Br=[{name:"咖啡色",value:"#655643"},{name:"粉色",value:"#FF9E9D"},{name:"橙色",value:"#ec8749"},{name:"蓝色",value:"#0088ff"},{name:"红色",value:"#e74000"},{name:"绿色",value:"#5cb85c"},{name:"白色",value:"#ffffff"},{name:"黑色",value:"#1d1d1d"}],Ur="/ftriDMtpThOrkDlXwhbIZCE46Y=",Qr="up17org",{formatDate:Wr}=Et["b"];let Vr;function Hr(t){if(t.match(Fr)||t.match(jr)){const e=t.replace(Fr,"").replace(jr,"");return Dr+e}return t.match(Ir)?t.replace(Ir,Mr):t.match(Mr)||t.match("http")?t:$r+t}const Gr=(t,e={})=>{const r=Math.round((new Date).getTime()/1e3)+3600,a=e.thumb||"image"===t&&"/quality/75/format/webp/compress/true/progressive/true";let n=Wr(Date.now(),"YYYY_MM_DD_HH_")+lt.a.generate();if(a){const t=a.match(/crop\/(\d+x\d+a+\d+a+\d+)/);t&&t.length>1&&(n+=t[1])}const s="/file/"+t+"/"+n,i={bucket:Qr,expiration:r,"save-key":s};if(a&&(i["x-gmkerl-thumb"]=a),e.apps){const t=s+"."+e.apps.f;i["apps"]=[{name:"naga",type:"audio",save_as:t,avopts:"/f/"+e.apps.f}]}const o=J.encode(JSON.stringify(i));e.done({signature:qr.a.hash(o+"&"+Ur),policy:o,bucket:Qr,"save-key":s,expiration:r})};function zr(t,e,r){Vr?e?(Object.keys(Vr).forEach((t=>{e.append(t,Vr[t])})),r(e)):r(Vr):Gr(t,{done:a=>{Vr=a,zr(t,e,r)}})}function Yr(t,e){const r=J.encode("veggie1989:rccrcc17"),a={Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${r}`};return Pr.a.request({url:"https://v0.api.upyun.com/up17org/"+t,method:"DELETE",headers:a})}function Xr(t,e){Pr.a.request({method:"POST",url:"https://v0.api.upyun.com/up17org",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((t=>{const r=t.data;200===r.code&&e(r)}))}function Zr(t,e=!1){return new Promise(((r,a)=>{zr("image",new FormData,(a=>{a.append("file",e?Z(t):t),Xr(a,(t=>{r({url:t.url,h:t["image-height"]/2,w:t["image-width"]/2,size:t.file_size})}))}))}))}function Kr(t){return new Promise(((e,r)=>{Gr("audio",{apps:{f:"MP3"},done:r=>{const a=new FormData;a.append("file",t),a.append("content-type","audio/ogg"),Object.keys(r).forEach((t=>{a.append(t,r[t])})),Xr(a,(t=>{e(t.url)}))}})}))}function Jr(t={},e){c["a"].start();let r=new Qe.a.TableObject("video"),a=new Qe.a.Query,n=t.limit||10,s=t.hasCd?[]:["-cd"];t.uid?a.compare("created_by","=",+t.uid):t.cateId&&a.compare("cate_id","=",t.cateId),(t.uid||t.cateId)&&s.push("-uinfo"),(t.recent||t.hidePrivate)&&a.compare("is_private","!=",!0),t.classid&&a.arrayContains("classids",[t.classid]),t.keyword&&a.matches("t",new RegExp(t.keyword,"i")),t.started_at&&a.compare("created_at",">",t.started_at.getTime()/1e3),t.ended_at&&a.compare("created_at","<",t.ended_at.getTime()/1e3),t.lt_count&&a.compare("n","<",+t.lt_count),t.gt_count&&a.compare("n",">",+t.gt_count),t.onlyCount?r.setQuery(a).select("created_at").find().then((t=>{if(200===t.statusCode){const r=t.data.meta.total_count;console.log("共有 "+r+" 条记录"),e(r)}})):r.setQuery(a).select(s).orderBy("-created_at").limit(n).expand("created_by").offset(t.offset||0).find({withCount:!0}).then((t=>{if(200===t.statusCode){const r=t.data.objects;console.log("共查询到 "+r.length+" 条记录",r);let a=[];for(let t of r)a.push(Object.assign({},t,{duration:Wr(t.dur,"mm:ss"),cover_url:Hr(t.cover_url),count:t.n||0,c_at:Wr(1e3*t.created_at,"YYYY-MM-DD")}));e(a,t.data.meta.next,t.data.meta.total_count)}c["a"].stop()}))}function ta(t,e,r){c["a"].start();let a=new Qe.a.TableObject("video");a.expand("created_by").get(t).then((t=>{const r=JSON.parse(t.data.cd);let a=r.canvas.find((t=>"AU"===t.ac));e(Object.assign({},t.data,{duration:Wr(t.data.dur,"mm:ss"),cover_url:Hr(t.data.cover_url),count:t.data.n||0,c_at:Wr(1e3*t.data.created_at,"YYYY-MM-DD"),cd:r,ap:a?a.data:t.data.ap})),c["a"].stop()}),r)}function ea(t,e){let r=new Qe.a.TableObject("video");r.delete(t).then(e)}function ra(t){let e=new Qe.a.TableObject("video"),r=e.getWithoutData(t);r.incrementBy("n",1),r.update()}function aa(t,e){let r=new Qe.a.TableObject("video"),a=r.create();a.set(t).save().then((t=>{201===t.statusCode&&(console.log("创建video成功, objectId:"+t.data.id),e(t.data.id))}))}function na(t){return"string"===typeof t&&0===t.indexOf("#")||String(t).indexOf("rgba")>-1?t:Br[t].value}function sa(t={},e){let r=new Qe.a.TableObject("task"),a=new Qe.a.Query;a.isNull("url"),r.setQuery(a).orderBy("-created_at").limit(20).expand("created_by").offset(t.offset||0).find({withCount:!0}).then((t=>{if(200===t.statusCode){const r=t.data.objects.map((t=>(t.c_at=Wr(1e3*t.created_at,"YYYY-MM-DD HH:mm"),t)));e(r,t.data.meta.next,t.data.meta.total_count)}}))}function ia(t){let e=new Qe.a.File;console.log(t),e.upload({fileObj:t},{categoryID:"5b5409b81548293cc1d75bf7"}).then((t=>{console.log(t.data)}))}var oa={name:"CanvasLayer",props:{wrapHeight:{default:506,type:Number,require:!0},isPlayer:{default:!1,type:Boolean},width:{default:900,type:Number},playerBgColor:{default:"#fff",type:String},needCapture:{default:!1,type:Boolean},scale:{default:1,type:Number},stageMode:{default:"start",type:String}},data(){return{height:this.wrapHeight,curX:0,curY:0,curOp:1,curColor:"#333333",scaleRate:this.scale,straX:!1,straY:!1,pdfHeight:this.wrapHeight,showCursor:!1}},mounted(){this.imageDict={},this.canvasObjs=[],this.earseHistoryObjs=[],this._points=[],this.ctxScaleRatio(),this.isPlayer?this.setupSyncLayer():(this.setupEditLayer(),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup))},beforeDestroy(){this.isPlayer||(document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup))},computed:{layerContainerHeight(){return this.isPlayer?"height:"+this.wrapHeight*this.scaleRate+"px;":""},layerStyle(){return"width:"+this.width*this.scaleRate+"px;height:"+this.height*this.scaleRate+"px;"},pdfLayerStyle(){return"width:"+this.width+"px;height:"+this.pdfHeight+"px;"},captureLayerStyle(){return"width:"+this.width+"px;height:"+this.wrapHeight+"px;"},captureH(){return this.wrapHeight*window.devicePixelRatio*this.scaleRate},pdfCanvasH(){return 2*this.pdfHeight},pdfCanvasW(){return 2*this.width},bgColor(){return this.isPlayer?"background-color:"+this.playerBgColor:"background-color:"+this.$store.getters.currentBgColor},canvasW(){return this.width*window.devicePixelRatio*this.scaleRate},canvasH(){return this.height*window.devicePixelRatio*this.scaleRate},color(){return this.$store.getters.currentColor},cursorStyle(){const t="url('"+$r+"/img/circle_"+this.$store.getters.colorIndex+".svg')";switch(this.layerType){case"E":case"S":return"cursor: crosshair;";default:return window.devicePixelRatio>1?"cursor: -webkit-image-set("+t+" 2x) 6 6, auto;":"cursor: "+t+" 6 6, auto;"}},tolerance(){return this.$store.getters.preferences.tolerance},lineWidth(){return this.$store.getters.currentLineWidth},layerType(){return this.$store.getters.currentLayerType},shapeType(){return this.$store.getters.currentShapeType},syncCursorPos(){return"transform: translateX("+this.curX*this.scaleRate+"px) translateY("+this.curY*this.scaleRate+"px) scale("+this.scaleRate+","+this.scaleRate+"); opacity:"+this.curOp+"; background-color:"+this.curColor+";width: 12px;height: 12px;border-radius: 12px;margin-top: -6px;margin-left: -6px;"}},watch:{layerType:function(t,e){this.setupEditLayer()},scaleRate:function(t,e){this.$nextTick((()=>{this.ctxScaleRatio()}))}},methods:{ctxScaleRatio(){["displayLayer","stageLayer","editLayer","fakeLayer","syncLayer"].forEach((t=>{const e=this.$refs[t];e&&e.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)}))},setupEditLayer(){const t=this.getLayerCtx("editLayer");switch(this.layerType){case"C":break;case"E":t.strokeStyle="#ff8619",t.fillStyle="rgba(255, 255, 255,0.4)",t.lineCap="round",t.lineJoin="round",t.lineWidth=1;break;case"S":break}},setupSyncLayer(){},scrollLayerContainer(t){this.$refs.layerContainer&&(this.$refs.layerContainer.scrollTop=t*this.scaleRate)},preloadStage(t,e){return new Promise(((r,a)=>{if(this.imageDict[e])r(this.imageDict[e]);else{let a=new window.Image;a.crossOrigin="Anonymous",a.onload=()=>{this.imageDict[e]=a,a=null,r(this.imageDict[e])},a.src=Hr(t.url)}}))},async preloadStages(t){for(const e of t)e.bg&&await this.preloadStage(e.bg,e.id)},updateHeight(t){return t<this.wrapHeight&&(t=this.wrapHeight),new Promise(((e,r)=>{t!==this.height?(this.height=t,this.$nextTick((()=>{this.ctxScaleRatio(),e()}))):(this.clearCtx("stageLayer"),e())}))},async setStageLayer(t,e,r){t.url&&(this.$q.loadingBar.start(),await this.preloadStage(t,e).then((e=>{let a=t.w,n=t.h;a!==this.width&&(n=this.width*n/a,a=this.width);const s=this.getLayerCtx("stageLayer");s.save(),r&&(s.globalAlpha=r);let i=0;n<this.wrapHeight&&"center"===this.stageMode&&(i=(this.wrapHeight-n)/2),s.drawImage(e,0,i,a*this.scaleRate,n*this.scaleRate),s.restore(),this.$q.loadingBar.stop()})))},getPointBy(t){if(t.touches){const{pageX:e,pageY:r,target:{offsetParent:{offsetLeft:a,offsetTop:n}}}=t.changedTouches[0];return[parseInt(e-a,10),parseInt(r-n-50,10)]}return[parseInt(t.layerX,10),parseInt(t.layerY,10)]},handleMousedown(t){const e=[this._px,this._py]=this.getPointBy(t);switch(this._dragging=!0,this.layerType){case"C":this._points.length=0,this._points.push(e);break;case"E":break;case"S":break}},handleMouseout(){this._dragging&&(this._dragging=!1,this.handleMouseup())},handleMousemove(t){const e=this.getPointBy(t),r=this.getLayerCtx("editLayer"),{x:a,y:n,w:s,h:i}=Cr(e[0],e[1],this._px,this._py,this.scaleRate);switch(this.layerType){case"C":{if(!this._dragging)return void this.$emit("capture",{ac:"CM",data:[e[0]/this.scaleRate,e[1]/this.scaleRate]});if(this.straX&&(this.stra_y?e[1]=this.stra_y:this.stra_y=e[1]),this.straY&&(this.stra_x?e[0]=this.stra_x:this.stra_x=e[0]),this._px===e[0]&&this._py===e[1])return;this._px=e[0],this._py=e[1],this._points.push(e),this._points=pr.a.radialDistance(this._points,this.tolerance);const t={co:this.color,wi:this.lineWidth,ty:this.layerType,po:this._points.slice()};this.$emit("capture",{ac:"CSync",data:t}),this.renderCurve(t,"editLayer",!0);break}case"E":{if(!this._dragging)return;this.clearCtx("editLayer"),r.fillRect(a,n,s,i),r.save(),r.setLineDash([5]),r.strokeRect(a,n,s,i),r.restore();const t=Sr(this.canvasObjs,{x:a,y:n,w:s,h:i});Lr(r,t,this.scaleRate);break}case"S":{if(!this._dragging)return;this._prev_shape_rect&&vr(r,this._prev_shape_rect,this.scaleRate),this._prev_shape_rect=[a-10,n-10,s+20,i+20];const t={ty:"S",co:this.color,sty:this.shapeType,data:[this._px/this.scaleRate,this._py/this.scaleRate,e[0]/this.scaleRate,e[1]/this.scaleRate]};this.renderShape(t,"editLayer");break}}},handleMouseup(t){this._dragging=!1,this.stra_y=null,this.stra_x=null;const e=this.getPointBy(t),r=Cr(e[0],e[1],this._px,this._py,this.scaleRate);switch(this.layerType){case"C":if(this._points.length>0){const t={po:this._points.slice(),co:this.color,wi:this.lineWidth,ty:this.layerType};this.clearCtx("editLayer",this._points),this.$emit("capture",{ac:"CEnd",data:t}),this.renderCurve(t),this._points.length=0}break;case"E":{this.clearCtx("editLayer");const t=Sr(this.canvasObjs,r),e=t.map((t=>t.id));if(!e.length)return void console.log("no earse");this.removeCanvasObjs(e),this.earseHistoryObjs.push(t),this.$emit("capture",{ac:"E",data:e}),this.reRenderCanvasData();break}case"S":{const t={ty:"S",co:this.color,sty:this.shapeType,data:[this._px/this.scaleRate,this._py/this.scaleRate,e[0]/this.scaleRate,e[1]/this.scaleRate]};this._prev_shape_rect&&(vr(this.getLayerCtx("editLayer"),this._prev_shape_rect,this.scaleRate),this._prev_shape_rect=null),this.renderShape(t),this.$emit("capture",{ac:"SEnd",data:t});break}}},redrawEarseHistory(){const t=this.earseHistoryObjs.pop();if(t){this.batchRenderObjs(t);for(const e of t)this.addCanvasObj(e);this.$emit("capture",{ac:"UE",data:t})}},resetLayer(){this.canvasObjs=[],this.clearCtx("displayLayer"),this.clearCtx("editLayer"),this.clearCtx("stageLayer"),this.clearCtx("syncLayer")},reRenderCanvasData(t){t&&(this.canvasObjs=t),this.canvasObjs.length?this.batchRenderObjs(this.canvasObjs,!0):this.clearCtx("displayLayer")},cursorMove(t){if(this.showCursor)for(const e of Object.keys(t))this.$data[e]=t[e]},removeCanvasObjs(t){return this.canvasObjs=this.canvasObjs.filter((e=>t.indexOf(e.id)<0)),this.canvasObjs},renderOneObj(t,e){return new Promise(((r,a)=>{switch(t.ty){case"C":this.renderCurve(t,e),r();break;case"S":this.renderShape(t,e),r();break;default:this.renderCurve(t,e),r();break}}))},async batchRenderObjs(t,e=!1){this.clearCtx("fakeLayer");for(const r of t)await this.renderOneObj(r,"fakeLayer");e&&this.clearCtx("displayLayer"),this.getLayerCtx("displayLayer").drawImage(this.$refs.fakeLayer,0,0,this.width*this.scaleRate,this.height*this.scaleRate)},renderCurve(t,e="displayLayer",r=!1){const a=this.getLayerCtx(e);if(a.strokeStyle=a.fillStyle=na(t.co),a.lineWidth=t.wi*this.scaleRate,a.lineCap=a.lineJoin="round",r){const r=a._points;a.clearCurve=r?()=>this.clearCtx(e,r):()=>{},a._points=t.po}else"displayLayer"===e&&this.addCanvasObj(t);wr(a,t.po,this.scaleRate,r)},renderShape(t,e="displayLayer"){const r=this.getLayerCtx(e);switch(t.sty){case"L":xr(r,t.data,this.scaleRate,t.co);break;case"AL":Rr(r,t.data,this.scaleRate,t.co);break;case"R":Tr(r,t.data,this.scaleRate,t.co);break;case"C":Er(r,t.data,this.scaleRate,t.co);break}"displayLayer"===e&&this.addCanvasObj(t)},getLayerCtx(t){return this.$refs[t].getContext("2d")},addCanvasObj(t){t.id=t.id||lt.a.generate(),this.canvasObjs.push(t)},clearCtx(t="editLayer",e){if(!this.$refs[t])return;const r=this.getLayerCtx(t);e?br(r,e,this.scaleRate):r.clearRect(0,0,this.canvasW,this.canvasH)},setScaleRateBy(t={}){if(t.origin)this.scaleRate=1;else{const e=t.width||window.screen.width;let r=e/this.width;t.height&&this.wrapHeight*r>t.height&&(r=t.height/this.wrapHeight),this.scaleRate=Math.floor(1e3*r)/1e3}},handleKeydown(t){16===t.keyCode&&(this.straX=!0,this.$toast.success("横直线模式生效")),18===t.keyCode&&(this.straY=!0,this.$toast.success("竖直线模式生效"))},handleKeyup(t){16===t.keyCode&&(this.straX=!1,this.$toast.warning("横直线模式失效")),18===t.keyCode&&(this.straY=!1,this.$toast.warning("竖直线模式失效"))},toggleCursor(t){this.showCursor=t},convertPDF2PNG(t,e){return new Promise(((r,a)=>{t.getPage(e).then((t=>{const e=t.getViewport(1),a=2*this.width/e.width,n=t.getViewport(a),s=parseInt(n.height,10);this.pdfHeight=s/2,this.$nextTick((()=>{t.render({canvasContext:this.getLayerCtx("pdfLayer"),viewport:n}).then((()=>{r(this.$refs.pdfLayer.toDataURL("image/webp",.8))}))}))}))}))},putImageAsBg(t){return new Promise(((e,r)=>{const a=new Image,n=this.getLayerCtx("pdfLayer");a.onload=()=>{let r=a.width,s=a.height;r>2*this.width?(s=2*this.width*s/r,r=2*this.width,this.pdfHeight=s/2,this.$nextTick((()=>{n.drawImage(a,0,0,r,s),e(this.$refs.pdfLayer.toDataURL("image/webp",.8))}))):e(t)},a.src=t}))},drawPointer(t){t.beginPath();const e=this.$refs.layerContainer.scrollTop*window.devicePixelRatio,r=this.curX*window.devicePixelRatio,a=this.curY*window.devicePixelRatio-e;r>0&&a>0&&(t.arc(r,a,12,0,2*Math.PI,!1),t.fillStyle=X(this.curColor,100*this.curOp),t.fill())},captureCurrentImage(){const t=this.getLayerCtx("captureLayer"),e=["stageLayer","displayLayer","syncLayer"],r=this.$refs.layerContainer.scrollTop*window.devicePixelRatio;e.forEach((e=>{"stageLayer"===e&&(t.fillStyle=this.playerBgColor,t.fillRect(0,0,this.canvasW,this.captureH)),t.drawImage(this.$refs[e],0,r,this.canvasW,this.captureH,0,0,this.canvasW,this.captureH)})),this.drawPointer(t),t.font="24px 楷体",t.fillStyle="rgba(255,255,255,0.7)",t.shadowColor="rgba(0,0,0,0.2)",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=2;const a="手绘微课",n=this.canvasW-t.measureText(a).width-10,s=this.captureH-20;return t.fillText(a,n,s),t.restore(),this.$refs.captureLayer},renderAvatar(t,e,r){const a=[80,80];return new Promise(((n,s)=>{const i=new window.Image;i.onload=()=>{t.drawImage(i,this.width*this.scaleRate/2-a[0]/2,r,a[0],a[1]),n(r+a[1]+25)},i.onerror=()=>{n(r+a[1]+25)},i.src=e}))},async genVideoCover(t={}){const e=this.getLayerCtx("fakeLayer");e.fillStyle="#fff";const r=this.width*this.scaleRate,a=this.height*this.scaleRate;e.fillRect(0,0,r,a);let n=80;e.textBaseline="middle",e.font="22px Roboto",e.fillStyle="#666";const s=t.title,i=e.measureText(s).width;if(i<r){const t=r/2-i/2;e.fillText(s,t,n)}e.font="16px Roboto",e.fillStyle="#999";const o="由手绘微课录制",c=r/2-e.measureText(o).width/2;if(e.fillText(o,c,a-60),n+=40,t.avatar&&n+130<a-60&&(n=await this.renderAvatar(e,t.avatar,n)),t.author){e.font="18px Roboto",e.fillStyle="#333";const a=r/2-e.measureText(t.author).width/2;e.fillText(t.author,a,n)}t.done(this.$refs.fakeLayer)}}},ca=oa,la=(r("7315"),Object(y["a"])(ca,ur,dr,!1,null,"9a365332",null)),ua=la.exports,da=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"controlBar"}},[t.shapeCtrlTrigger?r("q-popup-proxy",{attrs:{target:t.shapeCtrlTrigger}},[r("q-card",[r("q-tabs",{attrs:{shrink:"","active-color":"primary","indicator-color":"transparent",dense:""},model:{value:t.shapeType,callback:function(e){t.shapeType=e},expression:"shapeType"}},[r("q-tab",{attrs:{name:"L",label:t.$t("ctrlBar.line"),icon:"short_text"}}),r("q-tab",{attrs:{name:"AL",label:t.$t("ctrlBar.arrowLine"),icon:"trending_flat"}}),r("q-tab",{attrs:{name:"C",label:t.$t("ctrlBar.circle"),icon:"panorama_fish_eye"}}),r("q-tab",{attrs:{name:"R",label:t.$t("ctrlBar.rect"),icon:"crop_landscape"}})],1)],1)],1):t._e(),r("q-toolbar",{staticClass:"bg-white"},[r("q-tabs",{attrs:{shrink:"","active-color":"primary","indicator-color":"transparent",dense:""},model:{value:t.canvasLayer,callback:function(e){t.canvasLayer=e},expression:"canvasLayer"}},[r("q-tab",{attrs:{name:"C",label:t.$t("ctrlBar.pen"),icon:"edit"}}),r("q-tab",{ref:"shapeBtn",attrs:{name:"S",icon:t.currentShapeIcon,label:t.$t("ctrlBar.shape")}}),r("q-tab",{attrs:{name:"E",label:t.$t("ctrlBar.eraser"),icon:"crop_free"}})],1),r("q-space"),t.$q.screen.lt.md?t._e():r("q-btn",{staticClass:"q-mr-md",attrs:{icon:"undo",round:"",flat:""},on:{click:function(){return t.$emit("undo")}}},[r("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n        "+t._s(t.$t("ctrlBar.undoErase"))+"\n      ")])],1),t.$q.screen.lt.md?t._e():r("q-btn",{staticClass:"q-mr-md",attrs:{icon:"line_weight",round:"",flat:""},on:{click:t.openLineWidth}},[r("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n        "+t._s(t.$t("ctrlBar.penWidth"))+"\n      ")])],1),t.$q.screen.lt.md?t._e():r("q-btn",{staticClass:"q-mr-md",style:t.colorPickerStyle,attrs:{icon:"color_lens",round:"",flat:""},on:{click:t.openColorPicker}},[r("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n        "+t._s(t.$t("ctrlBar.penColor"))+"\n      ")])],1),r("uploader",{attrs:{autoStart:!1,options:t.uploadOptions},on:{"file-added":t.onFileAdded}},[r("uploader-btn",{attrs:{single:!0,attrs:t.uploadAttrs}},[r("q-btn",{attrs:{icon:"picture_as_pdf",round:"",flat:""}},[r("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n            "+t._s(t.$t("ctrlBar.uploadPdf"))+"\n          ")])],1)],1),t.$q.screen.lt.md?r("q-btn",{attrs:{icon:"more_vert",round:"",flat:""}},[r("q-menu",[r("q-list",{staticStyle:{"min-width":"100px"}},[r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.$emit("undo")}}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{attrs:{name:"undo"}})],1),r("q-item-section",[t._v("\n                "+t._s(t.$t("ctrlBar.undoErase"))+"\n              ")])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.openLineWidth}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{attrs:{name:"line_weight"}})],1),r("q-item-section",[t._v("\n                "+t._s(t.$t("ctrlBar.penWidth"))+"\n              ")])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.openColorPicker}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{attrs:{name:"color_lens"}})],1),r("q-item-section",[t._v("\n                "+t._s(t.$t("ctrlBar.penColor"))+"\n              ")])],1)],1)],1)],1):t._e()],1)],1)],1)},ha=[];const pa=r("9511");var fa={name:"ControlBar",props:{},data(){return{openMoreMenu:!1,uploadOptions:{testChunks:!1,singleFile:!0},uploadAttrs:{accept:"application/pdf,image/*"},limitPageNum:100,shapeCtrlTrigger:null}},mounted(){pa.workerSrc=$r+"/js/pdf.worker.js",this.shapeCtrlTrigger=this.$refs.shapeBtn.$el},computed:{colorPickerStyle(){return"color:"+this.$store.getters.currentColor},canvasLayer:{get(){return this.$store.getters.currentLayerType},set(t){this.$store.commit("CHANGE_CANVAS_LAYER",t)}},layerType(){return this.$store.getters.currentLayerType},shapeType:{get(){return this.$store.getters.currentShapeType},set(t){this.$store.commit("CHANGE_CANVAS_SHAPE_TYPE",t)}},currentShapeIcon(){switch(this.$store.getters.currentShapeType){case"L":return"short_text";case"AL":return"trending_flat";case"C":return"panorama_fish_eye";case"R":return"crop_landscape";default:return""}}},methods:{openColorPicker(){f.$emit("open:colorPicker")},openLineWidth(){f.$emit("open:lineWidth")},onFileAdded(t){const e=t.fileType.match(/image/);f.$emit("load:start",e?"正在插入背景图片":"正在解析文件");const r=new FileReader;e?(r.readAsDataURL(t.file),r.onload=t=>{this.$emit("compressImage",t.target.result)}):(r.readAsArrayBuffer(t.file),r.onload=t=>{pa.getDocument({data:t.target.result,cMapUrl:"/js/cmaps/",cMapPacked:!0}).then((t=>{f.$emit("load:end");const e=t.numPages;e>this.limitPageNum?f.$emit("dialog",{title:"提示",msg:"已超过文档上传页数限制: "+this.limitPageNum+"/"+e+", 继续操作，超出部分将不会被导入",confirm:()=>{this.$emit("convertPdf",{pdf:t,missionNum:this.limitPageNum})}}):this.$emit("convertPdf",{pdf:t,missionNum:e})}))})}}},ma=fa,ga=(r("8008"),r("7cbe")),ya=Object(y["a"])(ma,da,ha,!1,null,"d06b5422",null),va=ya.exports;Wt()(ya,"components",{QPopupProxy:ga["a"],QCard:ve["a"],QTabs:He["a"],QTab:Ge["a"],QToolbar:qt["a"],QSpace:$t["a"],QBtn:Mt["a"],QTooltip:It["a"],QMenu:Ft["a"],QList:jt["a"],QItem:Dt["a"],QItemSection:Bt["a"],QIcon:Nt["a"]}),Wt()(ya,"directives",{ClosePopup:Ut["a"]});var ba=r("c093"),wa=r.n(ba),Ca=r("755b");const _a=100;var La={name:"Editor",data(){return{framesData:{}}},components:{CanvasLayer:ua,ControlBar:va},created(){f.$on("toggle:startRecord",this.startRecord),f.$on("toggle:pauseRecord",this.pauseRecord),f.$on("remove:frame",this.removeCurFrame)},mounted(){wa.a.isRecordingSupported()||this.$q.notify({type:"negative",message:this.$t("editor.recordNotSupport")});const t=this.frameList[this.currentFrame-1];t.bg&&this.$refs.canvas.updateHeight(t.bg.h).then((()=>{this.$refs.canvas.setStageLayer(t.bg,t.id)})),this.currentAc=null,this.auRecorder=new wa.a({encoderPath:Ca["a"]}),this.auRecorder.onstart=()=>{this.records=[],this.currentTs=1,this.$q.notify({type:"positive",message:this.$t("editor.recordStart")});const t=this.$refs.canvasWrap.scrollTop;this.addAcRecord("F",{id:this.currentFid,top:t}),this.addAcRecord("CC",this.currentColor),this.setupRecordClock()},this.auRecorder.onpause=()=>{this.recordPaused=!0,this.clock.cancel(),this.$q.notify({type:"positive",message:this.$t("editor.paused")})},this.auRecorder.onresume=()=>{this.recordPaused=!1,this.currentAc=null,this.setupRecordClock(),this.$q.notify({type:"positive",message:this.$t("editor.resumed")})},this.auRecorder.onstop=()=>{this.addAcRecord("End"),this.clock.cancel(),this.currentTs=0,this.$store.commit("SET_CANVAS_OBJS",this.records);const t=lr.a.uniq(this.records.filter((t=>"F"===t.ac)).map((t=>"object"===typeof t.data?t.data.id:t.data))).map((t=>this.frameList.find((e=>e.id===t))));this.$store.commit("SET_STAGE_OBJS",t),this.$store.commit("SET_STAGE_BG_COLOR",this.currentBgColor),this.$store.commit("SET_PLAYER_SIZE",this.viewSize),this.$router.push({path:"preview"})},this.auRecorder.ondataavailable=t=>{const e=new Blob([t],{type:"audio/ogg"}),r=URL.createObjectURL(e);this.$store.commit("SET_AUDIO_TRACK",{url:r,blob:e})}},computed:{currentColor(){return this.$store.getters.currentColor},currentBgColor(){return this.$store.getters.currentBgColor},currentFrame(){return this.$store.getters.currentFrame},frameList(){return this.$store.getters.frameList},currentFid(){return this.$store.getters.currentFid},viewSize(){return this.$store.getters.viewSize},maxCanvasH(){return"max-height:"+this.viewSize[1]+"px;"},lang(){return this.$store.getters.preferences.lang},currentTs:{get(){return this.$store.getters.currentTs},set(t){this.$store.commit("SET_CURRENT_TS",t)}},currentDur:{get(){return this.$store.getters.currentDur},set(t){this.$store.commit("SET_CURRENT_DUR",t)}},recordPaused:{get(){return this.$store.getters.recordPaused},set(t){this.$store.commit("SET_RECORD_PAUSE",t)}}},watch:{currentColor:function(t,e){this.addAcRecord("CC",t)},currentFrame:function(t,e){const r=this.frameList[e-1];r&&(this.framesData[r.id]=this.$refs.canvas.canvasObjs),this.loadFrameContent(t),this.skipCapture=!0,this.$refs.canvasWrap.scrollTop=0},lang:function(t){this._i18n.locale=t}},methods:{startRecord(){this.currentTs?this.auRecorder.stop():this.auRecorder.start()},pauseRecord(){this.recordPaused?this.auRecorder.resume():this.auRecorder.pause()},setupRecordClock(){this.clock=Y(_a,(()=>{this.currentTs+=_a,this.currentTs%1e3===1&&(this.currentDur=this.currentTs),this.currentAc&&(this.records.push(this.currentAc),this.currentAc=null)}))},handleCapture(t){if(this.currentTs){if(this.currentAc&&this.currentAc.ac!==t.ac&&"CEnd"===this.currentAc.ac)return;this.currentAc=Object.assign({},t,{ts:this.currentTs})}},addAcRecord(t,e={}){this.currentTs&&this.records.push({ac:t,ts:this.currentTs,data:e})},handleUndoEarse(){this.$refs.canvas.redrawEarseHistory()},handleNavFrame(t){const e=this.currentFrame+t;this.$store.commit("CHANGE_CURRENT_FRAME",e)},handleNavToFrame(t){this.$store.commit("CHANGE_CURRENT_FRAME",t+1)},removeCurFrame(){this.$q.dialog({title:"确认操作",message:"确定要删除当前第 "+this.currentFrame+" 页吗？",cancel:!0,persistent:!0}).onOk((()=>{if(this.$store.commit("REMOVE_FRAME_BY_NUM",this.currentFrame),this.currentFrame>this.frameList.length){const t=0===this.frameList.length?1:this.currentFrame-1;this.$store.commit("CHANGE_CURRENT_FRAME",t)}else this.loadFrameContent(this.currentFrame)}))},loadFrameContent(t){const e=this.frameList[t-1].id,r=this.frameList[t-1].bg;this.$refs.canvas.updateHeight(r?r.h:this.viewSize[1]).then((()=>{this.$refs.canvas.reRenderCanvasData(this.framesData[e]||[]),r&&this.$refs.canvas.setStageLayer(r,e)})),this.addAcRecord("F",this.currentFid)},handleScroll(t){this.skipCapture?this.skipCapture=!1:this.handleCapture({ac:"SL",data:t.target.scrollTop})},async handleConvertPdf(t){let e=1;const r=[];while(e<=t.missionNum)f.$emit("load:start","正在导入第 "+e+" 页/共 "+t.missionNum+" 页"),await new Promise(((a,n)=>{this.$refs.canvas.convertPDF2PNG(t.pdf,e).then((t=>{Zr(t,!0).then((t=>{r.push(t),a()}))}))})),e++;this.$store.commit("INSERT_FRAME_BY_IMAGES",r),f.$emit("load:end")},handleCompressImage(t){this.$refs.canvas.putImageAsBg(t).then((t=>{Zr(t,!0).then((t=>{this.$store.commit("INSERT_FRAME_BY_IMAGE",t),f.$emit("load:end")}))}))}}},ka=La,Sa=(r("ebf5"),r("9989")),xa=Object(y["a"])(ka,ir,or,!1,null,"1afb9034",null),Ra=xa.exports;Wt()(xa,"components",{QPage:Sa["a"],QIcon:Nt["a"]});var Ta=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"q-pa-md"},[t.currentUser?r("q-infinite-scroll",{attrs:{offset:10},on:{load:t.onLoad},scopedSlots:t._u([t.hasNext?{key:"loading",fn:function(){return[r("div",{staticClass:"row justify-center q-my-md"},[r("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}:null],null,!0)},[r("q-list",{attrs:{separator:""}},[r("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("mywork.created"))+" "+t._s(t.allCount))]),t._l(t.workList,(function(e,a){return r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:"",to:"/vd/"+e.id}},[r("q-item-section",[r("q-item-label",[t._v(t._s(e.t))]),r("q-item-label",{attrs:{caption:""}},[r("small",[t._v("创建于")]),t._v(" "+t._s(e.c_at)+" "),r("small",[t._v("已播放")]),t._v(" "+t._s(e.count))])],1),r("q-item-section",{attrs:{side:""}},[t._v("\n          "+t._s(e.duration)+"\n        ")])],1)}))],2)],1):t._e(),t.workList&&0===t.workList.length?r("div",{staticClass:"empty-tip"},[t._v("暂无任何作品")]):t._e()],1)},Ea=[],Aa={name:"MyWork",data(){return{allCount:0,workList:null,hasNext:!1}},computed:{currentUser(){return this.$store.getters.currentUser}},watch:{currentUser:{handler(t){t||f.$emit("requireLogin")},immediate:!0}},methods:{loadVideos(t={},e){this.query=t,Jr(t,((r,a,n)=>{this.hasNext=!!a;let s=r;t.offset&&(s=this.workList.concat(r)),this.workList=s,this.allCount=n,e&&e()}))},onLoad(t,e){if(1===t||this.hasNext){const t=Object.assign(this.query||{},{offset:this.workList?this.workList.length:0,uid:this.currentUser.id});this.loadVideos(t,e)}}}},Pa=Aa,Oa=r("ef35"),qa=r("8380"),Ma=Object(y["a"])(Pa,Ta,Ea,!1,null,null,null),Ia=Ma.exports;Wt()(Ma,"components",{QInfiniteScroll:Oa["a"],QList:jt["a"],QItemLabel:we["a"],QItem:Dt["a"],QItemSection:Bt["a"],QSpinnerDots:qa["a"]}),Wt()(Ma,"directives",{Ripple:ke["a"]});var $a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"preview-container"},[r("player",{attrs:{audioUrl:t.audioTrack.url,canvasObjs:t.canvasObjs,stages:t.stages,autoPlay:!0,bgColor:t.stageBgColor,size:t.playerSize,duration:t.duration}})],1)},Na=[],Fa=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"player-wrap"},[r("div",{staticClass:"canvas-container"},[r("canvas-layer",{ref:"canvas",attrs:{isPlayer:!0,playerBgColor:t.bgColor,width:t.size[0],wrapHeight:t.size[1]}}),r("div",{staticClass:"coverage",on:{click:t.handlePlay}},[t.currentTs?t._e():[r("q-btn",{staticClass:"video-ctrl-cover",attrs:{color:"primary",round:"",icon:"play_arrow"}}),r("div",{staticClass:"video-dur"},[t._v(t._s(t.hDur))])]],2)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:t.currentTs,expression:"currentTs"}],staticClass:"ctrl-bar"},[r("q-btn",{staticClass:"q-mr-sm",attrs:{size:"sm",round:"",flat:"",icon:t.currentTs&&!t.isPaused?"pause":"play_arrow"},on:{click:t.handlePlay}}),t.canSeek?r("q-slider",{attrs:{dense:"",step:1,color:"white"},on:{change:t.onChangeProgress},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}}):t._e(),r("span",{staticClass:"time"},[t._v(t._s(t.currentTsDisplay))])],1)])},ja=[],Da=(r("26e9"),r("1e5c"));const Ba=100,{formatDate:Ua}=Et["b"];var Qa={name:"Player",components:{CanvasLayer:ua},props:{audioUrl:{type:String,require:!0},canvasObjs:{type:Array,require:!0},duration:{type:Number,require:!0},autoPlay:{type:Boolean,default:!1},stages:{type:Array},bgColor:{type:String},canSeek:{type:Boolean,default:!0},size:{type:Array,default(){return[900,506]}}},data(){return{currentTs:0,currentDur:0,progress:0,isPaused:!1,framesData:{}}},computed:{currentTsDisplay(){return Ua(this.currentDur,"mm:ss")},hDur(){return Ua(this.duration,"mm:ss")}},mounted(){this.canvasLayer=this.$refs.canvas,this.autoPlay&&this.canvasObjs.length&&this.preloadResource(this.startPlay)},beforeDestroy(){this.currentTs&&this.stopPlay(),this.currentAudio&&this.currentAudio.unload()},methods:{startPlay(){this.setupPlayerClock(),this.currentAudio.play(),this.$emit("played"),this.canvasLayer.toggleCursor(!0)},pausePlay(){this.clock&&this.clock.cancel(),this.currentAudio.pause(),this.isPaused=!0,this.$q.notify({message:"已暂停",type:"positive",timeout:3e3})},async resumePlay(){if(this.seekToTs&&this.seekToTs!==this.currentTs){const t=this.frameByTs(this.seekToTs);this.currentTs=this.seekToTs;const{cd:e,framesData:r,curFid:a,top:n,color:s}=this.parseRealPathByRange(0,this.currentTs);this.framesData=r,this.curFid=a,this.frameChange(t.data.id,n),this.canvasLayer.cursorMove({curColor:s}),this.canvasLayer.reRenderCanvasData(e),await this.seekAudio(this.currentTs),this.seekToTs=0}this.setupPlayerClock(),this.isPaused&&this.currentAudio.play(),this.isPaused=!1},stopPlay(){this.clock&&this.clock.cancel(),this.currentAudio&&this.currentAudio.stop(),this.currentTs=0,this.isPaused=!1,this.canvasLayer.toggleCursor(!1),this.canvasLayer.resetLayer(),this.framesData={},this.curFid=null,this.canvasLayer.scrollLayerContainer(0)},handlePlay(){this.currentTs?this.isPaused?this.resumePlay():this.pausePlay():this.preloadResource(this.startPlay)},doEachTask(t){return new Promise(((e,r)=>{this.canvasObjs.filter((e=>t-Ba<=e.ts&&e.ts<t)).forEach(this.playEachRecord),t%1e3===0&&(this.currentDur=t),this.progress=t/this.duration*100,e()}))},setupPlayerClock(){this.clock=Y(Ba,(()=>{this.currentTs+=Ba,this.doEachTask(this.currentTs)}))},playEachRecord(t){switch(t.ac){case"CSync":case"Cy":{this.canvasLayer.renderCurve(t.data,"syncLayer",!0);const e=t.data.po[t.data.po.length-1];this.canvasLayer.cursorMove({curX:e[0],curY:e[1],curOp:.5});break}case"CEnd":case"CE":this.canvasLayer.clearCtx("syncLayer"),this.canvasLayer.renderCurve(t.data);break;case"E":this.canvasLayer.removeCanvasObjs(t.data),this.canvasLayer.reRenderCanvasData();break;case"CM":this.canvasLayer.cursorMove({curX:t.data[0],curY:t.data[1],curOp:1});break;case"F":case"Frame":{this.preFid=this.curFid;let e=0;"object"===typeof t.data?(this.curFid=t.data.id,e=t.data.top):this.curFid=t.data,this.preFid&&(this.framesData[this.preFid]=this.canvasLayer.canvasObjs),this.frameChange(this.curFid,e);break}case"SL":this.canvasLayer.scrollLayerContainer(t.data);break;case"SEnd":this.canvasLayer.renderShape(t.data);break;case"End":this.progress=100,this.stopPlay();break;case"CC":this.canvasLayer.cursorMove({curColor:t.data});break;case"UE":this.canvasLayer.batchRenderObjs(t.data);for(const e of t.data)this.canvasLayer.addCanvasObj(e);break}},preloadResource(t){this.canvasLayer.preloadStages(this.stages),this.loadAudio(t)},groupRecordsByFrameRate(){let t=0;const e=[];while(t<this.duration)t+=Ba,e.push(this.canvasObjs.filter((e=>t-Ba<=e.ts&&e.ts<t)));return e},loadAudio(t){if(this.currentAudio)return void t();const e=this.audioUrl.match("http")?this.audioUrl:$r+this.audioUrl;this.currentAudio=new Da["Howl"]({src:[e,e+".MP3"],html5:!0,format:["ogg","mp3"],onload:t,onloaderror:()=>{this.$q.notify({message:"音频加载失败",type:"negative",timeout:1e4})}})},onChangeProgress(t){this.canSeek&&(this.seekToTs=Math.round(t*this.duration/100),this.currentDur=this.seekToTs)},seekAudio(t){return new Promise(((e,r)=>{this.currentAudio?(this.currentAudio.once("seek",e),this.currentAudio.seek(t/1e3)):e()}))},fitScreenWidth(){this.$refs.canvas.setScaleRateBy()},fitToOriginWidth(){this.$refs.canvas.setScaleRateBy({origin:!0})},frameByTs(t,e={}){const r=this.canvasObjs.filter((t=>"F"===t.ac)).reverse();for(const a in r)if(r[a].ts-t<=0)return e.to?r[a-e.to]:r[a]},frameChange(t,e){const r=this.stages.find((e=>e.id===t));if(r){const t=r.bg;this.canvasLayer.updateHeight(t?t.h:this.size[1]).then((()=>{this.canvasLayer.reRenderCanvasData(this.framesData[r.id]||[]),t&&this.canvasLayer.setStageLayer(t,r.id),this.canvasLayer.scrollLayerContainer(e)}))}},parseRealPathByRange(t,e){let r,a,n,s,i;const o=["F","CEnd","E","SEnd","CC","UE","SL"];let c=[];const l=this.canvasObjs.filter((r=>o.indexOf(r.ac)>-1&&t<=r.ts&&r.ts<=e));0===t&&(n={},r=a=null);for(const u of l)switch(u.ac){case"CEnd":case"SEnd":c.push(u.data);break;case"SL":s=u.data;break;case"CC":i=u.data;break;case"E":c=c.filter((t=>u.data.indexOf(t.id)<0));break;case"UE":Array.isArray(u.data)&&c.concat(u.data);break;case"F":0===t?(r=a,a=u.data,r&&(n[r]=c.slice(0)),c=n[a]||[]):c=[];break}return 0===t?{cd:c,framesData:n,curFid:a,top:s,color:i}:{cd:c,top:s}}}},Wa=Qa,Va=(r("3cdd"),Object(y["a"])(Wa,Fa,ja,!1,null,"df5aa4a2",null)),Ha=Va.exports;Wt()(Va,"components",{QBtn:Mt["a"],QSlider:_e["a"]});var Ga={name:"Preview",components:{Player:Ha},data(){return{}},computed:{audioTrack(){return this.$store.getters.audioTrack},canvasObjs(){return this.$store.getters.canvasObjs},duration(){return this.$store.getters.duration},stages(){return this.$store.getters.stages},currentUser(){return this.$store.getters.currentUser},stageBgColor(){return this.$store.getters.stageBgColor},playerSize(){return this.$store.getters.playerSize}},created(){f.$on("open:uploader",this.openUploadDialog)},mounted(){this.audioTrack.blob.size||this.$q.notify({message:"音频资源已失效",type:"negative",timeout:1e4})},methods:{openUploadDialog(){this.$q.dialog({title:this.$t("preview.upload"),message:"给本次录制的微课命名",prompt:{model:"",isValid:t=>t.length>2,type:"text"},cancel:!0,persistent:!0}).onOk((t=>{this.publishVideo(t)}))},publishVideo(t){t.length>0&&t.length<=30&&(f.$emit("load:start","发布中..."),Kr(this.audioTrack.blob).then((e=>{let r=this.audioTrack.blob.size;this.stages.forEach((t=>{t.bg&&(r+=t.bg.size)}));const a=this.stages.find((t=>t.bg));this.$store.commit("ADD_CANVAS_OBJ",{ac:"AU",ts:1,data:e,dur:this.duration}),aa({cd:JSON.stringify({stage:this.stages,canvas:this.canvasObjs,dur:this.duration,size:this.playerSize,bgcolor:this.stageBgColor,resSize:r}),t:t,uinfo:JSON.stringify({displayName:this.currentUser.displayName,av:this.currentUser.avatar}),dur:this.duration,cover_url:a?a.bg.url:""},(t=>{this.dialog=!1,f.$emit("load:end"),this.$router.replace({path:`/vd/${t}`})}))})).catch((t=>{console.log(t),this.$q.notify({message:this.$t("preview.pubFail"),type:"negative",timeout:1e4})})))}}},za=Ga,Ya=Object(y["a"])(za,$a,Na,!1,null,"61fa0235",null),Xa=Ya.exports,Za=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"preview-container"},[t.info.cd?r("player",{ref:"player",attrs:{audioUrl:t.info.ap,canvasObjs:t.info.cd.canvas,stages:t.info.cd.stage,duration:t.info.dur,size:t.info.cd.size,bgColor:t.info.cd.bgcolor},on:{played:t.plusPlayCount}}):t._e()],1)},Ka=[],Ja={name:"Video",components:{Player:Ha},data(){return{info:{t:"",created_by:{nickname:""}}}},computed:{currentUser(){return this.$store.getters.currentUser}},watch:{},created(){f.$on("video:fullscreen",this.requestFullscreen),f.$on("video:remove",this.removeVideo)},destroyed(){this.$store.commit("SET_VIDEO_INFO",null)},mounted(){this.getVideoBy(this.$route.params.id),window.addEventListener("orientationchange",(()=>{this.$refs.player.fitScreenWidth(),window.screen.orientation&&"landscape-primary"===window.screen.orientation.type&&this.$confirm("建议开启全屏模式, 获取最佳观看体验","提示",{type:"info",beforeClose:(t,e,r)=>{t&&this.requestFullscreen(),r()}})})),document.addEventListener("webkitfullscreenchange",(t=>{const e=document.mozFullScreen||document.webkitIsFullScreen;e||this.$refs.player.fitToOriginWidth()}))},methods:{getVideoBy(t){ta(t,(t=>{this.info=t,this.$store.commit("SET_VIDEO_INFO",t),this.$nextTick((()=>{window.screen.width<900&&this.$refs.player.fitScreenWidth()}))}))},plusPlayCount(){ra(this.$route.params.id)},requestFullscreen(t){const e=this.$refs.player.$el;t&&this.$refs.player.fitScreenWidth(),e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},removeVideo(){this.$q.dialog({title:"确认操作",message:"确定要删除 "+this.info.t+" 吗？无法恢复",cancel:!0,persistent:!0}).onOk((()=>{ea(this.info.id,(t=>{this.$router.replace({path:"/mywork"})}))}))}}},tn=Ja,en=Object(y["a"])(tn,Za,Ka,!1,null,null,null),rn=en.exports,an=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("section",[t.replyUrl?r("div",{staticClass:"text-center"},[r("video",{attrs:{width:t.info.cd.size[0],src:t.replyUrl,poster:t.coverImg,controls:""}}),r("div",[r("q-input",{attrs:{value:t.replyUrl,filled:""}})],1)]):t._e(),t.canConvert?r("div",{staticStyle:{"pointer-events":"none"}},[t.info.cd&&!t.replyUrl?r("player",{ref:"player",attrs:{canvasObjs:t.info.cd.canvas,stages:t.info.cd.stage,size:t.info.cd.size,duration:t.info.dur,scaleRate:t.scaleRate,bgColor:t.bgColor,stageMode:t.stageMode,unick:t.info.uinfo.displayName||"匿名",avatar:t.info.uinfo.photoURL||t.info.uinfo.av,title:t.info.t},on:{captureImg:t.getCaptureImg,playover:t.handleOver,getCover:function(e){return t.coverImg=e}}}):t._e()],1):t._e()])},nn=[],sn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"player-wrap"},[r("div",{ref:"layerContainer",staticClass:"canvas-layer-wrap",style:t.layerContainerHeight},[r("div",{staticClass:"canvas-layer",style:t.layerStyle+"background-color:"+t.bgColor},[r("canvas",{ref:"captureLayer",style:t.captureLayerStyle,attrs:{width:t.canvasW,height:t.captureH}}),r("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fakeLayer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"stageLayer",staticClass:"stage-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"displayLayer",staticClass:"display-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"syncLayer",staticClass:"sync-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}})])])])},on=[],cn=r("ecd6"),ln=r.n(cn);function un(){return ln()('(function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="635f")})({"069b":function(t,e,n){"use strict";var r=n("41fa"),o=n("3df9"),a=n("dd14"),i=n("9fc2")||0;function c(e){return r.seed(e),t.exports}function s(e){return i=e,t.exports}function f(t){return void 0!==t&&r.characters(t),r.shuffled()}function u(){return o(i)}t.exports=u,t.exports.generate=u,t.exports.seed=c,t.exports.worker=s,t.exports.characters=f,t.exports.isValid=a},"06cf":function(t,e,n){var r=n("83ab"),o=n("d1e7"),a=n("5c6c"),i=n("fc6a"),c=n("c04e"),s=n("5135"),f=n("0cfb"),u=Object.getOwnPropertyDescriptor;e.f=r?u:function(t,e){if(t=i(t),e=c(e,!0),f)try{return u(t,e)}catch(n){}if(s(t,e))return a(!o.f.call(t,e),t[e])}},"091d":function(t,e,n){"use strict";var r,o="object"===typeof window&&(window.crypto||window.msCrypto);r=o&&o.getRandomValues?function(t){return o.getRandomValues(new Uint8Array(t))}:function(t){for(var e=[],n=0;n<t;n++)e.push(Math.floor(256*Math.random()));return e},t.exports=r},"0cfb":function(t,e,n){var r=n("83ab"),o=n("d039"),a=n("cc12");t.exports=!r&&!o((function(){return 7!=Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},"1be4":function(t,e,n){var r=n("d066");t.exports=r("document","documentElement")},"1d80":function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can\'t call method on "+t);return t}},"23cb":function(t,e,n){var r=n("a691"),o=Math.max,a=Math.min;t.exports=function(t,e){var n=r(t);return n<0?o(n+e,0):a(n,e)}},"23e7":function(t,e,n){var r=n("da84"),o=n("06cf").f,a=n("9112"),i=n("6eeb"),c=n("ce4e"),s=n("e893"),f=n("94ca");t.exports=function(t,e){var n,u,l,d,p,y,h=t.target,v=t.global,b=t.stat;if(u=v?r:b?r[h]||c(h,{}):(r[h]||{}).prototype,u)for(l in e){if(p=e[l],t.noTargetGet?(y=o(u,l),d=y&&y.value):d=u[l],n=f(v?l:h+(b?".":"#")+l,t.forced),!n&&void 0!==d){if(typeof p===typeof d)continue;s(p,d)}(t.sham||d&&d.sham)&&a(p,"sham",!0),i(u,l,p,t)}}},"241c":function(t,e,n){var r=n("ca84"),o=n("7839"),a=o.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,a)}},"37e8":function(t,e,n){var r=n("83ab"),o=n("9bf2"),a=n("825a"),i=n("df75");t.exports=r?Object.defineProperties:function(t,e){a(t);var n,r=i(e),c=r.length,s=0;while(c>s)o.f(t,n=r[s++],e[n]);return t}},"3bbe":function(t,e,n){var r=n("861d");t.exports=function(t){if(!r(t)&&null!==t)throw TypeError("Can\'t set "+String(t)+" as a prototype");return t}},"3df9":function(t,e,n){"use strict";var r,o,a=n("bd92"),i=(n("41fa"),1567752802062),c=7;function s(t){var e="",n=Math.floor(.001*(Date.now()-i));return n===o?r++:(r=0,o=n),e+=a(c),e+=a(t),r>0&&(e+=a(r)),e+=a(n),e}t.exports=s},"3f8c":function(t,e){t.exports={}},"41fa":function(t,e,n){"use strict";var r,o,a,i=n("7eac"),c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function s(){a=!1}function f(t){if(t){if(t!==r){if(t.length!==c.length)throw new Error("Custom alphabet for shortid must be "+c.length+" unique characters. You submitted "+t.length+" characters: "+t);var e=t.split("").filter((function(t,e,n){return e!==n.lastIndexOf(t)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+c.length+" unique characters. These characters were not unique: "+e.join(", "));r=t,s()}}else r!==c&&(r=c,s())}function u(t){return f(t),r}function l(t){i.seed(t),o!==t&&(s(),o=t)}function d(){r||f(c);var t,e=r.split(""),n=[],o=i.nextValue();while(e.length>0)o=i.nextValue(),t=Math.floor(o*e.length),n.push(e.splice(t,1)[0]);return n.join("")}function p(){return a||(a=d(),a)}function y(t){var e=p();return e[t]}function h(){return r||c}t.exports={get:h,characters:u,seed:l,lookup:y,shuffled:p}},"428f":function(t,e,n){var r=n("da84");t.exports=r},"44ad":function(t,e,n){var r=n("d039"),o=n("c6b6"),a="".split;t.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==o(t)?a.call(t,""):Object(t)}:Object},"44d2":function(t,e,n){var r=n("b622"),o=n("7c73"),a=n("9bf2"),i=r("unscopables"),c=Array.prototype;void 0==c[i]&&a.f(c,i,{configurable:!0,value:o(null)}),t.exports=function(t){c[i][t]=!0}},4930:function(t,e,n){var r=n("d039");t.exports=!!Object.getOwnPropertySymbols&&!r((function(){return!String(Symbol())}))},"4d64":function(t,e,n){var r=n("fc6a"),o=n("50c4"),a=n("23cb"),i=function(t){return function(e,n,i){var c,s=r(e),f=o(s.length),u=a(i,f);if(t&&n!=n){while(f>u)if(c=s[u++],c!=c)return!0}else for(;f>u;u++)if((t||u in s)&&s[u]===n)return t||u||0;return!t&&-1}};t.exports={includes:i(!0),indexOf:i(!1)}},"50c4":function(t,e,n){var r=n("a691"),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},5135:function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},5692:function(t,e,n){var r=n("c430"),o=n("c6cd");(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.8.1",mode:r?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},"56ef":function(t,e,n){var r=n("d066"),o=n("241c"),a=n("7418"),i=n("825a");t.exports=r("Reflect","ownKeys")||function(t){var e=o.f(i(t)),n=a.f;return n?e.concat(n(t)):e}},"5c6c":function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},"635f":function(t,e,n){"use strict";n.r(e);const r=[{name:"咖啡色",value:"#655643"},{name:"粉色",value:"#FF9E9D"},{name:"橙色",value:"#ec8749"},{name:"蓝色",value:"#0088ff"},{name:"红色",value:"#e74000"},{name:"绿色",value:"#5cb85c"},{name:"白色",value:"#ffffff"},{name:"黑色",value:"#1d1d1d"}];n("ddb0");function o(t){return Math.max.apply(Math,t)}function a(t){return Math.min.apply(Math,t)}function i(t){const e=t.map((t=>t[0])),n=t.map((t=>t[1]));return[a(e),a(n),o(e)-a(e),o(n)-a(n)]}function c(t,e){return 1!==e?t*e+.5<<0:t}function s(t,e,n=1){const r=Math.round(e[0]*n-t.lineWidth/2-.5),o=Math.round(e[1]*n-t.lineWidth/2-.5),a=Math.round(e[2]*n+t.lineWidth+.5),i=Math.round(e[3]*n+t.lineWidth+.5);t.clearRect(r,o,a,i)}function f(t,e,n=1){s(t,i(e),n),e=[]}function u(t,e,n,r=!0){if(r&&t.clearCurve(),1===e.length){const r=e[0];return t.beginPath(),t.arc(c(r[0],n),c(r[1],n),t.lineWidth/2,0,2*Math.PI,!0),t.closePath(),void t.fill()}t.beginPath();const o=c(e[0][0],n),a=c(e[0][1],n);if(t.moveTo(o,a),2===e.length)return t.lineTo(c(e[1][0],n),c(e[1][1],n)),void t.stroke();let i=1;while(i<e.length-2){const r=c((e[i][0]+e[i+1][0])/2,n),o=c((e[i][1]+e[i+1][1])/2,n),a=c(e[i][0],n),s=c(e[i][1],n);t.quadraticCurveTo(a,s,r,o),i++}const s=c(e[i][0],n),f=c(e[i][1],n),u=c(e[i+1][0],n),l=c(e[i+1][1],n);t.quadraticCurveTo(s,f,u,l),t.stroke()}function l(t,e,n,r,o=1){return{x:Math.min(t,n)/o,y:Math.min(e,r)/o,w:Math.abs(n-t)/o,h:Math.abs(r-e)/o}}function d(t,e,n=1,r){t.save(),t.lineWidth=2,t.strokeStyle=r,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(e[0]*n,e[1]*n),t.lineTo(e[2]*n,e[3]*n),t.stroke(),t.restore()}function p(t,e,n=1,r){const o=10;t.save(),t.lineWidth=2,r&&(t.strokeStyle=r),t.lineCap="round",t.lineJoin="round";const a=e[2],i=e[3],c=Math.atan2(e[3]-e[1],e[2]-e[0]);t.beginPath(),t.moveTo(e[0]*n,e[1]*n),t.lineTo(e[2]*n,e[3]*n),t.moveTo(a,i),t.lineTo(a-o*Math.cos(c-Math.PI/6),i-o*Math.sin(c-Math.PI/6)),t.moveTo(a,i),t.lineTo(a-o*Math.cos(c+Math.PI/6),i-o*Math.sin(c+Math.PI/6)),t.stroke(),t.restore()}function y(t,e,n=1,r){t.save(),t.lineWidth=2,r&&(t.strokeStyle=r);const o=l(...e,n);t.strokeRect(o.x,o.y,o.w,o.h),t.restore()}function h(t,e,n=1,r){const o=l(...e,n),a=o.x+o.w/2,i=o.y+o.h/2;t.save(),t.lineWidth=2,r&&(t.strokeStyle=r),t.beginPath(),t.ellipse(a,i,o.w/2,o.h/2,0,2*Math.PI,!1),t.stroke(),t.restore()}var v=n("8dee"),b=n.n(v);const g=100;let x=0,m={},w=[],S=!1;const L=t=>self[t].getContext("2d"),O=t=>"string"===typeof t&&0===t.indexOf("#")||String(t).indexOf("rgba")>-1?t:r[t].value,T=(t={})=>{const e=L("fakeLayer");e.fillStyle="#fff";const n=self.width*self.scaleRate,r=self.height*self.scaleRate;e.fillRect(0,0,n,r);let o=80;e.textBaseline="middle",e.font="22px Roboto",e.fillStyle="#666";const a=t.title,i=e.measureText(a).width;if(i<n){const t=n/2-i/2;e.fillText(a,t,o)}e.font="16px Roboto",e.fillStyle="#999";const c="由手绘微课录制",s=n/2-e.measureText(c).width/2;if(e.fillText(c,s,r-60),o+=40,t.author){e.font="18px Roboto",e.fillStyle="#333";const r=n/2-e.measureText(t.author).width/2;e.fillText(t.author,r,o)}self.fakeLayer.convertToBlob({type:"image/webp"}).then((t=>{const e=new FileReader;return e.readAsDataURL(t),new Promise((t=>{e.onloadend=()=>{t(e.result)}}))})).then((t=>{postMessage({target:"mini",payload:{title:"SEND_COVER",data:t}})}))},M=t=>{t.id=t.id||b.a.generate(),w.push(t)},k=t=>(w=w.filter((e=>t.indexOf(e.id)<0)),w),P=(t="editLayer",e)=>{if(!self[t])return;const n=L(t);e?f(n,e,self.scaleRate):n.clearRect(0,0,self.canvasW,self.canvasH)},j=()=>{S=!0,x=0,w=[],P("displayLayer"),P("editLayer"),P("stageLayer"),P("syncLayer"),m={},self.curFid=null,postMessage({target:"mini",payload:{title:"CONVERT_DONE"}})},R=(t,e="displayLayer",n=!1)=>{const r=L(e);if(r.strokeStyle=r.fillStyle=O(t.co),r.lineWidth=t.wi*self.scaleRate,r.lineCap=r.lineJoin="round",n){const n=r._points;r.clearCurve=n?()=>P(e,n):()=>{},r._points=t.po}else"displayLayer"===e&&M(t);u(r,t.po,self.scaleRate,n)},E=(t,e="displayLayer")=>{const n=L(e);switch(t.sty){case"L":d(n,t.data,self.scaleRate,t.co);break;case"AL":p(n,t.data,self.scaleRate,t.co);break;case"R":y(n,t.data,self.scaleRate,t.co);break;case"C":h(n,t.data,self.scaleRate,t.co);break}"displayLayer"===e&&M(t)},C=(t,e)=>new Promise(((n,r)=>{switch(t.ty){case"C":R(t,e),n();break;case"S":E(t,e),n();break;default:R(t,e),n();break}})),_=async(t,e=!1)=>{P("fakeLayer");for(const n of t)await C(n,"fakeLayer");e&&P("displayLayer"),L("displayLayer").drawImage(self.fakeLayer,0,0,self.width*self.scaleRate,self.height*self.scaleRate)},I=t=>{t&&(w=t),w.length?_(w,!0):P("displayLayer")},A=(t,e,n=0)=>{if(t.url)return new Promise(((r,o)=>{let a=t.w,i=t.h;a!==self.width&&(i=self.width*i/a,a=self.width);const c=L("stageLayer");c.save(),c.drawImage(self.imageDict[e],0,n,a*self.scaleRate,i*self.scaleRate),c.restore(),r()}))},F=async(t,e)=>{const n=self.stages.find((e=>e.id===t));if(n){const t=n.bg;P("stageLayer"),I(m[n.id]||[]),t&&await A(t,n.id)}},W=t=>{switch(t.ac){case"CSync":case"Cy":R(t.data,"syncLayer",!0);break;case"CEnd":case"CE":P("syncLayer"),R(t.data);break;case"E":k(t.data),I();break;case"F":case"Frame":{self.preFid=self.curFid;let e=0;"object"===typeof t.data?(self.curFid=t.data.id,e=t.data.top):self.curFid=t.data,self.preFid&&(m[self.preFid]=w),F(self.curFid,e);break}case"SEnd":E(t.data);break;case"End":j();break;case"UE":_(t.data);for(const e of t.data)M(e);break}},D=(t,e)=>{const n=L("captureLayer"),r=["stageLayer","displayLayer","syncLayer"];r.forEach((t=>{"stageLayer"===t&&(n.fillStyle=self.bgColor,n.fillRect(0,0,self.canvasW,self.captureH)),n.drawImage(self[t],0,0,self.canvasW,self.captureH,0,0,self.canvasW,self.captureH)})),n.font="24px 楷体",n.fillStyle="rgba(255,255,255,0.7)",n.shadowColor="rgba(0,0,0,0.2)",n.shadowOffsetX=2,n.shadowOffsetY=2,n.shadowBlur=2;const o="手绘微课",a=self.canvasW-n.measureText(o).width-10,i=self.captureH-20;n.fillText(o,a,i),n.restore(),self.captureLayer.convertToBlob({type:"image/webp",quality:.9}).then((t=>{const e=new FileReader;return e.readAsDataURL(t),new Promise((t=>{e.onloadend=()=>{t(e.result)}}))})).then((n=>{postMessage({target:"mini",payload:{title:"CAPTURE_IMG",data:{imgData:n,cts:t}}}),e()}))},V=t=>new Promise(((e,n)=>{self.canvasObjs.filter((e=>t-g<=e.ts&&e.ts<t)).forEach(W),D(t,e)})),N=async()=>{while(!S)x+=g,await V(x)};onmessage=t=>{const{code:e,payload:n}=t.data;if(e)switch(e){case"INIT_LAYER":self.captureLayer=n.captureLayer,self.fakeLayer=n.fakeLayer,self.stageLayer=n.stageLayer,self.displayLayer=n.displayLayer,self.syncLayer=n.syncLayer,self.bgColor=n.bgColor,self.width=n.width,self.height=n.height,self.scaleRate=n.scaleRate,self.canvasW=n.canvasW,self.canvasH=n.canvasH,self.captureH=n.captureH,self.stages=n.stages,self.imageDict=n.imageDict;break;case"GET_COVER":T(n);break;case"START_CONVERT":self.canvasObjs=n,N();break;default:break}}},"69f3":function(t,e,n){var r,o,a,i=n("7f9a"),c=n("da84"),s=n("861d"),f=n("9112"),u=n("5135"),l=n("c6cd"),d=n("f772"),p=n("d012"),y=c.WeakMap,h=function(t){return a(t)?o(t):r(t,{})},v=function(t){return function(e){var n;if(!s(e)||(n=o(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}};if(i){var b=l.state||(l.state=new y),g=b.get,x=b.has,m=b.set;r=function(t,e){return e.facade=t,m.call(b,t,e),e},o=function(t){return g.call(b,t)||{}},a=function(t){return x.call(b,t)}}else{var w=d("state");p[w]=!0,r=function(t,e){return e.facade=t,f(t,w,e),e},o=function(t){return u(t,w)?t[w]:{}},a=function(t){return u(t,w)}}t.exports={set:r,get:o,has:a,enforce:h,getterFor:v}},"6eeb":function(t,e,n){var r=n("da84"),o=n("9112"),a=n("5135"),i=n("ce4e"),c=n("8925"),s=n("69f3"),f=s.get,u=s.enforce,l=String(String).split("String");(t.exports=function(t,e,n,c){var s,f=!!c&&!!c.unsafe,d=!!c&&!!c.enumerable,p=!!c&&!!c.noTargetGet;"function"==typeof n&&("string"!=typeof e||a(n,"name")||o(n,"name",e),s=u(n),s.source||(s.source=l.join("string"==typeof e?e:""))),t!==r?(f?!p&&t[e]&&(d=!0):delete t[e],d?t[e]=n:o(t,e,n)):d?t[e]=n:i(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&f(this).source||c(this)}))},7418:function(t,e){e.f=Object.getOwnPropertySymbols},7839:function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"7b0b":function(t,e,n){var r=n("1d80");t.exports=function(t){return Object(r(t))}},"7c73":function(t,e,n){var r,o=n("825a"),a=n("37e8"),i=n("7839"),c=n("d012"),s=n("1be4"),f=n("cc12"),u=n("f772"),l=">",d="<",p="prototype",y="script",h=u("IE_PROTO"),v=function(){},b=function(t){return d+y+l+t+d+"/"+y+l},g=function(t){t.write(b("")),t.close();var e=t.parentWindow.Object;return t=null,e},x=function(){var t,e=f("iframe"),n="java"+y+":";return e.style.display="none",s.appendChild(e),e.src=String(n),t=e.contentWindow.document,t.open(),t.write(b("document.F=Object")),t.close(),t.F},m=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(e){}m=r?g(r):x();var t=i.length;while(t--)delete m[p][i[t]];return m()};c[h]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(v[p]=o(t),n=new v,v[p]=null,n[h]=t):n=m(),void 0===e?n:a(n,e)}},"7dd0":function(t,e,n){"use strict";var r=n("23e7"),o=n("9ed3"),a=n("e163"),i=n("d2bb"),c=n("d44e"),s=n("9112"),f=n("6eeb"),u=n("b622"),l=n("c430"),d=n("3f8c"),p=n("ae93"),y=p.IteratorPrototype,h=p.BUGGY_SAFARI_ITERATORS,v=u("iterator"),b="keys",g="values",x="entries",m=function(){return this};t.exports=function(t,e,n,u,p,w,S){o(n,e,u);var L,O,T,M=function(t){if(t===p&&E)return E;if(!h&&t in j)return j[t];switch(t){case b:return function(){return new n(this,t)};case g:return function(){return new n(this,t)};case x:return function(){return new n(this,t)}}return function(){return new n(this)}},k=e+" Iterator",P=!1,j=t.prototype,R=j[v]||j["@@iterator"]||p&&j[p],E=!h&&R||M(p),C="Array"==e&&j.entries||R;if(C&&(L=a(C.call(new t)),y!==Object.prototype&&L.next&&(l||a(L)===y||(i?i(L,y):"function"!=typeof L[v]&&s(L,v,m)),c(L,k,!0,!0),l&&(d[k]=m))),p==g&&R&&R.name!==g&&(P=!0,E=function(){return R.call(this)}),l&&!S||j[v]===E||s(j,v,E),d[e]=E,p)if(O={values:M(g),keys:w?E:M(b),entries:M(x)},S)for(T in O)(h||P||!(T in j))&&f(j,T,O[T]);else r({target:e,proto:!0,forced:h||P},O);return O}},"7eac":function(t,e,n){"use strict";var r=1;function o(){return r=(9301*r+49297)%233280,r/233280}function a(t){r=t}t.exports={nextValue:o,seed:a}},"7f9a":function(t,e,n){var r=n("da84"),o=n("8925"),a=r.WeakMap;t.exports="function"===typeof a&&/native code/.test(o(a))},"825a":function(t,e,n){var r=n("861d");t.exports=function(t){if(!r(t))throw TypeError(String(t)+" is not an object");return t}},"83ab":function(t,e,n){var r=n("d039");t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"861d":function(t,e){t.exports=function(t){return"object"===typeof t?null!==t:"function"===typeof t}},8925:function(t,e,n){var r=n("c6cd"),o=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(t){return o.call(t)}),t.exports=r.inspectSource},"8dee":function(t,e,n){"use strict";t.exports=n("069b")},"90e3":function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++n+r).toString(36)}},9112:function(t,e,n){var r=n("83ab"),o=n("9bf2"),a=n("5c6c");t.exports=r?function(t,e,n){return o.f(t,e,a(1,n))}:function(t,e,n){return t[e]=n,t}},"94ca":function(t,e,n){var r=n("d039"),o=/#|\\.prototype\\./,a=function(t,e){var n=c[i(t)];return n==f||n!=s&&("function"==typeof e?r(e):!!e)},i=a.normalize=function(t){return String(t).replace(o,".").toLowerCase()},c=a.data={},s=a.NATIVE="N",f=a.POLYFILL="P";t.exports=a},"9bf2":function(t,e,n){var r=n("83ab"),o=n("0cfb"),a=n("825a"),i=n("c04e"),c=Object.defineProperty;e.f=r?c:function(t,e,n){if(a(t),e=i(e,!0),a(n),o)try{return c(t,e,n)}catch(r){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},"9ed3":function(t,e,n){"use strict";var r=n("ae93").IteratorPrototype,o=n("7c73"),a=n("5c6c"),i=n("d44e"),c=n("3f8c"),s=function(){return this};t.exports=function(t,e,n){var f=e+" Iterator";return t.prototype=o(r,{next:a(1,n)}),i(t,f,!1,!0),c[f]=s,t}},"9fc2":function(t,e,n){"use strict";t.exports=0},a691:function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},ae93:function(t,e,n){"use strict";var r,o,a,i=n("e163"),c=n("9112"),s=n("5135"),f=n("b622"),u=n("c430"),l=f("iterator"),d=!1,p=function(){return this};[].keys&&(a=[].keys(),"next"in a?(o=i(i(a)),o!==Object.prototype&&(r=o)):d=!0),void 0==r&&(r={}),u||s(r,l)||c(r,l,p),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:d}},b622:function(t,e,n){var r=n("da84"),o=n("5692"),a=n("5135"),i=n("90e3"),c=n("4930"),s=n("fdbf"),f=o("wks"),u=r.Symbol,l=s?u:u&&u.withoutSetter||i;t.exports=function(t){return a(f,t)||(c&&a(u,t)?f[t]=u[t]:f[t]=l("Symbol."+t)),f[t]}},bd92:function(t,e,n){"use strict";var r=n("41fa"),o=n("091d"),a=n("e51f");function i(t){var e,n=0,i="";while(!e)i+=a(o,r.get(),1),e=t<Math.pow(16,n+1),n++;return i}t.exports=i},c04e:function(t,e,n){var r=n("861d");t.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can\'t convert object to primitive value")}},c430:function(t,e){t.exports=!1},c6b6:function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},c6cd:function(t,e,n){var r=n("da84"),o=n("ce4e"),a="__core-js_shared__",i=r[a]||o(a,{});t.exports=i},c8ba:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}t.exports=n},ca84:function(t,e,n){var r=n("5135"),o=n("fc6a"),a=n("4d64").indexOf,i=n("d012");t.exports=function(t,e){var n,c=o(t),s=0,f=[];for(n in c)!r(i,n)&&r(c,n)&&f.push(n);while(e.length>s)r(c,n=e[s++])&&(~a(f,n)||f.push(n));return f}},cc12:function(t,e,n){var r=n("da84"),o=n("861d"),a=r.document,i=o(a)&&o(a.createElement);t.exports=function(t){return i?a.createElement(t):{}}},ce4e:function(t,e,n){var r=n("da84"),o=n("9112");t.exports=function(t,e){try{o(r,t,e)}catch(n){r[t]=e}return e}},d012:function(t,e){t.exports={}},d039:function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},d066:function(t,e,n){var r=n("428f"),o=n("da84"),a=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?a(r[t])||a(o[t]):r[t]&&r[t][e]||o[t]&&o[t][e]}},d1e7:function(t,e,n){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,a=o&&!r.call({1:2},1);e.f=a?function(t){var e=o(this,t);return!!e&&e.enumerable}:r},d2bb:function(t,e,n){var r=n("825a"),o=n("3bbe");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set,t.call(n,[]),e=n instanceof Array}catch(a){}return function(n,a){return r(n),o(a),e?t.call(n,a):n.__proto__=a,n}}():void 0)},d44e:function(t,e,n){var r=n("9bf2").f,o=n("5135"),a=n("b622"),i=a("toStringTag");t.exports=function(t,e,n){t&&!o(t=n?t:t.prototype,i)&&r(t,i,{configurable:!0,value:e})}},da84:function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,n("c8ba"))},dd14:function(t,e,n){"use strict";var r=n("41fa");function o(t){if(!t||"string"!==typeof t||t.length<6)return!1;var e=new RegExp("[^"+r.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g,"\\\\$&")+"]");return!e.test(t)}t.exports=o},ddb0:function(t,e,n){var r=n("da84"),o=n("fdbc"),a=n("e260"),i=n("9112"),c=n("b622"),s=c("iterator"),f=c("toStringTag"),u=a.values;for(var l in o){var d=r[l],p=d&&d.prototype;if(p){if(p[s]!==u)try{i(p,s,u)}catch(h){p[s]=u}if(p[f]||i(p,f,l),o[l])for(var y in a)if(p[y]!==a[y])try{i(p,y,a[y])}catch(h){p[y]=a[y]}}}},df75:function(t,e,n){var r=n("ca84"),o=n("7839");t.exports=Object.keys||function(t){return r(t,o)}},e163:function(t,e,n){var r=n("5135"),o=n("7b0b"),a=n("f772"),i=n("e177"),c=a("IE_PROTO"),s=Object.prototype;t.exports=i?Object.getPrototypeOf:function(t){return t=o(t),r(t,c)?t[c]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},e177:function(t,e,n){var r=n("d039");t.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},e260:function(t,e,n){"use strict";var r=n("fc6a"),o=n("44d2"),a=n("3f8c"),i=n("69f3"),c=n("7dd0"),s="Array Iterator",f=i.set,u=i.getterFor(s);t.exports=c(Array,"Array",(function(t,e){f(this,{type:s,target:r(t),index:0,kind:e})}),(function(){var t=u(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values"),a.Arguments=a.Array,o("keys"),o("values"),o("entries")},e51f:function(t,e){t.exports=function(t,e,n){var r=(2<<Math.log(e.length-1)/Math.LN2)-1,o=-~(1.6*r*n/e.length),a="";while(1){var i=t(o),c=o;while(c--)if(a+=e[i[c]&r]||"",a.length===+n)return a}}},e893:function(t,e,n){var r=n("5135"),o=n("56ef"),a=n("06cf"),i=n("9bf2");t.exports=function(t,e){for(var n=o(e),c=i.f,s=a.f,f=0;f<n.length;f++){var u=n[f];r(t,u)||c(t,u,s(e,u))}}},f772:function(t,e,n){var r=n("5692"),o=n("90e3"),a=r("keys");t.exports=function(t){return a[t]||(a[t]=o(t))}},fc6a:function(t,e,n){var r=n("44ad"),o=n("1d80");t.exports=function(t){return r(o(t))}},fdbc:function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},fdbf:function(t,e,n){var r=n("4930");t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator}});',"Worker",void 0,r.p+"js/offcanvas.worker.bb543541.worker.js")}var dn={name:"MiniPlayer",components:{},props:{canvasObjs:{type:Array,require:!0},scaleRate:{type:Number},stages:{type:Array},bgColor:{type:String},unick:{type:String},title:{type:String},cursor:{type:Boolean,default:!1},stageMode:{type:String},size:{type:Array,default(){return[900,506]}}},data(){return{currentTs:0,framesData:{},height:0,stoped:!1}},computed:{width(){return Math.round(this.size[0])},wrapHeight(){return Math.round(this.size[1]>450||"center"!==this.stageMode?this.size[1]:450)},layerContainerHeight(){return"height:"+this.wrapHeight*this.scaleRate+"px;"},canvasW(){return this.width*window.devicePixelRatio*this.scaleRate},canvasH(){return this.height*window.devicePixelRatio*this.scaleRate},layerStyle(){return"width:"+this.width*this.scaleRate+"px;height:"+this.height*this.scaleRate+"px;"},captureLayerStyle(){return"width:"+this.width+"px;height:"+this.wrapHeight+"px;"},captureH(){return this.wrapHeight*window.devicePixelRatio*this.scaleRate}},created(){this.height=this.wrapHeight,this.imageDict={}},mounted(){const t=new un;t.onmessage=e=>{if("mini"===e.data.target){const{title:r,data:a}=e.data.payload;"SEND_COVER"===r?(this.$emit("getCover",a),t.postMessage({code:"START_CONVERT",payload:this.canvasObjs})):"CONVERT_DONE"===r?this.$emit("playover"):"CAPTURE_IMG"===r&&this.$emit("captureImg",a.imgData,[this.canvasW,this.canvasH],a.cts)}},this.canvasObjs.length&&this.preloadResource((()=>{this.initOffscreenCanvas(t),t.postMessage({code:"GET_COVER",payload:{title:this.title,author:this.unick}})}))},beforeDestroy(){this.currentTs&&this.clock&&this.clock.cancel()},methods:{initOffscreenCanvas(t){const e=this.$refs.captureLayer.transferControlToOffscreen(),r=this.$refs.fakeLayer.transferControlToOffscreen(),a=this.$refs.stageLayer.transferControlToOffscreen(),n=this.$refs.displayLayer.transferControlToOffscreen(),s=this.$refs.syncLayer.transferControlToOffscreen();t.postMessage({code:"INIT_LAYER",payload:{captureLayer:e,fakeLayer:r,stageLayer:a,displayLayer:n,syncLayer:s,bgColor:this.bgColor,scaleRate:this.scaleRate*window.devicePixelRatio,width:this.width,height:this.height,canvasW:this.canvasW,canvasH:this.canvasH,captureH:this.captureH,stages:this.stages,imageDict:this.imageDict}},[e,r,a,n,s])},playEachRecord(t){switch(t.ac){case"CSync":case"Cy":{this.canvasLayer.renderCurve(t.data,"syncLayer",!0);const e=t.data.po[t.data.po.length-1];this.canvasLayer.cursorMove({curX:e[0],curY:e[1],curOp:.5});break}case"CEnd":case"CE":this.canvasLayer.clearCtx("syncLayer"),this.canvasLayer.renderCurve(t.data);break;case"E":this.canvasLayer.removeCanvasObjs(t.data),this.canvasLayer.reRenderCanvasData();break;case"CM":this.canvasLayer.cursorMove({curX:t.data[0],curY:t.data[1],curOp:1});break;case"F":case"Frame":{this.preFid=this.curFid;let e=0;"object"===typeof t.data?(this.curFid=t.data.id,e=t.data.top):this.curFid=t.data,this.preFid&&(this.framesData[this.preFid]=this.canvasLayer.canvasObjs),this.frameChange(this.curFid,e);break}case"SL":this.canvasLayer.scrollLayerContainer(t.data);break;case"SEnd":this.canvasLayer.renderShape(t.data);break;case"End":this.progress=100,this.stopPlay();break;case"CC":this.canvasLayer.cursorMove({curColor:t.data});break;case"UE":this.canvasLayer.batchRenderObjs(t.data);for(const e of t.data)this.canvasLayer.addCanvasObj(e);break}},preloadStage(t,e){return new Promise(((r,a)=>{if(this.imageDict[e])r(this.imageDict[e]);else{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{createImageBitmap(a).then((t=>{this.imageDict[e]=t,r(this.imageDict[e])}))},a.src=Hr(t.url)}}))},async preloadResource(t){for(const e of this.stages)e.bg&&await this.preloadStage(e.bg,e.id);t()}}},hn=dn,pn=(r("0440"),Object(y["a"])(hn,sn,on,!1,null,"5552dc36",null)),fn=pn.exports,mn=(r("c19f"),r("cfc3"),r("4a9b"),function(t){this.data=new Uint8Array(t),this.pos=0});mn.prototype.seek=function(t){this.pos=t},mn.prototype.writeBytes=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t[e]},mn.prototype.writeByte=function(t){this.data[this.pos++]=t},mn.prototype.writeU8=mn.prototype.writeByte,mn.prototype.writeU16BE=function(t){this.data[this.pos++]=t>>8,this.data[this.pos++]=t},mn.prototype.writeDoubleBE=function(t){for(var e=new Uint8Array(new Float64Array([t]).buffer),r=e.length-1;r>=0;r--)this.writeByte(e[r])},mn.prototype.writeFloatBE=function(t){for(var e=new Uint8Array(new Float32Array([t]).buffer),r=e.length-1;r>=0;r--)this.writeByte(e[r])},mn.prototype.writeString=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t.charCodeAt(e)},mn.prototype.writeEBMLVarIntWidth=function(t,e){switch(e){case 1:this.writeU8(128|t);break;case 2:this.writeU8(64|t>>8),this.writeU8(t);break;case 3:this.writeU8(32|t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 4:this.writeU8(16|t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 5:this.writeU8(8|t/4294967296&7),this.writeU8(t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;default:throw new RuntimeException("Bad EBML VINT size "+e)}},mn.prototype.measureEBMLVarInt=function(t){if(t<127)return 1;if(t<16383)return 2;if(t<2097151)return 3;if(t<268435455)return 4;if(t<34359738367)return 5;throw new RuntimeException("EBML VINT size not supported "+t)},mn.prototype.writeEBMLVarInt=function(t){this.writeEBMLVarIntWidth(t,this.measureEBMLVarInt(t))},mn.prototype.writeUnsignedIntBE=function(t,e){switch(void 0===e&&(e=this.measureUnsignedInt(t)),e){case 5:this.writeU8(Math.floor(t/4294967296));case 4:this.writeU8(t>>24);case 3:this.writeU8(t>>16);case 2:this.writeU8(t>>8);case 1:this.writeU8(t);break;default:throw new RuntimeException("Bad UINT size "+e)}},mn.prototype.measureUnsignedInt=function(t){return t<256?1:t<65536?2:t<1<<24?3:t<4294967296?4:5},mn.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayBufferDataStream's pos lies beyond end of buffer"};var gn=mn,yn=r("ad16"),vn=function(t,e){function r(t,e){var r={};return[t,e].forEach((function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e])})),r}function a(t){return!("string"!==typeof t||!t.match(/^data:image\/webp;base64,/i))&&window.atob(t.substring("data:image/webp;base64,".length))}function n(t,e){var r=t.toDataURL("image/webp",e);return a(r)}function s(t){var e=t.indexOf("VP8 ");if(-1==e)throw"Failed to identify beginning of keyframe in WebP image";return e+="VP8 ".length+4,t.substring(e)}function i(t){this.value=t}function o(t){this.value=t}function c(t,e,r){if(Array.isArray(r))for(var a=0;a<r.length;a++)c(t,e,r[a]);else if("string"===typeof r)t.writeString(r);else if(r instanceof Uint8Array)t.writeBytes(r);else{if(!r.id)throw"Bad EBML datatype "+typeof r.data;var n,s,l;if(r.offset=t.pos+e,t.writeUnsignedIntBE(r.id),Array.isArray(r.data))-1===r.size?t.writeByte(255):(n=t.pos,t.writeBytes([0,0,0,0])),s=t.pos,r.dataOffset=s+e,c(t,e,r.data),-1!==r.size&&(l=t.pos,r.size=l-s,t.seek(n),t.writeEBMLVarIntWidth(r.size,4),t.seek(l));else if("string"===typeof r.data)t.writeEBMLVarInt(r.data.length),r.dataOffset=t.pos+e,t.writeString(r.data);else if("number"===typeof r.data)r.size||(r.size=t.measureUnsignedInt(r.data)),t.writeEBMLVarInt(r.size),r.dataOffset=t.pos+e,t.writeUnsignedIntBE(r.data,r.size);else if(r.data instanceof o)t.writeEBMLVarInt(8),r.dataOffset=t.pos+e,t.writeDoubleBE(r.data.value);else if(r.data instanceof i)t.writeEBMLVarInt(4),r.dataOffset=t.pos+e,t.writeFloatBE(r.data.value);else{if(!(r.data instanceof Uint8Array))throw"Bad EBML datatype "+typeof r.data;t.writeEBMLVarInt(r.data.byteLength),r.dataOffset=t.pos+e,t.writeBytes(r.data)}}}return function(i){var l,u,d,h,p=5e3,f=1,m=!1,g=[],y=0,v=0,b={quality:.95,fileWriter:null,fd:null,frameDuration:null,frameRate:null},w={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},C={id:17545,data:new o(0)},_=[],L=new e(i.fileWriter||i.fd);function k(t){return t-d.dataOffset}function S(){var t={id:21420,size:5,data:0},e={id:290298740,data:[]};for(var r in w){var a=w[r];a.positionEBML=Object.create(t),e.data.push({id:19899,data:[{id:21419,data:a.id},a.positionEBML]})}return e}function x(){h=S();var e={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},r={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},C]},a={id:374648427,data:[{id:174,data:[{id:215,data:f},{id:29637,data:f},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:[{id:176,data:l},{id:186,data:u}]}]}]};d={id:408125543,size:-1,data:[h,r,a]};var n=new t(256);c(n,L.pos,[e,d]),L.write(n.getAsDataArray()),w.SegmentInfo.positionEBML.data=k(r.offset),w.Tracks.positionEBML.data=k(a.offset)}function R(e){var r=new t(4);if(!(e.trackNumber>0&&e.trackNumber<127))throw"TrackNumber must be > 0 and < 127";return r.writeEBMLVarInt(e.trackNumber),r.writeU16BE(e.timecode),r.writeByte(128),{id:163,data:[r.getAsDataArray(),e.frame]}}function T(t){return{id:524531317,data:[{id:231,data:Math.round(t.timecode)}]}}function E(t,e,r){_.push({id:187,data:[{id:179,data:e},{id:183,data:[{id:247,data:t},{id:241,data:k(r)}]}]})}function A(){var e={id:475249515,data:_},r=new t(16+32*_.length);c(r,L.pos,e),L.write(r.getAsDataArray()),w.Cues.positionEBML.data=k(e.offset)}function P(){if(0!=g.length){for(var e=0,r=0;r<g.length;r++)e+=g[r].frame.length;var a=new t(e+32*g.length),n=T({timecode:Math.round(y)});for(r=0;r<g.length;r++)n.data.push(R(g[r]));c(a,L.pos,n),L.write(a.getAsDataArray()),E(f,Math.round(y),n.offset),g=[],y+=v,v=0}}function O(){if(!i.frameDuration){if(!i.frameRate)throw"Missing required frameDuration or frameRate setting";i.frameDuration=1e3/i.frameRate}}function q(t){t.trackNumber=f,t.timecode=Math.round(v),g.push(t),v+=t.duration,v>=p&&P()}function M(){var e=new t(h.size),r=L.pos;c(e,h.dataOffset,h.data),L.seek(h.dataOffset),L.write(e.getAsDataArray()),L.seek(r)}function I(){var e=new t(8),r=L.pos;e.writeDoubleBE(y),L.seek(C.dataOffset),L.write(e.getAsDataArray()),L.seek(r)}this.addFrameData=function(t,e){if(m){if(e[0]!=l||e[1]!=u)throw"Frame size differs from previous frames"}else l=e[0],u=e[1],x(),m=!0;var r=a(t);if(!r)throw"Couldn't decode WebP frame, does the browser support WebP?";q({frame:s(r),duration:i.frameDuration})},this.addFrame=function(t){if(m){if(t.width!=l||t.height!=u)throw"Frame size differs from previous frames"}else l=t.width,u=t.height,x(),m=!0;var e=n(t,{quality:i.quality});if(!e)throw"Couldn't decode WebP frame, does the browser support WebP?";q({frame:s(e),duration:i.frameDuration})},this.complete=function(){return P(),A(),M(),I(),L.complete("video/webm")},this.getWrittenSize=function(){return L.length},i=r(b,i||{}),O()}},bn=vn(gn,yn["a"]),wn=r("e19a");const Cn=r("046a");var _n={name:"VideoConvert",components:{Player:fn},data(){return{info:{t:"",unick:""},audioUrl:null,coverImg:"",canConvert:!1,scaleRate:1,bgColor:null,stageMode:null}},computed:{progress:{get(){return this.$store.getters.convertProgress},set(t){this.$store.commit("SET_CONVERT_PROGRESS",t)}},replyUrl:{get(){return this.$store.getters.replyUrl},set(t){this.$store.commit("SET_REPLY_URL",t)}}},created(){f.$on("vdc:download",(()=>{K(this.info.id+"_up17.mp4",this.replyUrl)})),f.$on("vdc:crop",this.cropVideo),f.$on("vdc:fitHeight",this.fitHeightVideo),f.$on("vdc:scaleHalf",this.scaleHalf),f.$on("vdc:upload",this.uploadVideo)},mounted(){this.ffmpeg=Object(wn["createFFmpeg"])({log:!0}),ta(this.$route.params.id,this.initData)},methods:{initWebmWriter(){this.encoder=new bn({quality:1,frameRate:10,fd:this.ffmpeg.FS("open",this.info.id+"2.webm","w+")})},cropVideo(){this.canConvert=!1;let t=0;this.info.cd.stage.forEach((e=>{if(e.bg){const{w:r,h:a}=e.bg,n=this.info.cd.size[0]*a/r;n>t&&(t=n)}})),this.info.cd.size[1]=Math.ceil(t),this.$nextTick((()=>{this.encoder.complete().then((()=>{this.initWebmWriter(),this.canConvert=!0}))}))},scaleHalf(){this.canConvert=!1,this.scaleRate=.5,this.$nextTick((()=>{this.encoder.complete().then((()=>{this.initWebmWriter(),this.canConvert=!0}))}))},fitHeightVideo(){this.canConvert=!1;let t=this.info.cd.size[1];this.info.cd.stage.forEach((e=>{if(e.bg){const{w:r,h:a}=e.bg,n=this.info.cd.size[0]*a/r;n<t&&(t=n)}})),this.info.cd.size[1]=Math.ceil(t),this.$nextTick((()=>{this.encoder.complete().then((()=>{this.initWebmWriter(),this.canConvert=!0}))}))},async initData(t){this.$store.commit("SET_VIDEO_INFO",t);const e=t.cd.canvas.filter((t=>"AU"===t.ac));this.audioUrls=e.map((t=>Hr(t.data))),this.audioDurs=e.map(((t,r)=>e[r+1]?e[r+1].ts-t.ts:t.dur)),console.log(this.audioUrls);const r=t.cd.canvas.filter((t=>"TX"===t.ac));r.length>0&&(this.subtitles=Cn.stringify(r.map(((t,r)=>{const a=t.data.split("");return a.length>24&&(a.splice(24,0,"\n"),t.data=a.join("")),{start:e[r].ts,end:e[r].ts+e[r].dur,text:t.data}}))),this.bgColor="#000",this.stageMode="center");const a=this.$q.dialog({message:"正在加载转码组件",progress:!0,persistent:!0,ok:!1});await this.ffmpeg.load(),this.vdRecords=t.cd.canvas.filter((t=>"VD"===t.ac)).map((t=>({url:t.data.url,ts:t.ts}))),console.log(JSON.stringify(this.vdRecords)),this.info=t,this.initWebmWriter(),a.hide(),this.canConvert=!0},getCaptureImg(t,e,r){this.encoder.addFrameData(t,e),r<this.info.dur&&(this.progress="正在导出... "+Math.floor(100*r/this.info.dur)+" %")},handleOver(){const t=this.subtitles?"mp3":"m4a";this.encoder.complete().then((async e=>{const r=await this.downloadAudio(),a=URL.createObjectURL(e);this.subtitles&&(this.progress="正在生成字幕文件...",console.log(this.subtitles),this.ffmpeg.FS("writeFile",this.info.id+".srt",this.subtitles),this.ffmpeg.FS("mkdir","/fonts"),this.ffmpeg.FS("writeFile","/fonts/arial.ttf",await Object(wn["fetchFile"])("/fonts/arial.ttf")));let n=r[0];r.length>1&&(n=await this.combineAudios(r,t)),this.ffmpeg.FS("writeFile",this.info.id+".webm",await Object(wn["fetchFile"])(a)),this.output="output.mp4",await this.ffmpeg.run("-i",this.info.id+".webm","-i",n,this.output),this.subtitles&&(this.output="output2.mp4",await this.ffmpeg.run("-i","output.mp4","-vf","subtitles="+this.info.id+'.srt:fontsdir=/fonts:force_style="Fontname=Songti"',this.output));const s=this.ffmpeg.FS("readFile",this.output);this.progress=null,this.replyUrl=URL.createObjectURL(new Blob([s.buffer],{type:"video/mp4"})),this.$q.notify({type:"positive",message:"MP4视频导出完成"})}))},async combineAudios(t,e="m4a"){this.progress="合并多个音频...";const r=`${this.info.id}_allin.${e}`;return await this.ffmpeg.run("-i",`concat:${t.join("|")}`,"-acodec","copy",r),this.progress="所有音频合并完成",t.forEach((t=>{this.ffmpeg.FS("unlink",t)})),r},downloadAudio(t="m4a"){this.progress="正在处理音频...";const e=[],r=this.audioUrls[0].split(".");return"aac"===r[r.length-1]&&(t="aac"),this.audioUrls.forEach(((r,a)=>{e.push(new Promise(((e,n)=>{const s=`${this.info.id}_${a}.${t}`;Object(wn["fetchFile"])(r).then((t=>{this.ffmpeg.FS("writeFile",s,t),e(s)}))})))})),Promise.all(e)},uploadVideo(){ia(this.ffmpeg.FS("readFile",this.output))}}},Ln=_n,kn=Object(y["a"])(Ln,an,nn,!1,null,null,null),Sn=kn.exports;Wt()(kn,"components",{QInput:Ye["a"]});var xn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"q-pa-md"},[r("div",{staticClass:"filter-panel"},[r("div",{staticClass:"row q-col-gutter-md"},[r("div",{staticClass:"col"},[r("q-input",{attrs:{dense:"",outlined:"",label:"选择开始日期",mask:"date",rules:["date"]},scopedSlots:t._u([{key:"append",fn:function(){return[r("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[r("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[r("q-date",{model:{value:t.started_at,callback:function(e){t.started_at=e},expression:"started_at"}},[r("div",{staticClass:"row items-center justify-end"},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.started_at,callback:function(e){t.started_at=e},expression:"started_at"}})],1),r("div",{staticClass:"col"},[r("q-input",{attrs:{dense:"",outlined:"",label:"选择结束日期",mask:"date",rules:["date"]},scopedSlots:t._u([{key:"append",fn:function(){return[r("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[r("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[r("q-date",{model:{value:t.ended_at,callback:function(e){t.ended_at=e},expression:"ended_at"}},[r("div",{staticClass:"row items-center justify-end"},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.ended_at,callback:function(e){t.ended_at=e},expression:"ended_at"}})],1),r("div",{staticClass:"col"},[r("q-input",{attrs:{dense:"",outlined:"",label:"观看次数<",type:"number"},model:{value:t.lt_count,callback:function(e){t.lt_count=e},expression:"lt_count"}})],1),r("div",{staticClass:"col"},[r("q-input",{attrs:{dense:"",outlined:"",label:"观看次数>",type:"number"},model:{value:t.gt_count,callback:function(e){t.gt_count=e},expression:"gt_count"}})],1),r("div",{staticClass:"col"},[r("q-btn",{attrs:{color:"primary"},on:{click:t.doFilter}},[t._v("查询")])],1)])]),r("q-infinite-scroll",{attrs:{offset:10},on:{load:t.onLoad},scopedSlots:t._u([t.hasNext?{key:"loading",fn:function(){return[r("div",{staticClass:"row justify-center q-my-md"},[r("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}:null],null,!0)},[r("q-list",{attrs:{separator:""}},[r("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("mywork.created"))+" "+t._s(t.allCount))]),t._l(t.workList,(function(e,a){return r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:"",to:"/vd/"+e.id}},[r("q-item-section",[r("q-item-label",[t._v(t._s(e.t))]),r("q-item-label",{attrs:{caption:""}},[r("small",[t._v("创建于")]),t._v(" "+t._s(e.c_at)+" "),r("small",[t._v("已播放")]),t._v(" "+t._s(e.count)+"\n            "),r("small",[t._v("作者")]),t._v(" "+t._s(e.created_by.displayName||e.created_by.nickname||"匿名")+"\n          ")])],1),r("q-item-section",{attrs:{side:""}},[t._v("\n          "+t._s(e.duration)+"\n        ")])],1)}))],2)],1),t.workList&&0===t.workList.length?r("div",{staticClass:"empty-tip"},[t._v("暂无任何作品")]):t._e()],1)},Rn=[],Tn={name:"MyWork",data(){return{allCount:0,workList:null,hasNext:!1,started_at:null,ended_at:null,lt_count:null,gt_count:null}},methods:{doFilter(){this.loadVideos({started_at:this.started_at,ended_at:this.ended_at,lt_count:this.lt_count,gt_count:this.gt_count})},loadVideos(t={},e){this.query=t,Jr(t,((r,a,n)=>{this.hasNext=!!a;let s=r;t.offset&&(s=this.workList.concat(r)),this.workList=s,this.allCount=n,e&&e()}))},onLoad(t,e){if(1===t||this.hasNext){const t=Object.assign(this.query||{},{offset:this.workList?this.workList.length:0});this.loadVideos(t,e)}}}},En=Tn,An=r("52ee"),Pn=Object(y["a"])(En,xn,Rn,!1,null,null,null),On=Pn.exports;Wt()(Pn,"components",{QInput:Ye["a"],QIcon:Nt["a"],QPopupProxy:ga["a"],QDate:An["a"],QBtn:Mt["a"],QInfiniteScroll:Oa["a"],QList:jt["a"],QItemLabel:we["a"],QItem:Dt["a"],QItemSection:Bt["a"],QSpinnerDots:qa["a"]}),Wt()(Pn,"directives",{ClosePopup:Ut["a"],Ripple:ke["a"]});var qn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"q-pa-md"},[r("q-infinite-scroll",{attrs:{offset:10},on:{load:t.onLoad},scopedSlots:t._u([t.hasNext?{key:"loading",fn:function(){return[r("div",{staticClass:"row justify-center q-my-md"},[r("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}:null],null,!0)},[r("q-list",{attrs:{separator:""}},[r("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("mywork.created"))+" "+t._s(t.allCount))]),t._l(t.workList,(function(e,a){return r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:"",to:"/vd/"+e.vid}},[r("q-item-section",[r("q-item-label",[t._v(t._s(e.vid))]),r("q-item-label",{attrs:{caption:""}},[r("small",[t._v("创建于")]),t._v(" "+t._s(e.c_at)+"\n          ")])],1),r("q-item-section",{attrs:{side:""}},[t._v("\n          "+t._s(e.created_by.displayName||e.created_by.nickname||"匿名")+"\n        ")])],1)}))],2)],1),t.workList&&0===t.workList.length?r("div",{staticClass:"empty-tip"},[t._v("暂无任何任务")]):t._e()],1)},Mn=[],In={name:"TaskList",data(){return{allCount:0,workList:null,hasNext:!1}},methods:{loadVideos(t={},e){this.query=t,sa(t,((r,a,n)=>{this.hasNext=!!a;let s=r;t.offset&&(s=this.workList.concat(r)),this.workList=s,this.allCount=n,e&&e()}))},onLoad(t,e){if(1===t||this.hasNext){const t=Object.assign(this.query||{},{offset:this.workList?this.workList.length:0});this.loadVideos(t,e)}}}},$n=In,Nn=Object(y["a"])($n,qn,Mn,!1,null,null,null),Fn=Nn.exports;Wt()(Nn,"components",{QInfiniteScroll:Oa["a"],QList:jt["a"],QItemLabel:we["a"],QItem:Dt["a"],QItemSection:Bt["a"],QSpinnerDots:qa["a"]}),Wt()(Nn,"directives",{Ripple:ke["a"]});var jn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"q-pa-md row wrap"},[t._l(t.workList,(function(e,a){return r("div",{key:a,staticClass:"col-2 text-center q-mb-md"},[r("q-img",{staticStyle:{height:"140px","max-width":"150px"},attrs:{src:e,"spinner-color":"orange"},on:{click:function(r){return t.removeImg(e)}},scopedSlots:t._u([{key:"error",fn:function(){return[r("div",{staticClass:"absolute-full flex flex-center bg-negative text-white"},[t._v("\n          失效图片\n        ")])]},proxy:!0}],null,!0)})],1)})),t.hasNext?r("div",{staticClass:"col-2 text-center q-mb-md"},[r("q-btn",{attrs:{color:"secondary"},on:{click:t.loadmore}},[t._v("加载更多")])],1):t._e()],2)},Dn=[],Bn={name:"ImageList",data(){return{workList:null,hasNext:!1}},mounted(){this.loadVideos({hasCd:!0})},methods:{loadmore(){const t=Object.assign(this.query||{},{offset:this.workList?this.workList.length:0});this.loadVideos(t)},loadVideos(t={},e){this.query=t,Jr(t,((r,a)=>{this.hasNext=!!a;let n=Object(cr["uniq"])(Object(cr["flatten"])(r.map((t=>{const e=JSON.parse(t.cd);return e.stage.filter((t=>t.bg)).map((t=>t.bg.url))}))));t.offset&&(n=this.workList.concat(n)),this.workList=n,e&&e()}))},removeImg(t){this.$q.dialog({title:"确认操作",message:"确定要删除吗？",cancel:!0,persistent:!0}).onOk((()=>{if(t.match("https://libiao.ubairn.com")){const e=t.replace("https://libiao.ubairn.com/","").replace("!/fw/1000","");console.log("remove from upyun",e),Yr(e)}}))}}},Un=Bn,Qn=(r("a435"),r("068f")),Wn=Object(y["a"])(Un,jn,Dn,!1,null,null,null),Vn=Wn.exports;Wt()(Wn,"components",{QImg:Qn["a"],QBtn:Mt["a"]});const Hn=[{path:"/",component:sr,children:[{path:"",name:"editor",component:Ra},{path:"mywork",name:"mywork",component:Ia},{path:"preview",name:"preview",component:Xa},{path:"/vd/:id",name:"video",component:rn},{path:"/vdc/:id",name:"videoconvert",component:Sn},{path:"/worklist",name:"worklist",component:On},{path:"/tasklist",name:"tasklist",component:Fn},{path:"/imgs",name:"imageList",component:Vn}]},{path:"*",component:()=>r.e(2).then(r.bind(null,"e51e"))}];var Gn=Hn;a["a"].use(kt["a"]);var zn=function(){const t=new kt["a"]({scrollBehavior(t,e,r){return t.hash?{selector:t.hash}:r||{x:0,y:0}},routes:Gn,mode:"hash",base:""});return t},Yn=async function(){const t="function"===typeof Lt?await Lt({Vue:a["a"]}):Lt,e="function"===typeof zn?await zn({Vue:a["a"],store:t}):zn;t.$router=e;const r={router:e,store:t,render:t=>t(b),el:"#q-app"};return{app:r,store:t,router:e}},Xn=r("ef55"),Zn=r.n(Xn),Kn=({app:t,router:e,store:r,Vue:a})=>{a.use(Zn.a),Qe.a.init("1e40ebdba903ddf4aa47",{logLevel:"debug"});const n="0.1.0";console.log("debug ",!1),console.log("最新部署版本: ",n),r.getters.buildVersion!==n&&r.commit("SET_BUILD_VERSION",n),document.body.addEventListener("touchmove",(t=>{t.preventDefault()})),Qe.a.auth.getCurrentUser().then((t=>{r.commit("SET_CURRENT_USER",t.toJSON())}))},Jn=r("a925"),ts={app:{cancelBtn:"Cancel",confirmBtn:"Confirm",requireLoginTip:"Please login your account",loading:"loading..."},account:{userLogin:"User Login",userRegister:"New User Register",email:"Email",pwd:"Password",nick:"Nickname",login:"Login",register:"Register"},editor:{recordStart:"Record",pause:"Pause",resume:"Resume",paused:"Paused",resumed:"Resumed",mywork:"My work",preference:"Preference",canvasPref:"Canvas",pencilPref:"Pencil",langPref:"Language",blackboardMode:"Blackboard Mode",blackboardModeSub:"fit all frames",pencilT:"Pencil Tolerance",pencilTSub:"smaller better",feedback:"Feedback",viewFrameList:"Frame List",deleteCurFrame:"Remove Current Frame",pausedRecordTip:"Record Paused",recordResume:"Resume Record",canvasHTip:"Current canvas height limited to ",frameNo:"Page {cur} of {len}",recordNotSupport:"Current device does not support audio recording",graph:"Graph",legend:"Legend"},ctrlBar:{line:"Line",arrowLine:"Arrow Line",circle:"Circle",rect:"Rect",pen:"Pencil",shape:"Shape",eraser:"Eraser",undoErase:"Undo Last Erase",penWidth:"Pencil Width",penColor:"Pick Color",uploadPdf:"Upload PDF",opacity:"Opacity Mode",penWidthVal:"Current {px} pixel"},mywork:{title:"My Work",changeAccount:"Change Account",login:"Login",uploadLocal:"Upload Local Course",created:"Created"},contact:{title:"Contact Me",guide:"User Guide"},preview:{title:"Preview",upload:"Upload & Publish",save:"Save To Local",pubBtn:"Publish",pubFail:"Publish failed!"},worklist:{title:"Work List"},tasklist:{title:"Task List"},video:{download:"Download this video to local"},upyundelete:{title:"又拍云文件删除"},imageList:{title:"图片审核列表"}},es={app:{cancelBtn:"取消",confirmBtn:"确定",requireLoginTip:"请先登录您的账号",loading:"加载中..."},account:{userLogin:"用户登录",userRegister:"新用户注册",email:"邮箱",pwd:"密码",nick:"昵称",login:"登录",register:"注册"},editor:{recordStart:"开始录制",pause:"暂停",resume:"继续",paused:"已暂停",resumed:"已继续",mywork:"我的微课",preference:"偏好设置",canvasPref:"画布配置",langPref:"语言设置",pencilPref:"笔迹配置",blackboardMode:"模拟黑板背景",blackboardModeSub:"影响所有页面背景色",pencilT:"笔迹灵敏度",pencilTSub:"越小越灵敏",feedback:"反馈",viewFrameList:"分页快速预览",deleteCurFrame:"删除当前页",pausedRecordTip:"已暂停录制",recordResume:"继续录制",canvasHTip:"当前画布录制高度限定为",frameNo:"第 {cur}/{len} 页",recordNotSupport:"当前设备不支持语音录制",graph:"图表",legend:"英雄志"},ctrlBar:{line:"直线",arrowLine:"箭头",circle:"圆形",rect:"矩形",pen:"画笔",shape:"作图",eraser:"橡皮擦",undoErase:"撤销擦除",penWidth:"画笔粗细",penColor:"画笔调色",uploadPdf:"上传课件",opacity:"荧光模式",penWidthVal:"当前 {px} 像素"},mywork:{title:"我的微课",changeAccount:"切换账号",login:"去登录",uploadLocal:"上传本地微课",created:"已创作"},contact:{title:"向作者反馈",guide:"用户指南"},preview:{title:"预览",upload:"上传并发布",save:"保存到本地",pubBtn:"发布",pubFail:"发布失败"},worklist:{title:"作品列表"},tasklist:{title:"任务列表"},video:{download:"下载此微课到本地"},upyundelete:{title:"又拍云文件删除"},imageList:{title:"图片审核列表"}},rs={en:ts,zh:es};a["a"].use(Jn["a"]);const as=new Jn["a"]({locale:"zh",fallbackLocale:"zh",messages:rs});var ns=({app:t})=>{t.i18n=as};a["a"].prototype.$axios=Pr.a;const ss="";async function is(){const{app:t,store:e,router:r}=await Yn();let n=!1;const s=t=>{n=!0;const e=Object(t)===t?r.resolve(t).route.fullPath:t;window.location.href=e},i=window.location.href.replace(window.location.origin,""),o=[Kn,ns,void 0];for(let l=0;!1===n&&l<o.length;l++)if("function"===typeof o[l])try{await o[l]({app:t,router:r,store:e,Vue:a["a"],ssrContext:null,redirect:s,urlPath:i,publicPath:ss})}catch(c){return c&&c.url?void(window.location.href=c.url):void console.error("[Quasar] boot error:",c)}!0!==n&&new a["a"](t)}is()},3:function(t,e){},"3cdd":function(t,e,r){"use strict";r("8be0")},4:function(t,e){},"41ed":function(t,e,r){},5:function(t,e){},7315:function(t,e,r){"use strict";r("a7ec")},"7e6d":function(t,e,r){},8008:function(t,e,r){"use strict";r("41ed")},"814e":function(t,e,r){},"8be0":function(t,e,r){},a435:function(t,e,r){"use strict";r("b7fae")},a7ec:function(t,e,r){},ad16:function(t,e,r){"use strict";(function(t){r("c19f"),r("ace4"),r("e6cf"),r("5cc6");var a=function(e){return function(r){var a=[],n=Promise.resolve(),s=null,i=null;function o(t){return new Promise((function(e,r){var a=new FileReader;a.addEventListener("loadend",(function(){e(a.result)})),a.readAsArrayBuffer(t)}))}function c(t){return new Promise((function(e,r){t instanceof Uint8Array?e(t):t instanceof ArrayBuffer||ArrayBuffer.isView(t)?e(new Uint8Array(t)):t instanceof Blob?e(o(t).then((function(t){return new Uint8Array(t)}))):e(o(new Blob([t])).then((function(t){return new Uint8Array(t)})))}))}function l(t){var e=t.byteLength||t.length||t.size;if(!Number.isInteger(e))throw"Failed to determine size of element";return e}"undefined"!==typeof FileWriter&&r instanceof FileWriter?s=r:e&&r&&(i=r),this.pos=0,this.length=0,this.seek=function(t){if(t<0)throw"Offset may not be negative";if(isNaN(t))throw"Offset may not be NaN";if(t>this.length)throw"Seeking beyond the end of file is not allowed";this.pos=t},this.write=function(r){var o={offset:this.pos,data:r,length:l(r)},u=o.offset>=this.length;this.pos+=o.length,this.length=Math.max(this.length,this.pos),n=n.then((function(){if(i)return new Promise((function(r,a){c(o.data).then((function(a){var n=0,s=t.from(a.buffer),c=function(t,a,s){n+=a,n>=s.length?r():e.write(i,s,n,s.length-n,o.offset+n,c)};e.write(i,s,0,s.length,o.offset,c)}))}));if(s)return new Promise((function(t,e){s.onwriteend=t,s.seek(o.offset),s.write(new Blob([o.data]))}));if(!u)for(var r=0;r<a.length;r++){var n=a[r];if(!(o.offset+o.length<=n.offset||o.offset>=n.offset+n.length)){if(o.offset<n.offset||o.offset+o.length>n.offset+n.length)throw new Error("Overwrite crosses blob boundaries");return o.offset==n.offset&&o.length==n.length?void(n.data=o.data):c(n.data).then((function(t){return n.data=t,c(o.data)})).then((function(t){o.data=t,n.data.set(o.data,o.offset-n.offset)}))}}a.push(o)}))},this.complete=function(t){return n=i||s?n.then((function(){return null})):n.then((function(){for(var e=[],r=0;r<a.length;r++)e.push(a[r].data);return new Blob(e,{mimeType:t})})),n}}};e["a"]=a(null)}).call(this,r("b639").Buffer)},b7fae:function(t,e,r){},e427:function(t,e,r){},ebf5:function(t,e,r){"use strict";r("e427")}});