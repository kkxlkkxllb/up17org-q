(function(t){function e(e){for(var n,o,s=e[0],c=e[1],l=e[2],u=0,d=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);f&&f(e);while(d.length)d.shift()();return i.push.apply(i,l||[]),r()}function r(){for(var t,e=0;e<i.length;e++){for(var r=i[e],n=!0,o=1;o<r.length;o++){var c=r[o];0!==a[c]&&(n=!1)}n&&(i.splice(e--,1),t=s(s.s=r[0]))}return t}var n={},a={1:0},i=[];function o(t){return s.p+"js/"+({}[t]||t)+"."+{2:"97da1bd5"}[t]+".js"}function s(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.e=function(t){var e=[],r=a[t];if(0!==r)if(r)e.push(r[2]);else{var n=new Promise((function(e,n){r=a[t]=[e,n]}));e.push(r[2]=n);var i,c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=o(t);var l=new Error;i=function(e){c.onerror=c.onload=null,clearTimeout(u);var r=a[t];if(0!==r){if(r){var n=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+i+")",l.name="ChunkLoadError",l.type=n,l.request=i,r[1](l)}a[t]=void 0}};var u=setTimeout((function(){i({type:"timeout",target:c})}),12e4);c.onerror=c.onload=i,document.head.appendChild(c)}return Promise.all(e)},s.m=t,s.c=n,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=e,c=c.slice();for(var u=0;u<c.length;u++)e(c[u]);var f=l;i.push([1,0]),r()})({0:function(t,e){},1:function(t,e,r){t.exports=r("2f39")},2:function(t,e){},2215:function(t,e,r){},"2f39":function(t,e,r){"use strict";r.r(e);r("e6cf"),r("5319"),r("7d6e"),r("e54f"),r("62f2"),r("7e6d");var n=r("2b0e"),a=r("bf69"),i=r("42d2"),o=r("b05d"),s=r("2a19"),c=r("1b3f"),l=r("b12a"),u=r("436b"),f=r("5dab");n["a"].use(o["a"],{config:{notify:{position:"top",timeout:5e3,textColor:"white",actions:[{icon:"close",color:"white"}]},loadingBar:{color:"secondary"}},lang:a["a"],iconSet:i["a"],plugins:{Notify:s["a"],LoadingBar:c["a"],AppFullscreen:l["a"],Dialog:u["a"],AppVisibility:f["a"]}});var d=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"q-app"}},[r("router-view")],1)},h=[],p={name:"App",computed:{},created(){this.$q.iconMapFn=t=>{if(!0===t.startsWith("if:")){const e=t.substring(3);return{cls:"iconfont "+e}}}},watch:{"$q.appVisible"(t){console.log(t?"App became visible":"App went in the background")}},mounted(){this.setDocumentVh(),window.addEventListener("resize",this.setDocumentVh)},methods:{setDocumentVh(){const t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`)}}},v=p,g=r("2877"),y=Object(g["a"])(v,d,h,!1,null,null,null),m=y.exports,b=r("2f62"),w=r("0e44");const C="CHANGE_CANVAS_COLOR",x="CHANGE_CANVAS_OPACITY",_="CHANGE_CANVAS_BG_COLOR",S="CHANGE_CANVAS_LINE_WIDTH",E="CHANGE_CANVAS_LAYER",T="CHANGE_CANVAS_VIEW_SIZE",L="CHANGE_CANVAS_SHAPE_TYPE",R="CHANGE_CURRENT_FRAME",P="SET_CANVAS_OBJS",k="ADD_CANVAS_OBJ",A="SET_AUDIO_TRACK",O="SET_STAGE_OBJS",$="SET_STAGE_BG_COLOR",I="SET_PLAYER_SIZE",M="SET_CURRENT_TS",q="SET_CURRENT_DUR",j="SET_RECORD_PAUSE",N="SET_CONVERT_PROGRESS",U="SET_REPLY_URL",B="INSERT_FRAME_BY_IMAGES",F="INSERT_FRAME_BY_IMAGE",D="REMOVE_FRAME_BY_NUM",W="SET_CURRENT_USER",H="SET_PREFERENCE",V="SET_BUILD_VERSION",z="SET_VIDEO_INFO",Q="UPDATE_VIDEO_INFO",G="SET_VIDEO_IMGS_IN_USED";r("c975"),r("ace4"),r("5cc6");function Y(t,e){let r,n,a;return r=(new Date).getTime()+t,n=null,a=function(){return r+=t,n=setTimeout(a,r-(new Date).getTime()),e()},n=setTimeout(a,r-(new Date).getTime()),{cancel:()=>clearTimeout(n)}}function X(t){return new Promise((function(e,r){var n=new FileReader;n.addEventListener("loadend",(function(){e(n.result)})),n.readAsArrayBuffer(t)}))}function K(t,e){const r=t.replace("#",""),n=parseInt(r.substring(0,2),16),a=parseInt(r.substring(2,4),16),i=parseInt(r.substring(4,6),16);return"rgba("+n+","+a+","+i+","+e/100+")"}function J(t){let e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);const r=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length);let a=0;while(a<e.length)n[a]=e.charCodeAt(a),a++;return new Blob([n],{type:r})}function Z(t,e){const r=document.createElement("a");r.setAttribute("download",t),r.setAttribute("href",e),r.click()}const tt={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,r,n,a,i,o,s,c="",l=0;t=this._utf8_encode(t);while(l<t.length)e=t.charCodeAt(l++),r=t.charCodeAt(l++),n=t.charCodeAt(l++),a=e>>2,i=(3&e)<<4|r>>4,o=(15&r)<<2|n>>6,s=63&n,isNaN(r)?o=s=64:isNaN(n)&&(s=64),c=c+this._keyStr.charAt(a)+this._keyStr.charAt(i)+this._keyStr.charAt(o)+this._keyStr.charAt(s);return c},decode:function(t){var e,r,n,a,i,o,s,c="",l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<t.length)a=this._keyStr.indexOf(t.charAt(l++)),i=this._keyStr.indexOf(t.charAt(l++)),o=this._keyStr.indexOf(t.charAt(l++)),s=this._keyStr.indexOf(t.charAt(l++)),e=a<<2|i>>4,r=(15&i)<<4|o>>2,n=(3&o)<<6|s,c+=String.fromCharCode(e),64!=o&&(c+=String.fromCharCode(r)),64!=s&&(c+=String.fromCharCode(n));return c=this._utf8_decode(c),c},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},_utf8_decode:function(t){var e,r,n,a="",i=0;e=r=0;while(i<t.length)e=t.charCodeAt(i),e<128?(a+=String.fromCharCode(e),i++):e>191&&e<224?(r=t.charCodeAt(i+1),a+=String.fromCharCode((31&e)<<6|63&r),i+=2):(r=t.charCodeAt(i+1),n=t.charCodeAt(i+2),a+=String.fromCharCode((15&e)<<12|(63&r)<<6|63&n),i+=3);return a}},et={color:"#1d1d1d",colorIndex:3,lineWidth:2,bgColor:"#fff",layerType:"C",shapeType:"L",isOpacity:!1,viewSize:[900,506],screenRate:[16,10]},rt={currentBgColor:t=>t.bgColor,isOpacity:t=>t.isOpacity,currentColor:t=>t.isOpacity?K(t.color,50):t.color,currentLineWidth:t=>t.lineWidth,currentLayerType:t=>t.layerType,colorIndex:t=>t.colorIndex,currentShapeType:t=>t.shapeType,viewSize:t=>{let e=window.screen.availWidth;const r=window.screen.availHeight;if(Math.min(e,r)<450){e>560&&(e=560);const n=e<r?t.screenRate[0]/t.screenRate[1]:t.screenRate[1]/t.screenRate[0],a=parseInt(n*e,10);return[e,a]}return t.viewSize}},nt={[_](t,e){t.bgColor=e},[C](t,{color:e,idx:r}){t.color=e,t.colorIndex=r+1},[S](t,e){t.lineWidth=e},[E](t,e){t.layerType=e},[L](t,e){t.shapeType=e},[x](t,e){t.isOpacity=e},[T](t,e){t.viewSize=e}};var at={state:et,getters:rt,mutations:nt};const it={canvasObjs:[],audioTrack:{url:null,blob:null},stages:[],stageBgColor:"#fff",playerSize:[],currentTs:0,currentDur:0,recordPaused:!1,convertProgress:"",replyUrl:null},ot={canvasObjs:t=>t.canvasObjs,duration:t=>{const e=t.canvasObjs.find((t=>"End"===t.ac));return e?e.ts:0},audioTrack:t=>t.audioTrack,stages:t=>t.stages,stageBgColor:t=>t.stageBgColor,playerSize:t=>t.playerSize,currentTs:t=>t.currentTs,currentDur:t=>t.currentDur,recordPaused:t=>t.recordPaused,convertProgress:t=>t.convertProgress,replyUrl:t=>t.replyUrl},st={[P](t,e){t.canvasObjs=e},[k](t,e){t.canvasObjs.push(e)},[A](t,e){t.audioTrack=e},[O](t,e){t.stages=e},[$](t,e){t.stageBgColor=e},[I](t,e){t.playerSize=e},[M](t,e){t.currentTs=e},[q](t,e){t.currentDur=e},[j](t,e){t.recordPaused=e},[N](t,e){t.convertProgress=e},[U](t,e){t.replyUrl=e}};var ct={state:it,getters:ot,mutations:st},lt=(r("a434"),r("8dee")),ut=r.n(lt);const ft={frameNo:1,frameList:[{id:ut.a.generate()}]},dt={currentFrame:t=>t.frameNo,frameList:t=>t.frameList,currentFid:t=>t.frameList[t.frameNo-1].id},ht={[R](t,e){e>0&&(t.frameNo=e),e>t.frameList.length&&t.frameList.push({id:ut.a.generate()})},[F](t,e){t.frameList.splice(t.frameNo,0,{id:ut.a.generate(),bg:e}),t.frameNo+=1},[B](t,e){const r=t.frameList.length;e.forEach((e=>{t.frameList.push({id:ut.a.generate(),bg:e})})),e.length>0&&(t.frameNo=r+1)},[D](t,e){t.frameList.splice(e-1,1)}};var pt={state:ft,getters:dt,mutations:ht};const vt={currentUser:null,buildVersion:null,preferences:{tolerance:4,lang:navigator.language.match(/zh/)?"zh":"en"}},gt={currentUser:t=>t.currentUser,preferences:t=>t.preferences},yt={[W](t,e){t.currentUser=e},[H](t,e){t.preferences=Object.assign({},t.preferences,e)},[V](t,e){t.buildVersion=e}};var mt={state:vt,getters:gt,mutations:yt};const bt={videoInfo:null,videoImgsInUsed:[]},wt={videoInfo:t=>t.videoInfo,videoImgsInUsed:t=>t.videoImgsInUsed},Ct={[z](t,e){t.videoInfo=e},[Q](t,e){t.videoInfo=Object.assign({},t.videoInfo,e)},[G](t,e){t.videoImgsInUsed=e}};var xt={state:bt,getters:wt,mutations:Ct};n["a"].use(b["a"]);const _t=Object(w["a"])({paths:["user"]});var St=function(){const t=new b["a"].Store({plugins:[_t],modules:{canvas:at,record:ct,frame:pt,user:mt,video:xt},strict:!1});return t},Et=r("8c4f"),Tt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-layout",{attrs:{view:"hHh Lpr lFf"}},[r("q-header",["editor"===t.currentRoute?r("editor-header"):"video"===t.currentRoute?r("player-header"):"exporter"===t.currentRoute?r("export-header"):"videoconvert"===t.currentRoute?r("convert-header"):r("common-header")],1),r("q-page-container",[r("router-view")],1),r("q-dialog",{model:{value:t.openDrawPref,callback:function(e){t.openDrawPref=e},expression:"openDrawPref"}},[r("draw-preference")],1),r("q-dialog",{model:{value:t.openColorPicker,callback:function(e){t.openColorPicker=e},expression:"openColorPicker"}},[r("color-picker")],1),r("q-dialog",{model:{value:t.openLineWidth,callback:function(e){t.openLineWidth=e},expression:"openLineWidth"}},[r("line-width")],1),r("q-dialog",{model:{value:t.openZan,callback:function(e){t.openZan=e},expression:"openZan"}},[r("zan")],1)],1)},Lt=[];const Rt=new n["a"];var Pt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-toolbar",[r("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"if:iconzhong","aria-label":"Home",to:"/"}}),r("q-btn",{staticClass:"frame-nav-disp",attrs:{flat:"",dense:"",ripple:!1}},[t._v(t._s(t.frameNavDisplay))]),r("q-btn",{attrs:{dense:"",flat:"",icon:"delete_forever"},on:{click:t.triggerRemoveFrame}},[r("q-tooltip",[t._v(t._s(t.$t("editor.deleteCurFrame")))])],1),r("q-space"),r("q-btn",{staticClass:"record-btn",class:{recording:t.currentTs},attrs:{flat:"",icon:"fiber_manual_record",label:t.currentTs?t.currentTsDisplay:t.$t("editor.recordStart")},on:{click:t.startRecord}}),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.currentTs,expression:"currentTs"}],attrs:{dense:"",flat:"",icon:t.recordPaused?"play_arrow":"pause"},on:{click:t.pauseRecord}}),r("q-btn",{attrs:{dense:"",round:"",flat:""}},[r("q-icon",{attrs:{name:"if:icondot"}}),r("q-menu",[r("q-list",{staticStyle:{"min-width":"100px"}},[r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.triggerShowPref}},[r("q-item-section",[t._v(t._s(t.$t("editor.preference")))])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.$q.fullscreen.toggle()}}},[r("q-item-section",[t._v(t._s(t.$q.fullscreen.isActive?t.$t("editor.exitFullscreen"):t.$t("editor.fullscreen")))])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.triggerShowZan}},[r("q-item-section",[t._v(t._s(t.$t("editor.zan")))])],1)],1)],1)],1)],1)},kt=[],At=r("bd4c");const{formatDate:Ot}=At["a"];var $t={name:"EditorHeader",components:{},data(){return{}},computed:{currentTs(){return this.$store.getters.currentTs},currentDur(){return this.$store.getters.currentDur},recordPaused(){return this.$store.getters.recordPaused},currentTsDisplay(){return Ot(this.currentDur,"mm:ss")},currentFrame(){return this.$store.getters.currentFrame},frameList(){return this.$store.getters.frameList},frameNavDisplay(){return this.$t("editor.frameNo",{cur:this.currentFrame,len:this.frameList.length})}},methods:{triggerShowPref(){Rt.$emit("open:drawPref")},triggerShowZan(){Rt.$emit("open:zan")},startRecord(){Rt.$emit("toggle:startRecord")},pauseRecord(){Rt.$emit("toggle:pauseRecord")},triggerRemoveFrame(){Rt.$emit("remove:frame")}}},It=$t,Mt=r("65c6"),qt=r("9c40"),jt=r("05c0"),Nt=r("2c91"),Ut=r("0016"),Bt=r("4e73"),Ft=r("1c1c"),Dt=r("66e5"),Wt=r("4074"),Ht=r("7f67"),Vt=r("eebe"),zt=r.n(Vt),Qt=Object(g["a"])(It,Pt,kt,!1,null,null,null),Gt=Qt.exports;zt()(Qt,"components",{QToolbar:Mt["a"],QBtn:qt["a"],QTooltip:jt["a"],QSpace:Nt["a"],QIcon:Ut["a"],QMenu:Bt["a"],QList:Ft["a"],QItem:Dt["a"],QItemSection:Wt["a"]}),zt()(Qt,"directives",{ClosePopup:Ht["a"]});var Yt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-toolbar",[r("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"arrow_back",to:"/"}}),r("q-toolbar-title",[t._v("\n    "+t._s(t.title)+"\n  ")]),r("q-space"),r("q-btn",{attrs:{flat:"",primary:""},on:{click:t.startExport}},[t._v("\n    "+t._s(t.$t("preview.export"))+"\n  ")])],1)},Xt=[],Kt={name:"CommonHeader",data(){return{}},computed:{currentUser(){return this.$store.getters.currentUser},title(){return this.$t(`${this.$route.name}.title`)}},methods:{startExport(){Rt.$emit("start:export")}}},Jt=Kt,Zt=r("6ac5"),te=Object(g["a"])(Jt,Yt,Xt,!1,null,null,null),ee=te.exports;zt()(te,"components",{QToolbar:Mt["a"],QBtn:qt["a"],QToolbarTitle:Zt["a"],QSpace:Nt["a"]});var re=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-toolbar",[r("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"if:iconzhong"}}),t.info?r("q-toolbar-title",[t._v("\n    "+t._s(t.info.t)+"\n  ")]):t._e(),r("q-space"),t.info?r("q-btn",{attrs:{flat:"",round:"",icon:"more_vert"}},[r("q-menu",[r("q-list",{staticStyle:{"min-width":"100px"}},[r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.requestFullscreen}},[r("q-item-section",[t._v("\n            全屏播放\n          ")])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",to:"/"}},[r("q-item-section",[t._v("\n            去创作\n          ")])],1)],1)],1)],1):t._e()],1)},ne=[],ae={name:"PlayerHeader",data(){return{}},computed:{currentUser(){return this.$store.getters.currentUser},info(){return this.$store.getters.videoInfo},isAuthor(){return this.currentUser&&this.currentUser.id===this.info.created_by.id},canConvert(){if(this.info){const t=this.info.cd.canvas.filter((t=>"TX"===t.ac));return 0===t.length}return!1}},methods:{requestFullscreen(t){Rt.$emit("video:fullscreen")},removeVideo(){Rt.$emit("video:remove")},localExport(){Rt.$emit("video:export")}}},ie=ae,oe=Object(g["a"])(ie,re,ne,!1,null,null,null),se=oe.exports;zt()(oe,"components",{QToolbar:Mt["a"],QBtn:qt["a"],QToolbarTitle:Zt["a"],QSpace:Nt["a"],QMenu:Bt["a"],QList:Ft["a"],QItem:Dt["a"],QItemSection:Wt["a"]}),zt()(oe,"directives",{ClosePopup:Ht["a"]});var ce=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-toolbar",[r("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"arrow_back",to:"/"}}),t.info?r("q-toolbar-title",[t._v("\n    "+t._s(t.info.t)+"\n  ")]):t._e(),r("q-space"),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.progress,expression:"progress"}],attrs:{flat:""}},[t._v("\n    "+t._s(t.progress)+"\n  ")]),r("q-btn",{attrs:{flat:""},on:{click:function(e){return t.triggerEvent("scaleHalf")}}},[t._v("\n    缩略\n  ")]),r("q-btn",{attrs:{flat:""},on:{click:function(e){return t.triggerEvent("fitHeight")}}},[t._v("\n    高度优先\n  ")]),r("q-btn",{attrs:{flat:""},on:{click:function(e){return t.triggerEvent("crop")}}},[t._v("\n    裁剪留白\n  ")]),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.replyUrl,expression:"replyUrl"}],attrs:{flat:"",icon:"save_alt",label:"保存到本地"},on:{click:function(e){return t.triggerEvent("download")}}})],1)},le=[],ue={name:"PlayerHeader",data(){return{}},computed:{info(){return this.$store.getters.videoInfo},progress(){return this.$store.getters.convertProgress},replyUrl(){return this.$store.getters.replyUrl}},methods:{triggerEvent(t){Rt.$emit("vdc:"+t)}}},fe=ue,de=Object(g["a"])(fe,ce,le,!1,null,null,null),he=de.exports;zt()(de,"components",{QToolbar:Mt["a"],QBtn:qt["a"],QToolbarTitle:Zt["a"],QSpace:Nt["a"]});var pe=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-toolbar",[r("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",dense:"",icon:"arrow_back",to:"/"}}),t.info?r("q-toolbar-title",[t._v("\n    "+t._s(t.info.t)+"\n  ")]):t._e(),r("q-space"),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:!t.replyUrl,expression:"!replyUrl"}],attrs:{flat:"",icon:"cloud_upload",label:"上传云端稍后导出"},on:{click:function(e){return t.triggerEvent("upload")}}}),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.progress,expression:"progress"}],attrs:{flat:""}},[t._v("\n    "+t._s(t.progress)+"\n  ")]),r("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.replyUrl,expression:"replyUrl"}],attrs:{flat:"",icon:"save_alt",label:"保存到本地"},on:{click:function(e){return t.triggerEvent("download")}}})],1)},ve=[],ge={name:"PlayerHeader",data(){return{}},computed:{info(){return this.$store.getters.videoInfo},progress(){return this.$store.getters.convertProgress},replyUrl(){return this.$store.getters.replyUrl}},methods:{triggerEvent(t){Rt.$emit("vdc:"+t)}}},ye=ge,me=Object(g["a"])(ye,pe,ve,!1,null,null,null),be=me.exports;zt()(me,"components",{QToolbar:Mt["a"],QBtn:qt["a"],QToolbarTitle:Zt["a"],QSpace:Nt["a"]});var we=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-card",{staticClass:"dialog-width-sm"},[r("q-card-section",{staticClass:"row items-center q-pb-none"},[r("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("editor.preference")))]),r("q-space"),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),r("q-card-section",[r("q-list",{attrs:{separator:""}},[r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[r("q-item-section",[r("q-item-label",[t._v(t._s(t.$t("editor.blackboardMode"))+" "),r("small",{staticClass:"second"},[t._v(t._s(t.$t("editor.blackboardModeSub")))])])],1),r("q-item-section",{attrs:{side:""}},[r("q-toggle",{attrs:{color:"blue",val:!1},model:{value:t.blackboard,callback:function(e){t.blackboard=e},expression:"blackboard"}})],1)],1),r("q-item",{attrs:{tag:"label"}},[r("q-item-section",{attrs:{side:""}},[t._v("\n          "+t._s(t.$t("editor.pencilT"))+" "+t._s(t.tolerance)+" "),r("small",{staticClass:"second"},[t._v(t._s(t.$t("editor.pencilTSub")))])]),r("q-item-section",[r("q-slider",{attrs:{max:8,step:1,min:1,label:"",color:"teal"},model:{value:t.tolerance,callback:function(e){t.tolerance=e},expression:"tolerance"}})],1)],1),r("q-item",[r("q-item-section",[r("q-item-label",[t._v(t._s(t.$t("editor.langPref")))])],1),r("q-item-section",{attrs:{side:""}},[r("q-select",{attrs:{filled:"",options:t.langList,"option-value":"value","option-label":"label",dense:!0,"options-dense":!0},model:{value:t.lang,callback:function(e){t.lang=e},expression:"lang"}})],1)],1)],1)],1)],1)},Ce=[],xe={name:"DrawPreference",components:{},data(){return{langList:[{label:"中文",value:"zh"},{label:"English",value:"en"}]}},computed:{currentBgColor(){return this.$store.getters.currentBgColor},blackboard:{get(){return"#fff"!==this.currentBgColor},set(t){this.$store.commit("CHANGE_CANVAS_BG_COLOR",t?"#2C3E50":"#fff")}},tolerance:{get(){return this.$store.getters.preferences.tolerance},set(t){this.$store.commit("SET_PREFERENCE",{tolerance:t})}},lang:{get(){return this.$store.getters.preferences.lang},set(t){this.$store.commit("SET_PREFERENCE",{lang:t.value})}}}},_e=xe,Se=r("f09f"),Ee=r("a370"),Te=r("0170"),Le=r("9564"),Re=r("c1d0"),Pe=r("ddd8"),ke=r("714f"),Ae=Object(g["a"])(_e,we,Ce,!1,null,null,null),Oe=Ae.exports;zt()(Ae,"components",{QCard:Se["a"],QCardSection:Ee["a"],QSpace:Nt["a"],QBtn:qt["a"],QList:Ft["a"],QItem:Dt["a"],QItemSection:Wt["a"],QItemLabel:Te["a"],QToggle:Le["a"],QSlider:Re["a"],QSelect:Pe["a"]}),zt()(Ae,"directives",{ClosePopup:Ht["a"],Ripple:ke["a"]});var $e=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-card",{staticClass:"dialog-width-sm"},[r("q-card-section",{staticClass:"row items-center q-pb-none"},[r("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("ctrlBar.penColor")))]),r("q-space"),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),r("q-card-section",[r("q-color",{staticClass:"my-picker",attrs:{"default-view":"palette",palette:t.colorList,"no-footer":"",flat:""},model:{value:t.color,callback:function(e){t.color=e},expression:"color"}})],1),r("q-card-section",[r("q-list",{attrs:{separator:""}},[r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[r("q-item-section",[r("q-item-label",[t._v(t._s(t.$t("ctrlBar.opacity")))])],1),r("q-item-section",{attrs:{side:""}},[r("q-toggle",{attrs:{color:"blue",val:!1},model:{value:t.isOpacity,callback:function(e){t.isOpacity=e},expression:"isOpacity"}})],1)],1)],1)],1)],1)},Ie=[],Me={name:"ColorPicker",components:{},data(){return{colorList:["#e74000","#0088ff","#1d1d1d","#ffff00","#ff9e9d","#5cb85c","#5e405f","#f5f5f5"]}},computed:{color:{get(){return this.$store.getters.currentColor},set(t){console.log(t);const e=this.colorList.indexOf(t);this.$store.commit("CHANGE_CANVAS_COLOR",{color:t,idx:e})}},isOpacity:{get(){return this.$store.getters.isOpacity},set(t){this.$store.commit("CHANGE_CANVAS_OPACITY",t)}}}},qe=Me,je=r("b498"),Ne=Object(g["a"])(qe,$e,Ie,!1,null,null,null),Ue=Ne.exports;zt()(Ne,"components",{QCard:Se["a"],QCardSection:Ee["a"],QSpace:Nt["a"],QBtn:qt["a"],QColor:je["a"],QList:Ft["a"],QItem:Dt["a"],QItemSection:Wt["a"],QItemLabel:Te["a"],QToggle:Le["a"]}),zt()(Ne,"directives",{ClosePopup:Ht["a"],Ripple:ke["a"]});var Be=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-card",{staticClass:"dialog-width-sm"},[r("q-card-section",{staticClass:"row items-center q-pb-none"},[r("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("ctrlBar.penWidth")))]),r("q-space"),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),r("q-card-section",[r("div",{staticClass:"line-wrap"},[r("div",{staticClass:"sample-line",style:t.lineWidthStyle})]),r("q-slider",{attrs:{max:20,step:1,min:1},model:{value:t.lineWidth,callback:function(e){t.lineWidth=e},expression:"lineWidth"}})],1)],1)},Fe=[],De={name:"LineWidth",components:{},data(){return{}},computed:{color(){return this.$store.getters.currentColor},lineWidthStyle(){return"height:"+this.lineWidth+"px;background-color:"+this.color+";"},lineWidth:{get(){return this.$store.getters.currentLineWidth},set(t){this.$store.commit("CHANGE_CANVAS_LINE_WIDTH",t)}}}},We=De,He=Object(g["a"])(We,Be,Fe,!1,null,null,null),Ve=He.exports;zt()(He,"components",{QCard:Se["a"],QCardSection:Ee["a"],QSpace:Nt["a"],QBtn:qt["a"],QSlider:Re["a"]}),zt()(He,"directives",{ClosePopup:Ht["a"]});var ze=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-card",{staticClass:"dialog-width-md"},[r("q-card-section",{staticClass:"row items-center q-pb-none"},[r("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("editor.zan")))]),r("q-space"),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),r("q-card-section",[t._v("\n    本产品采取完全免费的运营模式，无广告，专注于微课制作和视频导出\n    "),r("br"),t._v("\n    如果本产品有打动你的地方，扫码赞赏我一下吧！\n    "),r("br"),t._v("\n    欢迎关注公众号交流反馈各种问题~\n    "),r("div",{staticClass:"flex-layout"},[r("q-img",{attrs:{src:t.zanUrl}}),r("q-img",{attrs:{src:t.gzhUrl}})],1)])],1)},Qe=[],Ge={name:"Zan",components:{},data(){return{gzhUrl:"https://libiao.ubairn.com/img/xcx/newWechatG.jpg",zanUrl:"https://libiao.ubairn.com/img/xcx/zanbill.png"}},mounted(){}},Ye=Ge,Xe=r("068f"),Ke=Object(g["a"])(Ye,ze,Qe,!1,null,null,null),Je=Ke.exports;zt()(Ke,"components",{QCard:Se["a"],QCardSection:Ee["a"],QSpace:Nt["a"],QBtn:qt["a"],QImg:Xe["a"]}),zt()(Ke,"directives",{ClosePopup:Ht["a"]});var Ze={name:"MainLayout",components:{DrawPreference:Oe,EditorHeader:Gt,CommonHeader:ee,PlayerHeader:se,ConvertHeader:he,ExportHeader:be,ColorPicker:Ue,LineWidth:Ve,Zan:Je},data(){return{openDrawPref:!1,openColorPicker:!1,openLineWidth:!1,openZan:!1}},computed:{currentRoute(){return this.$route.name}},created(){Rt.$on("open:drawPref",(()=>{this.openDrawPref=!0})),Rt.$on("open:zan",(()=>{this.openZan=!0})),Rt.$on("open:colorPicker",(()=>{this.openColorPicker=!0})),Rt.$on("open:lineWidth",(()=>{this.openLineWidth=!0})),Rt.$on("load:start",(t=>{this.dialog?this.dialog.update({message:t}):this.dialog=this.$q.dialog({message:t,progress:!0,persistent:!0,ok:!1})})),Rt.$on("load:end",(()=>{this.dialog&&(this.dialog.hide(),this.dialog=null)}))}},tr=Ze,er=r("4d5a"),rr=r("e359"),nr=r("09e3"),ar=r("24e8"),ir=Object(g["a"])(tr,Tt,Lt,!1,null,null,null),or=ir.exports;zt()(ir,"components",{QLayout:er["a"],QHeader:rr["a"],QPageContainer:nr["a"],QDialog:ar["a"]});var sr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-page",{staticClass:"bg-grey-3 e-container"},[r("div",{staticClass:"frame-ctrl nav-prev",on:{click:function(){return t.handleNavFrame(-1)}}},[r("q-icon",{attrs:{name:"chevron_left",size:"md"}})],1),r("div",{staticClass:"frame-ctrl nav-next",on:{click:function(){return t.handleNavFrame(1)}}},[r("q-icon",{attrs:{name:t.currentFrame<t.frameList.length?"chevron_right":"plus_one",size:"md"}})],1),r("div",{ref:"canvasWrap",staticClass:"canvas-container",style:t.maxCanvasH,on:{scroll:t.handleScroll}},[r("canvas-layer",{ref:"canvas",attrs:{width:t.viewSize[0],wrapHeight:t.viewSize[1]},on:{capture:t.handleCapture}})],1),r("div",{staticClass:"divider"},[t._v(t._s(t.$t("editor.canvasHTip"))+t._s(t.viewSize[1])+"px")]),r("control-bar",{on:{convertPdf:t.handleConvertPdf,compressImage:t.handleCompressImage,undo:t.handleUndoEarse}})],1)},cr=[],lr=(r("ddb0"),r("2b3d"),r("2ef0")),ur=r.n(lr),fr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"layerContainer",staticClass:"canvas-layer-wrap",style:t.layerContainerHeight},[t.isPlayer?t._e():r("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"pdfLayer",style:t.pdfLayerStyle,attrs:{width:t.pdfCanvasW,height:t.pdfCanvasH}}),r("div",{staticClass:"canvas-layer",style:t.layerStyle+t.bgColor},[t.needCapture?r("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"captureLayer",style:t.captureLayerStyle,attrs:{width:t.canvasW,height:t.captureH}}):t._e(),r("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fakeLayer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"stageLayer",staticClass:"stage-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"displayLayer",staticClass:"display-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),t.isPlayer?r("canvas",{ref:"syncLayer",staticClass:"sync-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}):t._e(),t.isPlayer?t._e():r("canvas",{ref:"editLayer",staticClass:"edit-layer",style:t.layerStyle+t.cursorStyle,attrs:{width:t.canvasW,height:t.canvasH},on:{mousedown:t.handleMousedown,touchstart:t.handleMousedown,mousemove:t.handleMousemove,touchmove:t.handleMousemove,mouseup:t.handleMouseup,touchend:t.handleMouseup,mouseout:t.handleMouseout}}),t.isPlayer?r("div",{directives:[{name:"show",rawName:"v-show",value:t.showCursor,expression:"showCursor"}],staticClass:"sync-cursor",style:t.syncCursorPos}):t._e()])])},dr=[],hr=(r("fb6a"),r("4d29")),pr=r.n(hr);function vr(t){return Math.max.apply(Math,t)}function gr(t){return Math.min.apply(Math,t)}function yr(t){const e=t.map((t=>t[0])),r=t.map((t=>t[1]));return[gr(e),gr(r),vr(e)-gr(e),vr(r)-gr(r)]}function mr(t,e){return 1!==e?t*e+.5<<0:t}function br(t,e,r=1){const n=Math.round(e[0]*r-t.lineWidth/2-.5),a=Math.round(e[1]*r-t.lineWidth/2-.5),i=Math.round(e[2]*r+t.lineWidth+.5),o=Math.round(e[3]*r+t.lineWidth+.5);t.clearRect(n,a,i,o)}function wr(t,e,r=1){br(t,yr(e),r),e=[]}function Cr(t,e,r,n=!0){if(n&&t.clearCurve(),1===e.length){const n=e[0];return t.beginPath(),t.arc(mr(n[0],r),mr(n[1],r),t.lineWidth/2,0,2*Math.PI,!0),t.closePath(),void t.fill()}t.beginPath();const a=mr(e[0][0],r),i=mr(e[0][1],r);if(t.moveTo(a,i),2===e.length)return t.lineTo(mr(e[1][0],r),mr(e[1][1],r)),void t.stroke();let o=1;while(o<e.length-2){const n=mr((e[o][0]+e[o+1][0])/2,r),a=mr((e[o][1]+e[o+1][1])/2,r),i=mr(e[o][0],r),s=mr(e[o][1],r);t.quadraticCurveTo(i,s,n,a),o++}const s=mr(e[o][0],r),c=mr(e[o][1],r),l=mr(e[o+1][0],r),u=mr(e[o+1][1],r);t.quadraticCurveTo(s,c,l,u),t.stroke()}function xr(t,e,r,n,a=1){return{x:Math.min(t,r)/a,y:Math.min(e,n)/a,w:Math.abs(r-t)/a,h:Math.abs(n-e)/a}}function _r(t,e,r,n=1){t.beginPath(),t.arc(e*n,r*n,4,2*Math.PI,!1),t.closePath(),t.lineWidth=1,t.stroke()}function Sr(t,e,r=1){e.forEach((e=>{switch(e.ty){case"C":const n=e.po[0],a=e.po[e.po.length-1];_r(t,n[0],n[1],r),_r(t,a[0],a[1],r);break;case"MC":t.save(),t.setLineDash([5]),Cr(t,e.po,r,!1),t.restore();break;case"S":switch(e.sty){case"L":case"AL":_r(t,e.data[0],e.data[1],r),_r(t,e.data[2],e.data[3],r);break;case"C":kr(t,e.data,r);break;case"R":Pr(t,e.data,r);break}}}))}function Er(t,e){let r,n,a,i,o,s;return!(!t||!e)&&(o=(t,e)=>!(t[1]<e[0]||t[0]>e[1]),r=[t.x,t.x+t.w],t.w<0&&(r=[r[1],r[0]]),n=[e.x,e.x+e.w],a=[t.y,t.y+t.h],t.h<0&&(a=[a[1],a[0]]),i=[e.y,e.y+e.h],s=o(r,n)&&o(a,i),s)}function Tr(t,e,r={}){const n=[],a=e.x+e.w,i=e.y+e.h;return t.forEach((t=>{switch(t.ty){case"C":case"MC":if(r.unclude_curve)break;for(let r of t.po)if(r[0]>=e.x&&r[0]<=a&&r[1]>=e.y&&r[1]<=i){n.push(t);break}break;case"S":if(r.only_curve)break;const o=xr(...t.data);switch(t.sty){case"R":case"C":Er(e,o)&&n.push(t);break;case"L":case"AL":const r=[t.data[0],t.data[1]],s=[t.data[2],t.data[3]],c=o.w,l=o.h,u=[o.x,o.y],f=[o.x+o.w,o.y+o.h],d=c/7;let h=1;const p=[r,s];while(u[0]+d*h<f[0]){const t=u[0]+d*h,e=l/c*d*h;let n;n=(s[1]-r[1])*(s[0]-r[0])>0?e+u[1]:f[1]-e,p.push([t,n]),h+=1}for(let o of p)if(o[0]>=e.x&&o[0]<=a&&o[1]>=e.y&&o[1]<=i){n.push(t);break}break}}})),n}function Lr(t,e,r=1,n){t.save(),t.lineWidth=2,t.strokeStyle=n,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(e[0]*r,e[1]*r),t.lineTo(e[2]*r,e[3]*r),t.stroke(),t.restore()}function Rr(t,e,r=1,n){const a=10;t.save(),t.lineWidth=2,n&&(t.strokeStyle=n),t.lineCap="round",t.lineJoin="round";const i=e[2],o=e[3],s=Math.atan2(e[3]-e[1],e[2]-e[0]);t.beginPath(),t.moveTo(e[0]*r,e[1]*r),t.lineTo(e[2]*r,e[3]*r),t.moveTo(i,o),t.lineTo(i-a*Math.cos(s-Math.PI/6),o-a*Math.sin(s-Math.PI/6)),t.moveTo(i,o),t.lineTo(i-a*Math.cos(s+Math.PI/6),o-a*Math.sin(s+Math.PI/6)),t.stroke(),t.restore()}function Pr(t,e,r=1,n){t.save(),t.lineWidth=2,n&&(t.strokeStyle=n);const a=xr(...e,r);t.strokeRect(a.x,a.y,a.w,a.h),t.restore()}function kr(t,e,r=1,n){const a=xr(...e,r),i=a.x+a.w/2,o=a.y+a.h/2;t.save(),t.lineWidth=2,n&&(t.strokeStyle=n),t.beginPath(),t.ellipse(i,o,a.w/2,a.h/2,0,2*Math.PI,!1),t.stroke(),t.restore()}var Ar=r("bc3a"),Or=r.n(Ar),$r=r("69a0"),Ir=r.n($r);const Mr="libiao.ubairn.com",qr="https://libiao.ubairn.com",jr="/file2/zip/",Nr=[{name:"咖啡色",value:"#655643"},{name:"粉色",value:"#FF9E9D"},{name:"橙色",value:"#ec8749"},{name:"蓝色",value:"#0088ff"},{name:"红色",value:"#e74000"},{name:"绿色",value:"#5cb85c"},{name:"白色",value:"#ffffff"},{name:"黑色",value:"#1d1d1d"}],Ur="/ftriDMtpThOrkDlXwhbIZCE46Y=",Br="up17org",{formatDate:Fr}=At["a"];let Dr;function Wr(t){return t.match(Mr)||t.match("http")?t:qr+t}const Hr=(t,e={})=>{const r=Math.round((new Date).getTime()/1e3)+3600,n=e.thumb||"image"===t&&"/quality/75/format/webp/compress/true/progressive/true";let a=ut.a.generate();if(n){const t=n.match(/crop\/(\d+x\d+a+\d+a+\d+)/);t&&t.length>1&&(a+=t[1])}let i="/file2/"+t+"/"+Fr(Date.now(),"YYYY_MM_DD")+"/"+a;"zip"===t&&(a=Fr(Date.now(),"YYYY_MM_DD_")+a,i="/file2/"+t+"/"+a);const o={bucket:Br,expiration:r,"save-key":i};if(n&&(o["x-gmkerl-thumb"]=n),e.apps){const t=i+"."+e.apps.f;o["apps"]=[{name:"naga",type:"audio",save_as:t,avopts:"/f/"+e.apps.f}]}const s=tt.encode(JSON.stringify(o));e.done({signature:Ir.a.hash(s+"&"+Ur),policy:s,bucket:Br,"save-key":i,expiration:r})};function Vr(t,e,r,n=!1){!Dr||n?Hr(t,{done:n=>{Dr=n,Vr(t,e,r)}}):e?(Object.keys(Dr).forEach((t=>{e.append(t,Dr[t])})),r(e)):r(Dr)}function zr(t,e){Or.a.request({method:"POST",url:"https://v0.api.upyun.com/up17org",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((t=>{const r=t.data;200===r.code&&e(r)}))}function Qr(t,e=!1){return new Promise(((r,n)=>{Vr("image",new FormData,(n=>{n.append("file",e?J(t):t),zr(n,(t=>{r({url:t.url,h:t["image-height"]/2,w:t["image-width"]/2,size:t.file_size})}))}),!0)}))}function Gr(t){return new Promise(((e,r)=>{Hr("zip",{done:r=>{const n=new FormData;n.append("file",t),n.append("content-type","application/zip"),Object.keys(r).forEach((t=>{n.append(t,r[t])})),zr(n,(t=>{e(t.url)}))}})}))}function Yr(t){return"string"===typeof t&&0===t.indexOf("#")||String(t).indexOf("rgba")>-1?t:Nr[t].value}var Xr={name:"CanvasLayer",props:{wrapHeight:{default:506,type:Number,require:!0},isPlayer:{default:!1,type:Boolean},width:{default:900,type:Number},playerBgColor:{default:"#fff",type:String},needCapture:{default:!1,type:Boolean},scale:{default:1,type:Number},stageMode:{default:"start",type:String}},data(){return{height:this.wrapHeight,curX:0,curY:0,curOp:1,curColor:"#333333",scaleRate:this.scale,straX:!1,straY:!1,pdfHeight:this.wrapHeight,showCursor:!1}},mounted(){this.imageDict={},this.canvasObjs=[],this.earseHistoryObjs=[],this._points=[],this.ctxScaleRatio(),this.isPlayer?this.setupSyncLayer():(this.setupEditLayer(),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup))},beforeDestroy(){this.isPlayer||(document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup))},computed:{layerContainerHeight(){return this.isPlayer?"height:"+this.wrapHeight*this.scaleRate+"px;":""},layerStyle(){return"width:"+this.width*this.scaleRate+"px;height:"+this.height*this.scaleRate+"px;"},pdfLayerStyle(){return"width:"+this.width+"px;height:"+this.pdfHeight+"px;"},captureLayerStyle(){return"width:"+this.width+"px;height:"+this.wrapHeight+"px;"},captureH(){return this.wrapHeight*window.devicePixelRatio*this.scaleRate},pdfCanvasH(){return 2*this.pdfHeight},pdfCanvasW(){return 2*this.width},bgColor(){return this.isPlayer?"background-color:"+this.playerBgColor:"background-color:"+this.$store.getters.currentBgColor},canvasW(){return this.width*window.devicePixelRatio*this.scaleRate},canvasH(){return this.height*window.devicePixelRatio*this.scaleRate},color(){return this.$store.getters.currentColor},cursorStyle(){const t="url('imgs/circle_"+this.$store.getters.colorIndex+".svg')";switch(this.layerType){case"E":case"S":return"cursor: crosshair;";default:return window.devicePixelRatio>1?"cursor: -webkit-image-set("+t+" 2x) 6 6, auto;":"cursor: "+t+" 6 6, auto;"}},tolerance(){return this.$store.getters.preferences.tolerance},lineWidth(){return this.$store.getters.currentLineWidth},layerType(){return this.$store.getters.currentLayerType},shapeType(){return this.$store.getters.currentShapeType},syncCursorPos(){return"transform: translateX("+this.curX*this.scaleRate+"px) translateY("+this.curY*this.scaleRate+"px) scale("+this.scaleRate+","+this.scaleRate+"); opacity:"+this.curOp+"; background-color:"+this.curColor+";width: 12px;height: 12px;border-radius: 12px;margin-top: -6px;margin-left: -6px;"}},watch:{layerType:function(t,e){this.setupEditLayer()},scaleRate:function(t,e){this.$nextTick((()=>{this.ctxScaleRatio()}))}},methods:{ctxScaleRatio(){["displayLayer","stageLayer","editLayer","fakeLayer","syncLayer"].forEach((t=>{const e=this.$refs[t];e&&e.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)}))},setupEditLayer(){const t=this.getLayerCtx("editLayer");switch(this.layerType){case"C":break;case"E":t.strokeStyle="#ff8619",t.fillStyle="rgba(255, 255, 255,0.4)",t.lineCap="round",t.lineJoin="round",t.lineWidth=1;break;case"S":break}},setupSyncLayer(){},scrollLayerContainer(t){this.$refs.layerContainer&&(this.$refs.layerContainer.scrollTop=t*this.scaleRate)},preloadStage(t,e){return new Promise(((r,n)=>{if(this.imageDict[e])r(this.imageDict[e]);else{let n=new window.Image;n.crossOrigin="Anonymous",n.onload=()=>{this.imageDict[e]=n,n=null,r(this.imageDict[e])},n.src=Wr(t.url)}}))},async preloadStages(t){for(const e of t)e.bg&&await this.preloadStage(e.bg,e.id)},updateHeight(t){return t<this.wrapHeight&&(t=this.wrapHeight),new Promise(((e,r)=>{t!==this.height?(this.height=t,this.$nextTick((()=>{this.ctxScaleRatio(),e()}))):(this.clearCtx("stageLayer"),e())}))},async setStageLayer(t,e,r){t.url&&(this.$q.loadingBar.start(),await this.preloadStage(t,e).then((e=>{let n=t.w,a=t.h;n>this.width&&(a=this.width*a/n,n=this.width);const i=this.getLayerCtx("stageLayer");i.save(),r&&(i.globalAlpha=r);let o=0;a<this.wrapHeight&&"center"===this.stageMode&&(o=(this.wrapHeight-a)/2),i.drawImage(e,0,o,n*this.scaleRate,a*this.scaleRate),i.restore(),this.$q.loadingBar.stop()})))},getPointBy(t){if(t.touches){const{pageX:e,pageY:r,target:{offsetParent:{offsetLeft:n,offsetTop:a}}}=t.changedTouches[0];return[parseInt(e-n,10),parseInt(r-a-50,10)]}return[parseInt(t.layerX,10),parseInt(t.layerY,10)]},handleMousedown(t){const e=[this._px,this._py]=this.getPointBy(t);switch(this._dragging=!0,this.layerType){case"C":this._points.length=0,this._points.push(e);break;case"E":break;case"S":break}},handleMouseout(){this._dragging&&(this._dragging=!1,this.handleMouseup())},handleMousemove(t){const e=this.getPointBy(t),r=this.getLayerCtx("editLayer"),{x:n,y:a,w:i,h:o}=xr(e[0],e[1],this._px,this._py,this.scaleRate);switch(this.layerType){case"C":{if(!this._dragging)return void this.$emit("capture",{ac:"CM",data:[e[0]/this.scaleRate,e[1]/this.scaleRate]});if(this.straX&&(this.stra_y?e[1]=this.stra_y:this.stra_y=e[1]),this.straY&&(this.stra_x?e[0]=this.stra_x:this.stra_x=e[0]),this._px===e[0]&&this._py===e[1])return;this._px=e[0],this._py=e[1],this._points.push(e),this._points=pr.a.radialDistance(this._points,this.tolerance);const t={co:this.color,wi:this.lineWidth,ty:this.layerType,po:this._points.slice()};this.$emit("capture",{ac:"CSync",data:t}),this.renderCurve(t,"editLayer",!0);break}case"E":{if(!this._dragging)return;this.clearCtx("editLayer"),r.fillRect(n,a,i,o),r.save(),r.setLineDash([5]),r.strokeRect(n,a,i,o),r.restore();const t=Tr(this.canvasObjs,{x:n,y:a,w:i,h:o});Sr(r,t,this.scaleRate);break}case"S":{if(!this._dragging)return;this._prev_shape_rect&&br(r,this._prev_shape_rect,this.scaleRate),this._prev_shape_rect=[n-10,a-10,i+20,o+20];const t={ty:"S",co:this.color,sty:this.shapeType,data:[this._px/this.scaleRate,this._py/this.scaleRate,e[0]/this.scaleRate,e[1]/this.scaleRate]};this.renderShape(t,"editLayer");break}}},handleMouseup(t){this._dragging=!1,this.stra_y=null,this.stra_x=null;const e=this.getPointBy(t),r=xr(e[0],e[1],this._px,this._py,this.scaleRate);switch(this.layerType){case"C":if(this._points.length>0){const t={po:this._points.slice(),co:this.color,wi:this.lineWidth,ty:this.layerType};this.clearCtx("editLayer",this._points),this.$emit("capture",{ac:"CEnd",data:t}),this.renderCurve(t),this._points.length=0}break;case"E":{this.clearCtx("editLayer");const t=Tr(this.canvasObjs,r),e=t.map((t=>t.id));if(!e.length)return void console.log("no earse");this.removeCanvasObjs(e),this.earseHistoryObjs.push(t),this.$emit("capture",{ac:"E",data:e}),this.reRenderCanvasData();break}case"S":{const t={ty:"S",co:this.color,sty:this.shapeType,data:[this._px/this.scaleRate,this._py/this.scaleRate,e[0]/this.scaleRate,e[1]/this.scaleRate]};this._prev_shape_rect&&(br(this.getLayerCtx("editLayer"),this._prev_shape_rect,this.scaleRate),this._prev_shape_rect=null),this.renderShape(t),this.$emit("capture",{ac:"SEnd",data:t});break}}},redrawEarseHistory(){const t=this.earseHistoryObjs.pop();if(t){this.batchRenderObjs(t);for(const e of t)this.addCanvasObj(e);this.$emit("capture",{ac:"UE",data:t})}},resetLayer(){this.canvasObjs=[],this.clearCtx("displayLayer"),this.clearCtx("editLayer"),this.clearCtx("stageLayer"),this.clearCtx("syncLayer")},reRenderCanvasData(t){t&&(this.canvasObjs=t),this.canvasObjs.length?this.batchRenderObjs(this.canvasObjs,!0):this.clearCtx("displayLayer")},cursorMove(t){if(this.showCursor)for(const e of Object.keys(t))this.$data[e]=t[e]},removeCanvasObjs(t){return this.canvasObjs=this.canvasObjs.filter((e=>t.indexOf(e.id)<0)),this.canvasObjs},renderOneObj(t,e){return new Promise(((r,n)=>{switch(t.ty){case"C":this.renderCurve(t,e),r();break;case"S":this.renderShape(t,e),r();break;default:this.renderCurve(t,e),r();break}}))},async batchRenderObjs(t,e=!1){this.clearCtx("fakeLayer");for(const r of t)await this.renderOneObj(r,"fakeLayer");e&&this.clearCtx("displayLayer"),this.getLayerCtx("displayLayer").drawImage(this.$refs.fakeLayer,0,0,this.width*this.scaleRate,this.height*this.scaleRate)},renderCurve(t,e="displayLayer",r=!1){const n=this.getLayerCtx(e);if(n.strokeStyle=n.fillStyle=Yr(t.co),n.lineWidth=t.wi*this.scaleRate,n.lineCap=n.lineJoin="round",r){const r=n._points;n.clearCurve=r?()=>this.clearCtx(e,r):()=>{},n._points=t.po}else"displayLayer"===e&&this.addCanvasObj(t);Cr(n,t.po,this.scaleRate,r)},renderShape(t,e="displayLayer"){const r=this.getLayerCtx(e);switch(t.sty){case"L":Lr(r,t.data,this.scaleRate,t.co);break;case"AL":Rr(r,t.data,this.scaleRate,t.co);break;case"R":Pr(r,t.data,this.scaleRate,t.co);break;case"C":kr(r,t.data,this.scaleRate,t.co);break}"displayLayer"===e&&this.addCanvasObj(t)},getLayerCtx(t){return this.$refs[t].getContext("2d")},addCanvasObj(t){t.id=t.id||ut.a.generate(),this.canvasObjs.push(t)},clearCtx(t="editLayer",e){if(!this.$refs[t])return;const r=this.getLayerCtx(t);e?wr(r,e,this.scaleRate):r.clearRect(0,0,this.canvasW,this.canvasH)},setScaleRateBy(t={}){if(t.origin)this.scaleRate=1;else{const e=t.width||window.screen.width;let r=e/this.width;t.height&&this.wrapHeight*r>t.height&&(r=t.height/this.wrapHeight),this.scaleRate=Math.floor(1e3*r)/1e3}},handleKeydown(t){16===t.keyCode&&(this.straX=!0,this.$toast.success("横直线模式生效")),18===t.keyCode&&(this.straY=!0,this.$toast.success("竖直线模式生效"))},handleKeyup(t){16===t.keyCode&&(this.straX=!1,this.$toast.warning("横直线模式失效")),18===t.keyCode&&(this.straY=!1,this.$toast.warning("竖直线模式失效"))},toggleCursor(t){this.showCursor=t},convertPDF2PNG(t,e){return new Promise(((r,n)=>{t.getPage(e).then((t=>{this.clearCtx("pdfLayer");const e=t.getViewport({scale:1}),n=2*this.width/e.width,a=t.getViewport({scale:n}),i=parseInt(a.height,10);this.pdfHeight=i/2,this.$nextTick((async()=>{await t.render({canvasContext:this.getLayerCtx("pdfLayer"),viewport:a}).promise,r(this.$refs.pdfLayer.toDataURL("image/webp",.8))}))}))}))},putImageAsBg(t){return new Promise(((e,r)=>{const n=new Image,a=this.getLayerCtx("pdfLayer");n.onload=()=>{let r=n.width,i=n.height;r>2*this.width?(i=2*this.width*i/r,r=2*this.width,this.pdfHeight=i/2,this.$nextTick((()=>{a.drawImage(n,0,0,r,i),e(this.$refs.pdfLayer.toDataURL("image/webp",.8))}))):e(t)},n.src=t}))},drawPointer(t){t.beginPath();const e=this.$refs.layerContainer.scrollTop*window.devicePixelRatio,r=this.curX*window.devicePixelRatio,n=this.curY*window.devicePixelRatio-e;r>0&&n>0&&(t.arc(r,n,12,0,2*Math.PI,!1),t.fillStyle=K(this.curColor,100*this.curOp),t.fill())},captureCurrentImage(){const t=this.getLayerCtx("captureLayer"),e=["stageLayer","displayLayer","syncLayer"],r=this.$refs.layerContainer.scrollTop*window.devicePixelRatio;e.forEach((e=>{"stageLayer"===e&&(t.fillStyle=this.playerBgColor,t.fillRect(0,0,this.canvasW,this.captureH)),t.drawImage(this.$refs[e],0,r,this.canvasW,this.captureH,0,0,this.canvasW,this.captureH)})),this.drawPointer(t),t.font="24px 楷体",t.fillStyle="rgba(255,255,255,0.7)",t.shadowColor="rgba(0,0,0,0.2)",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=2;const n="手绘微课",a=this.canvasW-t.measureText(n).width-10,i=this.captureH-20;return t.fillText(n,a,i),t.restore(),this.$refs.captureLayer},renderAvatar(t,e,r){const n=[80,80];return new Promise(((a,i)=>{const o=new window.Image;o.onload=()=>{t.drawImage(o,this.width*this.scaleRate/2-n[0]/2,r,n[0],n[1]),a(r+n[1]+25)},o.onerror=()=>{a(r+n[1]+25)},o.src=e}))},async genVideoCover(t={}){const e=this.getLayerCtx("fakeLayer");e.fillStyle="#fff";const r=this.width*this.scaleRate,n=this.height*this.scaleRate;e.fillRect(0,0,r,n);let a=80;e.textBaseline="middle",e.font="22px Roboto",e.fillStyle="#666";const i=t.title,o=e.measureText(i).width;if(o<r){const t=r/2-o/2;e.fillText(i,t,a)}e.font="16px Roboto",e.fillStyle="#999";const s="由手绘微课录制",c=r/2-e.measureText(s).width/2;if(e.fillText(s,c,n-60),a+=40,t.avatar&&a+130<n-60&&(a=await this.renderAvatar(e,t.avatar,a)),t.author){e.font="18px Roboto",e.fillStyle="#333";const n=r/2-e.measureText(t.author).width/2;e.fillText(t.author,n,a)}t.done(this.$refs.fakeLayer)}}},Kr=Xr,Jr=(r("ed4e"),Object(g["a"])(Kr,fr,dr,!1,null,"45f9c7d0",null)),Zr=Jr.exports,tn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"controlBar"}},[t.shapeCtrlTrigger?r("q-popup-proxy",{attrs:{target:t.shapeCtrlTrigger}},[r("q-card",[r("q-tabs",{attrs:{shrink:"","active-color":"primary","indicator-color":"transparent",dense:""},model:{value:t.shapeType,callback:function(e){t.shapeType=e},expression:"shapeType"}},[r("q-tab",{attrs:{name:"L",label:t.$t("ctrlBar.line"),icon:"short_text"}}),r("q-tab",{attrs:{name:"AL",label:t.$t("ctrlBar.arrowLine"),icon:"trending_flat"}}),r("q-tab",{attrs:{name:"C",label:t.$t("ctrlBar.circle"),icon:"panorama_fish_eye"}}),r("q-tab",{attrs:{name:"R",label:t.$t("ctrlBar.rect"),icon:"crop_landscape"}})],1)],1)],1):t._e(),r("q-toolbar",{staticClass:"bg-white"},[r("q-tabs",{attrs:{shrink:"","active-color":"primary","indicator-color":"transparent",dense:""},model:{value:t.canvasLayer,callback:function(e){t.canvasLayer=e},expression:"canvasLayer"}},[r("q-tab",{attrs:{name:"C",label:t.$t("ctrlBar.pen"),icon:"edit"}}),r("q-tab",{ref:"shapeBtn",attrs:{name:"S",icon:t.currentShapeIcon,label:t.$t("ctrlBar.shape")}}),r("q-tab",{attrs:{name:"E",label:t.$t("ctrlBar.eraser"),icon:"crop_free"}})],1),r("q-space"),t.$q.screen.lt.md?t._e():r("q-btn",{staticClass:"q-mr-md",attrs:{icon:"undo",round:"",flat:""},on:{click:function(){return t.$emit("undo")}}},[r("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n        "+t._s(t.$t("ctrlBar.undoErase"))+"\n      ")])],1),t.$q.screen.lt.md?t._e():r("q-btn",{staticClass:"q-mr-md",attrs:{icon:"line_weight",round:"",flat:""},on:{click:t.openLineWidth}},[r("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n        "+t._s(t.$t("ctrlBar.penWidth"))+"\n      ")])],1),t.$q.screen.lt.md?t._e():r("q-btn",{staticClass:"q-mr-md",style:t.colorPickerStyle,attrs:{icon:"color_lens",round:"",flat:""},on:{click:t.openColorPicker}},[r("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n        "+t._s(t.$t("ctrlBar.penColor"))+"\n      ")])],1),r("uploader",{attrs:{autoStart:!1,options:t.uploadOptions},on:{"file-added":t.onFileAdded}},[r("uploader-btn",{attrs:{attrs:t.uploadAttrs}},[r("q-btn",{attrs:{icon:"picture_as_pdf",round:"",flat:""}},[r("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n            "+t._s(t.$t("ctrlBar.uploadPdf"))+"\n          ")])],1)],1),t.$q.screen.lt.md?r("q-btn",{attrs:{icon:"more_vert",round:"",flat:""}},[r("q-menu",[r("q-list",{staticStyle:{"min-width":"100px"}},[r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(){return t.$emit("undo")}}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{attrs:{name:"undo"}})],1),r("q-item-section",[t._v("\n                "+t._s(t.$t("ctrlBar.undoErase"))+"\n              ")])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.openLineWidth}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{attrs:{name:"line_weight"}})],1),r("q-item-section",[t._v("\n                "+t._s(t.$t("ctrlBar.penWidth"))+"\n              ")])],1),r("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.openColorPicker}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{attrs:{name:"color_lens"}})],1),r("q-item-section",[t._v("\n                "+t._s(t.$t("ctrlBar.penColor"))+"\n              ")])],1)],1)],1)],1):t._e()],1)],1)],1)},en=[];const rn=r("f9cb");rn.GlobalWorkerOptions.workerSrc=qr+"/js/pdf2.worker.min.js";var nn={name:"ControlBar",props:{},data(){return{openMoreMenu:!1,uploadOptions:{testChunks:!1,singleFile:!1},uploadAttrs:{accept:"image/*,application/pdf",multiple:!0},limitPageNum:20,shapeCtrlTrigger:null}},created(){},mounted(){this.shapeCtrlTrigger=this.$refs.shapeBtn.$el},computed:{colorPickerStyle(){return"color:"+this.$store.getters.currentColor},canvasLayer:{get(){return this.$store.getters.currentLayerType},set(t){this.$store.commit("CHANGE_CANVAS_LAYER",t)}},layerType(){return this.$store.getters.currentLayerType},shapeType:{get(){return this.$store.getters.currentShapeType},set(t){this.$store.commit("CHANGE_CANVAS_SHAPE_TYPE",t)}},currentShapeIcon(){switch(this.$store.getters.currentShapeType){case"L":return"short_text";case"AL":return"trending_flat";case"C":return"panorama_fish_eye";case"R":return"crop_landscape";default:return""}}},methods:{openColorPicker(){Rt.$emit("open:colorPicker")},openLineWidth(){Rt.$emit("open:lineWidth")},onFileAdded(t){const e=t.fileType.match(/image/);Rt.$emit("load:start",e?"正在插入背景图片":"正在解析文件");const r=new FileReader;e?(r.readAsDataURL(t.file),r.onload=t=>{this.$emit("compressImage",t.target.result)}):(r.readAsArrayBuffer(t.file),r.onload=async t=>{const e=await rn.getDocument({data:t.target.result,cMapUrl:"/js/cmaps/",cMapPacked:!0}).promise,r=e.numPages;r>this.limitPageNum?this.$q.dialog({title:"提示",message:"已超过文档上传页数限制: "+this.limitPageNum+"/"+r+", 继续操作，超出部分将不会被导入",cancel:!0,persistent:!0}).onOk((()=>{this.$emit("convertPdf",{pdf:e,missionNum:this.limitPageNum})})):this.$emit("convertPdf",{pdf:e,missionNum:r})})}}},an=nn,on=(r("d048"),r("7cbe")),sn=r("429b"),cn=r("7460"),ln=Object(g["a"])(an,tn,en,!1,null,"ddcdbf7e",null),un=ln.exports;zt()(ln,"components",{QPopupProxy:on["a"],QCard:Se["a"],QTabs:sn["a"],QTab:cn["a"],QToolbar:Mt["a"],QSpace:Nt["a"],QBtn:qt["a"],QTooltip:jt["a"],QMenu:Bt["a"],QList:Ft["a"],QItem:Dt["a"],QItemSection:Wt["a"],QIcon:Ut["a"]}),zt()(ln,"directives",{ClosePopup:Ht["a"]});var fn=r("c093"),dn=r.n(fn),hn=r("755b");const pn=100;var vn={name:"Editor",data(){return{framesData:{}}},components:{CanvasLayer:Zr,ControlBar:un},beforeDestroy(){this.auRecorder=null,Rt.$off("toggle:startRecord",this.startRecord),Rt.$off("toggle:pauseRecord",this.pauseRecord),Rt.$off("remove:frame",this.removeCurFrame)},created(){Rt.$on("toggle:startRecord",this.startRecord),Rt.$on("toggle:pauseRecord",this.pauseRecord),Rt.$on("remove:frame",this.removeCurFrame),this.$store.commit("SET_CANVAS_OBJS",[]),this.auRecorder=new dn.a({encoderPath:hn["a"]}),this.auRecorder.onstart=this.handleRecordStarted,this.auRecorder.onpause=()=>{this.recordPaused=!0,this.clock.cancel(),this.$q.notify({type:"positive",message:this.$t("editor.paused")})},this.auRecorder.onresume=()=>{this.recordPaused=!1,this.currentAc=null,this.setupRecordClock(),this.$q.notify({type:"positive",message:this.$t("editor.resumed")})},this.auRecorder.onstop=()=>{this.addAcRecord("End"),this.clock.cancel(),this.currentTs=0,this.currentDur=0,this.$store.commit("SET_CANVAS_OBJS",this.records);const t=ur.a.uniq(this.records.filter((t=>"F"===t.ac)).map((t=>"object"===typeof t.data?t.data.id:t.data))).map((t=>this.frameList.find((e=>e.id===t))));this.$store.commit("SET_STAGE_OBJS",t),this.$store.commit("SET_STAGE_BG_COLOR",this.currentBgColor),this.$store.commit("SET_PLAYER_SIZE",this.viewSize),this.$router.push({path:"preview"})},this.auRecorder.ondataavailable=t=>{const e=new Blob([t],{type:"audio/ogg"}),r=URL.createObjectURL(e);this.$store.commit("SET_AUDIO_TRACK",{url:r,blob:e})}},mounted(){dn.a.isRecordingSupported()||this.$q.notify({type:"negative",message:this.$t("editor.recordNotSupport")});const t=this.frameList[this.currentFrame-1];t.bg&&this.$refs.canvas.updateHeight(t.bg.h).then((()=>{this.$refs.canvas.setStageLayer(t.bg,t.id)})),this.currentAc=null},computed:{currentColor(){return this.$store.getters.currentColor},currentBgColor(){return this.$store.getters.currentBgColor},currentFrame(){return this.$store.getters.currentFrame},frameList(){return this.$store.getters.frameList},currentFid(){return this.$store.getters.currentFid},viewSize(){return this.$store.getters.viewSize},maxCanvasH(){return"max-height:"+this.viewSize[1]+"px;"},lang(){return this.$store.getters.preferences.lang},currentTs:{get(){return this.$store.getters.currentTs},set(t){this.$store.commit("SET_CURRENT_TS",t)}},currentDur:{get(){return this.$store.getters.currentDur},set(t){this.$store.commit("SET_CURRENT_DUR",t)}},recordPaused:{get(){return this.$store.getters.recordPaused},set(t){this.$store.commit("SET_RECORD_PAUSE",t)}}},watch:{currentColor:function(t,e){this.addAcRecord("CC",t)},currentFrame:function(t,e){const r=this.frameList[e-1];r&&(this.framesData[r.id]=this.$refs.canvas.canvasObjs),this.loadFrameContent(t),this.skipCapture=!0,this.$refs.canvasWrap.scrollTop=0},lang:function(t){this._i18n.locale=t}},methods:{handleRecordStarted(){this.records=[],this.currentTs=1,this.$q.notify({type:"positive",message:this.$t("editor.recordStart")});const t=this.$refs.canvasWrap.scrollTop;this.addAcRecord("F",{id:this.currentFid,top:t}),this.addAcRecord("CC",this.currentColor),this.setupRecordClock()},startRecord(){this.currentTs?this.auRecorder.stop():this.auRecorder.start()},pauseRecord(){this.recordPaused?this.auRecorder.resume():this.auRecorder.pause()},setupRecordClock(){this.clock=Y(pn,(()=>{this.currentTs+=pn,this.currentTs%1e3===1&&(this.currentDur=this.currentTs),this.currentAc&&(this.records.push(this.currentAc),this.currentAc=null)}))},handleCapture(t){if(this.currentTs){if(this.currentAc&&this.currentAc.ac!==t.ac&&"CEnd"===this.currentAc.ac)return;this.currentAc=Object.assign({},t,{ts:this.currentTs})}},addAcRecord(t,e={}){this.currentTs&&this.records.push({ac:t,ts:this.currentTs,data:e})},handleUndoEarse(){this.$refs.canvas.redrawEarseHistory()},handleNavFrame(t){const e=this.currentFrame+t;this.$store.commit("CHANGE_CURRENT_FRAME",e)},handleNavToFrame(t){this.$store.commit("CHANGE_CURRENT_FRAME",t+1)},removeCurFrame(){this.$q.dialog({title:"确认操作",message:"确定要删除当前第 "+this.currentFrame+" 页吗？",cancel:!0,persistent:!0}).onOk((()=>{if(this.$store.commit("REMOVE_FRAME_BY_NUM",this.currentFrame),this.currentFrame>this.frameList.length){const t=0===this.frameList.length?1:this.currentFrame-1;this.$store.commit("CHANGE_CURRENT_FRAME",t)}else this.loadFrameContent(this.currentFrame)}))},loadFrameContent(t){const e=this.frameList[t-1].id,r=this.frameList[t-1].bg;this.$refs.canvas.updateHeight(r?r.h:this.viewSize[1]).then((()=>{this.$refs.canvas.reRenderCanvasData(this.framesData[e]||[]),r&&this.$refs.canvas.setStageLayer(r,e)})),this.addAcRecord("F",this.currentFid)},handleScroll(t){this.skipCapture?this.skipCapture=!1:this.handleCapture({ac:"SL",data:t.target.scrollTop})},async handleConvertPdf(t){let e=1;const r=[];while(e<=t.missionNum)Rt.$emit("load:start","正在导入第 "+e+" 页/共 "+t.missionNum+" 页"),await new Promise(((n,a)=>{this.$refs.canvas.convertPDF2PNG(t.pdf,e).then((t=>{Qr(t,!0).then((t=>{r.push(t),n()}))}))})),e++;this.$store.commit("INSERT_FRAME_BY_IMAGES",r),Rt.$emit("load:end")},handleCompressImage(t){this.$refs.canvas.putImageAsBg(t).then((t=>{Qr(t,!0).then((t=>{this.$store.commit("INSERT_FRAME_BY_IMAGE",t),Rt.$emit("load:end")}))}))}}},gn=vn,yn=(r("7265"),r("9989")),mn=Object(g["a"])(gn,sr,cr,!1,null,"32f71c29",null),bn=mn.exports;zt()(mn,"components",{QPage:yn["a"],QIcon:Ut["a"]});var wn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"preview-container"},[r("player",{attrs:{audioUrl:t.audioTrack.url,canvasObjs:t.canvasObjs,stages:t.stages,autoPlay:!0,bgColor:t.stageBgColor,size:t.playerSize,duration:t.duration}})],1)},Cn=[],xn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"player-wrap"},[r("div",{staticClass:"canvas-container"},[r("canvas-layer",{ref:"canvas",attrs:{isPlayer:!0,playerBgColor:t.bgColor,width:t.size[0],wrapHeight:t.size[1]}}),r("div",{staticClass:"coverage",on:{click:t.handlePlay}},[t.currentTs?t._e():[r("q-btn",{staticClass:"video-ctrl-cover",attrs:{color:"primary",round:"",icon:"play_arrow"}}),r("div",{staticClass:"video-dur"},[t._v(t._s(t.hDur))])]],2)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:t.currentTs,expression:"currentTs"}],staticClass:"ctrl-bar"},[r("q-btn",{staticClass:"q-mr-sm",attrs:{size:"sm",round:"",flat:"",icon:t.currentTs&&!t.isPaused?"pause":"play_arrow"},on:{click:t.handlePlay}}),t.canSeek?r("q-slider",{attrs:{dense:"",step:1,color:"white"},on:{change:t.onChangeProgress},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}}):t._e(),r("span",{staticClass:"time"},[t._v(t._s(t.currentTsDisplay))])],1)])},_n=[],Sn=(r("26e9"),r("1e5c"));const En=100,{formatDate:Tn}=At["a"];var Ln={name:"Player",components:{CanvasLayer:Zr},props:{audioUrl:{type:String,require:!0},canvasObjs:{type:Array,require:!0},duration:{type:Number,require:!0},autoPlay:{type:Boolean,default:!1},stages:{type:Array},bgColor:{type:String},canSeek:{type:Boolean,default:!0},size:{type:Array,default(){return[900,506]}}},data(){return{currentTs:0,currentDur:0,progress:0,isPaused:!1,framesData:{}}},computed:{currentTsDisplay(){return Tn(this.currentDur,"mm:ss")},hDur(){return Tn(this.duration,"mm:ss")}},mounted(){this.canvasLayer=this.$refs.canvas,this.autoPlay&&this.canvasObjs.length&&this.preloadResource(this.startPlay)},beforeDestroy(){this.currentTs&&this.stopPlay(),this.currentAudio&&this.currentAudio.unload()},methods:{startPlay(){this.setupPlayerClock(),this.currentAudio.play(),this.$emit("played"),this.canvasLayer.toggleCursor(!0)},pausePlay(){this.clock&&this.clock.cancel(),this.currentAudio.pause(),this.isPaused=!0,this.$q.notify({message:"已暂停",type:"positive",timeout:3e3})},async resumePlay(){if(this.seekToTs&&this.seekToTs!==this.currentTs){const t=this.frameByTs(this.seekToTs);this.currentTs=this.seekToTs;const{cd:e,framesData:r,curFid:n,top:a,color:i}=this.parseRealPathByRange(0,this.currentTs);this.framesData=r,this.curFid=n,this.frameChange(t.data.id,a),this.canvasLayer.cursorMove({curColor:i}),this.canvasLayer.reRenderCanvasData(e),await this.seekAudio(this.currentTs),this.seekToTs=0}this.setupPlayerClock(),this.isPaused&&this.currentAudio.play(),this.isPaused=!1},stopPlay(){this.clock&&this.clock.cancel(),this.currentAudio&&this.currentAudio.stop(),this.currentTs=0,this.isPaused=!1,this.canvasLayer.toggleCursor(!1),this.canvasLayer.resetLayer(),this.framesData={},this.curFid=null,this.canvasLayer.scrollLayerContainer(0)},handlePlay(){this.currentTs?this.isPaused?this.resumePlay():this.pausePlay():this.preloadResource(this.startPlay)},doEachTask(t){return new Promise(((e,r)=>{this.canvasObjs.filter((e=>t-En<=e.ts&&e.ts<t)).forEach(this.playEachRecord),t%1e3===0&&(this.currentDur=t),this.progress=t/this.duration*100,e()}))},setupPlayerClock(){this.clock=Y(En,(()=>{this.currentTs+=En,this.doEachTask(this.currentTs)}))},playEachRecord(t){switch(t.ac){case"CSync":case"Cy":{this.canvasLayer.renderCurve(t.data,"syncLayer",!0);const e=t.data.po[t.data.po.length-1];this.canvasLayer.cursorMove({curX:e[0],curY:e[1],curOp:.5});break}case"CEnd":case"CE":this.canvasLayer.clearCtx("syncLayer"),this.canvasLayer.renderCurve(t.data);break;case"E":this.canvasLayer.removeCanvasObjs(t.data),this.canvasLayer.reRenderCanvasData();break;case"CM":this.canvasLayer.cursorMove({curX:t.data[0],curY:t.data[1],curOp:1});break;case"F":case"Frame":{this.preFid=this.curFid;let e=0;"object"===typeof t.data?(this.curFid=t.data.id,e=t.data.top):this.curFid=t.data,this.preFid&&(this.framesData[this.preFid]=this.canvasLayer.canvasObjs),this.frameChange(this.curFid,e);break}case"SL":this.canvasLayer.scrollLayerContainer(t.data);break;case"SEnd":this.canvasLayer.renderShape(t.data);break;case"End":this.progress=100,this.stopPlay();break;case"CC":this.canvasLayer.cursorMove({curColor:t.data});break;case"UE":this.canvasLayer.batchRenderObjs(t.data);for(const e of t.data)this.canvasLayer.addCanvasObj(e);break}},preloadResource(t){this.canvasLayer.preloadStages(this.stages),this.loadAudio(t)},groupRecordsByFrameRate(){let t=0;const e=[];while(t<this.duration)t+=En,e.push(this.canvasObjs.filter((e=>t-En<=e.ts&&e.ts<t)));return e},loadAudio(t){if(this.currentAudio)return void t();const e=this.audioUrl.match("http")?this.audioUrl:qr+this.audioUrl;this.currentAudio=new Sn["Howl"]({src:[e,e+".MP3"],html5:!0,format:["ogg","mp3"],onload:t,onloaderror:()=>{this.$q.notify({message:"音频加载失败",type:"negative",timeout:1e4})}})},onChangeProgress(t){this.canSeek&&(this.seekToTs=Math.round(t*this.duration/100),this.currentDur=this.seekToTs)},seekAudio(t){return new Promise(((e,r)=>{this.currentAudio?(this.currentAudio.once("seek",e),this.currentAudio.seek(t/1e3)):e()}))},fitScreenWidth(){this.$refs.canvas.setScaleRateBy()},fitToOriginWidth(){this.$refs.canvas.setScaleRateBy({origin:!0})},frameByTs(t,e={}){const r=this.canvasObjs.filter((t=>"F"===t.ac)).reverse();for(const n in r)if(r[n].ts-t<=0)return e.to?r[n-e.to]:r[n]},frameChange(t,e){const r=this.stages.find((e=>e.id===t));if(r){const t=r.bg;this.canvasLayer.updateHeight(t?t.h:this.size[1]).then((()=>{this.canvasLayer.reRenderCanvasData(this.framesData[r.id]||[]),t&&this.canvasLayer.setStageLayer(t,r.id),this.canvasLayer.scrollLayerContainer(e)}))}},parseRealPathByRange(t,e){let r,n,a,i,o;const s=["F","CEnd","E","SEnd","CC","UE","SL"];let c=[];const l=this.canvasObjs.filter((r=>s.indexOf(r.ac)>-1&&t<=r.ts&&r.ts<=e));0===t&&(a={},r=n=null);for(const u of l)switch(u.ac){case"CEnd":case"SEnd":c.push(u.data);break;case"SL":i=u.data;break;case"CC":o=u.data;break;case"E":c=c.filter((t=>u.data.indexOf(t.id)<0));break;case"UE":Array.isArray(u.data)&&c.concat(u.data);break;case"F":0===t?(r=n,n=u.data,r&&(a[r]=c.slice(0)),c=a[n]||[]):c=[];break}return 0===t?{cd:c,framesData:a,curFid:n,top:i,color:o}:{cd:c,top:i}}}},Rn=Ln,Pn=(r("3cdd"),Object(g["a"])(Rn,xn,_n,!1,null,"df5aa4a2",null)),kn=Pn.exports;zt()(Pn,"components",{QBtn:qt["a"],QSlider:Re["a"]});var An={name:"Preview",components:{Player:kn},data(){return{}},computed:{audioTrack(){return this.$store.getters.audioTrack},canvasObjs(){return this.$store.getters.canvasObjs},duration(){return this.$store.getters.duration},stages(){return this.$store.getters.stages},stageBgColor(){return this.$store.getters.stageBgColor},playerSize(){return this.$store.getters.playerSize}},created(){Rt.$on("start:export",this.exportVideo)},mounted(){this.audioTrack.blob.size||this.$q.notify({message:"音频资源已失效",type:"negative",timeout:1e4})},methods:{exportVideo(){Rt.$emit("load:start","准备导出...");let t=this.audioTrack.blob.size;this.stages.forEach((e=>{e.bg&&(t+=e.bg.size)})),this.$store.commit("SET_VIDEO_INFO",{id:ut.a.generate(),cd:{stage:this.stages,canvas:this.canvasObjs,dur:this.duration,size:this.playerSize,bgcolor:this.stageBgColor,resSize:t},isMobile:this.$q.platform.is.mobile,dur:this.duration}),Rt.$emit("load:end"),this.$router.replace({path:"/export"})}}},On=An,$n=Object(g["a"])(On,wn,Cn,!1,null,"33f8d752",null),In=$n.exports,Mn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"preview-container"},[t.info?r("player",{ref:"player",attrs:{audioUrl:t.audioTrack.url,canvasObjs:t.info.cd.canvas,stages:t.info.cd.stage,duration:t.info.dur,size:t.info.cd.size,bgColor:t.info.cd.bgcolor}}):t._e()],1)},qn=[],jn=r("c4e3"),Nn=r.n(jn),Un=r("e19a"),Bn={name:"Video",components:{Player:kn},data(){return{}},computed:{audioTrack(){return this.$store.getters.audioTrack},info(){return this.$store.getters.videoInfo}},created(){Rt.$on("video:fullscreen",this.requestFullscreen),this.getVideoBy(this.$route.params.id)},destroyed(){this.$store.commit("SET_VIDEO_INFO",null)},mounted(){window.addEventListener("orientationchange",(()=>{this.$refs.player.fitScreenWidth(),window.screen.orientation&&"landscape-primary"===window.screen.orientation.type&&this.$confirm("建议开启全屏模式, 获取最佳观看体验","提示",{type:"info",beforeClose:(t,e,r)=>{t&&this.requestFullscreen(),r()}})})),document.addEventListener("webkitfullscreenchange",(t=>{const e=document.mozFullScreen||document.webkitIsFullScreen;e||this.$refs.player.fitToOriginWidth()}))},methods:{getVideoBy(t){if(t){const e=Wr(jr+t);Object(Un["fetchFile"])(e).then((t=>{Nn.a.loadAsync(t).then((t=>{t.file("data.json").async("string").then((e=>{t.file("audio.ogg").async("arraybuffer").then((t=>{const r=new Blob([t],{type:"audio/ogg"});this.$store.commit("SET_AUDIO_TRACK",{url:URL.createObjectURL(r),blob:r}),this.$store.commit("SET_VIDEO_INFO",JSON.parse(e)),this.$nextTick((()=>{window.screen.width<900&&this.$refs.player.fitScreenWidth()}))}))}))}))}))}},requestFullscreen(t){const e=this.$refs.player.$el;t&&this.$refs.player.fitScreenWidth(),e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}}},Fn=Bn,Dn=Object(g["a"])(Fn,Mn,qn,!1,null,null,null),Wn=Dn.exports,Hn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("section",[t.replyUrl?r("div",{staticClass:"text-center"},[r("video",{attrs:{width:t.info.cd.size[0],src:t.replyUrl,poster:t.coverImg,controls:""}})]):t._e(),r("div",{directives:[{name:"show",rawName:"v-show",value:!t.videoInfo,expression:"!videoInfo"}],staticClass:"empty-tip"},[t._v("没有可导出的视频")]),t.canConvert?r("div",{staticStyle:{"pointer-events":"none"}},[t.info.cd&&!t.replyUrl?r("player",{ref:"player",attrs:{canvasObjs:t.info.cd.canvas,stages:t.info.cd.stage,size:t.info.cd.size,title:t.info.t,duration:t.info.dur,scaleRate:t.scaleRate,bgColor:t.bgColor,cursor:!t.info.isMobile},on:{captureImg:t.getCaptureImg,error:t.handlePlayerError,playover:t.handleOver,getCover:function(e){return t.coverImg=e}}}):t._e()],1):t._e(),r("q-dialog",{model:{value:t.showUploadAlert,callback:function(e){t.showUploadAlert=e},expression:"showUploadAlert"}},[r("q-card",{staticStyle:{"max-width":"450px",top:"-100px"}},[t.errMsg?r("q-card-section",{staticClass:"q-pb-none text-accent text-bold"},[t._v("\n        导出异常提示 "+t._s(t.errMsg)+"\n      ")]):t._e(),r("q-card-section",[r("div",[t._v("可在PC电脑端Chrome浏览器中打开此链接进行MP4导出, 此链接有效期 7 天")]),r("div",{staticClass:"q-mt-sm"},[r("q-input",{ref:"exportUrlInput",attrs:{outlined:"",dense:"",value:t.exportUrl},on:{click:function(e){return t.$refs.exportUrlInput.select()}}})],1),r("div",{staticClass:"q-mt-md"},[t._v("你也可以直接分享观看链接，供在线观看，有效期 7 天")]),r("div",{staticClass:"q-mt-sm"},[r("q-input",{ref:"exportUrlInput2",attrs:{outlined:"",dense:"",value:t.playUrl},on:{click:function(e){return t.$refs.exportUrlInput2.select()}}})],1)]),r("q-card-actions",{attrs:{align:"center"}},[r("q-btn",{attrs:{color:"secondary",unelevated:""},on:{click:function(e){return t.copyLink(t.exportUrl)}}},[t._v("复制导出链接")]),r("q-btn",{attrs:{color:"primary",unelevated:""},on:{click:function(e){return t.copyLink(t.playUrl)}}},[t._v("复制观看链接")])],1)],1)],1)],1)},Vn=[],zn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"player-wrap"},[r("div",{ref:"layerContainer",staticClass:"canvas-layer-wrap",style:t.layerContainerHeight},[r("div",{staticClass:"canvas-layer",style:t.layerStyle+"background-color:"+t.bgColor},[r("canvas",{ref:"captureLayer",style:t.captureLayerStyle,attrs:{width:t.canvasW,height:t.captureH}}),r("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fakeLayer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"stageLayer",staticClass:"stage-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"displayLayer",staticClass:"display-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),r("canvas",{ref:"syncLayer",staticClass:"sync-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}})])])])},Qn=[],Gn=r("ecd6"),Yn=r.n(Gn);function Xn(){return Yn()('(function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="635f")})({"00ee":function(t,e,n){var r=n("b622"),o=r("toStringTag"),i={};i[o]="z",t.exports="[object z]"===String(i)},"0366":function(t,e,n){var r=n("1c0b");t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}},"069b":function(t,e,n){"use strict";var r=n("41fa"),o=n("3df9"),i=n("dd14"),a=n("9fc2")||0;function c(e){return r.seed(e),t.exports}function u(e){return a=e,t.exports}function f(t){return void 0!==t&&r.characters(t),r.shuffled()}function s(){return o(a)}t.exports=s,t.exports.generate=s,t.exports.seed=c,t.exports.worker=u,t.exports.characters=f,t.exports.isValid=i},"06cf":function(t,e,n){var r=n("83ab"),o=n("d1e7"),i=n("5c6c"),a=n("fc6a"),c=n("c04e"),u=n("5135"),f=n("0cfb"),s=Object.getOwnPropertyDescriptor;e.f=r?s:function(t,e){if(t=a(t),e=c(e,!0),f)try{return s(t,e)}catch(n){}if(u(t,e))return i(!o.f.call(t,e),t[e])}},"091d":function(t,e,n){"use strict";var r,o="object"===typeof window&&(window.crypto||window.msCrypto);r=o&&o.getRandomValues?function(t){return o.getRandomValues(new Uint8Array(t))}:function(t){for(var e=[],n=0;n<t;n++)e.push(Math.floor(256*Math.random()));return e},t.exports=r},"0b25":function(t,e,n){var r=n("a691"),o=n("50c4");t.exports=function(t){if(void 0===t)return 0;var e=r(t),n=o(e);if(e!==n)throw RangeError("Wrong length or index");return n}},"0cfb":function(t,e,n){var r=n("83ab"),o=n("d039"),i=n("cc12");t.exports=!r&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},"14c3":function(t,e,n){var r=n("c6b6"),o=n("9263");t.exports=function(t,e){var n=t.exec;if("function"===typeof n){var i=n.call(t,e);if("object"!==typeof i)throw TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==r(t))throw TypeError("RegExp#exec called on incompatible receiver");return o.call(t,e)}},"182d":function(t,e,n){var r=n("f8cd");t.exports=function(t,e){var n=r(t);if(n%e)throw RangeError("Wrong offset");return n}},"19aa":function(t,e){t.exports=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}},"1be4":function(t,e,n){var r=n("d066");t.exports=r("document","documentElement")},"1c0b":function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},"1c7e":function(t,e,n){var r=n("b622"),o=r("iterator"),i=!1;try{var a=0,c={next:function(){return{done:!!a++}},return:function(){i=!0}};c[o]=function(){return this},Array.from(c,(function(){throw 2}))}catch(u){}t.exports=function(t,e){if(!e&&!i)return!1;var n=!1;try{var r={};r[o]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(u){}return n}},"1cdc":function(t,e,n){var r=n("342f");t.exports=/(iphone|ipod|ipad).*applewebkit/i.test(r)},"1d80":function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can\'t call method on "+t);return t}},2266:function(t,e,n){var r=n("825a"),o=n("e95a"),i=n("50c4"),a=n("0366"),c=n("35a1"),u=n("2a62"),f=function(t,e){this.stopped=t,this.result=e};t.exports=function(t,e,n){var s,l,d,p,v,h,y,b=n&&n.that,g=!(!n||!n.AS_ENTRIES),x=!(!n||!n.IS_ITERATOR),w=!(!n||!n.INTERRUPTED),m=a(e,b,1+g+w),E=function(t){return s&&u(s),new f(!0,t)},S=function(t){return g?(r(t),w?m(t[0],t[1],E):m(t[0],t[1])):w?m(t,E):m(t)};if(x)s=t;else{if(l=c(t),"function"!=typeof l)throw TypeError("Target is not iterable");if(o(l)){for(d=0,p=i(t.length);p>d;d++)if(v=S(t[d]),v&&v instanceof f)return v;return new f(!1)}s=l.call(t)}h=s.next;while(!(y=h.call(s)).done){try{v=S(y.value)}catch(T){throw u(s),T}if("object"==typeof v&&v&&v instanceof f)return v}return new f(!1)}},"23cb":function(t,e,n){var r=n("a691"),o=Math.max,i=Math.min;t.exports=function(t,e){var n=r(t);return n<0?o(n+e,0):i(n,e)}},"23e7":function(t,e,n){var r=n("da84"),o=n("06cf").f,i=n("9112"),a=n("6eeb"),c=n("ce4e"),u=n("e893"),f=n("94ca");t.exports=function(t,e){var n,s,l,d,p,v,h=t.target,y=t.global,b=t.stat;if(s=y?r:b?r[h]||c(h,{}):(r[h]||{}).prototype,s)for(l in e){if(p=e[l],t.noTargetGet?(v=o(s,l),d=v&&v.value):d=s[l],n=f(y?l:h+(b?".":"#")+l,t.forced),!n&&void 0!==d){if(typeof p===typeof d)continue;u(p,d)}(t.sham||d&&d.sham)&&i(p,"sham",!0),a(s,l,p,t)}}},"241c":function(t,e,n){var r=n("ca84"),o=n("7839"),i=o.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,i)}},2626:function(t,e,n){"use strict";var r=n("d066"),o=n("9bf2"),i=n("b622"),a=n("83ab"),c=i("species");t.exports=function(t){var e=r(t),n=o.f;a&&e&&!e[c]&&n(e,c,{configurable:!0,get:function(){return this}})}},"2a62":function(t,e,n){var r=n("825a");t.exports=function(t){var e=t["return"];if(void 0!==e)return r(e.call(t)).value}},"2cf4":function(t,e,n){var r,o,i,a=n("da84"),c=n("d039"),u=n("0366"),f=n("1be4"),s=n("cc12"),l=n("1cdc"),d=n("605d"),p=a.location,v=a.setImmediate,h=a.clearImmediate,y=a.process,b=a.MessageChannel,g=a.Dispatch,x=0,w={},m="onreadystatechange",E=function(t){if(w.hasOwnProperty(t)){var e=w[t];delete w[t],e()}},S=function(t){return function(){E(t)}},T=function(t){E(t.data)},A=function(t){a.postMessage(t+"",p.protocol+"//"+p.host)};v&&h||(v=function(t){var e=[],n=1;while(arguments.length>n)e.push(arguments[n++]);return w[++x]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},r(x),x},h=function(t){delete w[t]},d?r=function(t){y.nextTick(S(t))}:g&&g.now?r=function(t){g.now(S(t))}:b&&!l?(o=new b,i=o.port2,o.port1.onmessage=T,r=u(i.postMessage,i,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts&&p&&"file:"!==p.protocol&&!c(A)?(r=A,a.addEventListener("message",T,!1)):r=m in s("script")?function(t){f.appendChild(s("script"))[m]=function(){f.removeChild(this),E(t)}}:function(t){setTimeout(S(t),0)}),t.exports={set:v,clear:h}},"2d00":function(t,e,n){var r,o,i=n("da84"),a=n("342f"),c=i.process,u=c&&c.versions,f=u&&u.v8;f?(r=f.split("."),o=r[0]+r[1]):a&&(r=a.match(/Edge\\/(\\d+)/),(!r||r[1]>=74)&&(r=a.match(/Chrome\\/(\\d+)/),r&&(o=r[1]))),t.exports=o&&+o},"342f":function(t,e,n){var r=n("d066");t.exports=r("navigator","userAgent")||""},"35a1":function(t,e,n){var r=n("f5df"),o=n("3f8c"),i=n("b622"),a=i("iterator");t.exports=function(t){if(void 0!=t)return t[a]||t["@@iterator"]||o[r(t)]}},"37e8":function(t,e,n){var r=n("83ab"),o=n("9bf2"),i=n("825a"),a=n("df75");t.exports=r?Object.defineProperties:function(t,e){i(t);var n,r=a(e),c=r.length,u=0;while(c>u)o.f(t,n=r[u++],e[n]);return t}},"3bbe":function(t,e,n){var r=n("861d");t.exports=function(t){if(!r(t)&&null!==t)throw TypeError("Can\'t set "+String(t)+" as a prototype");return t}},"3df9":function(t,e,n){"use strict";var r,o,i=n("bd92"),a=(n("41fa"),1567752802062),c=7;function u(t){var e="",n=Math.floor(.001*(Date.now()-a));return n===o?r++:(r=0,o=n),e+=i(c),e+=i(t),r>0&&(e+=i(r)),e+=i(n),e}t.exports=u},"3f8c":function(t,e){t.exports={}},"41fa":function(t,e,n){"use strict";var r,o,i,a=n("7eac"),c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function u(){i=!1}function f(t){if(t){if(t!==r){if(t.length!==c.length)throw new Error("Custom alphabet for shortid must be "+c.length+" unique characters. You submitted "+t.length+" characters: "+t);var e=t.split("").filter((function(t,e,n){return e!==n.lastIndexOf(t)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+c.length+" unique characters. These characters were not unique: "+e.join(", "));r=t,u()}}else r!==c&&(r=c,u())}function s(t){return f(t),r}function l(t){a.seed(t),o!==t&&(u(),o=t)}function d(){r||f(c);var t,e=r.split(""),n=[],o=a.nextValue();while(e.length>0)o=a.nextValue(),t=Math.floor(o*e.length),n.push(e.splice(t,1)[0]);return n.join("")}function p(){return i||(i=d(),i)}function v(t){var e=p();return e[t]}function h(){return r||c}t.exports={get:h,characters:s,seed:l,lookup:v,shuffled:p}},"428f":function(t,e,n){var r=n("da84");t.exports=r},"44ad":function(t,e,n){var r=n("d039"),o=n("c6b6"),i="".split;t.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==o(t)?i.call(t,""):Object(t)}:Object},"44d2":function(t,e,n){var r=n("b622"),o=n("7c73"),i=n("9bf2"),a=r("unscopables"),c=Array.prototype;void 0==c[a]&&i.f(c,a,{configurable:!0,value:o(null)}),t.exports=function(t){c[a][t]=!0}},"44de":function(t,e,n){var r=n("da84");t.exports=function(t,e){var n=r.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}},4840:function(t,e,n){var r=n("825a"),o=n("1c0b"),i=n("b622"),a=i("species");t.exports=function(t,e){var n,i=r(t).constructor;return void 0===i||void 0==(n=r(i)[a])?e:o(n)}},4930:function(t,e,n){var r=n("d039");t.exports=!!Object.getOwnPropertySymbols&&!r((function(){return!String(Symbol())}))},"4d64":function(t,e,n){var r=n("fc6a"),o=n("50c4"),i=n("23cb"),a=function(t){return function(e,n,a){var c,u=r(e),f=o(u.length),s=i(a,f);if(t&&n!=n){while(f>s)if(c=u[s++],c!=c)return!0}else for(;f>s;s++)if((t||s in u)&&u[s]===n)return t||s||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},"50c4":function(t,e,n){var r=n("a691"),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},5135:function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},5319:function(t,e,n){"use strict";var r=n("d784"),o=n("825a"),i=n("7b0b"),a=n("50c4"),c=n("a691"),u=n("1d80"),f=n("8aa5"),s=n("14c3"),l=Math.max,d=Math.min,p=Math.floor,v=/\\$([$&\'`]|\\d\\d?|<[^>]*>)/g,h=/\\$([$&\'`]|\\d\\d?)/g,y=function(t){return void 0===t?t:String(t)};r("replace",2,(function(t,e,n,r){var b=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,g=r.REPLACE_KEEPS_$0,x=b?"$":"$0";return[function(n,r){var o=u(this),i=void 0==n?void 0:n[t];return void 0!==i?i.call(n,o,r):e.call(String(o),n,r)},function(t,r){if(!b&&g||"string"===typeof r&&-1===r.indexOf(x)){var i=n(e,t,this,r);if(i.done)return i.value}var u=o(t),p=String(this),v="function"===typeof r;v||(r=String(r));var h=u.global;if(h){var m=u.unicode;u.lastIndex=0}var E=[];while(1){var S=s(u,p);if(null===S)break;if(E.push(S),!h)break;var T=String(S[0]);""===T&&(u.lastIndex=f(p,a(u.lastIndex),m))}for(var A="",O=0,R=0;R<E.length;R++){S=E[R];for(var L=String(S[0]),P=l(d(c(S.index),p.length),0),I=[],j=1;j<S.length;j++)I.push(y(S[j]));var M=S.groups;if(v){var k=[L].concat(I,P,p);void 0!==M&&k.push(M);var C=String(r.apply(void 0,k))}else C=w(L,p,P,I,M,r);P>=O&&(A+=p.slice(O,P)+C,O=P+L.length)}return A+p.slice(O)}];function w(t,n,r,o,a,c){var u=r+t.length,f=o.length,s=h;return void 0!==a&&(a=i(a),s=v),e.call(c,s,(function(e,i){var c;switch(i.charAt(0)){case"$":return"$";case"&":return t;case"`":return n.slice(0,r);case"\'":return n.slice(u);case"<":c=a[i.slice(1,-1)];break;default:var s=+i;if(0===s)return e;if(s>f){var l=p(s/10);return 0===l?e:l<=f?void 0===o[l-1]?i.charAt(1):o[l-1]+i.charAt(1):e}c=o[s-1]}return void 0===c?"":c}))}}))},5692:function(t,e,n){var r=n("c430"),o=n("c6cd");(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.8.1",mode:r?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},"56ef":function(t,e,n){var r=n("d066"),o=n("241c"),i=n("7418"),a=n("825a");t.exports=r("Reflect","ownKeys")||function(t){var e=o.f(a(t)),n=i.f;return n?e.concat(n(t)):e}},"5c6c":function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},"5cc6":function(t,e,n){var r=n("74e8");r("Uint8",(function(t){return function(e,n,r){return t(this,e,n,r)}}))},"605d":function(t,e,n){var r=n("c6b6"),o=n("da84");t.exports="process"==r(o.process)},"621a":function(t,e,n){"use strict";var r=n("da84"),o=n("83ab"),i=n("a981"),a=n("9112"),c=n("e2cc"),u=n("d039"),f=n("19aa"),s=n("a691"),l=n("50c4"),d=n("0b25"),p=n("77a7"),v=n("e163"),h=n("d2bb"),y=n("241c").f,b=n("9bf2").f,g=n("81d5"),x=n("d44e"),w=n("69f3"),m=w.get,E=w.set,S="ArrayBuffer",T="DataView",A="prototype",O="Wrong length",R="Wrong index",L=r[S],P=L,I=r[T],j=I&&I[A],M=Object.prototype,k=r.RangeError,C=p.pack,_=p.unpack,F=function(t){return[255&t]},U=function(t){return[255&t,t>>8&255]},D=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},N=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},V=function(t){return C(t,23,4)},W=function(t){return C(t,52,8)},B=function(t,e){b(t[A],e,{get:function(){return m(this)[e]}})},Y=function(t,e,n,r){var o=d(n),i=m(t);if(o+e>i.byteLength)throw k(R);var a=m(i.buffer).bytes,c=o+i.byteOffset,u=a.slice(c,c+e);return r?u:u.reverse()},G=function(t,e,n,r,o,i){var a=d(n),c=m(t);if(a+e>c.byteLength)throw k(R);for(var u=m(c.buffer).bytes,f=a+c.byteOffset,s=r(+o),l=0;l<e;l++)u[f+l]=s[i?l:e-l-1]};if(i){if(!u((function(){L(1)}))||!u((function(){new L(-1)}))||u((function(){return new L,new L(1.5),new L(NaN),L.name!=S}))){P=function(t){return f(this,P),new L(d(t))};for(var $,H=P[A]=L[A],q=y(L),X=0;q.length>X;)($=q[X++])in P||a(P,$,L[$]);H.constructor=P}h&&v(j)!==M&&h(j,M);var K=new I(new P(2)),z=j.setInt8;K.setInt8(0,2147483648),K.setInt8(1,2147483649),!K.getInt8(0)&&K.getInt8(1)||c(j,{setInt8:function(t,e){z.call(this,t,e<<24>>24)},setUint8:function(t,e){z.call(this,t,e<<24>>24)}},{unsafe:!0})}else P=function(t){f(this,P,S);var e=d(t);E(this,{bytes:g.call(new Array(e),0),byteLength:e}),o||(this.byteLength=e)},I=function(t,e,n){f(this,I,T),f(t,P,T);var r=m(t).byteLength,i=s(e);if(i<0||i>r)throw k("Wrong offset");if(n=void 0===n?r-i:l(n),i+n>r)throw k(O);E(this,{buffer:t,byteLength:n,byteOffset:i}),o||(this.buffer=t,this.byteLength=n,this.byteOffset=i)},o&&(B(P,"byteLength"),B(I,"buffer"),B(I,"byteLength"),B(I,"byteOffset")),c(I[A],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var e=Y(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Y(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return N(Y(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return N(Y(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return _(Y(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return _(Y(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){G(this,1,t,F,e)},setUint8:function(t,e){G(this,1,t,F,e)},setInt16:function(t,e){G(this,2,t,U,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){G(this,2,t,U,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){G(this,4,t,D,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){G(this,4,t,D,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){G(this,4,t,V,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){G(this,8,t,W,e,arguments.length>2?arguments[2]:void 0)}});x(P,S),x(I,T),t.exports={ArrayBuffer:P,DataView:I}},"635f":function(t,e,n){"use strict";n.r(e);const r=[{name:"咖啡色",value:"#655643"},{name:"粉色",value:"#FF9E9D"},{name:"橙色",value:"#ec8749"},{name:"蓝色",value:"#0088ff"},{name:"红色",value:"#e74000"},{name:"绿色",value:"#5cb85c"},{name:"白色",value:"#ffffff"},{name:"黑色",value:"#1d1d1d"}];n("c975"),n("ace4"),n("e6cf"),n("5319"),n("5cc6");function o(t,e){const n=t.replace("#",""),r=parseInt(n.substring(0,2),16),o=parseInt(n.substring(2,4),16),i=parseInt(n.substring(4,6),16);return"rgba("+r+","+o+","+i+","+e/100+")"}n("ddb0");function i(t){return Math.max.apply(Math,t)}function a(t){return Math.min.apply(Math,t)}function c(t){const e=t.map((t=>t[0])),n=t.map((t=>t[1]));return[a(e),a(n),i(e)-a(e),i(n)-a(n)]}function u(t,e){return 1!==e?t*e+.5<<0:t}function f(t,e,n=1){const r=Math.round(e[0]*n-t.lineWidth/2-.5),o=Math.round(e[1]*n-t.lineWidth/2-.5),i=Math.round(e[2]*n+t.lineWidth+.5),a=Math.round(e[3]*n+t.lineWidth+.5);t.clearRect(r,o,i,a)}function s(t,e,n=1){f(t,c(e),n),e=[]}function l(t,e,n,r=!0){if(r&&t.clearCurve(),1===e.length){const r=e[0];return t.beginPath(),t.arc(u(r[0],n),u(r[1],n),t.lineWidth/2,0,2*Math.PI,!0),t.closePath(),void t.fill()}t.beginPath();const o=u(e[0][0],n),i=u(e[0][1],n);if(t.moveTo(o,i),2===e.length)return t.lineTo(u(e[1][0],n),u(e[1][1],n)),void t.stroke();let a=1;while(a<e.length-2){const r=u((e[a][0]+e[a+1][0])/2,n),o=u((e[a][1]+e[a+1][1])/2,n),i=u(e[a][0],n),c=u(e[a][1],n);t.quadraticCurveTo(i,c,r,o),a++}const c=u(e[a][0],n),f=u(e[a][1],n),s=u(e[a+1][0],n),l=u(e[a+1][1],n);t.quadraticCurveTo(c,f,s,l),t.stroke()}function d(t,e,n,r,o=1){return{x:Math.min(t,n)/o,y:Math.min(e,r)/o,w:Math.abs(n-t)/o,h:Math.abs(r-e)/o}}function p(t,e,n=1,r){t.save(),t.lineWidth=2,t.strokeStyle=r,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(e[0]*n,e[1]*n),t.lineTo(e[2]*n,e[3]*n),t.stroke(),t.restore()}function v(t,e,n=1,r){const o=10;t.save(),t.lineWidth=2,r&&(t.strokeStyle=r),t.lineCap="round",t.lineJoin="round";const i=e[2],a=e[3],c=Math.atan2(e[3]-e[1],e[2]-e[0]);t.beginPath(),t.moveTo(e[0]*n,e[1]*n),t.lineTo(e[2]*n,e[3]*n),t.moveTo(i,a),t.lineTo(i-o*Math.cos(c-Math.PI/6),a-o*Math.sin(c-Math.PI/6)),t.moveTo(i,a),t.lineTo(i-o*Math.cos(c+Math.PI/6),a-o*Math.sin(c+Math.PI/6)),t.stroke(),t.restore()}function h(t,e,n=1,r){t.save(),t.lineWidth=2,r&&(t.strokeStyle=r);const o=d(...e,n);t.strokeRect(o.x,o.y,o.w,o.h),t.restore()}function y(t,e,n=1,r){const o=d(...e,n),i=o.x+o.w/2,a=o.y+o.h/2;t.save(),t.lineWidth=2,r&&(t.strokeStyle=r),t.beginPath(),t.ellipse(i,a,o.w/2,o.h/2,0,2*Math.PI,!1),t.stroke(),t.restore()}var b=n("8dee"),g=n.n(b);const x=100;let w=0,m={};const E={curX:0,curY:0,curOp:.5,curColor:""};let S=0,T=[],A=!1;const O=t=>self[t].getContext("2d"),R=()=>{["displayLayer","stageLayer","fakeLayer","syncLayer"].forEach((t=>{self[t]&&self[t].getContext("2d").scale(self.devicePixelRatio,self.devicePixelRatio)}))},L=t=>"string"===typeof t&&0===t.indexOf("#")||String(t).indexOf("rgba")>-1?t:r[t].value,P=(t={})=>{const e=O("fakeLayer");e.fillStyle="#fff";const n=self.width*self.scaleRate,r=self.height*self.scaleRate;e.fillRect(0,0,n,r);let o=80;e.textBaseline="middle",e.font="22px Roboto",e.fillStyle="#666";const i=t.title,a=e.measureText(i).width;if(a<n){const t=n/2-a/2;e.fillText(i,t,o)}e.font="16px Roboto",e.fillStyle="#999";const c="由手绘微课录制",u=n/2-e.measureText(c).width/2;if(e.fillText(c,u,r-60),o+=40,t.author){e.font="18px Roboto",e.fillStyle="#333";const r=n/2-e.measureText(t.author).width/2;e.fillText(t.author,r,o)}self.fakeLayer.convertToBlob({type:"image/webp"}).then((t=>{const e=new FileReader;return e.readAsDataURL(t),new Promise((t=>{e.onloadend=()=>{t(e.result)}}))})).then((t=>{postMessage({target:"mini",payload:{title:"SEND_COVER",data:t}})}))},I=t=>{t.id=t.id||g.a.generate(),T.push(t)},j=t=>(T=T.filter((e=>t.indexOf(e.id)<0)),T),M=(t="captureLayer",e)=>{if(!self[t])return;const n=O(t);e?s(n,e,self.scaleRate):n.clearRect(0,0,self.canvasW,self.canvasH)},k=()=>{A=!0,w=0,T=[],M("displayLayer"),M("captureLayer"),M("stageLayer"),M("syncLayer"),m={},self.curFid=null,postMessage({target:"mini",payload:{title:"CONVERT_DONE"}})},C=(t,e="displayLayer",n=!1)=>{const r=O(e);if(r.strokeStyle=r.fillStyle=L(t.co),r.lineWidth=t.wi*self.scaleRate,r.lineCap=r.lineJoin="round",n){const n=r._points;r.clearCurve=n?()=>M(e,n):()=>{},r._points=t.po}else"displayLayer"===e&&I(t);l(r,t.po,self.scaleRate,n)},_=(t,e="displayLayer")=>{const n=O(e);switch(t.sty){case"L":p(n,t.data,self.scaleRate,t.co);break;case"AL":v(n,t.data,self.scaleRate,t.co);break;case"R":h(n,t.data,self.scaleRate,t.co);break;case"C":y(n,t.data,self.scaleRate,t.co);break}"displayLayer"===e&&I(t)},F=(t,e)=>new Promise(((n,r)=>{switch(t.ty){case"C":C(t,e),n();break;case"S":_(t,e),n();break;default:C(t,e),n();break}})),U=async(t,e=!1)=>{M("fakeLayer");for(const n of t)await F(n,"fakeLayer");e&&M("displayLayer"),O("displayLayer").drawImage(self.fakeLayer,0,0,self.width*self.scaleRate,self.height*self.scaleRate)},D=t=>{t&&(T=t),T.length?U(T,!0):M("displayLayer")},N=(t,e,n=0)=>{if(!t.url)return;let r=t.w,o=t.h;r!==self.width&&(o=self.width*o/r,r=self.width);const i=O("stageLayer");i.save(),i.drawImage(self.imageDict[e],0,n,r*self.scaleRate,o*self.scaleRate),i.restore()},V=(t,e)=>{const n=self.stages.find((e=>e.id===t));if(n){const t=n.bg;M("stageLayer"),D(m[n.id]||[]),S=e*self.scaleRate,t&&N(t,n.id)}},W=t=>{for(const e of Object.keys(t))E[e]=t[e]},B=t=>{switch(t.ac){case"CSync":case"Cy":{C(t.data,"syncLayer",!0);const e=t.data.po[t.data.po.length-1];W({curX:e[0],curY:e[1],curOp:.5});break}case"CEnd":case"CE":M("syncLayer"),C(t.data);break;case"E":j(t.data),D();break;case"CM":W({curX:t.data[0],curY:t.data[1],curOp:1});break;case"F":case"Frame":{self.preFid=self.curFid;let e=0;"object"===typeof t.data?(self.curFid=t.data.id,e=t.data.top):self.curFid=t.data,self.preFid&&(m[self.preFid]=T),V(self.curFid,e);break}case"SL":S=t.data*self.scaleRate;break;case"SEnd":_(t.data);break;case"End":k();break;case"CC":W({curColor:t.data});break;case"UE":U(t.data);for(const e of t.data)I(e);break}},Y=t=>{t.beginPath();const e=S*self.devicePixelRatio,n=E.curX*self.devicePixelRatio,r=E.curY*self.devicePixelRatio-e;n>0&&r>0&&(t.arc(n,r,12,0,2*Math.PI,!1),t.fillStyle=o(E.curColor,100*E.curOp),t.fill())},G=(t,e)=>{const n=O("captureLayer"),r=["stageLayer","displayLayer","syncLayer"],o=S*self.devicePixelRatio;r.forEach((t=>{"stageLayer"===t&&(n.fillStyle=self.bgColor,n.fillRect(0,0,self.canvasW,self.captureH)),n.drawImage(self[t],0,o,self.canvasW,self.captureH,0,0,self.canvasW,self.captureH)})),self.enableCursor&&Y(n),n.font="24px 楷体",n.fillStyle="rgba(255,255,255,0.7)",n.shadowColor="rgba(0,0,0,0.2)",n.shadowOffsetX=2,n.shadowOffsetY=2,n.shadowBlur=2;const i="手绘微课",a=self.canvasW-n.measureText(i).width-10,c=self.captureH-20;n.fillText(i,a,c),n.restore(),self.captureLayer.convertToBlob({type:"image/webp",quality:.9}).then((t=>{const e=new FileReader;return e.readAsDataURL(t),new Promise((t=>{e.onloadend=()=>{t(e.result)}}))})).then((n=>{postMessage({target:"mini",payload:{title:"CAPTURE_IMG",data:{imgData:n,cts:t}}}),e()}))},$=t=>new Promise(((e,n)=>{self.canvasObjs.filter((e=>t-x<=e.ts&&e.ts<t)).forEach(B),G(t,e)})),H=async()=>{while(!A)w+=x,await $(w)};onmessage=t=>{const{code:e,payload:n}=t.data;if(e)switch(e){case"INIT_LAYER":self.captureLayer=n.captureLayer,self.fakeLayer=n.fakeLayer,self.stageLayer=n.stageLayer,self.displayLayer=n.displayLayer,self.syncLayer=n.syncLayer,self.bgColor=n.bgColor,self.width=n.width,self.height=n.height,self.scaleRate=n.scaleRate,self.devicePixelRatio=n.devicePixelRatio,self.canvasW=n.canvasW,self.canvasH=n.canvasH,self.captureH=n.captureH,self.stages=n.stages,self.imageDict=n.imageDict,self.enableCursor=n.enableCursor,R();break;case"GET_COVER":P(n);break;case"START_CONVERT":self.canvasObjs=n,H();break;default:break}}},6547:function(t,e,n){var r=n("a691"),o=n("1d80"),i=function(t){return function(e,n){var i,a,c=String(o(e)),u=r(n),f=c.length;return u<0||u>=f?t?"":void 0:(i=c.charCodeAt(u),i<55296||i>56319||u+1===f||(a=c.charCodeAt(u+1))<56320||a>57343?t?c.charAt(u):i:t?c.slice(u,u+2):a-56320+(i-55296<<10)+65536)}};t.exports={codeAt:i(!1),charAt:i(!0)}},"65f0":function(t,e,n){var r=n("861d"),o=n("e8b5"),i=n("b622"),a=i("species");t.exports=function(t,e){var n;return o(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!o(n.prototype)?r(n)&&(n=n[a],null===n&&(n=void 0)):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}},"69f3":function(t,e,n){var r,o,i,a=n("7f9a"),c=n("da84"),u=n("861d"),f=n("9112"),s=n("5135"),l=n("c6cd"),d=n("f772"),p=n("d012"),v=c.WeakMap,h=function(t){return i(t)?o(t):r(t,{})},y=function(t){return function(e){var n;if(!u(e)||(n=o(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}};if(a){var b=l.state||(l.state=new v),g=b.get,x=b.has,w=b.set;r=function(t,e){return e.facade=t,w.call(b,t,e),e},o=function(t){return g.call(b,t)||{}},i=function(t){return x.call(b,t)}}else{var m=d("state");p[m]=!0,r=function(t,e){return e.facade=t,f(t,m,e),e},o=function(t){return s(t,m)?t[m]:{}},i=function(t){return s(t,m)}}t.exports={set:r,get:o,has:i,enforce:h,getterFor:y}},"6eeb":function(t,e,n){var r=n("da84"),o=n("9112"),i=n("5135"),a=n("ce4e"),c=n("8925"),u=n("69f3"),f=u.get,s=u.enforce,l=String(String).split("String");(t.exports=function(t,e,n,c){var u,f=!!c&&!!c.unsafe,d=!!c&&!!c.enumerable,p=!!c&&!!c.noTargetGet;"function"==typeof n&&("string"!=typeof e||i(n,"name")||o(n,"name",e),u=s(n),u.source||(u.source=l.join("string"==typeof e?e:""))),t!==r?(f?!p&&t[e]&&(d=!0):delete t[e],d?t[e]=n:o(t,e,n)):d?t[e]=n:a(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&f(this).source||c(this)}))},7156:function(t,e,n){var r=n("861d"),o=n("d2bb");t.exports=function(t,e,n){var i,a;return o&&"function"==typeof(i=e.constructor)&&i!==n&&r(a=i.prototype)&&a!==n.prototype&&o(t,a),t}},7418:function(t,e){e.f=Object.getOwnPropertySymbols},"74e8":function(t,e,n){"use strict";var r=n("23e7"),o=n("da84"),i=n("83ab"),a=n("8aa7"),c=n("ebb5"),u=n("621a"),f=n("19aa"),s=n("5c6c"),l=n("9112"),d=n("50c4"),p=n("0b25"),v=n("182d"),h=n("c04e"),y=n("5135"),b=n("f5df"),g=n("861d"),x=n("7c73"),w=n("d2bb"),m=n("241c").f,E=n("a078"),S=n("b727").forEach,T=n("2626"),A=n("9bf2"),O=n("06cf"),R=n("69f3"),L=n("7156"),P=R.get,I=R.set,j=A.f,M=O.f,k=Math.round,C=o.RangeError,_=u.ArrayBuffer,F=u.DataView,U=c.NATIVE_ARRAY_BUFFER_VIEWS,D=c.TYPED_ARRAY_TAG,N=c.TypedArray,V=c.TypedArrayPrototype,W=c.aTypedArrayConstructor,B=c.isTypedArray,Y="BYTES_PER_ELEMENT",G="Wrong length",$=function(t,e){var n=0,r=e.length,o=new(W(t))(r);while(r>n)o[n]=e[n++];return o},H=function(t,e){j(t,e,{get:function(){return P(this)[e]}})},q=function(t){var e;return t instanceof _||"ArrayBuffer"==(e=b(t))||"SharedArrayBuffer"==e},X=function(t,e){return B(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},K=function(t,e){return X(t,e=h(e,!0))?s(2,t[e]):M(t,e)},z=function(t,e,n){return!(X(t,e=h(e,!0))&&g(n)&&y(n,"value"))||y(n,"get")||y(n,"set")||n.configurable||y(n,"writable")&&!n.writable||y(n,"enumerable")&&!n.enumerable?j(t,e,n):(t[e]=n.value,t)};i?(U||(O.f=K,A.f=z,H(V,"buffer"),H(V,"byteOffset"),H(V,"byteLength"),H(V,"length")),r({target:"Object",stat:!0,forced:!U},{getOwnPropertyDescriptor:K,defineProperty:z}),t.exports=function(t,e,n){var i=t.match(/\\d+$/)[0]/8,c=t+(n?"Clamped":"")+"Array",u="get"+t,s="set"+t,h=o[c],y=h,b=y&&y.prototype,A={},O=function(t,e){var n=P(t);return n.view[u](e*i+n.byteOffset,!0)},R=function(t,e,r){var o=P(t);n&&(r=(r=k(r))<0?0:r>255?255:255&r),o.view[s](e*i+o.byteOffset,r,!0)},M=function(t,e){j(t,e,{get:function(){return O(this,e)},set:function(t){return R(this,e,t)},enumerable:!0})};U?a&&(y=e((function(t,e,n,r){return f(t,y,c),L(function(){return g(e)?q(e)?void 0!==r?new h(e,v(n,i),r):void 0!==n?new h(e,v(n,i)):new h(e):B(e)?$(y,e):E.call(y,e):new h(p(e))}(),t,y)})),w&&w(y,N),S(m(h),(function(t){t in y||l(y,t,h[t])})),y.prototype=b):(y=e((function(t,e,n,r){f(t,y,c);var o,a,u,s=0,l=0;if(g(e)){if(!q(e))return B(e)?$(y,e):E.call(y,e);o=e,l=v(n,i);var h=e.byteLength;if(void 0===r){if(h%i)throw C(G);if(a=h-l,a<0)throw C(G)}else if(a=d(r)*i,a+l>h)throw C(G);u=a/i}else u=p(e),a=u*i,o=new _(a);I(t,{buffer:o,byteOffset:l,byteLength:a,length:u,view:new F(o)});while(s<u)M(t,s++)})),w&&w(y,N),b=y.prototype=x(V)),b.constructor!==y&&l(b,"constructor",y),D&&l(b,D,c),A[c]=y,r({global:!0,forced:y!=h,sham:!U},A),Y in y||l(y,Y,i),Y in b||l(b,Y,i),T(c)}):t.exports=function(){}},"77a7":function(t,e){var n=1/0,r=Math.abs,o=Math.pow,i=Math.floor,a=Math.log,c=Math.LN2,u=function(t,e,u){var f,s,l,d=new Array(u),p=8*u-e-1,v=(1<<p)-1,h=v>>1,y=23===e?o(2,-24)-o(2,-77):0,b=t<0||0===t&&1/t<0?1:0,g=0;for(t=r(t),t!=t||t===n?(s=t!=t?1:0,f=v):(f=i(a(t)/c),t*(l=o(2,-f))<1&&(f--,l*=2),t+=f+h>=1?y/l:y*o(2,1-h),t*l>=2&&(f++,l/=2),f+h>=v?(s=0,f=v):f+h>=1?(s=(t*l-1)*o(2,e),f+=h):(s=t*o(2,h-1)*o(2,e),f=0));e>=8;d[g++]=255&s,s/=256,e-=8);for(f=f<<e|s,p+=e;p>0;d[g++]=255&f,f/=256,p-=8);return d[--g]|=128*b,d},f=function(t,e){var r,i=t.length,a=8*i-e-1,c=(1<<a)-1,u=c>>1,f=a-7,s=i-1,l=t[s--],d=127&l;for(l>>=7;f>0;d=256*d+t[s],s--,f-=8);for(r=d&(1<<-f)-1,d>>=-f,f+=e;f>0;r=256*r+t[s],s--,f-=8);if(0===d)d=1-u;else{if(d===c)return r?NaN:l?-n:n;r+=o(2,e),d-=u}return(l?-1:1)*r*o(2,d-e)};t.exports={pack:u,unpack:f}},7839:function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"7b0b":function(t,e,n){var r=n("1d80");t.exports=function(t){return Object(r(t))}},"7c73":function(t,e,n){var r,o=n("825a"),i=n("37e8"),a=n("7839"),c=n("d012"),u=n("1be4"),f=n("cc12"),s=n("f772"),l=">",d="<",p="prototype",v="script",h=s("IE_PROTO"),y=function(){},b=function(t){return d+v+l+t+d+"/"+v+l},g=function(t){t.write(b("")),t.close();var e=t.parentWindow.Object;return t=null,e},x=function(){var t,e=f("iframe"),n="java"+v+":";return e.style.display="none",u.appendChild(e),e.src=String(n),t=e.contentWindow.document,t.open(),t.write(b("document.F=Object")),t.close(),t.F},w=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(e){}w=r?g(r):x();var t=a.length;while(t--)delete w[p][a[t]];return w()};c[h]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(y[p]=o(t),n=new y,y[p]=null,n[h]=t):n=w(),void 0===e?n:i(n,e)}},"7dd0":function(t,e,n){"use strict";var r=n("23e7"),o=n("9ed3"),i=n("e163"),a=n("d2bb"),c=n("d44e"),u=n("9112"),f=n("6eeb"),s=n("b622"),l=n("c430"),d=n("3f8c"),p=n("ae93"),v=p.IteratorPrototype,h=p.BUGGY_SAFARI_ITERATORS,y=s("iterator"),b="keys",g="values",x="entries",w=function(){return this};t.exports=function(t,e,n,s,p,m,E){o(n,e,s);var S,T,A,O=function(t){if(t===p&&j)return j;if(!h&&t in P)return P[t];switch(t){case b:return function(){return new n(this,t)};case g:return function(){return new n(this,t)};case x:return function(){return new n(this,t)}}return function(){return new n(this)}},R=e+" Iterator",L=!1,P=t.prototype,I=P[y]||P["@@iterator"]||p&&P[p],j=!h&&I||O(p),M="Array"==e&&P.entries||I;if(M&&(S=i(M.call(new t)),v!==Object.prototype&&S.next&&(l||i(S)===v||(a?a(S,v):"function"!=typeof S[y]&&u(S,y,w)),c(S,R,!0,!0),l&&(d[R]=w))),p==g&&I&&I.name!==g&&(L=!0,j=function(){return I.call(this)}),l&&!E||P[y]===j||u(P,y,j),d[e]=j,p)if(T={values:O(g),keys:m?j:O(b),entries:O(x)},E)for(A in T)(h||L||!(A in P))&&f(P,A,T[A]);else r({target:e,proto:!0,forced:h||L},T);return T}},"7eac":function(t,e,n){"use strict";var r=1;function o(){return r=(9301*r+49297)%233280,r/233280}function i(t){r=t}t.exports={nextValue:o,seed:i}},"7f9a":function(t,e,n){var r=n("da84"),o=n("8925"),i=r.WeakMap;t.exports="function"===typeof i&&/native code/.test(o(i))},"81d5":function(t,e,n){"use strict";var r=n("7b0b"),o=n("23cb"),i=n("50c4");t.exports=function(t){var e=r(this),n=i(e.length),a=arguments.length,c=o(a>1?arguments[1]:void 0,n),u=a>2?arguments[2]:void 0,f=void 0===u?n:o(u,n);while(f>c)e[c++]=t;return e}},"825a":function(t,e,n){var r=n("861d");t.exports=function(t){if(!r(t))throw TypeError(String(t)+" is not an object");return t}},"83ab":function(t,e,n){var r=n("d039");t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"861d":function(t,e){t.exports=function(t){return"object"===typeof t?null!==t:"function"===typeof t}},8925:function(t,e,n){var r=n("c6cd"),o=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(t){return o.call(t)}),t.exports=r.inspectSource},"8aa5":function(t,e,n){"use strict";var r=n("6547").charAt;t.exports=function(t,e,n){return e+(n?r(t,e).length:1)}},"8aa7":function(t,e,n){var r=n("da84"),o=n("d039"),i=n("1c7e"),a=n("ebb5").NATIVE_ARRAY_BUFFER_VIEWS,c=r.ArrayBuffer,u=r.Int8Array;t.exports=!a||!o((function(){u(1)}))||!o((function(){new u(-1)}))||!i((function(t){new u,new u(null),new u(1.5),new u(t)}),!0)||o((function(){return 1!==new u(new c(2),1,void 0).length}))},"8dee":function(t,e,n){"use strict";t.exports=n("069b")},"90e3":function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++n+r).toString(36)}},9112:function(t,e,n){var r=n("83ab"),o=n("9bf2"),i=n("5c6c");t.exports=r?function(t,e,n){return o.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},9263:function(t,e,n){"use strict";var r=n("ad6d"),o=n("9f7f"),i=RegExp.prototype.exec,a=String.prototype.replace,c=i,u=function(){var t=/a/,e=/b*/g;return i.call(t,"a"),i.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),f=o.UNSUPPORTED_Y||o.BROKEN_CARET,s=void 0!==/()??/.exec("")[1],l=u||s||f;l&&(c=function(t){var e,n,o,c,l=this,d=f&&l.sticky,p=r.call(l),v=l.source,h=0,y=t;return d&&(p=p.replace("y",""),-1===p.indexOf("g")&&(p+="g"),y=String(t).slice(l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\\n"!==t[l.lastIndex-1])&&(v="(?: "+v+")",y=" "+y,h++),n=new RegExp("^(?:"+v+")",p)),s&&(n=new RegExp("^"+v+"$(?!\\\\s)",p)),u&&(e=l.lastIndex),o=i.call(d?n:l,y),d?o?(o.input=o.input.slice(h),o[0]=o[0].slice(h),o.index=l.lastIndex,l.lastIndex+=o[0].length):l.lastIndex=0:u&&o&&(l.lastIndex=l.global?o.index+o[0].length:e),s&&o&&o.length>1&&a.call(o[0],n,(function(){for(c=1;c<arguments.length-2;c++)void 0===arguments[c]&&(o[c]=void 0)})),o}),t.exports=c},"94ca":function(t,e,n){var r=n("d039"),o=/#|\\.prototype\\./,i=function(t,e){var n=c[a(t)];return n==f||n!=u&&("function"==typeof e?r(e):!!e)},a=i.normalize=function(t){return String(t).replace(o,".").toLowerCase()},c=i.data={},u=i.NATIVE="N",f=i.POLYFILL="P";t.exports=i},"9bf2":function(t,e,n){var r=n("83ab"),o=n("0cfb"),i=n("825a"),a=n("c04e"),c=Object.defineProperty;e.f=r?c:function(t,e,n){if(i(t),e=a(e,!0),i(n),o)try{return c(t,e,n)}catch(r){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},"9ed3":function(t,e,n){"use strict";var r=n("ae93").IteratorPrototype,o=n("7c73"),i=n("5c6c"),a=n("d44e"),c=n("3f8c"),u=function(){return this};t.exports=function(t,e,n){var f=e+" Iterator";return t.prototype=o(r,{next:i(1,n)}),a(t,f,!1,!0),c[f]=u,t}},"9f7f":function(t,e,n){"use strict";var r=n("d039");function o(t,e){return RegExp(t,e)}e.UNSUPPORTED_Y=r((function(){var t=o("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),e.BROKEN_CARET=r((function(){var t=o("^r","gy");return t.lastIndex=2,null!=t.exec("str")}))},"9fc2":function(t,e,n){"use strict";t.exports=0},a078:function(t,e,n){var r=n("7b0b"),o=n("50c4"),i=n("35a1"),a=n("e95a"),c=n("0366"),u=n("ebb5").aTypedArrayConstructor;t.exports=function(t){var e,n,f,s,l,d,p=r(t),v=arguments.length,h=v>1?arguments[1]:void 0,y=void 0!==h,b=i(p);if(void 0!=b&&!a(b)){l=b.call(p),d=l.next,p=[];while(!(s=d.call(l)).done)p.push(s.value)}for(y&&v>2&&(h=c(h,arguments[2],2)),n=o(p.length),f=new(u(this))(n),e=0;n>e;e++)f[e]=y?h(p[e],e):p[e];return f}},a640:function(t,e,n){"use strict";var r=n("d039");t.exports=function(t,e){var n=[][t];return!!n&&r((function(){n.call(null,e||function(){throw 1},1)}))}},a691:function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},a981:function(t,e){t.exports="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof DataView},ac1f:function(t,e,n){"use strict";var r=n("23e7"),o=n("9263");r({target:"RegExp",proto:!0,forced:/./.exec!==o},{exec:o})},ace4:function(t,e,n){"use strict";var r=n("23e7"),o=n("d039"),i=n("621a"),a=n("825a"),c=n("23cb"),u=n("50c4"),f=n("4840"),s=i.ArrayBuffer,l=i.DataView,d=s.prototype.slice,p=o((function(){return!new s(2).slice(1,void 0).byteLength}));r({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:p},{slice:function(t,e){if(void 0!==d&&void 0===e)return d.call(a(this),t);var n=a(this).byteLength,r=c(t,n),o=c(void 0===e?n:e,n),i=new(f(this,s))(u(o-r)),p=new l(this),v=new l(i),h=0;while(r<o)v.setUint8(h++,p.getUint8(r++));return i}})},ad6d:function(t,e,n){"use strict";var r=n("825a");t.exports=function(){var t=r(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},ae40:function(t,e,n){var r=n("83ab"),o=n("d039"),i=n("5135"),a=Object.defineProperty,c={},u=function(t){throw t};t.exports=function(t,e){if(i(c,t))return c[t];e||(e={});var n=[][t],f=!!i(e,"ACCESSORS")&&e.ACCESSORS,s=i(e,0)?e[0]:u,l=i(e,1)?e[1]:void 0;return c[t]=!!n&&!o((function(){if(f&&!r)return!0;var t={length:-1};f?a(t,1,{enumerable:!0,get:u}):t[1]=1,n.call(t,s,l)}))}},ae93:function(t,e,n){"use strict";var r,o,i,a=n("e163"),c=n("9112"),u=n("5135"),f=n("b622"),s=n("c430"),l=f("iterator"),d=!1,p=function(){return this};[].keys&&(i=[].keys(),"next"in i?(o=a(a(i)),o!==Object.prototype&&(r=o)):d=!0),void 0==r&&(r={}),s||u(r,l)||c(r,l,p),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:d}},b575:function(t,e,n){var r,o,i,a,c,u,f,s,l=n("da84"),d=n("06cf").f,p=n("2cf4").set,v=n("1cdc"),h=n("605d"),y=l.MutationObserver||l.WebKitMutationObserver,b=l.document,g=l.process,x=l.Promise,w=d(l,"queueMicrotask"),m=w&&w.value;m||(r=function(){var t,e;h&&(t=g.domain)&&t.exit();while(o){e=o.fn,o=o.next;try{e()}catch(n){throw o?a():i=void 0,n}}i=void 0,t&&t.enter()},!v&&!h&&y&&b?(c=!0,u=b.createTextNode(""),new y(r).observe(u,{characterData:!0}),a=function(){u.data=c=!c}):x&&x.resolve?(f=x.resolve(void 0),s=f.then,a=function(){s.call(f,r)}):a=h?function(){g.nextTick(r)}:function(){p.call(l,r)}),t.exports=m||function(t){var e={fn:t,next:void 0};i&&(i.next=e),o||(o=e,a()),i=e}},b622:function(t,e,n){var r=n("da84"),o=n("5692"),i=n("5135"),a=n("90e3"),c=n("4930"),u=n("fdbf"),f=o("wks"),s=r.Symbol,l=u?s:s&&s.withoutSetter||a;t.exports=function(t){return i(f,t)||(c&&i(s,t)?f[t]=s[t]:f[t]=l("Symbol."+t)),f[t]}},b727:function(t,e,n){var r=n("0366"),o=n("44ad"),i=n("7b0b"),a=n("50c4"),c=n("65f0"),u=[].push,f=function(t){var e=1==t,n=2==t,f=3==t,s=4==t,l=6==t,d=7==t,p=5==t||l;return function(v,h,y,b){for(var g,x,w=i(v),m=o(w),E=r(h,y,3),S=a(m.length),T=0,A=b||c,O=e?A(v,S):n||d?A(v,0):void 0;S>T;T++)if((p||T in m)&&(g=m[T],x=E(g,T,w),t))if(e)O[T]=x;else if(x)switch(t){case 3:return!0;case 5:return g;case 6:return T;case 2:u.call(O,g)}else switch(t){case 4:return!1;case 7:u.call(O,g)}return l?-1:f||s?s:O}};t.exports={forEach:f(0),map:f(1),filter:f(2),some:f(3),every:f(4),find:f(5),findIndex:f(6),filterOut:f(7)}},bd92:function(t,e,n){"use strict";var r=n("41fa"),o=n("091d"),i=n("e51f");function a(t){var e,n=0,a="";while(!e)a+=i(o,r.get(),1),e=t<Math.pow(16,n+1),n++;return a}t.exports=a},c04e:function(t,e,n){var r=n("861d");t.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can\'t convert object to primitive value")}},c430:function(t,e){t.exports=!1},c6b6:function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},c6cd:function(t,e,n){var r=n("da84"),o=n("ce4e"),i="__core-js_shared__",a=r[i]||o(i,{});t.exports=a},c8ba:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}t.exports=n},c975:function(t,e,n){"use strict";var r=n("23e7"),o=n("4d64").indexOf,i=n("a640"),a=n("ae40"),c=[].indexOf,u=!!c&&1/[1].indexOf(1,-0)<0,f=i("indexOf"),s=a("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:u||!f||!s},{indexOf:function(t){return u?c.apply(this,arguments)||0:o(this,t,arguments.length>1?arguments[1]:void 0)}})},ca84:function(t,e,n){var r=n("5135"),o=n("fc6a"),i=n("4d64").indexOf,a=n("d012");t.exports=function(t,e){var n,c=o(t),u=0,f=[];for(n in c)!r(a,n)&&r(c,n)&&f.push(n);while(e.length>u)r(c,n=e[u++])&&(~i(f,n)||f.push(n));return f}},cc12:function(t,e,n){var r=n("da84"),o=n("861d"),i=r.document,a=o(i)&&o(i.createElement);t.exports=function(t){return a?i.createElement(t):{}}},cdf9:function(t,e,n){var r=n("825a"),o=n("861d"),i=n("f069");t.exports=function(t,e){if(r(t),o(e)&&e.constructor===t)return e;var n=i.f(t),a=n.resolve;return a(e),n.promise}},ce4e:function(t,e,n){var r=n("da84"),o=n("9112");t.exports=function(t,e){try{o(r,t,e)}catch(n){r[t]=e}return e}},d012:function(t,e){t.exports={}},d039:function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},d066:function(t,e,n){var r=n("428f"),o=n("da84"),i=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?i(r[t])||i(o[t]):r[t]&&r[t][e]||o[t]&&o[t][e]}},d1e7:function(t,e,n){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);e.f=i?function(t){var e=o(this,t);return!!e&&e.enumerable}:r},d2bb:function(t,e,n){var r=n("825a"),o=n("3bbe");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set,t.call(n,[]),e=n instanceof Array}catch(i){}return function(n,i){return r(n),o(i),e?t.call(n,i):n.__proto__=i,n}}():void 0)},d44e:function(t,e,n){var r=n("9bf2").f,o=n("5135"),i=n("b622"),a=i("toStringTag");t.exports=function(t,e,n){t&&!o(t=n?t:t.prototype,a)&&r(t,a,{configurable:!0,value:e})}},d784:function(t,e,n){"use strict";n("ac1f");var r=n("6eeb"),o=n("d039"),i=n("b622"),a=n("9263"),c=n("9112"),u=i("species"),f=!o((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),s=function(){return"$0"==="a".replace(/./,"$0")}(),l=i("replace"),d=function(){return!!/./[l]&&""===/./[l]("a","$0")}(),p=!o((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));t.exports=function(t,e,n,l){var v=i(t),h=!o((function(){var e={};return e[v]=function(){return 7},7!=""[t](e)})),y=h&&!o((function(){var e=!1,n=/a/;return"split"===t&&(n={},n.constructor={},n.constructor[u]=function(){return n},n.flags="",n[v]=/./[v]),n.exec=function(){return e=!0,null},n[v](""),!e}));if(!h||!y||"replace"===t&&(!f||!s||d)||"split"===t&&!p){var b=/./[v],g=n(v,""[t],(function(t,e,n,r,o){return e.exec===a?h&&!o?{done:!0,value:b.call(e,n,r)}:{done:!0,value:t.call(n,e,r)}:{done:!1}}),{REPLACE_KEEPS_$0:s,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:d}),x=g[0],w=g[1];r(String.prototype,t,x),r(RegExp.prototype,v,2==e?function(t,e){return w.call(t,this,e)}:function(t){return w.call(t,this)})}l&&c(RegExp.prototype[v],"sham",!0)}},da84:function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,n("c8ba"))},dd14:function(t,e,n){"use strict";var r=n("41fa");function o(t){if(!t||"string"!==typeof t||t.length<6)return!1;var e=new RegExp("[^"+r.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g,"\\\\$&")+"]");return!e.test(t)}t.exports=o},ddb0:function(t,e,n){var r=n("da84"),o=n("fdbc"),i=n("e260"),a=n("9112"),c=n("b622"),u=c("iterator"),f=c("toStringTag"),s=i.values;for(var l in o){var d=r[l],p=d&&d.prototype;if(p){if(p[u]!==s)try{a(p,u,s)}catch(h){p[u]=s}if(p[f]||a(p,f,l),o[l])for(var v in i)if(p[v]!==i[v])try{a(p,v,i[v])}catch(h){p[v]=i[v]}}}},df75:function(t,e,n){var r=n("ca84"),o=n("7839");t.exports=Object.keys||function(t){return r(t,o)}},e163:function(t,e,n){var r=n("5135"),o=n("7b0b"),i=n("f772"),a=n("e177"),c=i("IE_PROTO"),u=Object.prototype;t.exports=a?Object.getPrototypeOf:function(t){return t=o(t),r(t,c)?t[c]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},e177:function(t,e,n){var r=n("d039");t.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},e260:function(t,e,n){"use strict";var r=n("fc6a"),o=n("44d2"),i=n("3f8c"),a=n("69f3"),c=n("7dd0"),u="Array Iterator",f=a.set,s=a.getterFor(u);t.exports=c(Array,"Array",(function(t,e){f(this,{type:u,target:r(t),index:0,kind:e})}),(function(){var t=s(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values"),i.Arguments=i.Array,o("keys"),o("values"),o("entries")},e2cc:function(t,e,n){var r=n("6eeb");t.exports=function(t,e,n){for(var o in e)r(t,o,e[o],n);return t}},e51f:function(t,e){t.exports=function(t,e,n){var r=(2<<Math.log(e.length-1)/Math.LN2)-1,o=-~(1.6*r*n/e.length),i="";while(1){var a=t(o),c=o;while(c--)if(i+=e[a[c]&r]||"",i.length===+n)return i}}},e667:function(t,e){t.exports=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}}},e6cf:function(t,e,n){"use strict";var r,o,i,a,c=n("23e7"),u=n("c430"),f=n("da84"),s=n("d066"),l=n("fea9"),d=n("6eeb"),p=n("e2cc"),v=n("d44e"),h=n("2626"),y=n("861d"),b=n("1c0b"),g=n("19aa"),x=n("8925"),w=n("2266"),m=n("1c7e"),E=n("4840"),S=n("2cf4").set,T=n("b575"),A=n("cdf9"),O=n("44de"),R=n("f069"),L=n("e667"),P=n("69f3"),I=n("94ca"),j=n("b622"),M=n("605d"),k=n("2d00"),C=j("species"),_="Promise",F=P.get,U=P.set,D=P.getterFor(_),N=l,V=f.TypeError,W=f.document,B=f.process,Y=s("fetch"),G=R.f,$=G,H=!!(W&&W.createEvent&&f.dispatchEvent),q="function"==typeof PromiseRejectionEvent,X="unhandledrejection",K="rejectionhandled",z=0,J=1,Q=2,Z=1,tt=2,et=I(_,(function(){var t=x(N)!==String(N);if(!t){if(66===k)return!0;if(!M&&!q)return!0}if(u&&!N.prototype["finally"])return!0;if(k>=51&&/native code/.test(N))return!1;var e=N.resolve(1),n=function(t){t((function(){}),(function(){}))},r=e.constructor={};return r[C]=n,!(e.then((function(){}))instanceof n)})),nt=et||!m((function(t){N.all(t)["catch"]((function(){}))})),rt=function(t){var e;return!(!y(t)||"function"!=typeof(e=t.then))&&e},ot=function(t,e){if(!t.notified){t.notified=!0;var n=t.reactions;T((function(){var r=t.value,o=t.state==J,i=0;while(n.length>i){var a,c,u,f=n[i++],s=o?f.ok:f.fail,l=f.resolve,d=f.reject,p=f.domain;try{s?(o||(t.rejection===tt&&ut(t),t.rejection=Z),!0===s?a=r:(p&&p.enter(),a=s(r),p&&(p.exit(),u=!0)),a===f.promise?d(V("Promise-chain cycle")):(c=rt(a))?c.call(a,l,d):l(a)):d(r)}catch(v){p&&!u&&p.exit(),d(v)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&at(t)}))}},it=function(t,e,n){var r,o;H?(r=W.createEvent("Event"),r.promise=e,r.reason=n,r.initEvent(t,!1,!0),f.dispatchEvent(r)):r={promise:e,reason:n},!q&&(o=f["on"+t])?o(r):t===X&&O("Unhandled promise rejection",n)},at=function(t){S.call(f,(function(){var e,n=t.facade,r=t.value,o=ct(t);if(o&&(e=L((function(){M?B.emit("unhandledRejection",r,n):it(X,n,r)})),t.rejection=M||ct(t)?tt:Z,e.error))throw e.value}))},ct=function(t){return t.rejection!==Z&&!t.parent},ut=function(t){S.call(f,(function(){var e=t.facade;M?B.emit("rejectionHandled",e):it(K,e,t.value)}))},ft=function(t,e,n){return function(r){t(e,r,n)}},st=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=Q,ot(t,!0))},lt=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw V("Promise can\'t be resolved itself");var r=rt(e);r?T((function(){var n={done:!1};try{r.call(e,ft(lt,n,t),ft(st,n,t))}catch(o){st(n,o,t)}})):(t.value=e,t.state=J,ot(t,!1))}catch(o){st({done:!1},o,t)}}};et&&(N=function(t){g(this,N,_),b(t),r.call(this);var e=F(this);try{t(ft(lt,e),ft(st,e))}catch(n){st(e,n)}},r=function(t){U(this,{type:_,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:z,value:void 0})},r.prototype=p(N.prototype,{then:function(t,e){var n=D(this),r=G(E(this,N));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=M?B.domain:void 0,n.parent=!0,n.reactions.push(r),n.state!=z&&ot(n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new r,e=F(t);this.promise=t,this.resolve=ft(lt,e),this.reject=ft(st,e)},R.f=G=function(t){return t===N||t===i?new o(t):$(t)},u||"function"!=typeof l||(a=l.prototype.then,d(l.prototype,"then",(function(t,e){var n=this;return new N((function(t,e){a.call(n,t,e)})).then(t,e)}),{unsafe:!0}),"function"==typeof Y&&c({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return A(N,Y.apply(f,arguments))}}))),c({global:!0,wrap:!0,forced:et},{Promise:N}),v(N,_,!1,!0),h(_),i=s(_),c({target:_,stat:!0,forced:et},{reject:function(t){var e=G(this);return e.reject.call(void 0,t),e.promise}}),c({target:_,stat:!0,forced:u||et},{resolve:function(t){return A(u&&this===i?N:this,t)}}),c({target:_,stat:!0,forced:nt},{all:function(t){var e=this,n=G(e),r=n.resolve,o=n.reject,i=L((function(){var n=b(e.resolve),i=[],a=0,c=1;w(t,(function(t){var u=a++,f=!1;i.push(void 0),c++,n.call(e,t).then((function(t){f||(f=!0,i[u]=t,--c||r(i))}),o)})),--c||r(i)}));return i.error&&o(i.value),n.promise},race:function(t){var e=this,n=G(e),r=n.reject,o=L((function(){var o=b(e.resolve);w(t,(function(t){o.call(e,t).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}})},e893:function(t,e,n){var r=n("5135"),o=n("56ef"),i=n("06cf"),a=n("9bf2");t.exports=function(t,e){for(var n=o(e),c=a.f,u=i.f,f=0;f<n.length;f++){var s=n[f];r(t,s)||c(t,s,u(e,s))}}},e8b5:function(t,e,n){var r=n("c6b6");t.exports=Array.isArray||function(t){return"Array"==r(t)}},e95a:function(t,e,n){var r=n("b622"),o=n("3f8c"),i=r("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||a[i]===t)}},ebb5:function(t,e,n){"use strict";var r,o=n("a981"),i=n("83ab"),a=n("da84"),c=n("861d"),u=n("5135"),f=n("f5df"),s=n("9112"),l=n("6eeb"),d=n("9bf2").f,p=n("e163"),v=n("d2bb"),h=n("b622"),y=n("90e3"),b=a.Int8Array,g=b&&b.prototype,x=a.Uint8ClampedArray,w=x&&x.prototype,m=b&&p(b),E=g&&p(g),S=Object.prototype,T=S.isPrototypeOf,A=h("toStringTag"),O=y("TYPED_ARRAY_TAG"),R=o&&!!v&&"Opera"!==f(a.opera),L=!1,P={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},I={BigInt64Array:8,BigUint64Array:8},j=function(t){if(!c(t))return!1;var e=f(t);return"DataView"===e||u(P,e)||u(I,e)},M=function(t){if(!c(t))return!1;var e=f(t);return u(P,e)||u(I,e)},k=function(t){if(M(t))return t;throw TypeError("Target is not a typed array")},C=function(t){if(v){if(T.call(m,t))return t}else for(var e in P)if(u(P,r)){var n=a[e];if(n&&(t===n||T.call(n,t)))return t}throw TypeError("Target is not a typed array constructor")},_=function(t,e,n){if(i){if(n)for(var r in P){var o=a[r];o&&u(o.prototype,t)&&delete o.prototype[t]}E[t]&&!n||l(E,t,n?e:R&&g[t]||e)}},F=function(t,e,n){var r,o;if(i){if(v){if(n)for(r in P)o=a[r],o&&u(o,t)&&delete o[t];if(m[t]&&!n)return;try{return l(m,t,n?e:R&&b[t]||e)}catch(c){}}for(r in P)o=a[r],!o||o[t]&&!n||l(o,t,e)}};for(r in P)a[r]||(R=!1);if((!R||"function"!=typeof m||m===Function.prototype)&&(m=function(){throw TypeError("Incorrect invocation")},R))for(r in P)a[r]&&v(a[r],m);if((!R||!E||E===S)&&(E=m.prototype,R))for(r in P)a[r]&&v(a[r].prototype,E);if(R&&p(w)!==E&&v(w,E),i&&!u(E,A))for(r in L=!0,d(E,A,{get:function(){return c(this)?this[O]:void 0}}),P)a[r]&&s(a[r],O,r);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:R,TYPED_ARRAY_TAG:L&&O,aTypedArray:k,aTypedArrayConstructor:C,exportTypedArrayMethod:_,exportTypedArrayStaticMethod:F,isView:j,isTypedArray:M,TypedArray:m,TypedArrayPrototype:E}},f069:function(t,e,n){"use strict";var r=n("1c0b"),o=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=r(e),this.reject=r(n)};t.exports.f=function(t){return new o(t)}},f5df:function(t,e,n){var r=n("00ee"),o=n("c6b6"),i=n("b622"),a=i("toStringTag"),c="Arguments"==o(function(){return arguments}()),u=function(t,e){try{return t[e]}catch(n){}};t.exports=r?o:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=u(e=Object(t),a))?n:c?o(e):"Object"==(r=o(e))&&"function"==typeof e.callee?"Arguments":r}},f772:function(t,e,n){var r=n("5692"),o=n("90e3"),i=r("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},f8cd:function(t,e,n){var r=n("a691");t.exports=function(t){var e=r(t);if(e<0)throw RangeError("The argument can\'t be less than 0");return e}},fc6a:function(t,e,n){var r=n("44ad"),o=n("1d80");t.exports=function(t){return r(o(t))}},fdbc:function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},fdbf:function(t,e,n){var r=n("4930");t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},fea9:function(t,e,n){var r=n("da84");t.exports=r.Promise}});',"Worker",void 0,r.p+"js/offcanvas.worker.f5da1f64.worker.js")}var Kn={name:"MiniPlayer",components:{},props:{canvasObjs:{type:Array,require:!0},scaleRate:{type:Number},title:{type:String},stages:{type:Array},bgColor:{type:String},cursor:{type:Boolean,default:!1},size:{type:Array,default(){return[900,506]}}},data(){return{currentTs:0,framesData:{},height:0,stoped:!1}},computed:{width(){return Math.round(this.size[0])},wrapHeight(){return Math.round(this.size[1]>450?this.size[1]:450)},layerContainerHeight(){return"height:"+this.wrapHeight*this.scaleRate+"px;"},canvasW(){return this.width*window.devicePixelRatio*this.scaleRate},canvasH(){return this.height*window.devicePixelRatio*this.scaleRate},layerStyle(){return"width:"+this.width*this.scaleRate+"px;height:"+this.height*this.scaleRate+"px;"},captureLayerStyle(){return"width:"+this.width+"px;height:"+this.wrapHeight+"px;"},captureH(){return this.wrapHeight*window.devicePixelRatio*this.scaleRate}},created(){this.height=this.wrapHeight,this.imageDict={}},mounted(){const t=new Xn;t.onmessage=t=>{if("mini"===t.data.target){const{title:e,data:r}=t.data.payload;"SEND_COVER"===e?this.$emit("getCover",r):"CONVERT_DONE"===e?this.$emit("playover"):"CAPTURE_IMG"===e&&this.$emit("captureImg",r.imgData,[this.canvasW,this.canvasH],r.cts)}},this.canvasObjs.length&&this.preloadResource((()=>{try{this.initOffscreenCanvas(t)}catch(e){this.$emit("error","浏览器不支持离线画布，请使用外部浏览器")}t.postMessage({code:"GET_COVER",payload:{title:this.title||"未命名"}}),t.postMessage({code:"START_CONVERT",payload:this.canvasObjs})}))},beforeDestroy(){this.currentTs&&this.clock&&this.clock.cancel()},methods:{initOffscreenCanvas(t){const e=this.$refs.captureLayer.transferControlToOffscreen(),r=this.$refs.fakeLayer.transferControlToOffscreen(),n=this.$refs.stageLayer.transferControlToOffscreen(),a=this.$refs.displayLayer.transferControlToOffscreen(),i=this.$refs.syncLayer.transferControlToOffscreen();t.postMessage({code:"INIT_LAYER",payload:{captureLayer:e,fakeLayer:r,stageLayer:n,displayLayer:a,syncLayer:i,bgColor:this.bgColor,scaleRate:this.scaleRate,devicePixelRatio:window.devicePixelRatio,width:this.width,height:this.height,canvasW:this.canvasW,canvasH:this.canvasH,captureH:this.captureH,stages:this.stages,imageDict:this.imageDict,enableCursor:this.cursor}},[e,r,n,a,i])},preloadStage(t,e){return new Promise(((r,n)=>{if(this.imageDict[e])r(this.imageDict[e]);else{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{createImageBitmap(n).then((t=>{this.imageDict[e]=t,r(this.imageDict[e])}))},n.src=Wr(t.url)}}))},async preloadResource(t){let e=0;for(const r of this.stages)r.bg&&(r.bg.h>this.height&&(e=r.bg.h),await this.preloadStage(r.bg,r.id));e>this.height&&(this.height=e),this.$nextTick(t)}}},Jn=Kn,Zn=(r("44e8"),Object(g["a"])(Jn,zn,Qn,!1,null,"5e4ebfdf",null)),ta=Zn.exports,ea=(r("c19f"),r("cfc3"),r("4a9b"),function(t){this.data=new Uint8Array(t),this.pos=0});ea.prototype.seek=function(t){this.pos=t},ea.prototype.writeBytes=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t[e]},ea.prototype.writeByte=function(t){this.data[this.pos++]=t},ea.prototype.writeU8=ea.prototype.writeByte,ea.prototype.writeU16BE=function(t){this.data[this.pos++]=t>>8,this.data[this.pos++]=t},ea.prototype.writeDoubleBE=function(t){for(var e=new Uint8Array(new Float64Array([t]).buffer),r=e.length-1;r>=0;r--)this.writeByte(e[r])},ea.prototype.writeFloatBE=function(t){for(var e=new Uint8Array(new Float32Array([t]).buffer),r=e.length-1;r>=0;r--)this.writeByte(e[r])},ea.prototype.writeString=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t.charCodeAt(e)},ea.prototype.writeEBMLVarIntWidth=function(t,e){switch(e){case 1:this.writeU8(128|t);break;case 2:this.writeU8(64|t>>8),this.writeU8(t);break;case 3:this.writeU8(32|t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 4:this.writeU8(16|t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 5:this.writeU8(8|t/4294967296&7),this.writeU8(t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;default:throw new RuntimeException("Bad EBML VINT size "+e)}},ea.prototype.measureEBMLVarInt=function(t){if(t<127)return 1;if(t<16383)return 2;if(t<2097151)return 3;if(t<268435455)return 4;if(t<34359738367)return 5;throw new RuntimeException("EBML VINT size not supported "+t)},ea.prototype.writeEBMLVarInt=function(t){this.writeEBMLVarIntWidth(t,this.measureEBMLVarInt(t))},ea.prototype.writeUnsignedIntBE=function(t,e){switch(void 0===e&&(e=this.measureUnsignedInt(t)),e){case 5:this.writeU8(Math.floor(t/4294967296));case 4:this.writeU8(t>>24);case 3:this.writeU8(t>>16);case 2:this.writeU8(t>>8);case 1:this.writeU8(t);break;default:throw new RuntimeException("Bad UINT size "+e)}},ea.prototype.measureUnsignedInt=function(t){return t<256?1:t<65536?2:t<1<<24?3:t<4294967296?4:5},ea.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayBufferDataStream's pos lies beyond end of buffer"};var ra=ea,na=r("ad16"),aa=function(t,e){function r(t,e){var r={};return[t,e].forEach((function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e])})),r}function n(t){return!("string"!==typeof t||!t.match(/^data:image\/webp;base64,/i))&&window.atob(t.substring("data:image/webp;base64,".length))}function a(t,e){var r=t.toDataURL("image/webp",e);return n(r)}function i(t){var e=t.indexOf("VP8 ");if(-1==e)throw"Failed to identify beginning of keyframe in WebP image";return e+="VP8 ".length+4,t.substring(e)}function o(t){this.value=t}function s(t){this.value=t}function c(t,e,r){if(Array.isArray(r))for(var n=0;n<r.length;n++)c(t,e,r[n]);else if("string"===typeof r)t.writeString(r);else if(r instanceof Uint8Array)t.writeBytes(r);else{if(!r.id)throw"Bad EBML datatype "+typeof r.data;var a,i,l;if(r.offset=t.pos+e,t.writeUnsignedIntBE(r.id),Array.isArray(r.data))-1===r.size?t.writeByte(255):(a=t.pos,t.writeBytes([0,0,0,0])),i=t.pos,r.dataOffset=i+e,c(t,e,r.data),-1!==r.size&&(l=t.pos,r.size=l-i,t.seek(a),t.writeEBMLVarIntWidth(r.size,4),t.seek(l));else if("string"===typeof r.data)t.writeEBMLVarInt(r.data.length),r.dataOffset=t.pos+e,t.writeString(r.data);else if("number"===typeof r.data)r.size||(r.size=t.measureUnsignedInt(r.data)),t.writeEBMLVarInt(r.size),r.dataOffset=t.pos+e,t.writeUnsignedIntBE(r.data,r.size);else if(r.data instanceof s)t.writeEBMLVarInt(8),r.dataOffset=t.pos+e,t.writeDoubleBE(r.data.value);else if(r.data instanceof o)t.writeEBMLVarInt(4),r.dataOffset=t.pos+e,t.writeFloatBE(r.data.value);else{if(!(r.data instanceof Uint8Array))throw"Bad EBML datatype "+typeof r.data;t.writeEBMLVarInt(r.data.byteLength),r.dataOffset=t.pos+e,t.writeBytes(r.data)}}}return function(o){var l,u,f,d,h=5e3,p=1,v=!1,g=[],y=0,m=0,b={quality:.95,fileWriter:null,fd:null,frameDuration:null,frameRate:null},w={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},C={id:17545,data:new s(0)},x=[],_=new e(o.fileWriter||o.fd);function S(t){return t-f.dataOffset}function E(){var t={id:21420,size:5,data:0},e={id:290298740,data:[]};for(var r in w){var n=w[r];n.positionEBML=Object.create(t),e.data.push({id:19899,data:[{id:21419,data:n.id},n.positionEBML]})}return e}function T(){d=E();var e={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},r={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},C]},n={id:374648427,data:[{id:174,data:[{id:215,data:p},{id:29637,data:p},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:[{id:176,data:l},{id:186,data:u}]}]}]};f={id:408125543,size:-1,data:[d,r,n]};var a=new t(256);c(a,_.pos,[e,f]),_.write(a.getAsDataArray()),w.SegmentInfo.positionEBML.data=S(r.offset),w.Tracks.positionEBML.data=S(n.offset)}function L(e){var r=new t(4);if(!(e.trackNumber>0&&e.trackNumber<127))throw"TrackNumber must be > 0 and < 127";return r.writeEBMLVarInt(e.trackNumber),r.writeU16BE(e.timecode),r.writeByte(128),{id:163,data:[r.getAsDataArray(),e.frame]}}function R(t){return{id:524531317,data:[{id:231,data:Math.round(t.timecode)}]}}function P(t,e,r){x.push({id:187,data:[{id:179,data:e},{id:183,data:[{id:247,data:t},{id:241,data:S(r)}]}]})}function k(){var e={id:475249515,data:x},r=new t(16+32*x.length);c(r,_.pos,e),_.write(r.getAsDataArray()),w.Cues.positionEBML.data=S(e.offset)}function A(){if(0!=g.length){for(var e=0,r=0;r<g.length;r++)e+=g[r].frame.length;var n=new t(e+32*g.length),a=R({timecode:Math.round(y)});for(r=0;r<g.length;r++)a.data.push(L(g[r]));c(n,_.pos,a),_.write(n.getAsDataArray()),P(p,Math.round(y),a.offset),g=[],y+=m,m=0}}function O(){if(!o.frameDuration){if(!o.frameRate)throw"Missing required frameDuration or frameRate setting";o.frameDuration=1e3/o.frameRate}}function $(t){t.trackNumber=p,t.timecode=Math.round(m),g.push(t),m+=t.duration,m>=h&&A()}function I(){var e=new t(d.size),r=_.pos;c(e,d.dataOffset,d.data),_.seek(d.dataOffset),_.write(e.getAsDataArray()),_.seek(r)}function M(){var e=new t(8),r=_.pos;e.writeDoubleBE(y),_.seek(C.dataOffset),_.write(e.getAsDataArray()),_.seek(r)}this.addFrameData=function(t,e){if(v){if(e[0]!=l||e[1]!=u)throw"Frame size differs from previous frames"}else l=e[0],u=e[1],T(),v=!0;var r=n(t);if(!r)throw"Couldn't decode WebP frame, does the browser support WebP?";$({frame:i(r),duration:o.frameDuration})},this.addFrame=function(t){if(v){if(t.width!=l||t.height!=u)throw"Frame size differs from previous frames"}else l=t.width,u=t.height,T(),v=!0;var e=a(t,{quality:o.quality});if(!e)throw"Couldn't decode WebP frame, does the browser support WebP?";$({frame:i(e),duration:o.frameDuration})},this.complete=function(){return A(),k(),I(),M(),_.complete("video/webm")},this.getWrittenSize=function(){return _.length},o=r(b,o||{}),O()}},ia=aa(ra,na["a"]),oa=r("cdde"),sa={name:"VideoConvert",components:{Player:ta},data(){return{info:{t:"",unick:""},audioUrl:null,coverImg:"",canConvert:!1,scaleRate:1,bgColor:null,showUploadAlert:!1,exportUrl:"",playUrl:"",errMsg:""}},computed:{videoInfo(){return this.$store.getters.videoInfo},audioTrack(){return this.$store.getters.audioTrack},progress:{get(){return this.$store.getters.convertProgress},set(t){this.$store.commit("SET_CONVERT_PROGRESS",t)}},replyUrl:{get(){return this.$store.getters.replyUrl},set(t){this.$store.commit("SET_REPLY_URL",t)}}},created(){Rt.$on("vdc:download",(()=>{Z(this.info.id+"_up17.mp4",this.replyUrl)})),Rt.$on("vdc:upload",this.uploadToCloud)},beforeDestroy(){this.replyUrl=""},mounted(){this.ffmpeg=Object(Un["createFFmpeg"])(this.$q.platform.is.mobile?{mainName:"main",corePath:"https://unpkg.com/@ffmpeg/core-st@0.11.1/dist/ffmpeg-core.js"}:{corePath:"https://libiao.ubairn.com/js/ffmpeg-core.js",log:!0}),this.ffmpeg.setProgress((({ratio:t})=>{this.progress=this.progressText+Math.floor(100*t)+"%"}));const t=this.$route.query.file;if(t){if(this.$q.platform.is.mobile)return void alert("请前往PC端打开导出链接!");const e=Wr(jr+t);Object(Un["fetchFile"])(e).then((t=>{Nn.a.loadAsync(t).then((t=>{t.file("data.json").async("string").then((e=>{t.file("audio.ogg").async("arraybuffer").then((t=>{const r=new Blob([t],{type:"audio/ogg"});this.$store.commit("SET_AUDIO_TRACK",{url:URL.createObjectURL(r),blob:r}),this.$store.commit("SET_VIDEO_INFO",JSON.parse(e)),this.initData()}))}))}))}))}else this.$q.dialog({title:"提示",message:"是否需要给微课添加标题?",prompt:{model:"",type:"text"},cancel:{label:"跳过",color:"accent",flat:!0},persistent:!0}).onOk((t=>{this.$store.commit("UPDATE_VIDEO_INFO",{t:t})})).onDismiss(this.initData)},methods:{initWebmWriter(){this.encoder=new ia({quality:1,frameRate:10,fd:this.ffmpeg.FS("open",this.info.id+"2.webm","w+")})},async initData(){if(this.videoInfo){this.bgColor=this.videoInfo.cd.bgcolor,Rt.$emit("load:start","正在加载转码组件, 初次加载较慢");try{await this.ffmpeg.load()}catch(t){return this.errMsg=t,this.$q.platform.is.mobile?this.uploadToCloud():alert(t),void Rt.$emit("load:end")}this.info=this.videoInfo,this.initWebmWriter(),Rt.$emit("load:end"),this.canConvert=!0}},handlePlayerError(t){this.errMsg=t,this.uploadToCloud()},getCaptureImg(t,e,r){this.encoder.addFrameData(t,e),r<this.info.dur&&(this.progress="正在导出... "+Math.floor(100*r/this.info.dur)+" %")},handleOver(){this.encoder.complete().then((async t=>{const e=await this.downloadAudio2(),r=URL.createObjectURL(t);this.subtitles&&(this.progressText="正在生成字幕文件...",console.log(this.subtitles),this.ffmpeg.FS("writeFile",this.info.id+".srt",this.subtitles),this.ffmpeg.FS("mkdir","/fonts"),this.ffmpeg.FS("writeFile","/fonts/arial.ttf",await Object(Un["fetchFile"])("/fonts/arial.ttf"))),this.ffmpeg.FS("writeFile",this.info.id+".webm",await Object(Un["fetchFile"])(r)),this.output=`output_${this.info.id}.mp4`,this.progressText="正在合成视频...",await this.ffmpeg.run("-i",this.info.id+".webm","-i",e,this.output),this.subtitles&&(this.output="output2.mp4",await this.ffmpeg.run("-i","output.mp4","-vf","subtitles="+this.info.id+'.srt:fontsdir=/fonts:force_style="Fontname=Songti"',this.output));const n=this.ffmpeg.FS("readFile",this.output);this.progress=null,this.replyUrl=URL.createObjectURL(new Blob([n.buffer],{type:"video/mp4"})),this.$q.notify({type:"positive",message:"MP4视频导出完成"})}))},async combineAudios(t,e="m4a"){this.progressText="合并多个音频...";const r=`${this.info.id}_allin.${e}`;return await this.ffmpeg.run("-i",`concat:${t.join("|")}`,"-acodec","copy",r),this.progress="所有音频合并完成",t.forEach((t=>{this.ffmpeg.FS("unlink",t)})),r},downloadAudio2(t="m4a"){this.progressText="正在下载音频...";const e=`${this.info.id}.${t}`;return new Promise(((t,r)=>{X(this.audioTrack.blob).then((r=>{this.ffmpeg.FS("writeFile",e,new Uint8Array(r)),t(e)}))}))},uploadToCloud(){const t=new Nn.a;t.file("data.json",JSON.stringify(this.videoInfo)),t.file("audio.ogg",this.audioTrack.blob,{binary:!0}),t.generateAsync({type:"blob"}).then((t=>{Gr(t).then((t=>{this.exportUrl=window.location.href+"?file="+t.replace(jr,""),this.playUrl=window.location.origin+"/#/vd/"+t.replace(jr,""),this.showUploadAlert=!0}))}))},copyLink(t){Object(oa["a"])(t).then((()=>{this.$q.notify({type:"positive",message:"链接复制成功!"})})).catch((()=>{this.$q.notify({type:"negative",message:"不支持复制到粘贴板，请手动复制!"})}))}}},ca=sa,la=r("27f9"),ua=r("4b7e"),fa=Object(g["a"])(ca,Hn,Vn,!1,null,null,null),da=fa.exports;zt()(fa,"components",{QDialog:ar["a"],QCard:Se["a"],QCardSection:Ee["a"],QInput:la["a"],QCardActions:ua["a"],QBtn:qt["a"]});const ha=[{path:"/",component:or,children:[{path:"",name:"editor",component:bn},{path:"preview",name:"preview",component:In},{path:"/vd/:id",name:"video",component:Wn},{path:"/export",name:"exporter",component:da}]},{path:"*",component:()=>r.e(2).then(r.bind(null,"e51e"))}];var pa=ha;n["a"].use(Et["a"]);var va=function(){const t=new Et["a"]({scrollBehavior(t,e,r){return t.hash?{selector:t.hash}:r||{x:0,y:0}},routes:pa,mode:"hash",base:""});return t},ga=async function(){const t="function"===typeof St?await St({Vue:n["a"]}):St,e="function"===typeof va?await va({Vue:n["a"],store:t}):va;t.$router=e;const r={router:e,store:t,render:t=>t(m),el:"#q-app"};return{app:r,store:t,router:e}},ya=r("9483");Object(ya["a"])("service-worker.js",{ready(){},registered(){},cached(){},updatefound(){},updated(){},offline(){},error(){}});var ma=r("ef55"),ba=r.n(ma),wa=r("a925"),Ca={app:{cancelBtn:"Cancel",confirmBtn:"Confirm",requireLoginTip:"Please login your account",loading:"loading..."},account:{userLogin:"User Login",userRegister:"New User Register",email:"Email",pwd:"Password",nick:"Nickname",login:"Login",register:"Register"},editor:{recordStart:"Record",pause:"Pause",resume:"Resume",paused:"Paused",resumed:"Resumed",mywork:"My work",preference:"Preference",zan:"Appreciate",canvasPref:"Canvas",pencilPref:"Pencil",langPref:"Language",fullscreen:"Fullscreen",exitFullscreen:"Exit Fullscreen",blackboardMode:"Blackboard Mode",blackboardModeSub:"fit all frames",pencilT:"Pencil Tolerance",pencilTSub:"smaller better",feedback:"Feedback",viewFrameList:"Frame List",deleteCurFrame:"Remove Current Frame",pausedRecordTip:"Record Paused",recordResume:"Resume Record",canvasHTip:"Current canvas height limited to ",frameNo:"Page {cur} of {len}",recordNotSupport:"Current device does not support audio recording",graph:"Graph",legend:"Legend"},ctrlBar:{line:"Line",arrowLine:"Arrow Line",circle:"Circle",rect:"Rect",pen:"Pencil",shape:"Shape",eraser:"Eraser",undoErase:"Undo Last Erase",penWidth:"Pencil Width",penColor:"Pick Color",uploadPdf:"Upload PDF",opacity:"Opacity Mode",penWidthVal:"Current {px} pixel"},mywork:{title:"My Work",changeAccount:"Change Account",login:"Login",uploadLocal:"Upload Local Course",created:"Created"},contact:{title:"Contact Me",guide:"User Guide"},preview:{title:"Preview",export:"Export MP4",upload:"Upload & Publish",save:"Save To Local",pubBtn:"Publish",pubFail:"Publish failed!"},worklist:{title:"Work List"},tasklist:{title:"Task List"},video:{download:"Download this video to local"},upyundelete:{title:"又拍云文件删除"},imageList:{title:"图片审核列表"}},xa={app:{cancelBtn:"取消",confirmBtn:"确定",requireLoginTip:"请先登录您的账号",loading:"加载中..."},account:{userLogin:"用户登录",userRegister:"新用户注册",email:"邮箱",pwd:"密码",nick:"昵称",login:"登录",register:"注册"},editor:{recordStart:"开始录制",pause:"暂停",resume:"继续",paused:"已暂停",resumed:"已继续",mywork:"我的微课",preference:"偏好设置",zan:"赞赏",canvasPref:"画布配置",langPref:"语言设置",fullscreen:"全屏显示",exitFullscreen:"退出全屏",pencilPref:"笔迹配置",blackboardMode:"模拟黑板背景",blackboardModeSub:"影响所有页面背景色",pencilT:"笔迹灵敏度",pencilTSub:"越小越灵敏",feedback:"反馈",viewFrameList:"分页快速预览",deleteCurFrame:"删除当前页",pausedRecordTip:"已暂停录制",recordResume:"继续录制",canvasHTip:"当前画布录制高度限定为",frameNo:"第 {cur}/{len} 页",recordNotSupport:"当前设备不支持语音录制",graph:"图表",legend:"英雄志"},ctrlBar:{line:"直线",arrowLine:"箭头",circle:"圆形",rect:"矩形",pen:"画笔",shape:"作图",eraser:"橡皮擦",undoErase:"撤销擦除",penWidth:"画笔粗细",penColor:"画笔调色",uploadPdf:"上传课件",opacity:"荧光模式",penWidthVal:"当前 {px} 像素"},mywork:{title:"我的微课",changeAccount:"切换账号",login:"去登录",uploadLocal:"上传本地微课",created:"已创作"},contact:{title:"向作者反馈",guide:"用户指南"},preview:{title:"预览",export:"导出MP4",upload:"上传并发布",save:"保存到本地",pubBtn:"发布",pubFail:"发布失败"},worklist:{title:"作品列表"},tasklist:{title:"任务列表"},video:{download:"下载此微课到本地"},upyundelete:{title:"又拍云文件删除"},imageList:{title:"图片审核列表"}},_a={en:Ca,zh:xa},Sa=({app:t,router:e,store:r,Vue:n})=>{n.use(ba.a),n.use(wa["a"]);const a=new wa["a"]({locale:r.getters.preferences.lang,fallbackLocale:"zh",messages:_a});t.i18n=a;const i="0.1.1";console.log("debug ",!1),console.log("最新部署版本: ",i),r.getters.buildVersion!==i&&r.commit("SET_BUILD_VERSION",i),document.body.addEventListener("touchmove",(t=>{t.preventDefault()}))};n["a"].prototype.$axios=Or.a,/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&r.e(0).then(r.t.bind(null,"a0db",7));const Ea="";async function Ta(){const{app:t,store:e,router:r}=await ga();let a=!1;const i=t=>{a=!0;const e=Object(t)===t?r.resolve(t).route.fullPath:t;window.location.href=e},o=window.location.href.replace(window.location.origin,""),s=[Sa,void 0];for(let l=0;!1===a&&l<s.length;l++)if("function"===typeof s[l])try{await s[l]({app:t,router:r,store:e,Vue:n["a"],ssrContext:null,redirect:i,urlPath:o,publicPath:Ea})}catch(c){return c&&c.url?void(window.location.href=c.url):void console.error("[Quasar] boot error:",c)}!0!==a&&new n["a"](t)}Ta()},3:function(t,e){},"3cdd":function(t,e,r){"use strict";r("8be0")},4:function(t,e){},"44e8":function(t,e,r){"use strict";r("44fa")},"44fa":function(t,e,r){},5:function(t,e){},6:function(t,e){},7265:function(t,e,r){"use strict";r("2215")},"7e6d":function(t,e,r){},"8be0":function(t,e,r){},ad16:function(t,e,r){"use strict";(function(t){r("c19f"),r("ace4"),r("e6cf"),r("5cc6");var n=function(e){return function(r){var n=[],a=Promise.resolve(),i=null,o=null;function s(t){return new Promise((function(e,r){var n=new FileReader;n.addEventListener("loadend",(function(){e(n.result)})),n.readAsArrayBuffer(t)}))}function c(t){return new Promise((function(e,r){t instanceof Uint8Array?e(t):t instanceof ArrayBuffer||ArrayBuffer.isView(t)?e(new Uint8Array(t)):t instanceof Blob?e(s(t).then((function(t){return new Uint8Array(t)}))):e(s(new Blob([t])).then((function(t){return new Uint8Array(t)})))}))}function l(t){var e=t.byteLength||t.length||t.size;if(!Number.isInteger(e))throw"Failed to determine size of element";return e}"undefined"!==typeof FileWriter&&r instanceof FileWriter?i=r:e&&r&&(o=r),this.pos=0,this.length=0,this.seek=function(t){if(t<0)throw"Offset may not be negative";if(isNaN(t))throw"Offset may not be NaN";if(t>this.length)throw"Seeking beyond the end of file is not allowed";this.pos=t},this.write=function(r){var s={offset:this.pos,data:r,length:l(r)},u=s.offset>=this.length;this.pos+=s.length,this.length=Math.max(this.length,this.pos),a=a.then((function(){if(o)return new Promise((function(r,n){c(s.data).then((function(n){var a=0,i=t.from(n.buffer),c=function(t,n,i){a+=n,a>=i.length?r():e.write(o,i,a,i.length-a,s.offset+a,c)};e.write(o,i,0,i.length,s.offset,c)}))}));if(i)return new Promise((function(t,e){i.onwriteend=t,i.seek(s.offset),i.write(new Blob([s.data]))}));if(!u)for(var r=0;r<n.length;r++){var a=n[r];if(!(s.offset+s.length<=a.offset||s.offset>=a.offset+a.length)){if(s.offset<a.offset||s.offset+s.length>a.offset+a.length)throw new Error("Overwrite crosses blob boundaries");return s.offset==a.offset&&s.length==a.length?void(a.data=s.data):c(a.data).then((function(t){return a.data=t,c(s.data)})).then((function(t){s.data=t,a.data.set(s.data,s.offset-a.offset)}))}}n.push(s)}))},this.complete=function(t){return a=o||i?a.then((function(){return null})):a.then((function(){for(var e=[],r=0;r<n.length;r++)e.push(n[r].data);return new Blob(e,{mimeType:t})})),a}}};e["a"]=n(null)}).call(this,r("b639").Buffer)},bff1:function(t,e,r){},d048:function(t,e,r){"use strict";r("f6d0")},ed4e:function(t,e,r){"use strict";r("bff1")},f6d0:function(t,e,r){}});